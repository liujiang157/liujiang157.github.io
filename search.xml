<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>åŠ¨æ‰‹å®ç°ä¸€ä¸ªè¿·å®«æœºå™¨äºº</title>
      <link href="2021/09/23/%E5%8A%A8%E6%89%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E8%BF%B7%E5%AE%AB%E6%9C%BA%E5%99%A8%E4%BA%BA/"/>
      <url>2021/09/23/%E5%8A%A8%E6%89%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E8%BF%B7%E5%AE%AB%E6%9C%BA%E5%99%A8%E4%BA%BA/</url>
      
        <content type="html"><![CDATA[<p>å¾ˆä¹…æ²¡æœ‰äº§å‡ºï¼Œå›è¿‡å¤´æ¥çœ‹çœ‹è¿™äº›æ—¥å­ï¼Œå¥½åƒåˆæ²¡æœ‰ä»€ä¹ˆæœ‰è¶£çš„æŠ€æœ¯ç§¯ç´¯ã€‚çªç„¶æƒ³èµ·æ¥ä¹‹å‰å¸®æœ‹å‹åšäº†ä¸ªå°ä½œä¸šåšçš„ä¸€ä¸ªè¿·å®«æœºå™¨äººã€‚è™½ç„¶ä¸é«˜çº§ä½†æ˜¯è¿˜æ˜¯æŒºå¥½ç©çš„ã€‚ä¸‹é¢å°±ç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹è¿‡ç¨‹ã€‚</p><h3 id="åœ°å›¾ç»˜åˆ¶"><a href="#åœ°å›¾ç»˜åˆ¶" class="headerlink" title="åœ°å›¾ç»˜åˆ¶"></a>åœ°å›¾ç»˜åˆ¶</h3><p>é¦–å…ˆå®šä¹‰å‡ºåœ°å›¾çš„å®½å’Œé«˜ï¼Œåˆ©ç”¨ä¸€ä¸ªäºŒç»´æ•°ç»„æ¥ä¿å­˜åœ°å›¾çš„åœ°å½¢ã€‚ spawnMarker ç”¨äºå­˜å‚¨æœºå™¨äººå‡ºç”Ÿç‚¹ä½ç½®ã€‚ robots ç”¨äºå­˜æ”¾è¿·å®«ä¸­æœºå™¨äººçš„å½“å‰çŠ¶æ€ã€‚ controller ç”¨äºæ¥æ”¶é”®ç›˜/é¼ æ ‡äº‹ä»¶å¹¶ä¼ ç»™ Worldã€‚ Renderer ç”¨äºå°† 2D å­—ç¬¦åœ°å›¾æ¸²æŸ“æˆå›¾å½¢ã€‚ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">World</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> width, height;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">char</span>[][] terrain;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span> FIRST_TERRAIN = <span class="string">' '</span>, LAST_TERRAIN = <span class="string">'~'</span>; <span class="comment">//åœ°å›¾ä¸Šèƒ½å±•ç¤ºçš„ASCII æ–¹ä¾¿ç”¨äºæœºå™¨äººè¯´è¯</span></span><br><span class="line">    <span class="keyword">private</span> Position[] spawnMarker = <span class="keyword">new</span> Position[<span class="number">10</span>]; <span class="comment">//from digits 0 to 9</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Robot&gt; robots = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> Controller controller = <span class="keyword">new</span> Controller(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">private</span> Renderer renderer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> targetFrametime = <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> pause = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> currentFrame = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> pauseAtFrame = -<span class="number">1</span>; <span class="comment">//will pause if current frame equals this, set to &lt;0 to not use</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Method work, memoryToString;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°å·¥ä½œåšå®Œä¹‹åï¼Œæˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸‹å¦‚ä½•å°†ä¸‹é¢çš„ 2D å­—ç¬¦æ¸²æŸ“æˆå›¾æ¡ˆã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">String mazeMap =</span><br><span class="line"></span><br><span class="line">        <span class="string">"###################\n"</span> +</span><br><span class="line">        <span class="string">"#  0H  #   ##    #  $\n"</span> +</span><br><span class="line">        <span class="string">"#  #a ##   ## ## #  #\n"</span> +</span><br><span class="line">        <span class="string">"####p  # #     #   ##\n"</span> +</span><br><span class="line">        <span class="string">"#  yp  #    ## ##   #\n"</span> +</span><br><span class="line">        <span class="string">"#  #  Mid # ##Automn#\n"</span> +</span><br><span class="line">        <span class="string">"#####################"</span>;</span><br><span class="line"></span><br><span class="line">World world = <span class="keyword">new</span> World(mazeMap);</span><br><span class="line">Robot robot = makeMazeRunner();</span><br><span class="line">robot.spawnInWorld(world, <span class="string">'0'</span>);</span><br><span class="line">world.run();</span><br></pre></td></tr></table></figure><br>é¦–å…ˆé€šè¿‡ World çš„æ„é€ å‡½æ•°å°†åœ°å›¾æ•°æ®æ„å»ºå‡ºæ¥ï¼Œå¹¶æ”¾ç½®æœºå™¨äººå‡ºç”Ÿç‚¹ï¼Œå¹¶é»˜è®¤æ¸²æŸ“åœ°å›¾æ•°æ®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//constructs the world from the "2D" String</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">World</span><span class="params">(String mapData)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(mapData, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//you should probably leave shouldRender to true, otherwise you will not see anything</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">World</span><span class="params">(String mapData, <span class="keyword">boolean</span> shouldRender)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (shouldRender)</span><br><span class="line">        renderer = <span class="keyword">new</span> Renderer();</span><br><span class="line"></span><br><span class="line">    width = mapData.lines().mapToInt(String::length).max().orElseThrow();</span><br><span class="line">    height = (<span class="keyword">int</span>) mapData.lines().count();</span><br><span class="line"></span><br><span class="line">    terrain = <span class="keyword">new</span> <span class="keyword">char</span>[width][height];</span><br><span class="line">    String[] rows = mapData.lines().map(s -&gt; s + <span class="string">" "</span>.repeat(width - s.length())).toArray(String[]::<span class="keyword">new</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; height; y++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; width; x++) &#123;</span><br><span class="line">            <span class="keyword">char</span> c = rows[y].charAt(x);</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">'0'</span> &lt;= c &amp;&amp; c &lt;= <span class="string">'9'</span>)</span><br><span class="line">                spawnMarker[c - <span class="string">'0'</span>] = <span class="keyword">new</span> Position(x + <span class="number">0.5</span>, y + <span class="number">0.5</span>);</span><br><span class="line">            terrain[x][y] = c;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        work = Robot.class.getMethod("work");</span><br><span class="line">        memoryToString = Robot.class.getMethod("memoryToString");</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">        <span class="comment">/* student has not implemented these methods yet */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€é€šè¿‡ World çš„ run() æ–¹æ³•æ¥æ¸²æŸ“åœ°å›¾æ•°æ®ã€‚å…·ä½“çš„ Renderer ç±»ç»†èŠ‚å°±ä¸æè¿°äº†ï¼Œæ•´ä½“çš„æºç é“¾æ¥æˆ‘ä¼šè´´åœ¨æ–‡ç« ç»“å°¾ã€‚æ¸²æŸ“ååœ°å›¾å¤§è‡´æ˜¯è¿™ä¸ªæ ·å­ï¼š</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d196e480f3045208ff894b83f3dcf28~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>ä¿¯è§†å›¾æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d43f5c330f64457c82fe979e0cb5036a~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">public void run() &#123;</span><br><span class="line">    if(renderer !&#x3D; null)</span><br><span class="line">        renderer.setup();</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            if(renderer !&#x3D; null) &#123;</span><br><span class="line">                &#x2F;&#x2F; wait until unpaused</span><br><span class="line">                while (pause || currentFrame &#x3D;&#x3D; pauseAtFrame)</span><br><span class="line">                    Thread.sleep(50);</span><br><span class="line"></span><br><span class="line">                long before &#x3D; System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">                simulateFrame();</span><br><span class="line">                renderer.render();</span><br><span class="line"></span><br><span class="line">                long frametime &#x3D; System.currentTimeMillis() - before;</span><br><span class="line">                long sleepTime &#x3D; targetFrametime - frametime;</span><br><span class="line">                if (sleepTime &gt; 0)</span><br><span class="line">                    Thread.sleep(sleepTime);</span><br><span class="line">            &#125; else</span><br><span class="line">                simulateFrame();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">        &#x2F;* Intentionally left blank *&#x2F;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="è¿·å®«æœºå™¨äºº"><a href="#è¿·å®«æœºå™¨äºº" class="headerlink" title="è¿·å®«æœºå™¨äºº"></a>è¿·å®«æœºå™¨äºº</h3><p>æ¥ç€æˆ‘ä»¬æ¥çœ‹ Robot ç±»ã€‚æœºå™¨äººçš„å˜é‡ç›¸å¯¹è€Œè¨€å°±å˜å¾—æ¯”è¾ƒç®€å•ï¼Œname å’Œ size ç”¨äºæè¿°æœºå™¨äººçš„å§“åå¤§å°ã€‚ position ï¼Œdirection ï¼Œworld æè¿°æœºå™¨äººå½“å‰çŠ¶æ€ã€‚memory å’Œ sensors ç”¨äºå­˜å‚¨æœºå™¨äººçš„è®°å¿†å’Œæ„ŸçŸ¥ã€‚ todo å’Œ program ç”¨äºå­˜å‚¨æœºå™¨äººè¦åšçš„ä¸€ç³»åˆ—æŒ‡ä»¤ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Robot</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">double</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Position position = <span class="keyword">new</span> Position();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> direction;</span><br><span class="line">    <span class="keyword">private</span> World world;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// memory expand</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Memory&lt;?&gt;&gt; memory = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sensor expand</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Sensor&lt;?&gt;&gt; sensors = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Queue&lt;Command&gt; todo = <span class="keyword">new</span> ArrayDeque&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> Function&lt;Robot, List&lt;Command&gt;&gt; program = <span class="keyword">new</span> Function&lt;Robot, List&lt;Command&gt;&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;Command&gt; <span class="title">apply</span><span class="params">(Robot robot)</span> </span>&#123;</span><br><span class="line">            List&lt;Command&gt; commands = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            commands.addAll(todo);</span><br><span class="line">            <span class="keyword">return</span> commands;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ—¢ç„¶æœºå™¨äººè¦èµ°è¿·å®«ï¼Œé‚£èµ°å’Œè°ƒæ•´æ–¹å‘çš„æ–¹æ³•è‚¯å®šæ˜¯å¿…ä¸å¯å°‘çš„ã€‚è¿™é‡Œ turnBy è¡¨ç¤ºåœ¨å½“å‰æ–¹å‘ä¸Šé¢é¡ºå»¶å¤šå°‘è§’åº¦ï¼ŒturnTo è¡¨ç¤ºç›´æ¥è½¬å‘æ–°çš„æ–¹å‘ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Pre-programmed Commands</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">go</span><span class="params">(<span class="keyword">double</span> distance)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//step can be negative if the penguin walks backwards</span></span><br><span class="line">    <span class="keyword">double</span> sign = Math.signum(distance);</span><br><span class="line">    distance = Math.abs(distance);</span><br><span class="line">    <span class="comment">//penguin walks, each step being 0.2m</span></span><br><span class="line">    <span class="keyword">while</span> (distance &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        position.moveBy(sign * Math.min(distance, <span class="number">0.2</span>), direction);</span><br><span class="line">        world.resolveCollision(<span class="keyword">this</span>, position);</span><br><span class="line">        distance -= <span class="number">0.2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">turnBy</span><span class="params">(<span class="keyword">double</span> deltaDirection)</span> </span>&#123;</span><br><span class="line">    direction += deltaDirection;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">turnTo</span><span class="params">(<span class="keyword">double</span> newDirection)</span> </span>&#123;</span><br><span class="line">    direction = newDirection;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿™é‡Œè¿˜ç»™æœºå™¨äººåŠ äº†ä¸€ä¸ª say çš„æ–¹æ³•ï¼Œå› ä¸ºä¹‹å‰ World ä¸­å®šä¹‰äº†æœ‰ä¸€äº›å­—ç¬¦åœ¨åœ°å›¾ä¸­æ˜¯å¯ä»¥ç›´æ¥æ‰“å°å¹¶ä¸”ä¸è¢«æ¸²æŸ“çš„ã€‚å½“æœºå™¨äººèµ°åˆ°è¿™ä¸ªå­—ç¬¦ä¸Šï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿè®©æœºå™¨äººè¯´å‡ºè¿™ä¸ªå­—ç¬¦ã€‚å› ä¸ºæœ€åæ˜¯ä¸€ä¸ª gui çš„æ‰“å°æ‰€ä»¥è¿˜æ˜¯è°ƒç”¨äº† World ä¸­çš„ sayæ–¹æ³•æ¥æ¸²æŸ“è¿™ä¸ªå­—ç¬¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">say</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">    world.say(<span class="keyword">this</span>, text);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘è°ƒæ•´äº†ä¸€ä¸‹ ASCII çš„æ‰“å°èŒƒå›´ï¼Œè®©åœ°å›¾èƒ½å¤Ÿé¡ºåˆ©æ¸²æŸ“å‡ºä¸­ç§‹å¿«ä¹çš„æ–‡å­—ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæœºå™¨äººæ˜¯å¦‚ä½•è¯´å‡ºä¸­ç§‹å¿«ä¹çš„å§ï¼š</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5e73745b4c414870be7fdbf964704950~tplv-k3u1fbpfcp-watermark.image?" alt="ä¸­ç§‹2.gif"></p><p>æ¥ä¸‹æ¥å°±å¼€å§‹æˆ‘ä»¬æœ€é‡è¦çš„èµ°è¿·å®«ç¯èŠ‚å•¦ã€‚åœ¨ä¸çŸ¥é“è¿·å®«å¤æ‚åº¦çš„æƒ…å†µï¼Œåˆä¸èƒ½äººä¸ºé¢„è®¾è·¯çº¿ã€‚æ‰€ä»¥éœ€è¦æˆ‘ä»¬å¯¹äºæœªçŸ¥è·¯çº¿ï¼Œå¦‚ä½•è®©æœºå™¨äººåšå‡ºæ­£ç¡®æŒ‡ä»¤æœ‰ä¸€äº›æ€è€ƒã€‚</p><p>æˆ‘å½“æ—¶åº”è¯¥æ˜¯å‚è€ƒäº†è¿™ä¸ªå›¾ç‰‡ï¼Œä½†æ˜¯å…·ä½“çš„ç®—æ³•åº”è¯¥è¿˜æ˜¯ä¸è¿™ä¸ªæœ‰äº›å‡ºå…¥çš„ã€‚å¥ˆä½•è‡ªå·±æ²¡æœ‰åšæ³¨é‡Šï¼Œç°åœ¨éƒ½çœ‹ä¸æ‡‚å½“æ—¶æ˜¯æ€ä¹ˆæƒ³çš„äº†ã€‚æ‰€ä»¥ä½œä¸ºä¸€å coderï¼Œæ³¨é‡ŠçœŸçš„å¾ˆé‡è¦ï¼<br><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a470f6c1fe59404e9c180853594060a8~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>è¿™æ˜¯æˆ‘å½“æ—¶çš„ä»£ç ï¼Œæ¯”è¾ƒå¥½ç©çš„æ˜¯ï¼Œåªè¦åœ°å›¾æ˜¯å¯ä»¥é€šå‘ç»ˆç‚¹çš„ï¼Œå“ªæ€•åœ°å›¾å†…éƒ¨ä¸é€šï¼Œä½†æ˜¯å¤šä¸€ä¸ªå£ä»å¤–éƒ¨ä¹Ÿèƒ½è¿æ¥ç»ˆç‚¹ã€‚æœºå™¨äººä¹Ÿæ˜¯å¯ä»¥æ‰¾åˆ°ç»ˆç‚¹çš„ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Robot <span class="title">makeMazeRunner</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Robot panicPenguin = <span class="keyword">new</span> Robot(<span class="string">"Maze!"</span>, <span class="number">0</span>, <span class="number">0.5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create memory</span></span><br><span class="line">    Memory&lt;Character&gt; terrain = panicPenguin.createMemory(<span class="keyword">new</span> Memory&lt;&gt;(<span class="string">"terrain"</span>, <span class="string">'0'</span>));</span><br><span class="line">    Memory&lt;Character&gt; end = panicPenguin.createMemory(<span class="keyword">new</span> Memory&lt;&gt;(<span class="string">"end"</span>, <span class="string">'$'</span>));</span><br><span class="line">    <span class="comment">// create and attach sensors</span></span><br><span class="line">    panicPenguin.attachSensor(<span class="keyword">new</span> TerrainSensor().setProcessor(terrain::setData));</span><br><span class="line">    panicPenguin.attachSensor(<span class="keyword">new</span> TerrainSensor().setProcessor(end::setData));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// program the robot</span></span><br><span class="line">    panicPenguin.setProgram(robot -&gt; &#123;</span><br><span class="line">        Position position = robot.getPosition();</span><br><span class="line">        List&lt;Command&gt; commands = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Objects.equals(end.getData().toString(), <span class="string">"$"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> commands;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">switch</span> (dir) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">'#'</span> != robot.getWorld().getTerrain(position.x + <span class="number">1</span>, position.y)) &#123;</span><br><span class="line">                    commands.add(r -&gt; r.turnTo(<span class="number">0</span>));</span><br><span class="line">                    commands.add(r -&gt; r.say(terrain.getData().toString()));</span><br><span class="line">                    commands.add(r -&gt; r.go(<span class="number">1</span>));</span><br><span class="line">                    dir = <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">return</span> commands;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="string">'#'</span> != robot.getWorld().getTerrain(position.x, position.y - <span class="number">1</span>)) &#123;</span><br><span class="line">                        commands.add(r -&gt; r.turnTo(<span class="number">1.5</span> * Math.PI));</span><br><span class="line">                        commands.add(r -&gt; r.say(terrain.getData().toString()));</span><br><span class="line">                        commands.add(r -&gt; r.go(<span class="number">1</span>));</span><br><span class="line">                        <span class="keyword">return</span> commands;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        commands.add(r -&gt; r.turnTo(Math.PI));</span><br><span class="line">                        commands.add(r -&gt; r.say(terrain.getData().toString()));</span><br><span class="line">                        commands.add(r -&gt; r.go(<span class="number">1</span>));</span><br><span class="line">                        dir = <span class="number">3</span>;</span><br><span class="line">                        <span class="keyword">return</span> commands;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">'#'</span> != robot.getWorld().getTerrain(position.x, position.y + <span class="number">1</span>)) &#123;</span><br><span class="line">                    commands.add(r -&gt; r.turnTo(Math.PI * <span class="number">0.5</span>));</span><br><span class="line">                    commands.add(r -&gt; r.say(terrain.getData().toString()));</span><br><span class="line">                    commands.add(r -&gt; r.go(<span class="number">1</span>));</span><br><span class="line">                    dir = <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">return</span> commands;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="string">'#'</span> != robot.getWorld().getTerrain(position.x + <span class="number">1</span>, position.y)) &#123;</span><br><span class="line">                        commands.add(r -&gt; r.turnTo(<span class="number">0</span>));</span><br><span class="line">                        commands.add(r -&gt; r.say(terrain.getData().toString()));</span><br><span class="line">                        commands.add(r -&gt; r.go(<span class="number">1</span>));</span><br><span class="line">                        <span class="keyword">return</span> commands;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        commands.add(r -&gt; r.turnTo(<span class="number">1.5</span> * Math.PI));</span><br><span class="line">                        commands.add(r -&gt; r.say(terrain.getData().toString()));</span><br><span class="line">                        commands.add(r -&gt; r.go(<span class="number">1</span>));</span><br><span class="line">                        dir = <span class="number">0</span>;</span><br><span class="line">                        <span class="keyword">return</span> commands;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">'#'</span> != robot.getWorld().getTerrain(position.x - <span class="number">1</span>, position.y)) &#123;</span><br><span class="line">                    commands.add(r -&gt; r.turnTo(Math.PI));</span><br><span class="line">                    commands.add(r -&gt; r.say(terrain.getData().toString()));</span><br><span class="line">                    commands.add(r -&gt; r.go(<span class="number">1</span>));</span><br><span class="line">                    dir = <span class="number">3</span>;</span><br><span class="line">                    <span class="keyword">return</span> commands;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="string">'#'</span> != robot.getWorld().getTerrain(position.x, position.y + <span class="number">1</span>)) &#123;</span><br><span class="line">                        commands.add(r -&gt; r.turnTo(Math.PI * <span class="number">0.5</span>));</span><br><span class="line">                        commands.add(r -&gt; r.say(terrain.getData().toString()));</span><br><span class="line">                        commands.add(r -&gt; r.go(<span class="number">1</span>));</span><br><span class="line">                        <span class="keyword">return</span> commands;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        commands.add(r -&gt; r.turnTo(<span class="number">0</span>));</span><br><span class="line">                        commands.add(r -&gt; r.say(terrain.getData().toString()));</span><br><span class="line">                        commands.add(r -&gt; r.go(<span class="number">1</span>));</span><br><span class="line">                        dir = <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">return</span> commands;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">'#'</span> != robot.getWorld().getTerrain(position.x, position.y - <span class="number">1</span>)) &#123;</span><br><span class="line">                    commands.add(r -&gt; r.turnTo(<span class="number">1.5</span> * Math.PI));</span><br><span class="line">                    commands.add(r -&gt; r.say(terrain.getData().toString()));</span><br><span class="line">                    commands.add(r -&gt; r.go(<span class="number">1</span>));</span><br><span class="line">                    dir = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">return</span> commands;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="string">'#'</span> != robot.getWorld().getTerrain(position.x - <span class="number">1</span>, position.y)) &#123;</span><br><span class="line">                        commands.add(r -&gt; r.turnTo(Math.PI));</span><br><span class="line">                        commands.add(r -&gt; r.say(terrain.getData().toString()));</span><br><span class="line">                        commands.add(r -&gt; r.go(<span class="number">1</span>));</span><br><span class="line">                        <span class="keyword">return</span> commands;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        commands.add(r -&gt; r.turnTo(Math.PI * <span class="number">0.5</span>));</span><br><span class="line">                        commands.add(r -&gt; r.say(terrain.getData().toString()));</span><br><span class="line">                        commands.add(r -&gt; r.go(<span class="number">1</span>));</span><br><span class="line">                        dir = <span class="number">2</span>;</span><br><span class="line">                        <span class="keyword">return</span> commands;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> commands;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> panicPenguin;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ä¸‹é¢æ¥ä¸€èµ·çœ‹ä¸€ä¸‹å„ç§å¥½ç©çš„æ•ˆæœå›¾å§ã€‚</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cb6bbb97fa7e49f587711a508f7ed9ec~tplv-k3u1fbpfcp-watermark.image?" alt="ä¸­ç§‹.gif"></p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9624ee795bdd45e8a94b1f12279320c4~tplv-k3u1fbpfcp-watermark.image?" alt="ä¸­ç§‹3.gif"></p><h3 id="æºç é“¾æ¥"><a href="#æºç é“¾æ¥" class="headerlink" title="æºç é“¾æ¥"></a>æºç é“¾æ¥</h3><p><a href="https://github.com/liujiang157/Maze" target="_blank" rel="noopener">æºç é“¾æ¥</a>ï¼Œç¥å¤§å®¶ğŸ¥®èŠ‚å¿«ä¹~</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Quarkusä¸Spring bootæ€§èƒ½å¯¹æ¯”</title>
      <link href="2021/04/20/Quarkus%E4%B8%8ESpring-boot%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94/"/>
      <url>2021/04/20/Quarkus%E4%B8%8ESpring-boot%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94/</url>
      
        <content type="html"><![CDATA[<p>ç›®å‰å¸‚åœºä¸Šä¸»æµçš„æ¡†æ¶åŸºæœ¬éƒ½æ˜¯ <code>Spring</code> å…¨å®¶æ¡¶ç³»åˆ—ï¼Œ <code>Srping</code> çš„ç”Ÿæ€å®Œå–„ä¹Ÿæ˜¯ä¼—å¤šå¼€å‘è€…éå¸¸é’çè¿™ä¸ªæ¡†æ¶çš„åŸå› ä¹‹ä¸€ã€‚ä½†æ˜¯æˆ‘ä»¬ä»Šå¤©ä¸»è¦ä»å†…å­˜ç®¡ç†å’Œæ€§èƒ½æ–¹é¢çœ‹ä¸€ä¸‹ <code>Quarkus</code> å’Œ <code>Spring Boot</code> çš„åŒºåˆ«ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-Quarkus-ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Quarkus-ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Quarkus ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Quarkus ï¼Ÿ</h2><p>å®˜ç½‘æ˜¯è¿™æ ·å®šä¹‰çš„ï¼Œ<code>Quarkus</code> æ˜¯é’ˆå¯¹ Java è™šæ‹Ÿæœº (JVM) å’Œæœ¬æœºç¼–è¯‘çš„å…¨æ ˆ <code>Kubernetes</code> æœ¬åœ° Java æ¡†æ¶ï¼Œä¸“é—¨é’ˆå¯¹å®¹å™¨ä¼˜åŒ– Java ï¼Œä½¿å…¶æˆä¸ºæ— æœåŠ¡å™¨ï¼Œäº‘å’Œ Kubernetes ç¯å¢ƒçš„æœ‰æ•ˆå¹³å°ã€‚</p><h2 id="æ„å»ºç¨‹åº"><a href="#æ„å»ºç¨‹åº" class="headerlink" title="æ„å»ºç¨‹åº"></a>æ„å»ºç¨‹åº</h2><p>ä¸ºäº†ç›´è§‚çš„æ¯”è¾ƒä¸¤ä¸ªæ¡†æ¶çš„åŒºåˆ«ï¼Œè¿™ä¸¤ä¸ªç¨‹åºéƒ½å°†åªå¼•å…¥  Spring Web ä¾èµ–ã€‚</p><h3 id="æ„å»º-Quarkus-åº”ç”¨"><a href="#æ„å»º-Quarkus-åº”ç”¨" class="headerlink" title="æ„å»º Quarkus åº”ç”¨"></a>æ„å»º Quarkus åº”ç”¨</h3><p>æˆ‘ä»¬å¯ä»¥åœ¨ <a href="https://code.quarkus.io/" target="_blank" rel="noopener">Quarkus å®˜ç½‘</a>æ„å»ºæˆ‘ä»¬çš„ Quarkus åº”ç”¨ï¼Œæ³¨æ„æˆ‘ä»¬åªé€‰æ‹©äº† <code>Spring Web API</code> ä¾èµ–ã€‚</p><pre><code>var askSky = () =&gt; {    return ğŸŒ•.exists() ? new ğŸº : null;}</code></pre><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8727572903114c7fa2ca312e4a6270f9~tplv-k3u1fbpfcp-watermark.image" alt="506(1).jpg"></p><p>ä¸‹è½½ä»£ç ç”¨ IDE æ‰“å¼€ä¹‹å,æˆ‘ä»¬ä¼šå‘ç°æœ‰ä¸€ä¸ªé»˜è®¤çš„ <code>SpringGreetingController</code> ç±»:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/hello-spring"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringGreetingController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello Spring"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="æ„å»º-Spring-Boot-ç¨‹åº"><a href="#æ„å»º-Spring-Boot-ç¨‹åº" class="headerlink" title="æ„å»º Spring Boot ç¨‹åº"></a>æ„å»º Spring Boot ç¨‹åº</h3><p>Spring Boot çš„æ„å»ºæ–¹æ³•å°±ä¸ç”¨å¤šè¯´äº†ï¼Œæˆ‘ä»¬ä¹Ÿåªé€‰äº† <code>Spring Web</code> ä¾èµ–ã€‚</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a6c87f646d86469f90953f4613f4dec5~tplv-k3u1fbpfcp-watermark.image" alt="92445.jpg"></p><p>æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ <code>Spring</code> æ„å»ºåçš„ä»£ç ï¼Œæ·»åŠ  <code>SpringGreetingController</code> è‡³ Spring Boot é¡¹ç›®ä¸­ã€‚</p><h2 id="æ€§èƒ½æ¯”è¾ƒ"><a href="#æ€§èƒ½æ¯”è¾ƒ" class="headerlink" title="æ€§èƒ½æ¯”è¾ƒ"></a>æ€§èƒ½æ¯”è¾ƒ</h2><p>å®Œæˆäº†ä¸Šè¿°å·¥ä½œï¼Œä¸çŸ¥é“ä½ æ˜¯å¦å‘ç° <code>Quarkus</code> å¹¶æ²¡æœ‰åƒ <code>Spring Boot</code> ä¸€æ ·çš„ <code>Main</code> å¯åŠ¨å‡½æ•°ï¼Œä¹Ÿæ²¡æœ‰éƒ¨ç½²åˆ°Webå®¹å™¨ã€‚é€šè¿‡ç¿»é˜… <code>Quarkus</code> å®˜ç½‘çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åªéœ€è¦è¿™æ ·ä¸€è¡Œå‘½ä»¤æ¥å¯åŠ¨ <code>Quarkus</code> ç¨‹åºï¼š <code>mvnw compile quarkus:dev</code>ã€‚æˆ‘ä»¬å†ä½¿ç”¨ <code>mvnw compile spring-boot:run</code> å°† <code>spring boot</code> é¡¹ç›®è¿è¡Œèµ·æ¥ã€‚</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b5057da8243947d6ae8f02e85d7b5203~tplv-k3u1fbpfcp-watermark.image" alt="0838(1).jpg"></p><p>æˆ‘ä»¬ä½¿ç”¨ jdk æœ¬èº«æä¾›çš„ java ç›‘æµ‹çš„ GUI å·¥å…·â€” <code>jconsole</code> æ¥æ£€æµ‹ä¸¤ä¸ªè¿›ç¨‹çš„æ€§èƒ½æƒ…å†µã€‚</p><h3 id="Quarkus"><a href="#Quarkus" class="headerlink" title="Quarkus"></a>Quarkus</h3><h4 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h4><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/05ac6de459ee49caa582c28470654b9f~tplv-k3u1fbpfcp-watermark.image" alt="239fee4e568ac7166cc0c29655b60cc.png"></p><h4 id="ç±»"><a href="#ç±»" class="headerlink" title="ç±»"></a>ç±»</h4><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/290bc288660140198cbd88230b4621c7~tplv-k3u1fbpfcp-watermark.image" alt="f1ddabbb5232fcc4c3a9dcd498ba768.png"></p><h3 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h3><h4 id="æ¦‚è§ˆ-1"><a href="#æ¦‚è§ˆ-1" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h4><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d76a6bf030224372a409e924fc420a6e~tplv-k3u1fbpfcp-watermark.image" alt="714adcc272e8585b8a9414bc6f3cf63.png"></p><h4 id="ç±»-1"><a href="#ç±»-1" class="headerlink" title="ç±»"></a>ç±»</h4><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fa2671baec2b4586aceab1a8a26af2e8~tplv-k3u1fbpfcp-watermark.image" alt="2ced6255ce08b73d3b467500823ff2a.png"></p><p>ä¸¤ä¸ªåº”ç”¨ç¨‹åºçš„ç›´æ¥æ¯”è¾ƒéƒ½è¡¨æ˜ <code>Quarkus</code> åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨äº†æ›´å°‘çš„å†…å­˜ã€‚ <code>Spring Boot</code> ä½¿ç”¨çš„å†…å­˜çº¦ä¸º 145 Mbï¼Œè€ŒQuarkusçš„å†…å­˜ä½¿ç”¨çº¦ä¸º 122 Mbã€‚è€Œåœ¨ç±»åŠ è½½ä¸Š <code>Quarkus</code> å¤§çº¦åŠ è½½äº† 5303 ä¸ªç±»ï¼Œè€Œ <code>Spring Boot</code> å¤§çº¦åŠ è½½äº† 4785 ä¸ªç±»ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æµ‹è¯•ç»“æœå’Œæˆ‘åœ¨è§†é¢‘ä¸Šçœ‹åˆ°çš„æœ‰ä¸€å®šå‡ºå…¥ï¼Œè§†é¢‘çš„æµ‹è¯•ç»“æœæ˜¯ <code>Quarkus</code> æ€§èƒ½è¿œä¼˜äº <code>Spring Boot</code> çš„ã€‚æˆ‘çš„æµ‹è¯•ä¹Ÿåªæ˜¯ç»™å¤§å®¶ä¸€ä¸ªå‚è€ƒï¼ŒåŠ¨æ‰‹èƒ½åŠ›å¼ºçš„å¯ä»¥è‡ªå·±å»å®è·µä¸€ä¸‹ã€‚</p><blockquote><p>è§†é¢‘åœ°å€:  <a href="https://youtu.be/oz-QSGy1DSo" target="_blank" rel="noopener">Quarkus vs Spring Boot - Performance</a> </p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Frameworks </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>[è¯‘] å¿«é€Ÿç†è§£å¼€é—­åŸåˆ™</title>
      <link href="2021/04/20/%E8%AF%91-%E5%BF%AB%E9%80%9F%E7%90%86%E8%A7%A3%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99/"/>
      <url>2021/04/20/%E8%AF%91-%E5%BF%AB%E9%80%9F%E7%90%86%E8%A7%A3%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åŸæ–‡åœ°å€ï¼š<a href="https://levelup.gitconnected.com/the-open-closed-principle-made-simple-cc3d0ed70553" target="_blank" rel="noopener">The Open-Closed principle made simple</a><br>åŸæ–‡ä½œè€…ï¼š<a href="https://mihai-sandu.medium.com/" target="_blank" rel="noopener">Mihai Sandu</a><br>è¯‘è€…ï¼š<a href="https://maybelence.cn/">maybelence</a></p></blockquote><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e3157c27450b41d98d39467fcb8c42ed~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>åŸæ–‡çš„ç¤ºä¾‹ä»£ç éƒ½æ˜¯é‡‡ç”¨çš„ <code>Scala</code> è¯­è¨€ï¼Œå…¶å® <code>Scala</code> æœ¬èº«å’Œ <code>java</code> çš„è¯­æ³•éå¸¸åƒï¼Œè€ƒè™‘åˆ°ç›®å‰æ›´å¤šçš„å¼€å‘è€…éƒ½æ˜¯ java ï¼Œå› æ­¤æˆ‘æŠŠåŸæ–‡çš„ä»£ç éƒ½è½¬æˆäº† java ã€‚ä¸€äº›å’Œ java è¯­æ³•æœ‰å†²çªçš„åœ°æ–¹ä¹Ÿéƒ½åšäº†ä¸­æ–‡æ³¨é‡Šã€‚</p><hr><p>å¡è½¦æ˜¯ä¸€ç§å¤šåŠŸèƒ½çš„è®¾å¤‡ã€‚ä»–ä»¬å¯ä»¥æ ¹æ®è½¦å¢æŒ‚è½½çš„é›¶ä»¶ç±»å‹æ¥æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ï¼Œå¦‚æœè½½é‡å…è®¸çš„è¯ï¼Œç”šè‡³å¯ä»¥<br>è£…è½½å¤šä¸ªè½¦å¢ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼Œå¡è½¦å¯ä»¥é€šè¿‡ä¸åŒçš„é›¶ä»¶ä»¥è¿›è¡Œæ‰©å±•ï¼Œä½†ä¸èƒ½æ”¹è£…æ¯ä¸ªé›¶ä»¶çš„å†…éƒ¨å•å…ƒï¼ˆä¾‹å¦‚å‘åŠ¨æœºæˆ–æœºèˆ±ï¼‰ã€‚å¯æ‹“å±•çš„ä»£ç ä¹Ÿåº”è¯¥åƒå¡è½¦æŒ‚è½½é›¶ä»¶ä¸€æ ·å¾—å¿ƒåº”æ‰‹ã€‚</p><h2 id="åˆ¶å†°æœºé—®é¢˜"><a href="#åˆ¶å†°æœºé—®é¢˜" class="headerlink" title="åˆ¶å†°æœºé—®é¢˜"></a>åˆ¶å†°æœºé—®é¢˜</h2><p>å‡è®¾æˆ‘ä»¬å¿…é¡»è¦ç¼–å†™ä¸€ä¸ªç¨‹åºæ¥ä¸º <em>Ted&amp;Kelly</em> å…¬å¸åˆ¶ä½œå¯å¯å†°æ¿€å‡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IceCreamMachine</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MakeIceCream</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Cacao ice-cream"</span>); <span class="comment">//logic to create cacao ice cream</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†ç¨‹åºäº¤ä»˜ç»™å®¢æˆ·ï¼Œè™½ç„¶è¿™æ®µä»£ç å¾ˆç®€å•ï¼Œä½†æ˜¯çœ‹ä¸Šå»æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œè€Œä¸”æ²¡æœ‰è¿åä»»ä½•åŸåˆ™ã€‚å®¢æˆ·ç›®å‰æ˜¯éå¸¸æ»¡æ„çš„ã€‚</p><p>ä½†æ˜¯äº‹æƒ…å¹¶ä¸æ˜¯åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå®¢æˆ·æ€»æ˜¯ä¼šæœ‰ä¸€äº›æ–°çš„éœ€æ±‚ã€‚è¿™å°±æ„å‘³ç€æˆ‘ä»¬éœ€è¦ä¸æ–­è°ƒæ•´æˆ‘ä»¬çš„ä»£ç ã€‚</p><h3 id="æ·»åŠ æ–°çš„å£å‘³"><a href="#æ·»åŠ æ–°çš„å£å‘³" class="headerlink" title="æ·»åŠ æ–°çš„å£å‘³"></a>æ·»åŠ æ–°çš„å£å‘³</h3><p>æ²¡æƒ³åˆ°ç¨‹åºåˆšä¸Šçº¿å°±å¦‚æ­¤ç«çˆ†ï¼Œäºæ˜¯ <em>Tedï¼†Kelly</em> å¸Œæœ›æ‰©å¤§è§„æ¨¡ã€‚ä»–ä»¬è¦æ±‚æˆ‘ä»¬è¿˜è¦èƒ½å¤Ÿç”Ÿäº§é¦™è‰å‘³çš„å†°æ¿€å‡Œã€‚</p><p>çŸ­æš‚æ€è€ƒä¹‹åï¼Œæˆ‘ä»¬ç»™å‡ºäº†ä»¥ä¸‹è§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IceCreamMachine</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MakeIceCream</span><span class="params">(String flavor)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"cacao"</span>.equals(flavor))</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">"Cacao ice-cream"</span>); <span class="comment">//logic to create cacao ice-cream</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"vanilla"</span>.equals(flavor))</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">"Vanilla ice-cream"</span>); <span class="comment">//logic to create vanilla ice-cream</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"Flavor not supported"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¿®æ”¹äº†æœ€åˆçš„ä»£ç ï¼Œæ·»åŠ äº†ä¸€ä¸ªå‚æ•°ä»¥æŒ‡å®šæ‰€éœ€çš„å£å‘³ï¼Œå¹¶æ·»åŠ äº† <code>if</code> è¯­å¥ä»¥åœ¨é€»è¾‘ä¹‹é—´åˆ‡æ¢ã€‚ç”±äºæˆ‘ä»¬å·²ç»æ”¹å˜äº†æœ€åˆçš„å‡½æ•°ç­¾åï¼Œå› æ­¤è°ƒç”¨æˆ‘ä»¬ä»£ç çš„æ–¹æ³•å°†è¢«ç ´åï¼Œä½†æ˜¯è‡³å°‘ä»ç°åœ¨å¼€å§‹ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ä¸ç ´åæ›´æ”¹çš„æƒ…å†µä¸‹æ”¯æŒå…¶ä»–å£å‘³çš„ç”Ÿäº§ã€‚</p><h3 id="åˆ›å»ºå¯å¯å’Œé¦™è‰ç»„åˆ"><a href="#åˆ›å»ºå¯å¯å’Œé¦™è‰ç»„åˆ" class="headerlink" title="åˆ›å»ºå¯å¯å’Œé¦™è‰ç»„åˆ"></a>åˆ›å»ºå¯å¯å’Œé¦™è‰ç»„åˆ</h3><p>ä¸šåŠ¡è¿›å±•é¡ºåˆ©ï¼Œä½†æ˜¯å¾ˆå¿«å®¢æˆ·å°±æå‡ºäº†ç¬¬äºŒä¸ªéœ€æ±‚ï¼Œå¸Œæœ›æˆ‘ä»¬èƒ½å¤Ÿç”Ÿäº§ç”±å¯å¯å’Œé¦™è‰åˆ¶æˆçš„å†°æ·‡æ·‹ã€‚äº‹æƒ…å¼€å§‹å˜å¾—æœ‰ç‚¹å¤æ‚ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶èƒ½å¤Ÿå¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IceCreamMachine</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MakeIceCream</span><span class="params">(String flavor)</span> <span class="keyword">throws</span> Exception </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"cacao"</span>.equals(flavor))</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">"Cacao ice-cream"</span>); <span class="comment">//logic to create cacao ice-cream</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"vanilla"</span>.equals(flavor))</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">"Vanilla ice-cream"</span>); <span class="comment">//logic to create vanilla ice-cream</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"cacao-vanilla"</span>.equals(flavor))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//copy &amp; paste the cacao ice-cream logic</span></span><br><span class="line">            System.out.println(<span class="string">"Cacao ice-cream"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//copy &amp; paste the vanilla ice-cream logic</span></span><br><span class="line">            System.out.println(<span class="string">"Vanilla ice-cream"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"Flavor not supported"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åˆæ·»åŠ äº†ä¸€ä¸ª <code>if</code> è¯­å¥ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”Ÿäº§å†°æ·‡æ·‹çš„é€»è¾‘è¢«å¤åˆ¶åˆ°æ¯ä¸ª <code>if</code> å†…éƒ¨ã€‚åœ¨å®é™…çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘å¯èƒ½ä¼šåœ¨å•ç‹¬çš„æœåŠ¡ä¸­æå–ç”Ÿäº§çš„é€»è¾‘ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æˆ‘ä»¬å°†çœ‹åˆ°çš„é‚£æ ·ï¼Œæå–æœåŠ¡å¹¶ä¸æ€»æ˜¯æœ€å¥½çš„æ–¹æ¡ˆã€‚</p><p>å½“ <em>Tedï¼†Kelly</em> è¦æ±‚æ”¯æŒç”Ÿäº§æ›´å¤šå£å‘³æ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆã€‚å¦‚æœä»–æƒ³è¿›ä¸€æ­¥å°†å®ƒä»¬ç»“åˆèµ·æ¥æ€ä¹ˆåŠï¼Ÿä»…æ·»åŠ  <code>if</code> å­å¥å¹¶ä¸æ˜¯ç†æƒ³çš„è§£å†³æ–¹æ¡ˆã€‚</p><h3 id="è¿™ç§è§£å†³æ–¹æ¡ˆäº§ç”Ÿçš„é—®é¢˜"><a href="#è¿™ç§è§£å†³æ–¹æ¡ˆäº§ç”Ÿçš„é—®é¢˜" class="headerlink" title="è¿™ç§è§£å†³æ–¹æ¡ˆäº§ç”Ÿçš„é—®é¢˜"></a>è¿™ç§è§£å†³æ–¹æ¡ˆäº§ç”Ÿçš„é—®é¢˜</h3><p>æ¯æ¬¡æˆ‘ä»¬æ·»åŠ æ–°çš„å£å‘³æˆ–ç»„åˆæ—¶ï¼Œæˆ‘ä»¬éƒ½å¿…é¡»æ›´æ–° <code>IceCreamMachine</code> ç±»ï¼Œè¿™å°±æ„å‘³ç€ï¼š</p><ul><li>æˆ‘ä»¬æ›´æ–°å·²ç»éƒ¨ç½²çš„ä»£ç </li><li>è¿™ä¸ªç±»å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œæ˜“è¯»æ€§å˜å¾—è¶Šæ¥è¶Šå·®ã€‚å‡è®¾æˆ‘ä»¬æœ‰ 100 ç§å£å‘³ï¼Œè¿™ä¸ªç±»å¾ˆå®¹æ˜“è†¨èƒ€åˆ° 5000+ è¡Œä»£ç </li><li>æˆ‘ä»¬å¯èƒ½ä¼šç ´åç°æœ‰çš„å•å…ƒæµ‹è¯•</li></ul><p>ç°åœ¨å›æƒ³ä¸€ä¸‹å¼€å¤´å¡è½¦çš„ç±»æ¯”ï¼Œå½“ä½ æ¯æ¬¡æ›´æ¢è½¦å¢æŒ‚è½½çš„é›¶ä»¶æ—¶ï¼Œä½ ä¼šæ¯æ¬¡éƒ½æ›´æ¢å¼•æ“å—ï¼Ÿæ˜¾ç„¶ä¸ä¼šï¼Œçœ‹æˆ‘ä»¬å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="ä¼ ç»Ÿçš„å¯æ‹“å±•æ€§æ–¹æ³•"><a href="#ä¼ ç»Ÿçš„å¯æ‹“å±•æ€§æ–¹æ³•" class="headerlink" title="ä¼ ç»Ÿçš„å¯æ‹“å±•æ€§æ–¹æ³•"></a>ä¼ ç»Ÿçš„å¯æ‹“å±•æ€§æ–¹æ³•</h2><p><em>Bertrand Meyer</em> æ˜¯æœ€æ—©æå‡ºå¼€é—­åŸåˆ™è¿™ä¸€æœ¯è¯­çš„äººï¼Œä»–å®šä¹‰ â€œè½¯ä»¶å®ä½“ï¼ˆç±»ï¼Œæ¨¡å—ï¼Œå‡½æ•°ï¼Œç­‰ï¼‰ åº”å½“å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚â€</p><p>æ¢å¥è¯è¯´ï¼Œæ¯å½“æˆ‘ä»¬éœ€è¦å‘æ—§å¯¹è±¡æ·»åŠ æ–°è¡Œä¸ºæ—¶ï¼Œéƒ½å¯ä»¥æ ¹æ®éœ€è¦ç»§æ‰¿å’Œæ›´æ–°å®ƒä»¬ã€‚å¼€é—­åŸåˆ™æ˜¯é‚£äº›æ˜“äºç†è§£å´éš¾ä»¥åº”ç”¨çš„åŸåˆ™ä¹‹ä¸€ã€‚</p><p>è®©æˆ‘ä»¬éµå¾ªè¿™ç§æ–¹æ³•é‡å†™åˆšåˆšçš„ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseIceCream</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">MakeIceCream</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacaoIceCream</span> <span class="keyword">extends</span> <span class="title">BaseIceCream</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MakeIceCream</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Cacao ice-cream"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VanillaIceCream</span> <span class="keyword">extends</span> <span class="title">BaseIceCream</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MakeIceCream</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Vanilla ice-cream"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacaoAndVanilla</span> <span class="keyword">extends</span> <span class="title">CacaoIceCream</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MakeIceCream</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.MakeIceCream();</span><br><span class="line">        System.out.println(<span class="string">"Vanilla ice-cream"</span>); <span class="comment">//duplicate vanilla logic because we can't iherit both cacao and vanilla</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åŸå§‹ç±»åˆ†ä¸ºäº†å››ä¸ªç±»ï¼Œæ¯ä¸ªç±»ä»£è¡¨ä¸€ç§ç”Ÿäº§å£å‘³ã€‚é€šè¿‡æ­¤è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬è§£å†³äº†æ‰€æœ‰æœ€åˆçš„é—®é¢˜ï¼š</p><ul><li>æ¯ä¸ªç±»éƒ½çŸ­å°ç²¾æ‚ï¼Œå¯ç»´æŠ¤æ€§å’Œæ˜“è¯»æ€§éƒ½å¾ˆé«˜</li><li>å½“éœ€è¦æ·»åŠ æ–°å£å‘³æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¸€ä¸ªæ–°çš„ç±»</li><li>ä¸ä¼šå½±å“ç°æœ‰çš„å•å…ƒæµ‹è¯•</li></ul><p>ä»£ç çœ‹èµ·æ¥å·²ç»æ²¡æœ‰ä»»ä½•é—®é¢˜äº†ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ°è¿™é‡Œå°±åœæ­¢æ€è€ƒï¼Œä½†æ˜¯å…¶å®è¿™ç§è§£å†³æ–¹æ¡ˆè¿˜æ˜¯å­˜åœ¨ä¸€äº›<strong>é—®é¢˜</strong>çš„ï¼š</p><ul><li>ä¸èƒ½ç»§æ‰¿å¤šä¸ªç±»ï¼Œå› æ­¤å¯¹äºä¸¤ç§å£å‘³çš„ç»“åˆï¼Œæˆ‘ä»¬å¿…é¡»å¤åˆ¶ä¸€äº›ä»£ç æˆ–å°†é€»è¾‘æå–åˆ°æœåŠ¡ä¸­</li><li>å¦‚æœåŸºç±»ä¸­çš„ä»£ç è¢«æ›´æ–°ï¼Œæ‰€æœ‰å­ç±»éƒ½ä¼šå—åˆ°å½±å“ã€‚å‡è®¾åŸºç±»é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥äº†ä¸€äº›ä¾èµ–å…³ç³»ï¼Œæ¯å½“æˆ‘ä»¬æ·»åŠ æ–°çš„ä¾èµ–å…³ç³»æ—¶ï¼Œæ‰€æœ‰å­ä»£éƒ½å¿…é¡»å°†è¯¥å‚æ•°è§£æä¸ºåŸºæœ¬æ„é€ å‡½æ•°</li></ul><h2 id="ç°åœ¨å¯æ‹“å±•æ€§çš„æ–¹æ³•"><a href="#ç°åœ¨å¯æ‹“å±•æ€§çš„æ–¹æ³•" class="headerlink" title="ç°åœ¨å¯æ‹“å±•æ€§çš„æ–¹æ³•"></a>ç°åœ¨å¯æ‹“å±•æ€§çš„æ–¹æ³•</h2><p>å½“ <em>Robert C. Martin</em> é‡ç”³ <em>Meyer</em> çš„å¼€é—­åŸåˆ™æ—¶ï¼Œä»–åšäº†ä¸€äº›æ›´æ–°ã€‚<strong>åçˆ±ç»§æ‰¿è€Œä¸æ˜¯ç»§æ‰¿</strong>ã€‚</p><p>ç»„åˆå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç”±åœ°éšæ„ç»„åˆä»»æ„æ•°é‡å’Œæ‰€éœ€çš„ç»„åˆã€‚è€Œä¸”ï¼Œå¦‚æœæˆ‘ä»¬é’ˆå¯¹æŠ½è±¡ç±»ï¼ˆæ¥å£ï¼‰è¿›è¡Œç¼–ç¨‹ï¼Œåˆ™å¯ä»¥ä¿®æ”¹å·²æœ‰ä»£ç çš„è¡Œä¸ºè€Œæ— éœ€è¿›è¡Œä¿®æ”¹ä»£ç ã€‚è®©æˆ‘ä»¬çœ‹çœ‹æœ€ç»ˆçš„è§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">public interface <span class="type">IMakeIceCream</span> &#123;</span><br><span class="line">    void <span class="type">Make</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CacaoIceCream</span> <span class="title">implements</span> <span class="title">IMakeIceCream</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">IMakeIceCream</span> iceCreamMaker;</span><br><span class="line"></span><br><span class="line">    public <span class="type">CacaoIceCream</span>(<span class="type">IMakeIceCream</span> iceCreamMaker)  <span class="comment">//å¯é€‰å‚æ•°ï¼Œå¦‚æœä¸éœ€è¦å¦ä¸€ä¸ªå£å‘³ä¼ null</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.iceCreamMaker = iceCreamMaker;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void <span class="type">Make</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (iceCreamMaker != <span class="literal">null</span>) <span class="comment">//if flavor passed in, make that first</span></span><br><span class="line">        &#123;</span><br><span class="line">            iceCreamMaker.<span class="type">Make</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">System</span>.out.println(<span class="string">"Cacao ice-cream"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VanillaIceCream</span> <span class="title">implements</span> <span class="title">IMakeIceCream</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">IMakeIceCream</span> iceCreamMaker;</span><br><span class="line"></span><br><span class="line">    public <span class="type">VanillaIceCream</span>(<span class="type">IMakeIceCream</span> iceCreamMaker)  <span class="comment">//å¯é€‰å‚æ•°ï¼Œå¦‚æœä¸éœ€è¦å¦ä¸€ä¸ªå£å‘³ä¼ null</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.iceCreamMaker = iceCreamMaker;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    public void <span class="type">Make</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (iceCreamMaker != <span class="literal">null</span>) <span class="comment">//if flavor passed in, make that first</span></span><br><span class="line">        &#123;</span><br><span class="line">            iceCreamMaker.<span class="type">Make</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">System</span>.out.println(<span class="string">"Vanilla ice-cream"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨å°†åŸå§‹çš„ç±»åˆ†æˆäº†ä¸‰ä¸ªå¯¹è±¡ï¼š</p><ul><li><code>IMakeIceCream</code> æ¥å£å®šä¹‰äº†åˆ¶ä½œå†°æ·‡æ·‹çš„é€šç”¨æŠ½è±¡</li><li><code>CacaoIceCream</code> å®ç°äº† <code>IMakeIceCream</code> </li><li><code>VanillaIceCream</code> å®ç°äº† <code>IMakeIceCream</code> </li></ul><p>é€šè¿‡ä½¿ç”¨æ¥å£ï¼Œæˆ‘ä»¬å°†ç±»å’Œå®ç°è§£è€¦ã€‚æ¥å£æ˜¯å°é—­ä¸å¯ä¿®æ”¹çš„ï¼Œå› æ­¤ä¸€æ—¦æˆ‘ä»¬å®šä¹‰äº†å¯¹è±¡ï¼Œå°±æ— æ³•æ›´æ”¹ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä¸ºæ–°çš„åŠŸèƒ½å®šä¹‰æ–°æ¥å£å¹¶ç»§æ‰¿å®ƒä»¬ã€‚è¿™ä½¿å¾—ä»£ç å¯æ‰©å±•ã€‚</p><p>ä¸ºä»€ä¹ˆè¦å‘æ¯ä¸ªæ„é€ å‡½æ•°æ·»åŠ  <code>IMakeIceCream</code> å‚æ•°ï¼Ÿæ–°ä»£ç æ˜¯å¦å…·æœ‰æ—§æ–¹æ³•æˆ–æ—§æ–¹æ³•çš„æ‰€æœ‰åŠŸèƒ½ï¼Ÿ</p><hr><p>ç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚å¯å¯é¦™è‰ç»„åˆä»åœ¨è¿™é‡Œï¼Œä½†æˆ‘ä»¬ä¸éœ€è¦ if å­å¥æˆ–ä¸“é—¨é’ˆå¯¹å®ƒçš„ç±»ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ„é€ å‡½æ•°å‚æ•°ã€‚ç±»ä¼¼è¿™æ ·ï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cacaoVanillaIceCream = <span class="keyword">new</span> <span class="type">CacaoIceCream</span>(<span class="keyword">new</span> <span class="type">VanillaIceCream</span>());</span><br><span class="line">cacaoVanillaIceCream.<span class="type">Make</span>();</span><br></pre></td></tr></table></figure><p>ç»„åˆçš„å¥½å¤„åœ¨äºï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦åˆæˆä»»æ„æ•°é‡çš„å¯¹è±¡ã€‚éœ€è¦ 4 ç§å£å‘³ï¼Ÿåªéœ€ç¼–å†™ä¸€ä¸ªæ„é€ å‡½æ•°é“¾å³å¯ã€‚è¿™ç§°ä¸ºè£…é¥°å™¨æ¨¡å¼ã€‚ä½ å¯ä»¥åœ¨ <a href="https://refactoring.guru/design-patterns/decorator/csharp/example" target="_blank" rel="noopener">è¿™é‡Œ</a> è¯»æ›´å¤šå…³äºå®ƒçš„å†…å®¹ã€‚</p><p>è¯·æ³¨æ„ï¼Œ <code>IMakeIceCream</code> å‚æ•°æ˜¯å¯é€‰çš„ã€‚è¿™ä½¿æˆ‘å¯ä»¥ç»„åˆä½¿ç”¨æˆ–å•ç‹¬ä½¿ç”¨è¯¥ç±»ã€‚</p><p>åƒè¿™æ ·ç¼–å†™ä»£ç ä¼šå®ç°ä¸€ä¸ªå¯æ‹”æ’å¼çš„ä½“ç³»ç»“æ„ã€‚è¿™æ˜¯éå¸¸ nice çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–å†™ä»£ç æ¥æ·»åŠ æ–°åŠŸèƒ½ï¼Œè€Œä¸æ›´æ”¹ç°æœ‰åŠŸèƒ½ã€‚ä»»åŠ¡å®Œæˆã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‹¥æŠ±Restful--Jerseyæ¡†æ¶</title>
      <link href="2021/04/19/%E6%8B%A5%E6%8A%B1Restful-Jersey%E6%A1%86%E6%9E%B6/"/>
      <url>2021/04/19/%E6%8B%A5%E6%8A%B1Restful-Jersey%E6%A1%86%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<h3 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h3><p>æåˆ° RestFul ï¼Œå¾ˆå®¹æ˜“è”æƒ³åˆ° Spring æ¡†æ¶ï¼Œå¦‚æœä½ åœ¨æ­¤ä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡ Spring æ¡†æ¶ï¼Œå»ºè®®å…ˆç‚¹å‡» <a href="https://spring.io/guides/gs/rest-service/" target="_blank" rel="noopener">ä¼ é€é—¨</a> äº†è§£ä¸€ä¸‹å¦‚ä½•é€šè¿‡ Spring å¿«é€Ÿæ„å»ºä¸€ä¸ª Restful Web æœåŠ¡ã€‚</p><p>ä»Šå¤©æˆ‘ä»¬ä¸»è¦é€šè¿‡å¦ä¸€ä¸ªè½»é‡çº§çš„æ¡†æ¶â€” <code>Jersey</code> æ•´åˆ Spring æ¥æ„å»ºä¸€ä¸ª Restful æœåŠ¡ã€‚ Jersey æ˜¯ä¸€ä¸ªç”¨äºæ„å»º Restful Web æœåŠ¡çš„ä¸€ä¸ªå¼€æºæ¡†æ¶ã€‚æ˜¯ <a href="https://zh.wikipedia.org/wiki/JAX-RS" target="_blank" rel="noopener">JAX-RS</a> è§„èŒƒçš„ä¸€ç§å…·ä½“å®ç°ã€‚</p><h3 id="Maven-ä¾èµ–"><a href="#Maven-ä¾èµ–" class="headerlink" title="Maven ä¾èµ–"></a>Maven ä¾èµ–</h3><p>é¦–å…ˆå¼•å…¥ <code>Jersey</code> ç›¸å…³çš„ä¾èµ–ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish.jersey.containers<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jersey-container-servlet<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish.jersey.media<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jersey-media-json-jackson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><br>å¦‚æœè¦æ•´åˆ Spring æ¡†æ¶çš„è¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¼•å…¥ <code>jersey-spring4</code> ä¾èµ–ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ•´åˆspring --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish.jersey.ext<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jersey-spring4<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0-M6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Web-é…ç½®"><a href="#Web-é…ç½®" class="headerlink" title="Web é…ç½®"></a>Web é…ç½®</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ª Web é¡¹ç›®æ¥è¿›è¡Œ Servlet é…ç½®ï¼Œä½¿ç”¨ Spring çš„ WebApplicationInitializer ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Order</span>(Ordered.HIGHEST_PRECEDENCE)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationInitializer</span> <span class="keyword">implements</span> <span class="title">WebApplicationInitializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStartup</span><span class="params">(javax.servlet.ServletContext servletContext)</span> </span>&#123;</span><br><span class="line">        AnnotationConfigWebApplicationContext context</span><br><span class="line">                = <span class="keyword">new</span> AnnotationConfigWebApplicationContext();</span><br><span class="line"></span><br><span class="line">        servletContext.addListener(<span class="keyword">new</span> ContextLoaderListener(context));</span><br><span class="line">        servletContext.setInitParameter(<span class="string">"contextConfigLocation"</span>, <span class="string">"com.example.server"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿™é‡Œæ·»åŠ  <code>@Order(Ordered.HIGHEST_PRECEDENCE)</code> æ³¨è§£çš„ä½œç”¨æ˜¯ç¡®ä¿ WebApplicationInitializer åœ¨ Jersey-Spring é»˜è®¤åˆå§‹åŒ–ç¨‹åºä¹‹å‰æ‰§è¡Œã€‚</p><h3 id="ä½¿ç”¨-Jersey-JAX-RS-æœåŠ¡"><a href="#ä½¿ç”¨-Jersey-JAX-RS-æœåŠ¡" class="headerlink" title="ä½¿ç”¨ Jersey JAX-RS æœåŠ¡"></a>ä½¿ç”¨ Jersey JAX-RS æœåŠ¡</h3><h4 id="èµ„æºè¡¨ç¤ºç±»"><a href="#èµ„æºè¡¨ç¤ºç±»" class="headerlink" title="èµ„æºè¡¨ç¤ºç±»"></a>èµ„æºè¡¨ç¤ºç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@XmlRootElement</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFirstName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> firstName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstName</span><span class="params">(String firstName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.firstName = firstName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å½“ä»…éœ€è¦ XML æ”¯æŒï¼ˆé™¤äº†JSONï¼‰æ—¶ï¼Œæ‰éœ€è¦å¼•å…¥ @XmlRootElement è¿™ä¸€ç±»çš„ JAXB æ³¨è§£ï¼Œ</p></blockquote><h4 id="å®ç°æœåŠ¡"><a href="#å®ç°æœåŠ¡" class="headerlink" title="å®ç°æœåŠ¡"></a>å®ç°æœåŠ¡</h4><p>ç°åœ¨æˆ‘ä»¬é€šè¿‡ JAX-RS æ³¨è§£æ¥æ„å»ºä¸€ä¸ª RESTful Web æœåŠ¡:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Path</span>(<span class="string">"/employees"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeResource</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeRepository employeeRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GET</span></span><br><span class="line">    <span class="meta">@Path</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="meta">@Produces</span>(&#123; MediaType.APPLICATION_JSON, MediaType.APPLICATION_XML &#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Employee <span class="title">getEmployee</span><span class="params">(@PathParam(<span class="string">"id"</span>)</span> <span class="keyword">int</span> id) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> employeeRepository.getEmployee(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@POST</span></span><br><span class="line">    <span class="meta">@Consumes</span>(&#123; MediaType.APPLICATION_JSON, MediaType.APPLICATION_XML &#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">addEmployee</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      Employee employee, @Context UriInfo uriInfo)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        employeeRepository.addEmployee(<span class="keyword">new</span> Employee(employee.getId(), </span><br><span class="line">          employee.getFirstName(), employee.getLastName(), </span><br><span class="line">          employee.getAge()));</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> Response.status(Response.Status.CREATED.getStatusCode())</span><br><span class="line">          .header(</span><br><span class="line">            <span class="string">"Location"</span>, </span><br><span class="line">            String.format(<span class="string">"%s/%s"</span>,uriInfo.getAbsolutePath().toString(), </span><br><span class="line">            employee.getId())).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p> <code>@Path</code> æ³¨è§£è¡¨ç¤ºæœåŠ¡è¯·æ±‚è·¯ç”±ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å˜é‡åµŒå…¥åˆ°è¯·æ±‚è·¯ç”±ä¸­ï¼Œå¦‚ä»£ç ä¸­çš„ <code>{id}</code> ã€‚å¦‚æœéœ€è¦è·å–è¯¥å˜é‡å€¼ï¼Œå¯ä»¥é€šè¿‡ <code>@PathParam</code> æ³¨è§£ã€‚</p><p> <code>@GET</code> ï¼Œ <code>@PUT</code> ï¼Œ <code>@POST</code> ,  <code>@DELETE</code> å’Œ <code>@HEAD</code> æ ‡è¯†è¯·æ±‚ HTTP çš„æ–¹å¼ã€‚</p><p> <code>@Produces</code> è¡¨ç¤ºå“åº”çš„æ•°æ®ç±»å‹ï¼Œåœ¨ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å·²å°†å…¶é…ç½®ä¸ºæ ¹æ®HTTPè¯·æ±‚å¤´ä¸º  (Acceptapplication/json æˆ– application/xml) çš„å€¼è¿”å›JSONæˆ–XMLã€‚</p><p> <code>@Consumes</code> å®šä¹‰æœåŠ¡å¯ç”¨çš„ MIME ç±»å‹ï¼Œå…·ä½“çš„æ•°æ®ç±»å‹å–å†³äºè¯·æ±‚å¤´ Content-Typeï¼ˆapplication/jsonæˆ–application/xmlï¼‰ã€‚</p><p> <code>@Context</code> æ³¨è§£ç”¨äºå°†ä¿¡æ¯æ³¨å…¥ç±»å­—æ®µï¼Œbeanå±æ€§æˆ–æ–¹æ³•å‚æ•°ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒæ¥æ³¨å…¥ <code>UriInfo</code> ã€‚æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å®ƒæ¥æ³¨å…¥ ServletConfig ï¼Œ ServletContext ï¼Œ HttpServletRequest å’Œ HttpServletResponse ã€‚</p><h3 id="ä½¿ç”¨-ExceptionMapper"><a href="#ä½¿ç”¨-ExceptionMapper" class="headerlink" title="ä½¿ç”¨ ExceptionMapper"></a>ä½¿ç”¨ ExceptionMapper</h3><p> <code>ExceptionMapper</code> å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ‹¦æˆªå¼‚å¸¸å¹¶å°†é€‚å½“çš„HTTPå“åº”ä»£ç è¿”å›ç»™å®¢æˆ·ç«¯ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œå¦‚æœæŠ›å‡º EmployeeNotFound å¼‚å¸¸ï¼Œåˆ™è¿”å› HTTP å“åº”ä»£ç  404 ï¼š<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Provider</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotFoundExceptionHandler</span> </span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">ExceptionMapper</span>&lt;<span class="title">EmployeeNotFound</span>&gt; </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">toResponse</span><span class="params">(EmployeeNotFound ex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Response.status(Response.Status.NOT_FOUND).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="ç®¡ç†èµ„æºç±»"><a href="#ç®¡ç†èµ„æºç±»" class="headerlink" title="ç®¡ç†èµ„æºç±»"></a>ç®¡ç†èµ„æºç±»</h3><p>æœ€åï¼Œè®©æˆ‘ä»¬æ ¹æ®åº”ç”¨ç¨‹åºè·¯å¾„è¿æ¥æ‰€æœ‰æœåŠ¡å®ç°ç±»å’Œå¼‚å¸¸æ˜ å°„ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApplicationPath</span>(<span class="string">"/resources"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestConfig</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Set&lt;Class&lt;?&gt;&gt; getClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HashSet&lt;Class&lt;?&gt;&gt;(</span><br><span class="line">          Arrays.asList(</span><br><span class="line">            EmployeeResource<span class="class">.<span class="keyword">class</span>, </span></span><br><span class="line"><span class="class">            <span class="title">NotFoundExceptionHandler</span>.<span class="title">class</span>, </span></span><br><span class="line"><span class="class">            <span class="title">AlreadyExistsExceptionHandler</span>.<span class="title">class</span>))</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="API-æµ‹è¯•"><a href="#API-æµ‹è¯•" class="headerlink" title="API æµ‹è¯•"></a>API æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JerseyApiLiveTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SERVICE_URL</span><br><span class="line">      = <span class="string">"http://localhost:8082/spring-jersey/resources/employees"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">givenGetAllEmployees_whenCorrectRequest_thenResponseCodeSuccess</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> ClientProtocolException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        HttpUriRequest request = <span class="keyword">new</span> HttpGet(SERVICE_URL);</span><br><span class="line"></span><br><span class="line">        HttpResponse httpResponse = HttpClientBuilder</span><br><span class="line">          .create()</span><br><span class="line">          .build()</span><br><span class="line">          .execute(request);</span><br><span class="line"></span><br><span class="line">        assertEquals(httpResponse</span><br><span class="line">          .getStatusLine()</span><br><span class="line">          .getStatusCode(), HttpStatus.SC_OK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æœ¬æ–‡ä»‹ç»äº† <code>Jersey</code> æ¡†æ¶å¹¶å¼€å‘äº†ä¸€ä¸ªç®€å•çš„ API ã€‚æˆ‘ä»¬å¼•å…¥ <code>Spring</code> ç”¨äºä¾èµ–å…³ç³»æ³¨å…¥åŠŸèƒ½ã€‚è¿˜çœ‹åˆ°äº† ExceptionMapper çš„ä½¿ç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Frameworks </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
            <tag> Jersey </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCodeæ¯æ—¥ä¸€é¢˜--ç»è¥æ‘©å¤©è½®çš„æœ€å¤§åˆ©æ¶¦</title>
      <link href="2021/04/14/LeetCode%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-%E7%BB%8F%E8%90%A5%E6%91%A9%E5%A4%A9%E8%BD%AE%E7%9A%84%E6%9C%80%E5%A4%A7%E5%88%A9%E6%B6%A6/"/>
      <url>2021/04/14/LeetCode%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-%E7%BB%8F%E8%90%A5%E6%91%A9%E5%A4%A9%E8%BD%AE%E7%9A%84%E6%9C%80%E5%A4%A7%E5%88%A9%E6%B6%A6/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æ˜¨å¤©è¯´ä»Šå¤©å‡†å¤‡åˆ·ä¸€ä¸‹<code>è´ªå¿ƒç®—æ³•</code>ï¼Œä»Šå¤©æ ¹æ®è´ªå¿ƒç®—æ³•çš„ tag æ‰¾äº†ä¸€ä¸ªé¢˜ç›®ã€‚é¢˜ç›®æœ¬èº«æ²¡æœ‰ç‰¹åˆ«éš¾ï¼Œæ•´ç†å®Œè¿™é¢˜çš„è§£é¢˜æ€è·¯ä¹‹åï¼Œæˆ‘ä¼šå†æ‰¾å‡ é¢˜çœ‹çœ‹æœ‰æ²¡æœ‰å…±æ€§æ€è·¯å¯ä»¥æ•´ç†åˆ†äº«ä¸€ä¸‹ã€‚</p><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>ä½ æ­£åœ¨ç»è¥ä¸€åº§æ‘©å¤©è½®ï¼Œè¯¥æ‘©å¤©è½®å…±æœ‰<code>4 ä¸ªåº§èˆ±</code> ï¼Œæ¯ä¸ªåº§èˆ± <code>æœ€å¤šå¯ä»¥å®¹çº³ 4 ä½æ¸¸å®¢</code> ã€‚ä½ å¯ä»¥ é€†æ—¶é’ˆ è½®è½¬åº§èˆ±ï¼Œä½†æ¯æ¬¡è½®è½¬éƒ½éœ€è¦æ”¯ä»˜ä¸€å®šçš„è¿è¡Œæˆæœ¬ <code>runningCost</code> ã€‚æ‘©å¤©è½®æ¯æ¬¡è½®è½¬éƒ½æ°å¥½è½¬åŠ¨ <code>1 / 4</code> å‘¨ã€‚</p><p>ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„ <code>customers</code> ï¼Œ <code>customers[i]</code> æ˜¯åœ¨ç¬¬ <code>i</code> æ¬¡è½®è½¬ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ä¹‹å‰åˆ°è¾¾çš„æ–°æ¸¸å®¢çš„æ•°é‡ã€‚è¿™ä¹Ÿæ„å‘³ç€ä½ å¿…é¡»åœ¨æ–°æ¸¸å®¢åˆ°æ¥å‰è½®è½¬ i æ¬¡ã€‚æ¯ä½æ¸¸å®¢åœ¨ç™»ä¸Šç¦»åœ°é¢æœ€è¿‘çš„åº§èˆ±å‰éƒ½ä¼šæ”¯ä»˜ç™»èˆ±æˆæœ¬ <code>boardingCost</code> ï¼Œä¸€æ—¦è¯¥åº§èˆ±å†æ¬¡æŠµè¾¾åœ°é¢ï¼Œä»–ä»¬å°±ä¼šç¦»å¼€åº§èˆ±ç»“æŸæ¸¸ç©ã€‚</p><p>ä½ å¯ä»¥éšæ—¶åœä¸‹æ‘©å¤©è½®ï¼Œå³ä¾¿æ˜¯ <code>åœ¨æœåŠ¡æ‰€æœ‰æ¸¸å®¢ä¹‹å‰</code> ã€‚å¦‚æœä½ å†³å®šåœæ­¢è¿è¥æ‘©å¤©è½®ï¼Œä¸ºäº†ä¿è¯æ‰€æœ‰æ¸¸å®¢å®‰å…¨ç€é™†ï¼Œå°†<code>å…è´¹è¿›è¡Œæ‰€æœ‰åç»­è½®è½¬</code> ã€‚æ³¨æ„ï¼Œå¦‚æœæœ‰è¶…è¿‡ 4 ä½æ¸¸å®¢åœ¨ç­‰æ‘©å¤©è½®ï¼Œé‚£ä¹ˆåªæœ‰ 4 ä½æ¸¸å®¢å¯ä»¥ç™»ä¸Šæ‘©å¤©è½®ï¼Œå…¶ä½™çš„éœ€è¦ç­‰å¾… <code>ä¸‹ä¸€æ¬¡è½®è½¬</code> ã€‚</p><p>è¿”å›æœ€å¤§åŒ–åˆ©æ¶¦æ‰€éœ€æ‰§è¡Œçš„ <code>æœ€å°è½®è½¬æ¬¡æ•°</code> ã€‚ å¦‚æœä¸å­˜åœ¨åˆ©æ¶¦ä¸ºæ­£çš„æ–¹æ¡ˆï¼Œåˆ™è¿”å› <code>-1</code> ã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/06dfd4f56d484929940737bc41fb87cc~tplv-k3u1fbpfcp-watermark.image" alt="wheeldiagram12.png"></p><p><strong>ç¤ºä¾‹</strong> 1ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šcustomers &#x3D; [8,3], boardingCost &#x3D; 5, runningCost &#x3D; 6</span><br><span class="line">è¾“å‡ºï¼š3</span><br><span class="line">è§£é‡Šï¼šåº§èˆ±ä¸Šæ ‡æ³¨çš„æ•°å­—æ˜¯è¯¥åº§èˆ±çš„å½“å‰æ¸¸å®¢æ•°ã€‚</span><br><span class="line">1. 8 ä½æ¸¸å®¢æŠµè¾¾ï¼Œ4 ä½ç™»èˆ±ï¼Œ4 ä½ç­‰å¾…ä¸‹ä¸€èˆ±ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 4 * $5 - 1 * $6 &#x3D; $14 ã€‚</span><br><span class="line">2. 3 ä½æ¸¸å®¢æŠµè¾¾ï¼Œ4 ä½åœ¨ç­‰å¾…çš„æ¸¸å®¢ç™»èˆ±ï¼Œå…¶ä»– 3 ä½ç­‰å¾…ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 8 * $5 - 2 * $6 &#x3D; $28 ã€‚</span><br><span class="line">3. æœ€å 3 ä½æ¸¸å®¢ç™»èˆ±ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 11 * $5 - 3 * $6 &#x3D; $37 ã€‚</span><br><span class="line">è½®è½¬ 3 æ¬¡å¾—åˆ°æœ€å¤§åˆ©æ¶¦ï¼Œæœ€å¤§åˆ©æ¶¦ä¸º $37 ã€‚</span><br></pre></td></tr></table></figure><br><strong>ç¤ºä¾‹</strong> 2ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šcustomers &#x3D; [10,9,6], boardingCost &#x3D; 6, runningCost &#x3D; 4</span><br><span class="line">è¾“å‡ºï¼š7</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">1. 10 ä½æ¸¸å®¢æŠµè¾¾ï¼Œ4 ä½ç™»èˆ±ï¼Œ6 ä½ç­‰å¾…ä¸‹ä¸€èˆ±ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 4 * $6 - 1 * $4 &#x3D; $20 ã€‚</span><br><span class="line">2. 9 ä½æ¸¸å®¢æŠµè¾¾ï¼Œ4 ä½ç™»èˆ±ï¼Œ11 ä½ç­‰å¾…ï¼ˆ2 ä½æ˜¯å…ˆå‰å°±åœ¨ç­‰å¾…çš„ï¼Œ9 ä½æ–°åŠ å…¥ç­‰å¾…çš„ï¼‰ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 8 * $6 - 2 * $4 &#x3D; $40 ã€‚</span><br><span class="line">3. æœ€å 6 ä½æ¸¸å®¢æŠµè¾¾ï¼Œ4 ä½ç™»èˆ±ï¼Œ13 ä½ç­‰å¾…ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 12 * $6 - 3 * $4 &#x3D; $60 ã€‚</span><br><span class="line">4. 4 ä½ç™»èˆ±ï¼Œ9 ä½ç­‰å¾…ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º * $6 - 4 * $4 &#x3D; $80 ã€‚</span><br><span class="line">5. 4 ä½ç™»èˆ±ï¼Œ5 ä½ç­‰å¾…ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 20 * $6 - 5 * $4 &#x3D; $100 ã€‚</span><br><span class="line">6. 4 ä½ç™»èˆ±ï¼Œ1 ä½ç­‰å¾…ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 24 * $6 - 6 * $4 &#x3D; $120 ã€‚</span><br><span class="line">7. 1 ä½ç™»èˆ±ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 25 * $6 - 7 * $4 &#x3D; $122 ã€‚</span><br><span class="line">è½®è½¬ 7 æ¬¡å¾—åˆ°æœ€å¤§åˆ©æ¶¦ï¼Œæœ€å¤§åˆ©æ¶¦ä¸º$122 ã€‚</span><br></pre></td></tr></table></figure></p><p><strong>ç¤ºä¾‹</strong> 3ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šcustomers &#x3D; [3,4,0,5,1], boardingCost &#x3D; 1, runningCost &#x3D; 92</span><br><span class="line">è¾“å‡ºï¼š-1</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">1. 3 ä½æ¸¸å®¢æŠµè¾¾ï¼Œ3 ä½ç™»èˆ±ï¼Œ0 ä½ç­‰å¾…ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 3 * $1 - 1 * $92 &#x3D; -$89 ã€‚</span><br><span class="line">2. 4 ä½æ¸¸å®¢æŠµè¾¾ï¼Œ4 ä½ç™»èˆ±ï¼Œ0 ä½ç­‰å¾…ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º is 7 * $1 - 2 * $92 &#x3D; -$177 ã€‚</span><br><span class="line">3. 0 ä½æ¸¸å®¢æŠµè¾¾ï¼Œ0 ä½ç™»èˆ±ï¼Œ0 ä½ç­‰å¾…ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 7 * $1 - 3 * $92 &#x3D; -$269 ã€‚</span><br><span class="line">4. 5 ä½æ¸¸å®¢æŠµè¾¾ï¼Œ4 ä½ç™»èˆ±ï¼Œ1 ä½ç­‰å¾…ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 12 * $1 - 4 * $92 &#x3D; -$356 ã€‚</span><br><span class="line">5. 1 ä½æ¸¸å®¢æŠµè¾¾ï¼Œ2 ä½ç™»èˆ±ï¼Œ0 ä½ç­‰å¾…ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 13 * $1 - 5 * $92 &#x3D; -$447 ã€‚</span><br><span class="line">åˆ©æ¶¦æ°¸ä¸ä¸ºæ­£ï¼Œæ‰€ä»¥è¿”å› -1 ã€‚</span><br></pre></td></tr></table></figure><br><strong>ç¤ºä¾‹</strong> 4ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šcustomers &#x3D; [10,10,6,4,7], boardingCost &#x3D; 3, runningCost &#x3D; 8</span><br><span class="line">è¾“å‡ºï¼š9</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">1. 10 ä½æ¸¸å®¢æŠµè¾¾ï¼Œ4 ä½ç™»èˆ±ï¼Œ6 ä½ç­‰å¾…ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 4 * $3 - 1 * $8 &#x3D; $4 ã€‚</span><br><span class="line">2. 10 ä½æ¸¸å®¢æŠµè¾¾ï¼Œ4 ä½ç™»èˆ±ï¼Œ12 ä½ç­‰å¾…ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 8 * $3 - 2 * $8 &#x3D; $8 ã€‚</span><br><span class="line">3. 6 ä½æ¸¸å®¢æŠµè¾¾ï¼Œ4 ä½ç™»èˆ±ï¼Œ14 ä½ç­‰å¾…ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 12 * $3 - 3 * $8 &#x3D; $12 ã€‚</span><br><span class="line">4. 4 ä½æ¸¸å®¢æŠµè¾¾ï¼Œ4 ä½ç™»èˆ±ï¼Œ14 ä½ç­‰å¾…ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 16 * $3 - 4 * $8 &#x3D; $16 ã€‚</span><br><span class="line">5. 7 ä½æ¸¸å®¢æŠµè¾¾ï¼Œ4 ä½ç™»èˆ±ï¼Œ17 ä½ç­‰å¾…ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 20 * $3 - 5 * $8 &#x3D; $20 ã€‚</span><br><span class="line">6. 4 ä½ç™»èˆ±ï¼Œ13 ä½ç­‰å¾…ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 24 * $3 - 6 * $8 &#x3D; $24 ã€‚</span><br><span class="line">7. 4 ä½ç™»èˆ±ï¼Œ9 ä½ç­‰å¾…ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 28 * $3 - 7 * $8 &#x3D; $28 ã€‚</span><br><span class="line">8. 4 ä½ç™»èˆ±ï¼Œ5 ä½ç­‰å¾…ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 32 * $3 - 8 * $8 &#x3D; $32 ã€‚</span><br><span class="line">9. 4 ä½ç™»èˆ±ï¼Œ1 ä½ç­‰å¾…ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 36 * $3 - 9 * $8 &#x3D; $36 ã€‚</span><br><span class="line">â€‹â€‹â€‹â€‹â€‹â€‹â€‹10. 1 ä½ç™»èˆ±ï¼Œ0 ä½ç­‰å¾…ï¼Œæ‘©å¤©è½®è½®è½¬ã€‚å½“å‰åˆ©æ¶¦ä¸º 37 * $3 - 10 * $8 &#x3D; $31 ã€‚</span><br><span class="line">è½®è½¬ 9 æ¬¡å¾—åˆ°æœ€å¤§åˆ©æ¶¦ï¼Œæœ€å¤§åˆ©æ¶¦ä¸º $36 ã€‚</span><br></pre></td></tr></table></figure></p><p><strong>æç¤º</strong>ï¼š</p><ul><li>n == customers.length</li><li>1 &lt;= n &lt;= 105</li><li>0 &lt;= customers[i] &lt;= 50</li><li>1 &lt;= boardingCost, runningCost &lt;= 100</li></ul><blockquote><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰&lt;/br&gt;<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/maximum-profit-of-operating-a-centennial-wheel" target="_blank" rel="noopener">https://leetcode-cn.com/problems/maximum-profit-of-operating-a-centennial-wheel</a>&lt;/br&gt;<br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p></blockquote><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>è¿™é¢˜æˆ‘ä»¬çš„å…³æ³¨ç‚¹å…¶å®åªè¦å…³æ³¨æœ€ä¸‹é¢çš„ä»“ä½å°±å¯ä»¥ï¼Œä¸ç®¡æ‘©å¤©è½®å¦‚ä½•è½®è½¬ï¼Œæœ€ä¸‹é¢çš„ä»“ä½æ°¸è¿œä¸ºç©ºã€‚å› ä¸ºè½¬æ¯æ¬¡é¡¾å®¢å®Œæˆä¸€å‘¨çš„æ—¶å€™å¿…å®šç¦»å¼€æ‘©å¤©è½®ã€‚å½“æˆ‘ä»¬å†³å®šåœæ­¢æœåŠ¡æ—¶å€™ï¼Œä¸ºäº†ä¿è¯æ‰€æœ‰æ¸¸å®¢å®‰å…¨ç€é™†ï¼Œå°†<code>å…è´¹è¿›è¡Œæ‰€æœ‰åç»­è½®è½¬</code> ã€‚ä¹Ÿå°±æ˜¯åç»­è´¹ç”¨éƒ½ä¸åœ¨è€ƒè™‘èŒƒå›´ä¹‹å†…ã€‚</p><p>ç†è§£äº†è¿™äº›ï¼Œè¿™é¢˜æ˜¯æ€è·¯å°±é€æ¸å˜å¾—æ¸…æ™°èµ·æ¥ã€‚æˆ‘ä»¬åªè¦ä¿è¯æ¯æ¬¡æœ€ä¸‹é¢çš„æ‘©å¤©è½®ä¸Šçš„äººæ•°è¶³å¤Ÿå¤šï¼Œå»é™¤å›ºå®šè½®è½¬æˆæœ¬ï¼Œå°±èƒ½è®©æˆ‘ä»¬çš„æ”¶ç›Šæœ€å¤§åŒ–ã€‚å¤§è‡´æ•´ç†ä¸€ä¸‹æ€è·¯ï¼š</p><ul><li>å½“ <code>i</code> æ‰¹æ¸¸å®¢å¤§äº4äººï¼š<code>customer[i] - 4</code> äººæ’é˜Ÿç­‰å¾…ï¼Œæ­¤æ¬¡åˆ©æ¶¦ä¸ºï¼š4 * boardingCost - runningCost</li><li>å½“ <code>i</code> æ‰¹æ¸¸å®¢å°äº4äººï¼š<code>customer[i]</code> äººå…¨éƒ¨ä¹˜ä»“ï¼Œæ­¤æ¬¡åˆ©æ¶¦ä¸ºï¼šcustomer[i] * boardingCost - runningCost</li></ul><p>å¦‚æœç©·ä¸¾æƒ…å½¢ï¼Œæ— éæœ‰è¿™æ ·å‡ ç§æƒ…å½¢</p><ol><li>customer[i] å°äºç­‰äº4  å…¨éƒ¨ç™»ä»“</li><li>customer[i] å¤§äº4  ç™»ä»“4äººï¼Œå°†ç­‰å¾…äººæ•°åŠ å…¥customer[i+1] ï¼Œè¿™æ ·ä¸‹æ¬¡å¾ªç¯ä¸å½±å“ 1 ä¸­çš„æƒ…å½¢</li><li>å…¨éƒ¨éå†ä¹‹åï¼Œcustomer[customer.length-1] å¤§äº 4 ã€‚å‡å» 4 ä¸ªå·²ç™»æœºäººæ•°ã€‚</li><li>å¯¹äº customer[customer.length-1] å‰©ä¸‹äººæ•°ï¼Œå°½å¯èƒ½æ¯æ¬¡ä¸Šçš„æœ€å¤šã€‚</li></ol><h3 id="æœ€ç»ˆä»£ç "><a href="#æœ€ç»ˆä»£ç " class="headerlink" title="æœ€ç»ˆä»£ç "></a>æœ€ç»ˆä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minOperationsMaxProfit</span><span class="params">(<span class="keyword">int</span>[] customers, <span class="keyword">int</span> boardingCost, <span class="keyword">int</span> runningCost)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> minRotaes = <span class="number">0</span>, maxProfit = <span class="number">0</span>, currentProfit = <span class="number">0</span>, currentRotaes = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; customers.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (customers[i] &lt;= <span class="number">4</span>) &#123;</span><br><span class="line">                currentProfit += customers[i] * boardingCost - runningCost;</span><br><span class="line">                currentRotaes++;</span><br><span class="line">                <span class="keyword">if</span> (maxProfit &lt; currentProfit) &#123;</span><br><span class="line">                    minRotaes = currentRotaes;</span><br><span class="line">                    maxProfit = currentProfit;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                currentProfit += <span class="number">4</span> * boardingCost - runningCost;</span><br><span class="line">                currentRotaes++;</span><br><span class="line">                <span class="keyword">if</span> (maxProfit &lt; currentProfit) &#123;</span><br><span class="line">                    minRotaes = currentRotaes;</span><br><span class="line">                    maxProfit = currentProfit;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (i &lt; customers.length - <span class="number">1</span>) &#123;</span><br><span class="line">                    customers[i + <span class="number">1</span>] += customers[i] - <span class="number">4</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        customers[customers.length - <span class="number">1</span>] -= <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">while</span> (customers[customers.length - <span class="number">1</span>] &gt; <span class="number">4</span>) &#123;</span><br><span class="line">            currentProfit += <span class="number">4</span> * boardingCost - runningCost;</span><br><span class="line">            currentRotaes++;</span><br><span class="line">            customers[customers.length - <span class="number">1</span>] -= <span class="number">4</span>;</span><br><span class="line">            <span class="keyword">if</span> (maxProfit &lt; currentProfit) &#123;</span><br><span class="line">                minRotaes = currentRotaes;</span><br><span class="line">                maxProfit = currentProfit;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (customers[customers.length - <span class="number">1</span>] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            currentProfit += customers[customers.length - <span class="number">1</span>] * boardingCost - runningCost;</span><br><span class="line">            currentRotaes++;</span><br><span class="line">            <span class="keyword">if</span> (maxProfit &lt; currentProfit) &#123;</span><br><span class="line">                minRotaes = currentRotaes;</span><br><span class="line">                maxProfit = currentProfit;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> minRotaes &gt; <span class="number">0</span> ? minRotaes : -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h3><p>æˆ‘ä»¥ä¸ºè¿™ä¸€é¢˜ä¼šæœ‰ä¸€äº›å·§å¦™çš„è§£æ³•ï¼Œç”šè‡³å»ç ”ç©¶äº†ä¸€ä¸‹å…¶ä»–äººçš„è§£æ³•ã€‚å‘ç°æ™®ééƒ½æ˜¯æŠŠé¢˜ç›®ç¿»è¯‘ä¸€ä¸‹ï¼Œæ²¡æœ‰èŠ±å“¨çš„æ“ä½œã€‚æ™šç‚¹æ—¶é—´æˆ‘æ‰¾å‡ ä¸ªå…¸å‹çš„è´ªå¿ƒç®—æ³•æ•´ç†ä¸€ä¸‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> leetcode </tag>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCodeæ¯æ—¥ä¸€é¢˜--éªŒè¯å›æ–‡ä¸²</title>
      <link href="2021/04/14/LeetCode%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-%E9%AA%8C%E8%AF%81%E5%9B%9E%E6%96%87%E4%B8%B2/"/>
      <url>2021/04/14/LeetCode%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-%E9%AA%8C%E8%AF%81%E5%9B%9E%E6%96%87%E4%B8%B2/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ä»Šå¤©é¢˜ç›®æ˜¯è¯¯æ‰“è¯¯æ’é‡åˆ°çš„ã€‚åŸæœ¬æƒ³åˆ·ä¸€ä¸‹äº”å¤§å¸¸ç”¨ç®—æ³•ä¹‹ä¸€çš„â€” <code>è´ªå¿ƒç®—æ³•</code> ï¼Œç”¨æ ‡ç­¾æœäº†ä¸€ä¸‹è´ªå¿ƒç®—æ³•ï¼Œç‚¹è¿›å»ä¹‹åå‘ç°å¹¶ä¸æ˜¯ã€‚ä½†æ˜¯é‡åˆ°å°±æ˜¯ç¼˜åˆ†ï¼Œå¹¶ä¸”è¿™é¢˜çš„è§£é¢˜æ€è·¯å¾ˆåƒå¿«é€Ÿæ’åºï¼Œå› æ­¤ä»Šå¤©é¡ºä¾¿å¤ä¹ ä¸€ä¸‹å¿«é€Ÿæ’åºï¼Œä¹ŸåŒæ—¶å¯ä»¥å¤ä¹ ä¸€ä¸‹äº”å¤§å¸¸ç”¨ç®—æ³•çš„å¦ä¸€ç§â€” <code>åˆ†æ²»ç®—æ³•</code> ã€‚æ˜å¤©åº”è¯¥ä¼šæ•´ç†ä¸€ä¸‹è´ªå¿ƒç®—æ³•çš„è§£é¢˜æ€è·¯ã€‚</p><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒéªŒè¯å®ƒæ˜¯å¦æ˜¯å›æ–‡ä¸²ï¼Œåªè€ƒè™‘å­—æ¯å’Œæ•°å­—å­—ç¬¦ï¼Œå¯ä»¥å¿½ç•¥å­—æ¯çš„å¤§å°å†™ã€‚</p><p><strong>è¯´æ˜</strong>ï¼šæœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬å°†ç©ºå­—ç¬¦ä¸²å®šä¹‰ä¸ºæœ‰æ•ˆçš„å›æ–‡ä¸²ã€‚</p><p><strong>ç¤ºä¾‹</strong> 1:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: &quot;A man, a plan, a canal: Panama&quot;</span><br><span class="line">è¾“å‡º: true</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong> 2:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: &quot;race a car&quot;</span><br><span class="line">è¾“å‡º: false</span><br></pre></td></tr></table></figure><blockquote><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/valid-palindrome" target="_blank" rel="noopener">https://leetcode-cn.com/problems/valid-palindrome</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p></blockquote><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>å¯¹äºæœ¬é¢˜ï¼Œéš¾å…ä¼šæ¶‰åŠå‰åä¸¤ä¸ªå…ƒç´ æ¯”å¯¹ã€‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸¤ä¸ª <code>æ¸¸æ ‡</code> ä¸€ä¸ªä»å­—ç¬¦ä¸²çš„èµ·å§‹ä½ï¼Œä¸€ä¸ªä»å­—ç¬¦ä¸²çš„æœ«ä½ï¼Œä¾æ¬¡éå†ã€‚é‡åˆ°æ— æ•ˆå­—ç¬¦æ¸¸æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œå½“ <code>left</code> å’Œ <code>right</code> ç›¸é‡ä¹‹åã€‚è¯´æ˜åœ¨æ­¤ä¹‹å‰æ‰€æœ‰çš„å…ƒç´ å…¨éƒ¨ç›¸åŒã€‚å¦‚æœåœ¨ç›¸é‡ä¹‹å‰å·²ç»é‡åˆ°ä¸åŒ¹é…çš„å­—ç¬¦ï¼Œè¯´æ˜åŒ¹é…å¤±è´¥ã€‚</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/02bc146c007044bfabd5a79176e7768f~tplv-k3u1fbpfcp-watermark.image" alt="æœªå‘½åæ–‡ä»¶.png"></p><p>æ ¹æ®è¿™æ ·çš„æ€è·¯å¯ä»¥å†™å‡ºä¸€æ®µä¼ªä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">BEGIN:</span><br><span class="line">    <span class="keyword">while</span>: left!= right then</span><br><span class="line">    <span class="keyword">do</span>:</span><br><span class="line">        <span class="keyword">if</span>(leftå­—ç¬¦æ— æ•ˆ) then</span><br><span class="line">                left++;</span><br><span class="line">                CONTINUE;</span><br><span class="line">        END <span class="keyword">if</span>;</span><br><span class="line">        <span class="keyword">if</span>(rightå­—ç¬¦æ— æ•ˆ) then</span><br><span class="line">                right++;</span><br><span class="line">                CONTINUE;</span><br><span class="line">        END <span class="keyword">if</span>;</span><br><span class="line">        <span class="keyword">if</span>(leftå­—ç¬¦ï¼=rightå­—ç¬¦)</span><br><span class="line">                BREAK;</span><br><span class="line">    END <span class="keyword">while</span>;</span><br><span class="line">    <span class="keyword">return</span> left== right;</span><br><span class="line">END</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·å…¶å®è¿˜æ˜¯æœ‰ä¸€ç‚¹é—®é¢˜çš„ï¼Œ <code>left</code> çœŸçš„èƒ½æ¯æ¬¡éƒ½é‡åˆ° <code>right</code> å—ï¼Ÿå¦‚æœè¾“å…¥çš„å­—ç¬¦ä¸²ä¸­æœ‰æ•ˆå­—ç¬¦ä¸ªæ•°æ˜¯å¥‡æ•°ï¼Œå¯ä»¥é‡åˆ°ã€‚ä½†æ˜¯å¦‚æœæœ‰æ•ˆå­—ç¬¦ä¸ªæ•°æ˜¯å¶æ•°ï¼Œå¦‚ <code>aa</code> , left å’Œ right åŒ¹é…æˆåŠŸã€‚è¿™æ—¶ï¼Œ left å’Œ right åˆ†åˆ«ç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œä»–ä»¬ä¾¿å®Œç¾çš„æ“¦è‚©è€Œè¿‡ã€‚ä»–ä»¬æ“¦è‚©è€Œè¿‡ï¼Œä¹Ÿèƒ½ä»£è¡¨åœ¨æ“¦è‚©ä¹‹å‰æ‰€æœ‰çš„å­—ç¬¦ä¸²éƒ½æ˜¯åŒ¹é…ä¸Šçš„ï¼Œå› æ­¤çœŸå®çš„ä¸´ç•Œæ¡ä»¶åº”è¯¥æ˜¯ <code>left &lt; right</code> ã€‚æ•´ç†ä¸€ä¸‹æœ€ç»ˆçš„ä»£ç ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPalindrome</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        String inStr = s.toLowerCase();</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, right = inStr.length() - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!Character.isLetterOrDigit(inStr.charAt(left))) &#123;</span><br><span class="line">                ++left;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!Character.isLetterOrDigit(inStr.charAt(right))) &#123;</span><br><span class="line">                --right;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (inStr.charAt(left) != inStr.charAt(right))</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            ++left;</span><br><span class="line">            --right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left &gt;= right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ¸¸æ ‡æ“ä½œï¼Œå¾ˆå®¹æ˜“è”æƒ³åˆ°å¿«é€Ÿæ’åºã€‚æ’åºç®—æ³•çš„æ€æƒ³æ˜¯åœ¨å¾…æ’åºçš„æ•°åˆ—ä¸­ï¼Œé¦–å…ˆæ‰¾ä¸€ä¸ªæ•°å­—ä½œä¸ºåŸºå‡†æ•°ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªå¾…æ’åºçš„æ•°åˆ—ä¸­å°äºåŸºå‡†æ•°çš„å…ƒç´ ç§»åŠ¨åˆ°å¾…æ’åºçš„æ•°åˆ—çš„å·¦è¾¹ï¼ŒæŠŠå¤§äºåŸºå‡†æ•°çš„å…ƒç´ ç§»åŠ¨åˆ°å¾…æ’åºçš„æ•°åˆ—çš„å³è¾¹ã€‚è¿™æ—¶å€™å·¦è¾¹çš„å…ƒç´ è‚¯å®šå…¨éƒ¨å°äº<code>åŸºå‡†æ•°</code>å°äºå³è¾¹å…ƒç´ ã€‚æ¥ç€å†åˆ†åˆ«å¯¹å·¦å³ä¸¤ä¸ªåˆ†åŒºé‡å¤è¿™ä¸ªæ“ä½œï¼Œç›´è‡³å®Œå…¨æœ‰åºã€‚</p><p>è¿™é‡Œä»¥ 47ã€29ã€71ã€99ã€78ã€19ã€24ã€47 ä¸ºä¾‹ã€‚é¦–å…ˆé€‰å–ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºåŸºå‡†å€¼ã€‚å®šä¹‰ä¸¤ä¸ª <code>æ¸¸æ ‡</code> i å’Œ j ï¼Œå°† <code>i</code> æ¸¸æ ‡ä¾æ¬¡å‘å‰ç§»åŠ¨ï¼Œæ‰¾åˆ°æ¯”åŸºå‡†æ•°å°çš„å°±äº¤æ¢ã€‚æ¥ç€ç§»åŠ¨æ¸¸æ ‡ <code>j</code> ä»å·¦è¾¹å¼€å§‹å¾€å³è¾¹æ‰¾ï¼Œæ‰¾åˆ°ç¬¬ 1 ä¸ªæ¯”åŸºå‡†æ•°å¤§çš„å€¼ï¼Œè®©å®ƒä¸åŸºå‡†å€¼äº¤æ¢ï¼›ç„¶åç»§ç»­å¯»æ‰¾ï¼Œç›´åˆ° i ä¸ j ç›¸é‡æ—¶ç»“æŸï¼Œæœ€ååŸºå‡†å€¼æ‰€åœ¨çš„ä½ç½®å³ k çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´ k å·¦è¾¹çš„å€¼å‡æ¯” k ä¸Šçš„å€¼å°ï¼Œè€Œ k å³è¾¹çš„å€¼éƒ½æ¯” k ä¸Šçš„å€¼å¤§ã€‚</p><p>æ‰€ä»¥å¯¹äºä¸Šé¢çš„æ•°åˆ— 47ã€29ã€71ã€99ã€78ã€19ã€24ã€47ï¼Œè¿›è¡Œç¬¬ 1 è¶Ÿç¬¬ 1 ä¸ªäº¤æ¢çš„æ’åºæƒ…å†µå¦‚ä¸‹ï¼Œç¬¬ 1 æ¬¡çš„æ“ä½œæƒ…å†µå›¾æ‰€ç¤ºã€‚</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5ff6c592995549a4924416f25bc71e64~tplv-k3u1fbpfcp-watermark.image" alt="1-jpg.jpg"></p><p>äº¤æ¢ä¹‹åï¼Œj ç§»åŠ¨åˆ°äº†ä¸‹æ ‡ä¸º 6 çš„ä½ç½®ï¼Œå¯¹ i ç»§ç»­æ‰«æï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/29abc35db495427faed4aefa8c012187~tplv-k3u1fbpfcp-watermark.image" alt="2-1Q00220013M46.jpg"></p><p>æ­¤æ—¶äº¤æ¢åçš„æ•°åˆ—å˜ä¸º 24ã€29ã€47ã€99ã€78ã€19ã€71ã€47ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­å¯¹ iã€j è¿›è¡Œæ“ä½œï¼Œå¦‚å›¾ 3 æ‰€ç¤ºï¼Œç»§ç»­è¿›è¡Œ iâ€” åŠ j++ çš„æ¯”è¾ƒæ“ä½œã€‚</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3a6e1191f2334471a8664b3492f3ef1b~tplv-k3u1fbpfcp-watermark.image" alt="3-1Q00220025I54.jpg"></p><p>è¿›è¡Œäº†è¿™ä¸¤æ¬¡ iã€j çš„ç§»åŠ¨ã€æ¯”è¾ƒã€äº¤æ¢ä¹‹åï¼Œæˆ‘ä»¬æœ€ç»ˆå¾—åˆ°çš„æ•°åˆ—æ˜¯ 24ã€29ã€19ã€47ã€78ã€99ã€71ã€47ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­è¿›è¡Œ iâ€” çš„æ“ä½œï¼Œå‘ç°åœ¨ i ä¸º 4 æ—¶æ¯” 47 å¤§ä¸ç”¨äº¤æ¢ï¼Œåœ¨ i ä¸º 3 æ—¶ä¸ j ç›¸é‡ï¼Œè¿™æ—¶å°±ä¸éœ€è¦ç»§ç»­ç§»åŠ¨ã€æ¯”è¾ƒäº†ï¼Œå·²ç»æ‰¾åˆ° k äº†ï¼Œå¹¶ä¸” k çš„å€¼ä¸º 3ã€‚æˆ‘ä»¬å¯ä»¥ç¡®è®¤ä¸€ä¸‹å½“å‰çš„æ•°åˆ—æ˜¯ä¸æ˜¯ k å·¦è¾¹çš„å€¼éƒ½æ¯” 47 å°ï¼Œè€Œ k å³è¾¹çš„å€¼éƒ½æ¯” 47 å¤§ï¼ˆç”±äºè¦ä¿æŒç›¸å¯¹ä½ç½®ä¸å˜ï¼Œæ‰€ä»¥ 47 åŒæ ·åœ¨åŸºå‡†å€¼ 47 çš„å³è¾¹ï¼‰ã€‚</p><p>47 è¿™ä¸ªå€¼å·²ç»è½åˆ°äº†å®ƒè¯¥åœ¨çš„ä½ç½®ï¼Œç¬¬ 1 è¶Ÿæ’åºå®Œæˆäº†ã€‚æ¥ä¸‹æ¥å°±æ˜¯ä»¥ k ä¸ºåŸºå‡†ï¼Œåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œç„¶ååœ¨å·¦å³ä¸¤éƒ¨åˆ†åˆ†åˆ«æ‰§è¡Œä¸Šè¿°æ’åºæ“ä½œï¼Œæœ€åæ•°æ®ä¼šåˆ†ä¸º 4 éƒ¨åˆ†ï¼›æ¥ç€å¯¹æ¯éƒ¨åˆ†è¿›è¡Œæ“ä½œï¼Œç›´åˆ°æ¯éƒ¨åˆ†éƒ½åªæœ‰ä¸€ä¸ªå€¼ä¸ºæ­¢ã€‚</p><blockquote><p>æ ·ä¾‹æ¥æºï¼šã€Šæ•°æ®ç»“æ„ä¸ç®—æ³•æ•™ç¨‹ã€‹&lt;/br&gt;<br>é“¾æ¥ï¼š<a href="http://data.biancheng.net/view/117.html" target="_blank" rel="noopener">http://data.biancheng.net/view/117.html</a></p></blockquote><h3 id="å¿«æ’ä»£ç "><a href="#å¿«æ’ä»£ç " class="headerlink" title="å¿«æ’ä»£ç "></a>å¿«æ’ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuickSort</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] array;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">QuickSort</span><span class="params">(<span class="keyword">int</span>[] array)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.array = array;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        quickSort(array, <span class="number">0</span>, array.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length; i++) &#123;</span><br><span class="line">            System.out.println(array[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€’å½’æ’åº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> src</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(<span class="keyword">int</span>[] src, <span class="keyword">int</span> begin, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (begin &lt; end) &#123;</span><br><span class="line">            <span class="keyword">int</span> key = src[begin];</span><br><span class="line">            <span class="keyword">int</span> i = begin;</span><br><span class="line">            <span class="keyword">int</span> j = end;</span><br><span class="line">            <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">                <span class="keyword">while</span> (i &lt; j &amp;&amp; src[j] &gt; key) &#123;</span><br><span class="line">                    j--;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (i &lt; j) &#123;</span><br><span class="line">                    src[i] = src[j];</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">while</span> (i &lt; j &amp;&amp; src[i] &lt; key) &#123;</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (i &lt; j) &#123;</span><br><span class="line">                    src[j] = src[i];</span><br><span class="line">                    j--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            src[i] = key;</span><br><span class="line">            quickSort(src, begin, i - <span class="number">1</span>);</span><br><span class="line">            quickSort(src, i + <span class="number">1</span>, end);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ’åºç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æœ¬è´¨å…¶å®æ˜¯åˆ†æ²»æ€æƒ³ï¼ŒæŠŠé—®é¢˜åˆ†ä¸ºä¸€ä¸ªä¸ªçš„å°éƒ¨åˆ†æ¥åˆ†åˆ«è§£å†³ï¼Œå†æŠŠç»“æœç»„åˆèµ·æ¥ã€‚è¿™é¢˜é€šè¿‡ä¸€ä¸ªå°çš„æ¸¸æ ‡æ“ä½œå¼ºè¡ŒæŠŠå¿«æ’æ‹‰äº†è¿‡æ¥ã€‚è™½ç„¶é¢˜ç›®ç®€å•ï¼Œä½†æ˜¯èƒ½å¤ä¹ ä¸€ä¸‹ <code>åˆ†æ²»ç®—æ³•</code> ï¼Œä¹Ÿå·©å›ºäº†ä¸€ä¸‹å¿«é€Ÿæ’åºï¼Œä¹Ÿç®—ä»Šå¤©æœ‰æ‰€æ”¶è·å§ã€‚</p><p>æœ¬æ–‡æ­£åœ¨å‚ä¸ã€Œæ˜é‡‘ 2021 4 æœˆåˆ·é¢˜æ‰“å¡ã€, ç‚¹å‡»æŸ¥çœ‹ <a href="https://juejin.cn/post/6946462614306160670/" target="_blank" rel="noopener">æ´»åŠ¨è¯¦æƒ…</a>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> leetcode </tag>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCodeæ¯æ—¥ä¸€é¢˜--æŒ‰æ—¢å®šé¡ºåºåˆ›å»ºç›®æ ‡æ•°ç»„</title>
      <link href="2021/04/14/LeetCode%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-%E6%8C%89%E6%97%A2%E5%AE%9A%E9%A1%BA%E5%BA%8F%E5%88%9B%E5%BB%BA%E7%9B%AE%E6%A0%87%E6%95%B0%E7%BB%84/"/>
      <url>2021/04/14/LeetCode%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-%E6%8C%89%E6%97%A2%E5%AE%9A%E9%A1%BA%E5%BA%8F%E5%88%9B%E5%BB%BA%E7%9B%AE%E6%A0%87%E6%95%B0%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ä»Šå¤©åˆ·åˆ°çš„è¿™ä¸ªé¢˜ç›®ï¼Œä»éš¾åº¦è€Œè¨€éå¸¸ç®€å•ï¼Œç”šè‡³å¯ä»¥ç¬ç§’ï¼Œä½†æ˜¯å»¶ä¼¸ä¸€ä¸‹å¾ˆå®¹æ˜“æƒ³åˆ°åŸºç¡€æ’åºé‡Œé¢éå¸¸å¸¸è§çš„ä¸€ç§â€”<code>æ’å…¥æ’åº</code> ã€‚æ‰€ä»¥å€Ÿç€ä»Šå¤©çš„é¢˜ç›®ï¼Œæ­£å¥½é¢å¤–å¤ä¹ ä¸€ä¸‹æ’å…¥æ’åºã€‚</p><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>ç»™ä½ ä¸¤ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> å’Œ <code>index</code>ã€‚ä½ éœ€è¦æŒ‰ç…§ä»¥ä¸‹è§„åˆ™åˆ›å»ºç›®æ ‡æ•°ç»„ï¼š</p><ul><li>ç›®æ ‡æ•°ç»„ <code>target</code> æœ€åˆä¸ºç©ºã€‚</li><li>æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºä¾æ¬¡è¯»å– <code>nums[i]</code> å’Œ <code>index[i]</code>ï¼Œåœ¨ <code>target</code> æ•°ç»„ä¸­çš„ä¸‹æ ‡ <code>index[i]</code> å¤„æ’å…¥å€¼ <code>nums[i]</code> ã€‚</li><li>é‡å¤ä¸Šä¸€æ­¥ï¼Œç›´åˆ°åœ¨ <code>nums</code> å’Œ <code>index</code> ä¸­éƒ½æ²¡æœ‰è¦è¯»å–çš„å…ƒç´ ã€‚</li></ul><p>è¯·ä½ è¿”å›ç›®æ ‡æ•°ç»„ã€‚</p><p>é¢˜ç›®ä¿è¯æ•°å­—æ’å…¥ä½ç½®æ€»æ˜¯å­˜åœ¨ã€‚</p><p><strong>ç¤ºä¾‹</strong> 1ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums &#x3D; [0,1,2,3,4], index &#x3D; [0,1,2,2,1]</span><br><span class="line">è¾“å‡ºï¼š[0,4,1,3,2]</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">nums       index     target</span><br><span class="line">0            0        [0]</span><br><span class="line">1            1        [0,1]</span><br><span class="line">2            2        [0,1,2]</span><br><span class="line">3            2        [0,1,3,2]</span><br><span class="line">4            1        [0,4,1,3,2]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong> 2ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums &#x3D; [1,2,3,4,0], index &#x3D; [0,1,2,3,0]</span><br><span class="line">è¾“å‡ºï¼š[0,1,2,3,4]</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">nums       index     target</span><br><span class="line">1            0        [1]</span><br><span class="line">2            1        [1,2]</span><br><span class="line">3            2        [1,2,3]</span><br><span class="line">4            3        [1,2,3,4]</span><br><span class="line">0            0        [0,1,2,3,4]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong> 3ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums &#x3D; [1], index &#x3D; [0]</span><br><span class="line">è¾“å‡ºï¼š[1]</span><br></pre></td></tr></table></figure></p><p><strong>æç¤º</strong>ï¼š</p><ul><li>1 &lt;= nums.length, index.length &lt;= 100</li><li>nums.length == index.length</li><li>0 &lt;= nums[i] &lt;= 100</li><li>0 &lt;= index[i] &lt;= i</li></ul><blockquote><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/create-target-array-in-the-given-order" target="_blank" rel="noopener">https://leetcode-cn.com/problems/create-target-array-in-the-given-order</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p></blockquote><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>è¿™ä¸ªé¢˜ç›®ä¸»è¦è¿˜æ˜¯æŠŠé¢˜ç›®æ„æ€ç†è§£æ¸…æ¥šã€‚æ ¹æ®ç¤ºä¾‹ï¼Œå½“æ–°æ•°ç»„å¯¹åº” <code>index[i]</code> ä¸‹æ ‡å·²ç»å­˜åœ¨å…ƒç´ æ—¶ï¼Œæ–°çš„ <code>num[i]</code> ä¼šæ’å…¥åˆ°è¿™ä¸ªåæ ‡ä¹‹ä¸­ã€‚åŸæœ¬å¡«å……åœ¨ <code>index[i]</code> å…ƒç´ ä¼šä¾æ¬¡å‘åç§»åŠ¨ä¸€ä½ã€‚ç†è§£äº†è¿™ä¸ªä¹‹åã€‚å°±ä¼šå‘ç°ï¼Œç›¸å½“äºå¯¹æ¯ä¸ªå…ƒç´ ï¼Œä»–éƒ½æ˜¯æ‰§è¡Œäº†ä¸€ä¸ªæ’å…¥æ“ä½œã€‚æ‰€ä»¥ä»£ç ä¹Ÿå°±èƒ½å¾ˆå®¹æ˜“å†™å‡ºæ¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[] array;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] createTargetArray(<span class="keyword">int</span>[] nums, <span class="keyword">int</span>[] index) &#123;</span><br><span class="line">        array = <span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            generateNewArray(nums[i], index[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ’å…¥æ•°æ®</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">generateNewArray</span><span class="params">(<span class="keyword">int</span> num, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = array.length - <span class="number">1</span>; i &gt; index; i--) &#123;</span><br><span class="line">            array[i] = array[i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        array[index] = num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>LeetCode å®˜ç½‘é¢˜è§£å¼•äº†ä¸ª List ï¼Œä½†æ˜¯æ®Šé€”åŒå½’ï¼Œä¹Ÿæ˜¯å¯¹æ¯ä¸ªå…ƒç´ åšæ’å…¥æ“ä½œã€‚ä»£ç ä¹Ÿè´´å‡ºæ¥çœ‹ä¸€ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] createTargetArray(<span class="keyword">int</span>[] nums, <span class="keyword">int</span>[] index) &#123;</span><br><span class="line">        List&lt;Integer&gt; targetList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            targetList.add(index[i],nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span>[] target = <span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            target[i] = targetList.get(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> target;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é¢˜ç›®åˆ°è¿™é‡Œç»“æŸäº†ã€‚ä½†æ˜¯è¿™ä¸ªæ’å…¥è¿‡ç¨‹ï¼Œå¾ˆåƒæˆ‘ä»¬åšæ’æ’çš„æ—¶å€™ã€‚æˆ‘ä»¬åšæ’æ’çš„æ—¶å€™ï¼Œé»˜è®¤ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æœ€å°çš„å…ƒç´ ï¼Œä» <code>i=1</code> å¼€å§‹éå†ï¼Œå¦‚ (a) ä» 2 å¼€å§‹éå†ï¼Œç„¶åå¯»æ‰¾æ’å…¥ä½ç½®ã€‚å¦‚æœåœ¨å·¦è¾¹æ‰¾åˆ°äº†æ’å…¥ä½ç½®ï¼Œé‚£ä¹ˆå·¦è¾¹æ’å…¥ä¹‹åå°±æ˜¯æœ‰åºçš„ï¼Œå¦‚æœå·¦è¾¹æ²¡æœ‰æ’å…¥ä½ç½®ï¼Œè¯´æ˜å·¦è¾¹æ‰€æœ‰å…ƒç´ åŒ…æ‹¬å½“å‰å…ƒç´ ï¼Œéƒ½æ˜¯æœ‰åºçš„ï¼Œå¦‚å›¾ (d) ã€‚</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bea5f449848b45b1a1d45be20f571977~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><h3 id="æ’å…¥æ’åºä»£ç "><a href="#æ’å…¥æ’åºä»£ç " class="headerlink" title="æ’å…¥æ’åºä»£ç "></a>æ’å…¥æ’åºä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] insertSort(<span class="keyword">int</span>[] arr) &#123;</span><br><span class="line">        <span class="comment">// ä»ä¸‹æ ‡ä¸º1çš„å…ƒç´ å¼€å§‹é€‰æ‹©åˆé€‚çš„ä½ç½®æ’å…¥ï¼Œå› ä¸ºä¸‹æ ‡ä¸º0çš„åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œé»˜è®¤æ˜¯æœ‰åºçš„</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            <span class="comment">// è®°å½•è¦æ’å…¥çš„æ•°æ®</span></span><br><span class="line">            <span class="keyword">int</span> tmp = arr[i];</span><br><span class="line">            <span class="comment">// ä»å·²ç»æ’åºçš„åºåˆ—æœ€å³è¾¹çš„å¼€å§‹æ¯”è¾ƒï¼Œæ‰¾åˆ°æ¯”å…¶å°çš„æ•°</span></span><br><span class="line">            <span class="keyword">int</span> j = i;</span><br><span class="line">            <span class="keyword">while</span> (j &gt; <span class="number">0</span> &amp;&amp; tmp &lt; arr[j - <span class="number">1</span>]) &#123;</span><br><span class="line">                arr[j] = arr[j - <span class="number">1</span>]; </span><br><span class="line">                j--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å­˜åœ¨æ¯”å…¶å°çš„æ•°ï¼Œæ’å…¥</span></span><br><span class="line">            <span class="keyword">if</span> (j != i) &#123;</span><br><span class="line">                arr[j] = tmp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> arr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä»Šå¤©é¢˜ç›®ä¸éš¾ï¼Œä½†æ˜¯å¤šå¤ä¹ äº†ä¸€ä¸ªåŸºç¡€æ’åºï¼Œæ„Ÿè§‰ä¹Ÿæ˜¯æœ‰æ‰€æ”¶è·ã€‚åœ¨æ¯æ¬¡åˆ·é¢˜çš„æ—¶å€™ï¼Œå¤šå»æ€è€ƒä¹‹å‰æ˜¯å¦é‡åˆ°ç›¸ä¼¼åœºæ™¯ã€‚ä¸è‡³äºé—å¿˜ä¹‹å‰çš„çŸ¥è¯†ã€‚é¡ºä¾¿æ¨èä¸€ä¸‹æˆ‘æœ€è¿‘ä¸¤å¤©çš„æ–‡ç« ï¼Œä¹Ÿæ˜¯å¾ˆæœ‰å…±æ€§çš„ä¸¤ç¯‡åŠ¨æ€è§„åˆ’ï¼š</p><ul><li><a href="https://juejin.cn/post/6949201709608468510" target="_blank" rel="noopener">[LeetCode1262é¢˜ - å¯è¢«ä¸‰æ•´é™¤çš„æœ€å¤§å’Œ] | åˆ·é¢˜æ‰“å¡</a></li><li><a href="https://juejin.cn/post/6949809128680194079" target="_blank" rel="noopener">[LeetCode70é¢˜ - çˆ¬æ¥¼æ¢¯] | åˆ·é¢˜æ‰“å¡</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> leetcode </tag>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCodeæ¯æ—¥ä¸€é¢˜--çˆ¬æ¥¼æ¢¯</title>
      <link href="2021/04/14/LeetCode%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-%E7%88%AC%E6%A5%BC%E6%A2%AF/"/>
      <url>2021/04/14/LeetCode%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-%E7%88%AC%E6%A5%BC%E6%A2%AF/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æ˜¨å¤©å°è¯•äº†ç¬¬ä¸€ä¸ªåŠ¨æ€è§„åˆ’é¢˜ç›®â€”<a href="https://juejin.cn/post/6949201709608468510" target="_blank" rel="noopener">å¯è¢«ä¸‰æ•´é™¤çš„æœ€å¤§å’Œ</a>ï¼Œç”¨äº†å…¨é‡é€’å½’å’ŒåŠ¨æ€è§„åˆ’ä¸¤ç§æ–¹æ¡ˆã€‚ä»Šå¤©çš„æ‰“å¡é¢˜ç›®ä¹Ÿä¾æ—§æ˜¯ä¸€ä¸ªåŠ¨æ€è§„åˆ’é¢˜ã€‚å¯èƒ½å¾ˆå¤šäººåœ¨åšåŠ¨æ€è§„åˆ’çš„æ—¶å€™ï¼Œçˆ¬æ¥¼æ¢¯éƒ½æ˜¯ä»–ä»¬åšçš„ç¬¬ä¸€ä¸ªé¢˜ã€‚ä½†æ˜¯è¿™ä¸ªè§£æ³•ä¹Ÿä¾ç„¶æœ‰è¶£ã€‚ä»Šå¤©ä¾ç„¶ä»é€’å½’å’Œdpä¸¤ä¸ªè§’åº¦æ¥è§£é¢˜ã€‚</p><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>å‡è®¾ä½ æ­£åœ¨çˆ¬æ¥¼æ¢¯ã€‚éœ€è¦ n é˜¶ä½ æ‰èƒ½åˆ°è¾¾æ¥¼é¡¶ã€‚</p><p>æ¯æ¬¡ä½ å¯ä»¥çˆ¬ 1 æˆ– 2 ä¸ªå°é˜¶ã€‚ä½ æœ‰å¤šå°‘ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶å‘¢ï¼Ÿ</p><p><strong>æ³¨æ„</strong>ï¼šç»™å®š n æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ã€‚</p><p><strong>ç¤ºä¾‹</strong> 1ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š 2</span><br><span class="line">è¾“å‡ºï¼š 2</span><br><span class="line">è§£é‡Šï¼š æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶ã€‚</span><br><span class="line">1.  1 é˜¶ + 1 é˜¶</span><br><span class="line">2.  2 é˜¶</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong> 2ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š 3</span><br><span class="line">è¾“å‡ºï¼š 3</span><br><span class="line">è§£é‡Šï¼š æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶ã€‚</span><br><span class="line">1.  1 é˜¶ + 1 é˜¶ + 1 é˜¶</span><br><span class="line">2.  1 é˜¶ + 2 é˜¶</span><br><span class="line">3.  2 é˜¶ + 1 é˜¶</span><br></pre></td></tr></table></figure><blockquote><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/climbing-stairs" target="_blank" rel="noopener">https://leetcode-cn.com/problems/climbing-stairs</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p></blockquote><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>å¦‚æœçœ‹è¿‡æ˜¨å¤©çš„<a href="https://juejin.cn/post/6949201709608468510" target="_blank" rel="noopener">å¯è¢«ä¸‰æ•´é™¤çš„æœ€å¤§å’Œ</a>ï¼Œåº”è¯¥å¾ˆå®¹æ˜“å°±èƒ½å‘ç°ï¼Œå¦‚æœé‚£ä¸ªé¢˜æ˜¯è¿›é˜¶ç‰ˆæœ¬çš„è¯ï¼Œè¿™ä¸ªé¡¶å¤šç®—ä¸€ä¸ªåˆçº§ç‰ˆã€‚<br>ç°åœ¨ä¾ç„¶é‡‡ç”¨åŒæ ·çš„æ€è·¯ï¼Œå‡è®¾æˆ‘åˆ°äº†ç¬¬ <code>n</code> ä¸ªå°é˜¶ï¼Œé‚£ä¹ˆæˆ‘æœ‰å¯èƒ½æ˜¯ä» <code>n-1</code> å°é˜¶ä¸Šæ¥ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä» <code>n-2</code> å°é˜¶ä¸Šæ¥ã€‚</p><p>å¦‚æœæŠŠ <code>n</code> é˜¶çš„æ–¹æ¡ˆæ€»æ•°è®°ä¸º <code>f(n)</code> ,é‚£ <code>n-1</code> å’Œ <code>n-2</code> çš„æ€»æ•°å°±åˆ†åˆ«ä¸º <code>f(n-1)</code> å’Œ <code>f(n-2)</code> ã€‚æ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œä¸éš¾çœ‹å‡º <code>f(n) = f(n-1) + f(n-2)</code> ã€‚è¿™é‡Œè¦ä¿è¯å®šä¹‰åŸŸæœ‰æ„ä¹‰ï¼Œæ‰€ä»¥æœ€å°çš„ n-2 &gt;=1ã€‚<br>èƒ½å¾—åˆ° <code>nâˆˆ[3,æ— ç©·) ï¼Œn=N*</code> ã€‚æˆ‘ä»¬è¿™æ—¶å€™ç©·ä¸¾ä¸€ä¸‹å°äº3çš„æ—¶å€™ï¼Œ n=1 æ—¶ï¼Œä» 0 åˆ° 1 åªæœ‰ä¸€ç§åœºæ™¯ï¼Œ n=2 æ—¶ï¼Œä» 0 åˆ° 2 æœ‰ä¸¤ç§åœºæ™¯ï¼Œå³ä¸€æ¬¡ç›´æ¥ä¸¤æ­¥æˆ–è€…ä¸€æ¬¡ä¸€æ­¥ã€‚</p><p>ç°åœ¨çœ‹ä¸€ä¸‹é€’å½’æ€è·¯çš„ä»£ç :<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">climbStairs</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">return</span> climbStairs(n - <span class="number">1</span>) + climbStairs(n - <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ä»£ç å¾ˆç®€æ´ï¼Œä¹Ÿå¾ˆæ˜“æ‡‚ã€‚çœ‹èµ·æ¥è§£æ³•å¼‚å¸¸æ¼‚äº®ï¼Œä½†æ˜¯è¿™æ ·æš´åŠ›é€’å½’çš„è¯ï¼Œå¯¹äº <code>n</code> ä»–æ¯æ¬¡éƒ½æœ‰ä¸¤ä¸ªå„¿å­ <code>n-1</code> å’Œ <code>n-2</code> ,å‡è®¾ä¸€ç›´é€’å½’åˆ°æœ‰ä¸€ä¸ªç»“ç‚¹æ˜¯ 5 ,é‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹ä»–è¿˜è¦é€’å½’ 8 æ¬¡ (5ä¸‹é¢æ˜¯8ä¸ªèŠ‚ç‚¹)ï¼Œå› ä¸º 2 å’Œ 1 æ˜¯ç¡®å®šçš„æ•°å­—ï¼Œæ‰€ä»¥å¯¹äº <code>n</code> èŠ‚ç‚¹ï¼Œæ€»å…±çš„é€’å½’æ¬¡æ•°åº”è¯¥æ˜¯ 2<sup>n-2</sup> æ¬¡ã€‚å› æ­¤ä»æ—¶é—´å¤æ‚åº¦ä¸Šæ¥è®²ï¼Œæ•ˆç‡æ˜¯å¾ˆä½çš„ã€‚</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dc15fc8fdb9c4010bffd12cc70005237~tplv-k3u1fbpfcp-watermark.image" alt="æœªå‘½åæ–‡ä»¶.png"></p><p>ä¸‹é¢æˆ‘ä»¬æ¥ä¼˜åŒ–è¿™æ®µä»£ç ï¼Œåœ¨å·²ç»å¾—çŸ¥ <code>f(n) = f(n-1) + f(n-2)</code> ï¼Œä¸”<code>f(1) = 1, f(2) = 2</code>çš„æ¡ä»¶ä¸‹ï¼Œæˆ‘ä¸éš¾å¾—åˆ° f(3) = f(1) + f(2) ã€‚å¦‚æœæˆ‘ä»¬æŠŠ f(1) å­˜å…¥ä¸€ä¸ªä¸´æ—¶å˜é‡ temp1 ï¼Œf(2) å­˜å…¥ä¸€ä¸ªä¸´æ—¶å˜é‡ temp2 ï¼Œf(3) = temp1 + temp2 ï¼Œæ­¤æ—¶å†å¯¹ç»“æœåšå¤„ç†è®© f(2) å æ® temp1 ï¼Œ f(3) å æ® temp2ã€‚é‚£ä¸€ç›´åˆ°æœ€åf(n) = temp1 + temp2ã€‚</p><h3 id="æœ€ç»ˆä»£ç "><a href="#æœ€ç»ˆä»£ç " class="headerlink" title="æœ€ç»ˆä»£ç "></a>æœ€ç»ˆä»£ç </h3><p>åœ¨ä¸Šä¸€ä¸ªæš´åŠ›é€’å½’ä»£ç ç¨ç¨æ”¹åŠ¨ä¹‹åï¼Œæœ€ç»ˆä»£ç è¿™æ ·ä¼˜åŒ–ä¹‹åæ—¶é—´å¤æ‚åº¦åªæœ‰O(n)ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">climbStairs</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> temp1 = <span class="number">1</span>, temp2 = <span class="number">2</span>, f_n = <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">3</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            temp1 = temp2;</span><br><span class="line">            temp2 = f_n;</span><br><span class="line">            f_n = temp1 + temp2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> f_n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æˆ‘ä¹Ÿæ˜¯åˆšå¼€å§‹æ¥è§¦åŠ¨æ€è§„åˆ’è¿™ä¸€ç±»ç®—æ³•é¢˜ï¼Œä½†æ˜¯åŠ¨æ€ç®—æ³•ç»™æˆ‘çš„æ„Ÿè§‰éƒ½æ˜¯å¦‚æœä¸è€ƒè™‘æ•ˆç‡çš„æƒ…å†µä¸‹ï¼Œæš´åŠ›é€’å½’éƒ½æ˜¯å¯ä»¥å®ç°çš„ã€‚è‡³äºå¦‚ä½•ä¼˜åŒ–é€’å½’ï¼Œæˆ‘æœ€è¿‘åšçš„å‡ é¢˜éƒ½æ˜¯æ‰¾å‡† n ä¸ n-1 ä¹‹é—´çš„çŠ¶æ€ï¼Œå†åè¿‡æ¥ä» 1-&gt;n ï¼Œåˆ©ç”¨æ•°ç»„æˆ–è€…ä¸´æ—¶å˜é‡æˆ–è€…å…¶ä»–æ•°æ®ç»“æ„å­˜å‚¨ä¿¡æ¯ï¼Œä»è€Œé™ä½æ—¶é—´å¤æ‚åº¦ã€‚ç»§ç»­åŠ æ²¹ï¼</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> leetcode </tag>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCodeæ¯æ—¥ä¸€é¢˜--å¯ä»¥è¢«ä¸‰æ•´é™¤çš„æœ€å¤§çš„æ•°</title>
      <link href="2021/04/09/LeetCode%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-%E9%9B%B6%E9%92%B1%E5%85%91%E6%8D%A2/"/>
      <url>2021/04/09/LeetCode%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-%E9%9B%B6%E9%92%B1%E5%85%91%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ä»Šå¤©ç»ˆäºå¼€å§‹ä¸Šæ‰‹é¢è¯•ä¸­æœ€ä¸ºé«˜é¢‘çš„â€”<code>åŠ¨æ€è§„åˆ’</code>äº†ã€‚å¯èƒ½æ˜¯ä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡ï¼Œå°±å¬åˆ«äººè¯´åŠ¨æ€è§„åˆ’å¾ˆéš¾ï¼Œæ‰€ä»¥æˆ‘ä¸€ç›´ä¸æ„¿å»é¢å¯¹è¿™ç±»é¢˜ç›®ã€‚ä»Šå¤©é¼“äº†é¼“å‹‡æ°”ï¼Œä¸Šæ‰‹äº†ç¬¬ä¸€ä¸ªåŠ¨æ€è§„åˆ’é¢˜ã€‚å½“æˆ‘åšå®Œç¬¬ä¸€ä¸ªä¹‹åï¼Œæˆ‘å‘ç°å…¶å®åŠ¨æ€è§„åˆ’å…¶å®æ²¡æœ‰æƒ³è±¡çš„é‚£ä¹ˆå¯æ€•ã€‚ä¹Ÿæ¨èé‚£äº›ä¸æ•¢å°è¯•çš„coderå¤šå»å°è¯•ä¸€ä¸‹ï¼Œä½ ä¸å°è¯•ä¸€ä¸‹ä½ å°±æ°¸è¿œä¸çŸ¥é“å…¶å®ä½ æ˜¯å¯ä»¥çš„ã€‚</p><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å›èƒ½è¢«ä¸‰æ•´é™¤çš„å…ƒç´ æœ€å¤§å’Œã€‚</p><p><strong>ç¤ºä¾‹</strong> 1ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums &#x3D; [3,6,5,1,8]</span><br><span class="line">è¾“å‡ºï¼š18</span><br><span class="line">è§£é‡Šï¼šé€‰å‡ºæ•°å­— 3, 6, 1 å’Œ 8ï¼Œå®ƒä»¬çš„å’Œæ˜¯ 18ï¼ˆå¯è¢« 3 æ•´é™¤çš„æœ€å¤§å’Œï¼‰ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong> 2ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums &#x3D; [4]</span><br><span class="line">è¾“å‡ºï¼š0</span><br><span class="line">è§£é‡Šï¼š4 ä¸èƒ½è¢« 3 æ•´é™¤ï¼Œæ‰€ä»¥æ— æ³•é€‰å‡ºæ•°å­—ï¼Œè¿”å› 0ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong> 3ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums &#x3D; [1,2,3,4,4]</span><br><span class="line">è¾“å‡ºï¼š12</span><br><span class="line">è§£é‡Šï¼šé€‰å‡ºæ•°å­— 1, 3, 4 ä»¥åŠ 4ï¼Œå®ƒä»¬çš„å’Œæ˜¯ 12ï¼ˆå¯è¢« 3 æ•´é™¤çš„æœ€å¤§å’Œï¼‰ã€‚</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong>ï¼š</p><p>1 &lt;= nums.length &lt;= 4 * 10^4<br>1 &lt;= nums[i] &lt;= 10^4<br>é€šè¿‡æ¬¡æ•°9,965æäº¤æ¬¡æ•°19,256</p><blockquote><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/greatest-sum-divisible-by-three" target="_blank" rel="noopener">https://leetcode-cn.com/problems/greatest-sum-divisible-by-three</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p></blockquote><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>å¯¹äºæ•°ç»„ <code>nums</code> ï¼Œå‡è®¾å…ˆä»ä¸­å– <code>n</code> ä¸ªå…ƒç´ ä¸­ä»»å–äº†ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆå°±æœ‰ N ç§é€‰æ‹©ï¼Œå¯¹äºå‰©ä¸‹çš„å…ƒç´ ï¼Œåˆæœ‰ N-1 ç§é€‰æ‹©ã€‚ä»¥æ­¤ç±»æ¨ï¼Œå¦‚æœæš´åŠ›ç©·ä¸¾ï¼Œé‚£ä¹ˆä¸€å…±æœ‰ <code>n!</code> ç§åœºæ™¯ã€‚æœ€åæ»¡è¶³åœºæ™¯çš„æƒ…å†µï¼Œå°±æ˜¯sum%3==0ï¼Œæ¯”è¾ƒæ‰€æœ‰sumä¸­æœ€å¤§çš„é‚£ä¸ªå€¼å°±æ˜¯æˆ‘ä»¬è¦çš„ç­”æ¡ˆï¼Œæˆ–è€… <code>nums</code> ä¸€ç›´éå†åˆ°æœ€åï¼Œå³æ–°ç”Ÿæˆçš„æ•°ç»„é•¿åº¦ä¸º0éƒ½æ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„å°±ç›´æ¥returnæ‰ã€‚è¿™æ ·æš´åŠ›é€’å½’çš„è§£æ³•å¤§è‡´å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxSumDivThree</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nums.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        findmaxSumDivThree(nums, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">findmaxSumDivThree</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> sum)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (sum % <span class="number">3</span> == <span class="number">0</span>)</span><br><span class="line">            result = Math.max(result, sum);</span><br><span class="line">        <span class="keyword">if</span> (nums.length == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> newSum = sum + nums[i];</span><br><span class="line">            findmaxSumDivThree( removeCurrent(nums, i), newSum);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å»æ‰iåæ ‡å½¢æˆæ–°æ•°ç»„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] removeCurrent(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> i) &#123;</span><br><span class="line">        <span class="keyword">int</span>[] newNums = <span class="keyword">new</span> <span class="keyword">int</span>[nums.length - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; nums.length; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (j != i)</span><br><span class="line">                newNums[m++] = nums[j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newNums;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ä½†æ˜¯è¿™ç§æš´åŠ›é€’å½’ä¼šå­˜åœ¨è®¸å¤šé‡å¤åœºæ™¯ï¼Œå¯¹äºæ•°ç»„ [1,2,3] è€Œè¨€ï¼Œç¬¬ä¸€æ¬¡é€‰å– 1ï¼Œç¬¬äºŒæ¬¡é€‰å– 2ï¼Œç¬¬ä¸‰æ¬¡é€‰å– 3ï¼Œå’Œç¬¬ä¸€æ¬¡é€‰å– 2ï¼Œç¬¬äºŒæ¬¡é€‰å– 1ï¼Œç¬¬ä¸‰æ¬¡é€‰å– 3ã€‚åªæ˜¯æ¢äº†ä¸ªé¡ºåºã€‚ç›¸å½“äºæ— æ„ä¹‰å·¥ä½œé‡å¤é€’å½’äº† <code>(n-1)!</code>æ¬¡ã€‚æ— ç–‘æ•ˆç‡æ˜¯å¤§æ‰“æŠ˜æ‰£çš„ã€‚å¹¶ä¸”è¿™ä¸ªè§£æ³•çš„solutionæ—¶é—´è¶…å‡ºäº†é™åˆ¶ï¼Œè¯´ç™½äº†è¿˜æ˜¯æ•ˆç‡ä¸è¿‡å…³ï¼Œæ‰€ä»¥è¦è°ƒæ•´ã€‚<br>æˆ‘ä»¬æ–°å»ºä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œé•¿ n+1 å®½ 3 æ¥ç»´æŠ¤å½“å‰çš„çŠ¶æ€ã€‚å³</p><ul><li>dp[i][0]è¡¨ç¤ºnums[0â€¦i]æ¨¡ä¸‰ä½™é›¶çš„æœ€å¤§å’Œ</li><li>dp[i][1]è¡¨ç¤ºnums[0â€¦i]æ¨¡ä¸‰ä½™ä¸€çš„æœ€å¤§å’Œ</li><li>dp[i][2]è¡¨ç¤ºnums[0â€¦i]æ¨¡ä¸‰ä½™äºŒçš„æœ€å¤§å’Œ</li></ul><p>å‡è®¾å½“å‰æ€»å’Œå¯¹ä¸‰å–æ¨¡æ˜¯0,å³å½“å‰å’Œä¸º dp[i][0] ï¼Œé‚£ä¹ˆåœ¨ä»–ä¹‹å‰æœ‰ä¸‰ä¸ªçŠ¶æ€</p><ul><li>dp[i-1][0] + nums[i]   nums[i]%3==0</li><li>dp[i-1][1] + nums[i]   nums[i]%3==1</li><li>dp[i-1][2] + nums[i]   nums[i]%3==2<br>æ­¤æ—¶æˆ‘éœ€è¦çš„æ˜¯<code>dp[i][0]</code>çš„æœ€å¤§å€¼ï¼Œæ‰€ä»¥è¿˜éœ€è¦ä¸Šé¢å€¼è¿˜éœ€è¦ä¸ dp[i-1] åšæ¯”è¾ƒï¼ˆå¦‚æœ dp[i-1][1] + nums[i] éƒ½æ¯”ä¸ä¸Š dp[i-1][0] ,é‚£è¿™ä¸ªç»“æœè‡ªç„¶ä¸èƒ½å æœ‰æˆ‘æœŸå¾…çš„ dp[i][0] ä½ç½®ï¼‰ã€‚</li></ul><p>ç›¸åŒçš„å¯¹äº dp[i][1] ä¹Ÿå°±èƒ½å†™å‡º:</p><ul><li>dp[i-1][0] + nums[i]   nums[i]%3==1</li><li>dp[i-1][1] + nums[i]   nums[i]%3==0</li><li>dp[i-1][2] + nums[i]   nums[i]%3==2<br>å¯¹äº dp[i][2] åŒæ ·çš„é“ç†ï¼š</li><li>dp[i-1][0] + nums[i]   nums[i]%3==2</li><li>dp[i-1][1] + nums[i]   nums[i]%3==1</li><li>dp[i-1][2] + nums[i]   nums[i]%3==0<br>åˆ°äº†è¿™é‡Œï¼Œå°±å¯ä»¥å‘ç°å½“ <code>nums[i]%3==0</code> å–æ¨¡æ˜¯0çš„æ—¶å€™ã€‚å°±æ€»å…±æœ‰ä¸‰ç§åœºæ™¯ï¼Œç›¸å½“äºä¸€ä¸ªæŠŠæ€è·¯å†åè¿‡æ¥ç†è§£ï¼š</li><li>dp[i][0] = max(dp[i - 1][0], dp[i - 1][0] + nums[i - 1])</li><li>dp[i][1] = max(dp[i - 1][1], dp[i - 1][1] + nums[i - 1])</li><li>dp[i][2] = max(dp[i - 1][2], dp[i - 1][2] + nums[i - 1])<br>å‰©ä¸‹ä¸¤ç§åœºæ™¯ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼Œæœ€ådp[n][0]å°±æ˜¯æœ€ 3 å–æ¨¡ä¸º 0 çš„æœ€å¤§å’Œï¼Œç›´æ¥çœ‹ä»£ç é‡Œçš„æ•ˆæœå§ã€‚</li></ul><h3 id="æœ€ç»ˆä»£ç "><a href="#æœ€ç»ˆä»£ç " class="headerlink" title="æœ€ç»ˆä»£ç "></a>æœ€ç»ˆä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxSumDivThree</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[][] dp = <span class="keyword">new</span> <span class="keyword">int</span> [nums.length+<span class="number">1</span>][<span class="number">3</span>];</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>; dp[<span class="number">0</span>][<span class="number">1</span>] = Integer.MIN_VALUE; dp[<span class="number">0</span>][<span class="number">2</span>] = Integer.MIN_VALUE;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i - <span class="number">1</span>] % <span class="number">3</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                dp[i][<span class="number">0</span>] = Math.max(dp[i - <span class="number">1</span>][<span class="number">0</span>], dp[i - <span class="number">1</span>][<span class="number">0</span>] + nums[i - <span class="number">1</span>]);</span><br><span class="line">                dp[i][<span class="number">1</span>] = Math.max(dp[i - <span class="number">1</span>][<span class="number">1</span>], dp[i - <span class="number">1</span>][<span class="number">1</span>] + nums[i - <span class="number">1</span>]);</span><br><span class="line">                dp[i][<span class="number">2</span>] = Math.max(dp[i - <span class="number">1</span>][<span class="number">2</span>], dp[i - <span class="number">1</span>][<span class="number">2</span>] + nums[i - <span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (nums[i - <span class="number">1</span>] % <span class="number">3</span> == <span class="number">1</span>) &#123;</span><br><span class="line">                dp[i][<span class="number">0</span>] = Math.max(dp[i - <span class="number">1</span>][<span class="number">0</span>], dp[i - <span class="number">1</span>][<span class="number">2</span>] + nums[i - <span class="number">1</span>]);</span><br><span class="line">                dp[i][<span class="number">1</span>] = Math.max(dp[i - <span class="number">1</span>][<span class="number">1</span>], dp[i - <span class="number">1</span>][<span class="number">0</span>] + nums[i - <span class="number">1</span>]);</span><br><span class="line">                dp[i][<span class="number">2</span>] = Math.max(dp[i - <span class="number">1</span>][<span class="number">2</span>], dp[i - <span class="number">1</span>][<span class="number">1</span>] + nums[i - <span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (nums[i - <span class="number">1</span>] % <span class="number">3</span> == <span class="number">2</span>) &#123;</span><br><span class="line">                dp[i][<span class="number">0</span>] = Math.max(dp[i - <span class="number">1</span>][<span class="number">0</span>], dp[i - <span class="number">1</span>][<span class="number">1</span>] + nums[i - <span class="number">1</span>]);</span><br><span class="line">                dp[i][<span class="number">1</span>] = Math.max(dp[i - <span class="number">1</span>][<span class="number">1</span>], dp[i - <span class="number">1</span>][<span class="number">2</span>] + nums[i - <span class="number">1</span>]);</span><br><span class="line">                dp[i][<span class="number">2</span>] = Math.max(dp[i - <span class="number">1</span>][<span class="number">2</span>], dp[i - <span class="number">1</span>][<span class="number">0</span>] + nums[i - <span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[nums.length][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>åšå®Œä¹‹åï¼Œæ„Ÿè§‰è‡ªå·±è¿˜æ˜¯æœ‰å¾ˆå¤šæ”¶è·çš„ï¼Œå¸Œæœ›ä»¥åé‡åˆ°åŠ¨æ€è§„åˆ’çš„æ—¶å€™éƒ½èƒ½å†·é™åˆ†æã€‚ä»Šæ—¥æ‰“å¡æˆåŠŸï¼Œæ¬¢è¿å¤§å®¶ä¸€èµ·å’Œæˆ‘å‚ä¸ <a href="https://juejin.cn/post/6946462614306160670/" target="_blank" rel="noopener">4æœˆåˆ·é¢˜æ‰“å¡æŒ‘æˆ˜</a>ã€‚ä¸€èµ·æå‡è‡ªå·±ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> leetcode </tag>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCodeæ¯æ—¥ä¸€é¢˜--æ•´ç†å­—ç¬¦ä¸²</title>
      <link href="2021/04/08/LeetCode%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-%E6%95%B4%E7%90%86%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
      <url>2021/04/08/LeetCode%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-%E6%95%B4%E7%90%86%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æœ€è¿‘å‡ å¤©æ²¡é€›æ˜é‡‘ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•çŸ¥è¯†ä¸Šçš„è¾“å‡ºã€‚ä»Šå¤©åˆšä¸Šå°±çœ‹åˆ°æ˜é‡‘åˆå‘èµ·äº†æ¯æ—¥åˆ·é¢˜æ‰“å¡çš„æ´»åŠ¨ã€‚æ­£å¥½è¿™å‡ å¤©æ‰‹å¾ˆé¢“ã€‚å…ˆåšä¸€ä¸ªç®€å•é¢˜æ¥å¯»æ‰¾ä¸€ä¸‹çŠ¶æ€ã€‚</p><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>ç»™ä½ ä¸€ä¸ªç”±å¤§å°å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸² s ã€‚</p><p>ä¸€ä¸ªæ•´ç†å¥½çš„å­—ç¬¦ä¸²ä¸­ï¼Œä¸¤ä¸ªç›¸é‚»å­—ç¬¦ s[i] å’Œ s[i+1]ï¼Œå…¶ä¸­ 0&lt;= i &lt;= s.length-2 ï¼Œè¦æ»¡è¶³å¦‚ä¸‹æ¡ä»¶:</p><p>è‹¥ s[i] æ˜¯å°å†™å­—ç¬¦ï¼Œåˆ™ s[i+1] ä¸å¯ä»¥æ˜¯ç›¸åŒçš„å¤§å†™å­—ç¬¦ã€‚<br>è‹¥ s[i] æ˜¯å¤§å†™å­—ç¬¦ï¼Œåˆ™ s[i+1] ä¸å¯ä»¥æ˜¯ç›¸åŒçš„å°å†™å­—ç¬¦ã€‚<br>è¯·ä½ å°†å­—ç¬¦ä¸²æ•´ç†å¥½ï¼Œæ¯æ¬¡ä½ éƒ½å¯ä»¥ä»å­—ç¬¦ä¸²ä¸­é€‰å‡ºæ»¡è¶³ä¸Šè¿°æ¡ä»¶çš„ ä¸¤ä¸ªç›¸é‚» å­—ç¬¦å¹¶åˆ é™¤ï¼Œç›´åˆ°å­—ç¬¦ä¸²æ•´ç†å¥½ä¸ºæ­¢ã€‚</p><p>è¯·è¿”å›æ•´ç†å¥½çš„ å­—ç¬¦ä¸² ã€‚é¢˜ç›®ä¿è¯åœ¨ç»™å‡ºçš„çº¦æŸæ¡ä»¶ä¸‹ï¼Œæµ‹è¯•æ ·ä¾‹å¯¹åº”çš„ç­”æ¡ˆæ˜¯å”¯ä¸€çš„ã€‚</p><p>æ³¨æ„ï¼šç©ºå­—ç¬¦ä¸²ä¹Ÿå±äºæ•´ç†å¥½çš„å­—ç¬¦ä¸²ï¼Œå°½ç®¡å…¶ä¸­æ²¡æœ‰ä»»ä½•å­—ç¬¦ã€‚</p><blockquote><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/make-the-string-great" target="_blank" rel="noopener">https://leetcode-cn.com/problems/make-the-string-great</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p></blockquote><p><strong>ç¤ºä¾‹ 1ï¼š</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šs &#x3D; &quot;leEeetcode&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;leetcode&quot;</span><br><span class="line">è§£é‡Šï¼šæ— è®ºä½ ç¬¬ä¸€æ¬¡é€‰çš„æ˜¯ i &#x3D; 1 è¿˜æ˜¯ i &#x3D; 2ï¼Œéƒ½ä¼šä½¿ &quot;leEeetcode&quot; ç¼©å‡ä¸º &quot;leetcode&quot; ã€‚</span><br></pre></td></tr></table></figure></p><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šs &#x3D; &quot;abBAcC&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;&quot;</span><br><span class="line">è§£é‡Šï¼šå­˜åœ¨å¤šç§ä¸åŒæƒ…å†µï¼Œä½†æ‰€æœ‰çš„æƒ…å†µéƒ½ä¼šå¯¼è‡´ç›¸åŒçš„ç»“æœã€‚ä¾‹å¦‚ï¼š</span><br><span class="line">&quot;abBAcC&quot; --&gt; &quot;aAcC&quot; --&gt; &quot;cC&quot; --&gt; &quot;&quot;</span><br><span class="line">&quot;abBAcC&quot; --&gt; &quot;abBA&quot; --&gt; &quot;aA&quot; --&gt; &quot;&quot;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šs &#x3D; &quot;s&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;s&quot;</span><br></pre></td></tr></table></figure><br>æç¤ºï¼š</p><ul><li>1 &lt;= s.length &lt;= 100</li><li>s åªåŒ…å«å°å†™å’Œå¤§å†™è‹±æ–‡å­—æ¯</li></ul><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>çœ‹åˆ°è¿™ä¸ªé¢˜ç›®ï¼Œæœ€ç›´æ¥æƒ³åˆ°çš„æš´åŠ›è§£æ³•å°±æ˜¯ä¾æ¬¡éå†ï¼Œå¦‚æœå‡ºç°åæ ‡ <code>i</code> æ»¡è¶³ä¸Šè¿°è¿°åœºæ™¯å°±è·³è¿‡å½“å‰å…ƒç´ å’Œä¸‹ä¸€ä¸ªå…ƒç´ ã€‚å¦åˆ™<code>æ‹¼æ¥</code>å½“å‰å­—ç¬¦ã€‚å¦‚æœéå†ç»“æŸï¼Œæ‹¼æ¥åçš„å­—ç¬¦ä¸²é•¿åº¦ä»ç„¶ç­‰äºå½“å‰é•¿åº¦ã€‚è¯´æ˜æ²¡æœ‰ä»»ä½•å…ƒç´ æ»¡è¶³ä¸Šè¿°åœºæ™¯ã€‚ç›´æ¥è¿”å›è¯¥å­—ç¬¦ä¸²ã€‚å¦åˆ™ä»ç„¶æ‰§è¡Œè¯¥é€»è¾‘ã€‚</p><p>å¾ˆæ˜æ˜¾çš„ä¸€ä¸ªé€’å½’é€»è¾‘ã€‚ç›´æ¥çœ‹ä¸€ä¸‹æš´åŠ›è§£çš„ä»£ç ï¼Œéå†çš„ä¹‹åå› ä¸ºåé¢è¦åˆ¤æ–­ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œé˜²æ­¢ä¸‹æ ‡è¶Šç•Œå¯ä»¥å…ˆåˆ¤æ–­ä¸€ä¸‹å½“å‰ä¸‹æ ‡æ˜¯ä¸æ˜¯æœ€åä¸€ä¸ªä¸‹æ ‡ï¼Œå¦‚æœæ˜¯æœ€åä¸€ä¸ªä¸‹æ ‡å°±ç›´æ¥æ‹¼æ¥å½“å‰å…ƒç´ ã€‚å› ä¸ºåé¢æ²¡æœ‰å…ƒç´ ï¼Œæ˜¾ç„¶ä¹Ÿå°±ä¸æ»¡è¶³è¿™ç§åœºæ™¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">makeGood</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i==s.length()-<span class="number">1</span>)&#123;</span><br><span class="line">                stringBuilder.append(s.charAt(i));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (Character.isUpperCase(s.charAt(i)) &amp;&amp; !Character.isUpperCase(s.charAt(i + <span class="number">1</span>)) &amp;&amp; Character.toLowerCase(s.charAt(i)) == s.charAt(i + <span class="number">1</span>)) &#123;</span><br><span class="line">                i += <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!Character.isUpperCase(s.charAt(i)) &amp;&amp; Character.isUpperCase(s.charAt(i + <span class="number">1</span>)) &amp;&amp; Character.toUpperCase(s.charAt(i)) == s.charAt(i + <span class="number">1</span>)) &#123;</span><br><span class="line">                i += <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                stringBuilder.append(s.charAt(i));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//é€’å½’å¤„ç†</span></span><br><span class="line">        <span class="keyword">return</span> s.length() == stringBuilder.length() ? s : makeGood(stringBuilder.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€’å½’çš„å†…å­˜æ¶ˆè€—å’Œæ—¶é—´å¤æ‚åº¦æ— ç–‘éå¸¸ä»¤äººç—›è‹¦ï¼Œé‚£å°±æ¥ç€è€ƒè™‘ä¸€ä¸‹è¿™é¢˜æœ‰æ²¡æœ‰æ›´ä¼˜é›…ä¸€ç‚¹çš„å®ç°æ–¹æ¡ˆã€‚åœ¨ä¾æ¬¡éå†è¾“å…¥å­—ç¬¦ä¸² <code>s</code> çš„æ—¶å€™ï¼Œå¦‚æœä¸æ»¡è¶³è¦æ±‚åœºæ™¯ï¼Œé€‰æ‹©æ‹¼æ¥å­—ç¬¦ä¸²ã€‚<br>å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ac84eff2566f44028aecfb3f2605c943~tplv-k3u1fbpfcp-watermark.image" alt="æœªå‘½åæ–‡ä»¶ (2).png"><br>è¿™æ˜¯æ–°ä¸²çš„ <code>b</code> ä¸è€ä¸²çš„ <code>B</code> æ»¡è¶³åœºæ™¯ï¼Œå¼¹å‡ºæ–°ä¸²æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆæ ˆé¡¶å…ƒç´ ï¼‰ï¼Œè€ä¸²é¡ºç§»ä¸‹æ ‡ã€‚æ­¤æ—¶æ–°ä¸²çš„æ ˆé¡¶ <code>a</code> ä¸è€ä¸²çš„ <code>A</code> ä»æ»¡è¶³åœºæ™¯ï¼Œå¼¹å‡º <code>a</code> å…ƒç´ ,éå†è€ä¸²çš„ä¸‹æ ‡å†æ¬¡+1ã€‚å½“æ–°ä¸²æ ˆé¡¶ä¸è€ä¸²å½“å‰å­—ç¬¦ä¸æ»¡è¶³åœºæ™¯æ—¶ã€‚æ–°ä¸²å…¥æ ˆè€ä¸²çš„å½“å‰å­—ç¬¦ã€‚è¿™ç§åšæ³•æ—¶é—´å¤æ‚åº¦åªæœ‰ O(n) ã€‚è€Œä¸”çœå»äº†é€’å½’é€ æˆçš„æ ˆå†…å­˜æŸè€—ã€‚</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2c263bbf3eab4df0b87dd48c96019e46~tplv-k3u1fbpfcp-watermark.image" alt="æœªå‘½åæ–‡ä»¶ (3).png"></p><h3 id="æœ€ç»ˆä»£ç "><a href="#æœ€ç»ˆä»£ç " class="headerlink" title="æœ€ç»ˆä»£ç "></a>æœ€ç»ˆä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">makeGood</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (stringBuilder.length() &gt; <span class="number">0</span> &amp;&amp; Character.toLowerCase(stringBuilder.charAt(stringBuilder.length()-<span class="number">1</span>)) == Character.toLowerCase(s.charAt(i)) &amp;&amp; stringBuilder.charAt(stringBuilder.length()-<span class="number">1</span>) != s.charAt(i)) &#123;</span><br><span class="line">                stringBuilder.deleteCharAt(stringBuilder.length()-<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                stringBuilder.append(s.charAt(i));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä»Šå¤©æ‰“å¡ç¬¬ä¸€å¤©ï¼Œå…ˆåšä¸€é¢˜æ¿€åŠ±ä¸€ä¸‹è‡ªå·±ï¼Œå…ˆç»™è‡ªå·±å®šä¸ªå°ç›®æ ‡ï¼Œå®Œæˆ4æœˆä»½æ¯æ—¥æ‰“å¡ã€‚</p><p>æœ¬æ–‡æ­£åœ¨å‚ä¸ã€Œæ˜é‡‘ 2021 4 æœˆåˆ·é¢˜æ‰“å¡ã€, ç‚¹å‡»æŸ¥çœ‹ <a href="https://juejin.cn/post/6946462614306160670/" target="_blank" rel="noopener">æ´»åŠ¨è¯¦æƒ…</a></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> leetcode </tag>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”¨JAVAå®ç°ä¸€ä¸ªIMDBæ•°æ®è§£æå™¨</title>
      <link href="2021/03/31/%E7%94%A8JAVA%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAIMDB%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90%E5%99%A8/"/>
      <url>2021/03/31/%E7%94%A8JAVA%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAIMDB%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p>åœ¨IMDBæ•°æ®åº“ä¸­ï¼Œè‡³å°‘æœ‰2000ä¸‡æ¡æ•°æ®å¯ä»¥æŸ¥è¯¢ã€‚åœ¨ä½¿ç”¨è¿™äº›æ•°æ®ä¹‹å‰è¿˜æœ‰è®¸å¤šå‰ç½®å·¥ä½œéœ€è¦å®Œæˆã€‚</p><h3 id="æ•°æ®åº“æ–‡ä»¶"><a href="#æ•°æ®åº“æ–‡ä»¶" class="headerlink" title="æ•°æ®åº“æ–‡ä»¶"></a>æ•°æ®åº“æ–‡ä»¶</h3><p>æˆ‘ä»¬åªå–120è¡Œçš„æ ·ä¾‹æ•°æ®æ¥æµ‹è¯•æˆ‘ä»¬çš„è§£æå™¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">Andre, KentThe Mask: The Origin (1995) (VG)  (voice)</span><br><span class="line"></span><br><span class="line">Andre, KevinCome Fly with Us (1974)  [Tony]  &lt;4&gt;</span><br><span class="line">Deep Throat Part II (1974)  (as Carter Courtney Jr.)  [Russian Agent]  &lt;8&gt;</span><br><span class="line">Fringe Benefits (1974)  [Dr. Charles Cherrypopper]  &lt;1&gt;</span><br><span class="line">Invasion of the Love Drones (1977)  [Pseudo Drone]  &lt;26&gt;</span><br><span class="line">Is There Sex After Death? (1971)  (as Carter Courtney Jr.)  [Sex Bowl Contestant]  &lt;82&gt;</span><br><span class="line">Lady on the Couch (1974)  [Dr. Miller]</span><br><span class="line">Naked Came the Stranger (1975)  [Party Guy with Candle]  &lt;6&gt;</span><br><span class="line">Sex Fantasies (1975)</span><br><span class="line">Stigma (1972)  (as Carter Courtney)  [Homosexual]  &lt;10&gt;</span><br><span class="line">Teenage Hitchhikers (1975)  (as Carter Courtney Jr.)  [Farquart (Bruce)]  &lt;8&gt;</span><br><span class="line">The $50,000 Climax Show (1975)  (as Kevin Andre Darby)</span><br><span class="line">The Big Con (1975)  (as Carter Courtney)  [Sam Browne]  &lt;7&gt;</span><br><span class="line">The Defiance of Good (1975)  [Dr. Hirsch]  &lt;8&gt;</span><br><span class="line">The Love Bus (1974)  (as Kevin AndrÃ©)  [Ralph Kramden]  &lt;7&gt;</span><br><span class="line">The Mount of Venus (1975)  (as Kevin AndrÃ©)  [Bacchus]  &lt;5&gt;</span><br><span class="line">The New York City Woman (1977)  (archive footage) (uncredited)  [Dr. Chartop]</span><br><span class="line">The Passions of Carol (1975)  (as Kevin AndrÃ©)  [The Spirits]  &lt;5&gt;</span><br><span class="line">The Private Afternoons of Pamela Mann (1974)  [Frank&#39;s First Client]  &lt;6&gt;</span><br><span class="line">The Switch or How to Alter Your Ego (1974)  [Seymour]  &lt;17&gt;</span><br><span class="line">Whatever Happened to Miss September? (1973)  (as Knah-Knah)  [Bentley]</span><br><span class="line"></span><br><span class="line">Andre, KurtMy Politics, My Country (2012)</span><br><span class="line">World Bender (2014)  [Network Executive]  &lt;8&gt;</span><br><span class="line"></span><br><span class="line">Andre, L.J.&quot;Disneyland&quot; (1954) &#123;Willie and the Yank: The Deserter (#13.15)&#125;  [Uncle Ferd]  &lt;10&gt;</span><br><span class="line">&quot;Disneyland&quot; (1954) &#123;Willie and the Yank: The Mosby Raiders (#13.16)&#125;  [Uncle Ferd]  &lt;10&gt;</span><br><span class="line"></span><br><span class="line">Andre, LeClercStreetSmart Guide (2014) (V)  [Himself - Guest]</span><br><span class="line">&quot;Laughs&quot; (2014) &#123;(#1.22)&#125;</span><br><span class="line">&quot;Laughs&quot; (2014) &#123;(#1.5)&#125;  [Himself]</span><br><span class="line"></span><br><span class="line">Andre, Lorin-PierreCirque du Soleil: Worlds Away (2012)  [Viva Elvis Cast Member]  &lt;198&gt;</span><br><span class="line">The Neighborhood Ball: An Inauguration Celebration (2009) (TV)  [Antigravity Performer]</span><br><span class="line"></span><br><span class="line">Andre, LukkaArmando Rene: Start Running (2015) (V)</span><br><span class="line">Making of Salir Corriendo (2015)  (archive footage)</span><br><span class="line"></span><br><span class="line">Andre, MandiMemoirs of a Lifeguard (2010)</span><br><span class="line"></span><br><span class="line">Andre, MarcusThe Grad Film (2015)  [Rob]</span><br><span class="line"></span><br><span class="line">Andre, Mario (I)Love Your Mama (1990)  [Bartender]</span><br><span class="line"></span><br><span class="line">Andre, Mario (II)Market Value (2016)  [Triage Patient]</span><br><span class="line">The Breakout Dream (2015)  [Pastor Mark]</span><br><span class="line">The Penny (2010)  [Darrell Watts]  &lt;6&gt;</span><br><span class="line"></span><br><span class="line">Andre, Mario (III)Blactose Intolerance (2015)  [Pa Pa]</span><br><span class="line">Life Outside the Rhyme (2016)  [The Muffin Man]</span><br><span class="line">Preacher Man (2015)  [Elder Jones]  &lt;4&gt;</span><br><span class="line">School for Gods (????)  [St. Louis Cartel]</span><br><span class="line">Under Pressure (2016)  [Uncle Ray]</span><br><span class="line">&quot;The Natural&quot; (2016)  [The Manager]</span><br><span class="line"></span><br><span class="line">Andre, MartinVasilissa maimou (2000)</span><br><span class="line"></span><br><span class="line">Andre, Mat (I)Lights Camera Blood! (2015)  [Hank the Hobo]</span><br><span class="line">&quot;Todd and the Book of Pure Evil&quot; (2010) &#123;B.Y.O.B.O.P.E. (#2.11)&#125;  [Dancerman]  &lt;18&gt;</span><br><span class="line"></span><br><span class="line">Andre, Mathias (II)Guilty Pleasures (2016) (TV)  [Groomer 3]  &lt;26&gt;</span><br><span class="line"></span><br><span class="line">Andre, MatthewSanta Rosa (2004) (V)</span><br><span class="line"></span><br><span class="line">Andre, Michael (II)&quot;Here 2 Help&quot; (2011) &#123;(#1.2)&#125;  [Himself]  &lt;3&gt;</span><br><span class="line">&quot;Here 2 Help&quot; (2011) &#123;(#1.3)&#125;  [Himself]  &lt;2&gt;</span><br><span class="line">&quot;Here 2 Help&quot; (2011) &#123;(#1.4)&#125;  [Himself]  &lt;2&gt;</span><br><span class="line">&quot;Here 2 Help&quot; (2011) &#123;(#1.5)&#125;  [Himself]  &lt;2&gt;</span><br><span class="line">&quot;Here 2 Help&quot; (2011) &#123;(#1.6)&#125;  [Himself]  &lt;2&gt;</span><br><span class="line">&quot;Peter Andre: My Life&quot; (2011) &#123;(#1.2)&#125;  [Himself]</span><br><span class="line">&quot;Peter Andre: My Life&quot; (2011) &#123;(#1.3)&#125;  [Himself]</span><br><span class="line">&quot;Peter Andre: My Life&quot; (2011) &#123;(#1.4)&#125;  [Himself]</span><br><span class="line">&quot;Peter Andre: My Life&quot; (2011) &#123;(#1.5)&#125;  [Himself]</span><br><span class="line">&quot;Peter Andre: My Life&quot; (2011) &#123;(#3.4)&#125;  [Himself]</span><br><span class="line">&quot;Peter Andre: My Life&quot; (2011) &#123;(#3.5)&#125;  [Himself]</span><br><span class="line">&quot;Peter Andre: My Life&quot; (2011) &#123;He&#39;s Found His Happy Ever After (#5.4)&#125;  [Himself]</span><br><span class="line">&quot;Peter Andre: My Life&quot; (2011) &#123;I Can&#39;t Remember When I Was 15 (#4.4)&#125;  [Himself]</span><br><span class="line">&quot;Peter Andre: My Life&quot; (2011) &#123;It&#39;s a New Chapter, Isn&#39;t It? (#5.1)&#125;  [Himself]</span><br><span class="line">&quot;Peter Andre: My Life&quot; (2011) &#123;Some Days Are Better Than Others (#4.1)&#125;  [Himself]</span><br><span class="line">&quot;Peter Andre: My Life&quot; (2011) &#123;There&#39;s Only One Problem... She Doesn&#39;t Like Coffee (#3.1)&#125;  [Himself]</span><br><span class="line">&quot;Peter Andre: My Life&quot; (2011) &#123;We&#39;re Off to Zanzib-Andre (#5.3)&#125;  [Himself]</span><br><span class="line">&quot;Peter Andre: My Life&quot; (2011) &#123;Why Wait, Why Hesitate? (#5.5)&#125;  [Himself]</span><br><span class="line"></span><br><span class="line">Andre, MiguelJourney Among Women (1977)  [Soldier]  &lt;21&gt;</span><br><span class="line"></span><br><span class="line">Andre, Mikail1 Lawan Satu (2013)  [Radhi]</span><br><span class="line">Dua Kalimah (2013)</span><br><span class="line">Gangster Wars (2013)  [Romeo]</span><br><span class="line">Mukasurat Cinta (2014)</span><br><span class="line">Sniper (2014)  [Mat Jambang]</span><br><span class="line">Tokak (2013)  [Boy]</span><br><span class="line"></span><br><span class="line">Andre, MikeA Mystery in Carmine (2012)  (as Mikey Andre)  [Toby]</span><br><span class="line"></span><br><span class="line">Andre, Mohd MikailHantu dalam botol kicap (2012)  [Azri]  &lt;4&gt;</span><br><span class="line"></span><br><span class="line">Andre, Mohd Pierre3 Temujanji (2012)  [Sein]  &lt;2&gt;</span><br><span class="line">3, 2, 1 cinta (2011)  (as Pierre Andre)  [Fariz]  &lt;3&gt;</span><br><span class="line">9 September (2007)  (as Pierre Andre)  [Kogi]  &lt;1&gt;</span><br><span class="line">Aku, Kau &amp; Dia (2012)  (as Pierre Andre)  [Abang Harris]</span><br><span class="line">Al-Hijab (2011)  (as Pierre Andre)  [Rafael]  &lt;1&gt;</span><br><span class="line">Chantek (2012)  [Ad]  &lt;1&gt;</span><br><span class="line">Cinta (2006)  [Taufiq]</span><br><span class="line">Cinta fotokopi (2005)  (as Pierre Andre)  [Din]</span><br><span class="line">Gol &amp; Gincu (2005)  [Reza]  &lt;3&gt;</span><br><span class="line">Jangan pandang belakang (2007)  [Darma]</span><br><span class="line">Jangan tegur (2009)  [Kamal]  &lt;2&gt;</span><br><span class="line">Krazy crazy krezy... (2009)  (as Pierre AndrÃ©)  &lt;3&gt;</span><br><span class="line">Pontianak harum sundal malam 2 (2005)  [Purnama]</span><br><span class="line">Potret mistik (2005)  (as Pierre Andre)  [Badrul]</span><br><span class="line">Salon (2005)  [Ezra Fernandez]  &lt;2&gt;</span><br><span class="line">Sepi (2008)  [Khalil]</span><br><span class="line">Seru (2011)  [Bob]</span><br><span class="line">Strawberi cinta (2012)  [Hakimi]</span><br><span class="line">X (2012&#x2F;I)  [Hafiz]</span><br><span class="line">&quot;Gol &amp; Gincu: The Series&quot; (2006)  [Reza]  &lt;2&gt;</span><br></pre></td></tr></table></figure><h3 id="ç”¨æ­£åˆ™åˆ†ææ•°æ®åº“æ–‡ä»¶"><a href="#ç”¨æ­£åˆ™åˆ†ææ•°æ®åº“æ–‡ä»¶" class="headerlink" title="ç”¨æ­£åˆ™åˆ†ææ•°æ®åº“æ–‡ä»¶"></a>ç”¨æ­£åˆ™åˆ†ææ•°æ®åº“æ–‡ä»¶</h3><p>æˆ‘ä»¬ä½¿ç”¨æ­£åˆ™æ¥å¾—åˆ°æ­£ç¡®çš„æ•°æ®ï¼Œå¦‚æœä½ ä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡æ­£åˆ™è¡¨è¾¾å¼ï¼Œæˆ‘æ¨è<a href="https://regexr.com/" target="_blank" rel="noopener">RegexR</a>ç½‘ç«™æä¾›ç»™ä½ å­¦ä¹ ã€‚</p><p>æˆ‘ä»¬å°†ä½¿ç”¨ä¸‹é¢çš„æ­£åˆ™å­—ç¬¦ä¸²:</p><figure class="highlight re"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="literal">[A-Z<span class="identifier">a</span>-<span class="identifier">z</span>,.'<span class="identifier">$</span>&amp; ]</span>*)?(<span class="literal">[\<span class="identifier">t</span>]</span>*)(.+?)(<span class="literal">[ ]</span>*)\\((<span class="literal">[<span class="number">0</span>-<span class="number">9</span>,?]</span>&#123;<span class="number">4</span>&#125;)(.+?\\n&#123;<span class="number">2</span>&#125;)?</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¼šå°†æ‰€æœ‰çš„æ•°æ®ä»æ¼”å‘˜ä¸­åˆ é™¤ï¼Œç„¶åä½ å¯ä»¥å•ç‹¬çš„ä½¿ç”¨è¿™äº›æ•°æ®ã€‚</p><h3 id="åˆ›å»ºJAVAé¡¹ç›®"><a href="#åˆ›å»ºJAVAé¡¹ç›®" class="headerlink" title="åˆ›å»ºJAVAé¡¹ç›®"></a>åˆ›å»ºJAVAé¡¹ç›®</h3><p>å¦‚æœä½ ä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡JAVAï¼Œå¸Œæœ›ä½ å…ˆå­¦ä¹ ä¸€ä¸‹JAVAçš„åŸºç¡€è¯¾ç¨‹ã€‚</p><p>æˆ‘ä»¬ä»…ä»…éœ€è¦4ä¸ªç±»ï¼š</p><ul><li>Main</li><li>Reader</li><li>Parser</li><li>Writer</li></ul><h4 id="åˆ›å»ºReaderç±»"><a href="#åˆ›å»ºReaderç±»" class="headerlink" title="åˆ›å»ºReaderç±»"></a>åˆ›å»ºReaderç±»</h4><p>æˆ‘ä»¬åº”è¯¥åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯åˆ›å»ºä¸€ä¸ªReaderç±»ï¼Œè¯¥ç±»å°†è¯»å–å…¶ä¸­åŒ…å«æ‰€æœ‰æ¼”å‘˜çš„æ•°æ®åº“æ–‡ä»¶ï¼ˆdatabase.txtï¼‰ã€‚åœ¨Javaä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Fileå’ŒScannerç±»è¯»å–æ–‡ä»¶çš„æ•°æ®å¹¶å°†å…¶æ”¾å…¥ArrayListä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Reader</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ArrayList&lt;String&gt; lines = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;String&gt; <span class="title">Read</span><span class="params">(String dbFile)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            File readable = <span class="keyword">new</span> File(Reader<span class="class">.<span class="keyword">class</span>.<span class="title">getResource</span>(<span class="title">dbFile</span>).<span class="title">getFile</span>())</span>;</span><br><span class="line">            Scanner dbScanner = <span class="keyword">new</span> Scanner(readable);</span><br><span class="line">            <span class="keyword">while</span> (dbScanner.hasNextLine()) &#123;</span><br><span class="line">                String data = dbScanner.nextLine();</span><br><span class="line">                lines.add(data);</span><br><span class="line">            &#125;</span><br><span class="line">            dbScanner.close();</span><br><span class="line">             </span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span>(FileNotFoundException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"File not found"</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lines;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œåˆ›å»ºä¿å­˜Stringç±»å‹çš„ArrayListã€‚å…¬å…±æ–¹æ³•Readï¼ˆï¼‰å°†é‡‡ç”¨æˆ‘ä»¬è¦è¯»å–çš„æ–‡ä»¶çš„è·¯å¾„ï¼Œç„¶åScannerå°†æ¯ä¸€è¡Œæ•°æ®æ”¾å…¥ArrayListä¸­ã€‚å¦‚æœæ²¡æœ‰å‰©ä½™çš„è¡Œï¼Œå…³é—­Scannerã€‚</p><h4 id="åˆ›å»ºParserç±»"><a href="#åˆ›å»ºParserç±»" class="headerlink" title="åˆ›å»ºParserç±»"></a>åˆ›å»ºParserç±»</h4><p>ä¸ºäº†å°†æ¯ä¸€è¡Œçš„æ•°æ®è§£æä¸ºç»“æ„åŒ–çš„csvæ–‡ä»¶ï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªåŒ¹é…æ¨¡æ¿å¹¶æ£€æŸ¥æ˜¯å¦èƒ½å¤ŸåŒ¹é…åˆšåˆšè¯»å–çš„æ–‡ä»¶ã€‚</p><h5 id="ParseActors-æ–¹æ³•"><a href="#ParseActors-æ–¹æ³•" class="headerlink" title="ParseActors æ–¹æ³•"></a>ParseActors æ–¹æ³•</h5><p>ParseActorsæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œæ–‡ä»¶å­˜å‚¨çš„æ•°æ®listï¼Œå’Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ArrayList&lt;ArrayList&lt;String&gt;&gt; ParseActors(ArrayList&lt;String&gt; input, String regex) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªStringæ³›å‹çš„ä¸€ä¸ªArrayListï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ•°æ®åº“ä¸­çš„æ¯ä¸ªæ¼”å‘˜å’Œç”µå½±èƒ½è¢«åˆ†åˆ«æ³¨å†Œã€‚</p><h5 id="åˆ›å»ºåŒ¹é…æ¨¡å¼"><a href="#åˆ›å»ºåŒ¹é…æ¨¡å¼" class="headerlink" title="åˆ›å»ºåŒ¹é…æ¨¡å¼"></a>åˆ›å»ºåŒ¹é…æ¨¡å¼</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pattern pattern = Pattern.compile(regex);</span><br></pre></td></tr></table></figure><h5 id="ç»„è£…å“åº”å€¼"><a href="#ç»„è£…å“åº”å€¼" class="headerlink" title="ç»„è£…å“åº”å€¼"></a>ç»„è£…å“åº”å€¼</h5><p>ä¸ºäº†ç¡®ä¿æˆ‘ä»¬çš„csvæ–‡ä»¶æ˜¯ç»“æ„åŒ–çš„ã€‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªArrayListå¹¶ä¸”æ·»åŠ csvçš„header (Actor, Title, Year)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;ArrayList&lt;String&gt;&gt; collections = <span class="keyword">new</span> ArrayList&lt;ArrayList&lt;String&gt; &gt;();</span><br><span class="line"></span><br><span class="line">collections.add(<span class="keyword">new</span> ArrayList&lt;String&gt;());</span><br><span class="line"></span><br><span class="line">collections.get(<span class="number">0</span>).add(<span class="string">"Actor"</span>);</span><br><span class="line">collections.get(<span class="number">0</span>).add(<span class="string">"Title"</span>);</span><br><span class="line">collections.get(<span class="number">0</span>).add(<span class="string">"Year"</span>);</span><br></pre></td></tr></table></figure><h5 id="æŸ¥æ‰¾åŒ¹é…é¡¹å¹¶å¡«å……collections"><a href="#æŸ¥æ‰¾åŒ¹é…é¡¹å¹¶å¡«å……collections" class="headerlink" title="æŸ¥æ‰¾åŒ¹é…é¡¹å¹¶å¡«å……collections"></a>æŸ¥æ‰¾åŒ¹é…é¡¹å¹¶å¡«å……collections</h5><p>ç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½åˆ—è¡¨å¹¶åˆ›å»ºå¥½äº†åŒ¹é…æ¨¡æ¿ï¼Œæˆ‘ä»¬å¯ä»¥æœç´¢åŒ¹é…é¡¹ã€‚å†æ¬¡æŸ¥çœ‹æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²æ—¶ï¼Œæˆ‘ä»¬å‘ç°å¯ä»¥åŒ¹é…ä¸€äº›å†…å®¹ã€‚æˆ‘ä»¬åªéœ€è¦æ¼”å‘˜çš„å§“åï¼Œä»–ä¸Šæ¼”çš„ç”µå½±ä»¥åŠå¹´ä»½ã€‚</p><p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ˜ å°„æ‰€æœ‰ç»“æœçš„<code>for</code>å¾ªç¯ï¼Œç„¶åä½¿ç”¨åŒ¹é…æ¨¡æ¿æ‰¾åˆ°æ­£ç¡®çš„<code>strings</code>ã€‚<br>ç°åœ¨ï¼Œè¯¥æ•°æ®åº“å­˜åœ¨ä¸€ä¸ªå¤§é—®é¢˜ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬åªèƒ½çœ‹åˆ°æ¼”å‘˜ä¸€æ¬¡ï¼Œç„¶åæ‰èƒ½çœ‹åˆ°ä»–æ‰€æ’­æ”¾çš„ç”µå½±çš„å®Œæ•´åˆ—è¡¨ã€‚</p><p>ä¸€æ—¦å°†æ¼”å‘˜æ”¾å…¥<code>collections</code>ï¼Œæˆ‘ä»¬å‡è®¾åœ¨æ‰¾åˆ°å¦ä¸€ä¸ªæ¼”å‘˜ä¹‹å‰ï¼Œæ‰¾åˆ°çš„æ‰€æœ‰ç”µå½±éƒ½æ˜¯ä»–æ‰€æ‰®æ¼”çš„ç”µå½±ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Parser</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ArrayList&lt;ArrayList&lt;String&gt;&gt; ParseActors(ArrayList&lt;String&gt; input, String regex) &#123;</span><br><span class="line">        Pattern pattern = Pattern.compile(regex);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ArrayList&lt;String&gt; lijst = new ArrayList&lt;String&gt;();</span></span><br><span class="line"></span><br><span class="line">        ArrayList&lt;ArrayList&lt;String&gt;&gt; collections = <span class="keyword">new</span> ArrayList&lt;ArrayList&lt;String&gt; &gt;();</span><br><span class="line"></span><br><span class="line">        collections.add(<span class="keyword">new</span> ArrayList&lt;String&gt;());</span><br><span class="line"></span><br><span class="line">        collections.get(<span class="number">0</span>).add(<span class="string">"Actor"</span>);</span><br><span class="line">        collections.get(<span class="number">0</span>).add(<span class="string">"Title"</span>);</span><br><span class="line">        collections.get(<span class="number">0</span>).add(<span class="string">"Year"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; input.size(); i++) &#123;</span><br><span class="line">            Matcher matcher = pattern.matcher(input.get(i));</span><br><span class="line"></span><br><span class="line">            collections.add(<span class="keyword">new</span> ArrayList&lt;String&gt;());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(matcher.find()) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (matcher.group(<span class="number">1</span>) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    String actor = matcher.group(<span class="number">1</span>).toString();</span><br><span class="line">                    <span class="comment">//lijst.add(actor.replaceAll("[,]", ""));   </span></span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">if</span>(actor == <span class="string">""</span>)&#123;</span><br><span class="line">                        collections.get(i+<span class="number">1</span>).add(collections.get(i).get(<span class="number">0</span>).replaceAll(<span class="string">"[,]"</span>, <span class="string">""</span>).toString());</span><br><span class="line">                        System.out.println(collections.get(i+<span class="number">1</span>).get(<span class="number">0</span>));</span><br><span class="line">                         </span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        collections.get(i+<span class="number">1</span>).add(actor.replaceAll(<span class="string">"[,]"</span>, <span class="string">""</span>));</span><br><span class="line">                        System.out.println(collections.get(i+<span class="number">1</span>).get(<span class="number">0</span>));</span><br><span class="line">                    &#125;     </span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (matcher.group(<span class="number">3</span>) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//lijst.add(matcher.group(3));</span></span><br><span class="line"></span><br><span class="line">                    collections.get(i+<span class="number">1</span>).add(matcher.group(<span class="number">3</span>).replaceAll(<span class="string">"[\",]"</span>, <span class="string">""</span>).replaceAll(<span class="string">"[,]"</span>, <span class="string">""</span>).toString());</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (matcher.group(<span class="number">5</span>) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//lijst.add(matcher.group(5));</span></span><br><span class="line">                    collections.get(i+<span class="number">1</span>).add(matcher.group(<span class="number">5</span>));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (matcher.group(<span class="number">6</span>) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//lijst.add("null");</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> collections;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºWriterç±»"><a href="#åˆ›å»ºWriterç±»" class="headerlink" title="åˆ›å»ºWriterç±»"></a>åˆ›å»ºWriterç±»</h4><p>Writerç±»çš„ä½œç”¨æ˜¯å°†è¾“å‡ºçš„æ•°æ®å†™å…¥åˆ°csvæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨æ­¤ç±»ä¸­åˆ›å»ºçš„ä¸¤ç§æ–¹æ³•æ¯”Parserç±»ç®€å•å¾—å¤šã€‚<br>æˆ‘ä»¬éœ€è¦å†æ¬¡ä½¿ç”¨Fileç±»ï¼Œè¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸ºdata.csvçš„æ–‡ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createFile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        File myObj = <span class="keyword">new</span> File(<span class="string">"data.csv"</span>);</span><br><span class="line">        <span class="keyword">if</span> (myObj.createNewFile()) &#123;</span><br><span class="line">            System.out.println(<span class="string">"File created: "</span> + myObj.getName());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"File already exists."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        System.out.println(<span class="string">"An error occurred."</span>);</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªwriteToFile()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†æ‰€æœ‰æ•°æ®é€è¡Œå†™å…¥CSVæ–‡ä»¶ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writeToFile</span><span class="params">(ArrayList&lt;ArrayList&lt;String&gt;&gt; parserOutput)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileWriter myWriter = <span class="keyword">new</span> FileWriter(<span class="string">"data.csv"</span>);</span><br><span class="line"></span><br><span class="line">            System.out.println(parserOutput);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parserOutput.size(); i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(parserOutput.get(i).isEmpty())&#123;</span><br><span class="line">                    <span class="comment">//nothing</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   </span><br><span class="line">                    myWriter.append(parserOutput.get(i).get(<span class="number">0</span>) + <span class="string">","</span> + parserOutput.get(i).get(<span class="number">1</span>) + <span class="string">","</span> + parserOutput.get(i).get(<span class="number">2</span>) + <span class="string">"\n"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            myWriter.close();</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">"Successfully wrote to the file."</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"An error occurred."</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="æ•´åˆä»£ç "><a href="#æ•´åˆä»£ç " class="headerlink" title="æ•´åˆä»£ç "></a>æ•´åˆä»£ç </h4><p>ä¸ºäº†å°†æ‰€æœ‰çš„ä»£ç æ•´åˆåœ¨ä¸€èµ·ï¼Œæµ‹è¯•æˆ‘ä»¬çš„è§£æå™¨ï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ª<code>Main.java</code>å¹¶æ·»åŠ æˆ‘ä»¬çš„æ­£åˆ™å­—ç¬¦ä¸²å’Œæ•°æ®åº“æ–‡ä»¶åœ°å€</li><li>åˆ›å»º Writer, Reader, å’Œ Parserçš„å®ä¾‹</li><li>åˆ›å»ºä¸€ä¸ªlistå­˜å‚¨è¯»å–æ•°æ®</li><li>åˆ›å»ºä¸€ä¸ªlistå­˜å‚¨è§£ææ•°æ®</li></ul><p>æœ€åï¼Œæˆ‘ä»¬å°†æ‰€æœ‰çš„æ•°æ®å†™å…¥åˆ°csvæ–‡åŒ–ä¸­ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String file = <span class="string">"/databases/actorstest.txt"</span>;</span><br><span class="line">        String regex = <span class="string">"([A-Za-z,.'$&amp; ]*)?([\t]*)(.+?)([ ]*)\\(([0-9,?]&#123;4&#125;)(.+?\\n&#123;2&#125;)?"</span>;</span><br><span class="line"></span><br><span class="line">        Reader reader = <span class="keyword">new</span> Reader();</span><br><span class="line">        Parser parser = <span class="keyword">new</span> Parser();</span><br><span class="line">        Writer writer = <span class="keyword">new</span> Writer();</span><br><span class="line">        </span><br><span class="line">        ArrayList&lt;String&gt; lijst = reader.Read(file);</span><br><span class="line">        ArrayList&lt;ArrayList&lt;String&gt;&gt; parsed = parser.ParseActors(lijst, regex);</span><br><span class="line"></span><br><span class="line">     </span><br><span class="line">        writer.createFile();</span><br><span class="line">        writer.writeToFile(parsed);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><h4 id="è¿è¡Œä»£ç æµ‹è¯•è§£æå™¨"><a href="#è¿è¡Œä»£ç æµ‹è¯•è§£æå™¨" class="headerlink" title="è¿è¡Œä»£ç æµ‹è¯•è§£æå™¨"></a>è¿è¡Œä»£ç æµ‹è¯•è§£æå™¨</h4><p>è¿è¡Œä»£ç ä¹‹åï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª<code>data.csv</code>çš„æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p><iframe src="/downloads/code/demo.html" allowfullscreen="" frameborder="0" height="2252" width="680" title="data.csv"  scrolling="auto"></iframe><p>å¦‚ä½ æ‰€è§ï¼Œå®ƒå­˜å‚¨äº†æ‰€æœ‰çš„æ•°æ®ï¼Œå¹¶æŒ‰ç…§<code>æ ‡é¢˜</code>, <code>æ¼”å‘˜</code>, å’Œ<code>å¹´ä»½</code>åˆ†ç»„ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æˆ‘ä»¬ä¸ºæ¼”å‘˜åˆ—è¡¨åˆ›å»ºäº†ä¸€ä¸ªè§£æå™¨ã€‚å¦‚æœè¦è§£ææ›´å¤šIMDBåˆ—è¡¨æˆ–æ‰¾åˆ°çš„ä»»ä½•æ•°æ®åº“/åˆ—è¡¨ï¼Œåˆ™å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„Parseï¼ˆï¼‰æ–¹æ³•ã€‚<br>è¿™æ ·çš„è§£æå™¨ä½¿æ‚¨å¯ä»¥æ›´å¥½åœ°ç†è§£æ•°æ®çš„å¤–è§‚ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>[è¯‘] JAVA16å¸¦ç»™å¼€å‘è€…çš„æ–°ç‰¹æ€§</title>
      <link href="2021/03/29/%E8%AF%91-JAVA16%E5%B8%A6%E7%BB%99%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7/"/>
      <url>2021/03/29/%E8%AF%91-JAVA16%E5%B8%A6%E7%BB%99%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åŸæ–‡åœ°å€ï¼š<a href="https://levelup.gitconnected.com/features-java-16-brings-to-developers-b0edd1a1ed28" target="_blank" rel="noopener">Features Java 16 Brings to Developers</a><br>åŸæ–‡ä½œè€…ï¼š<a href="https://zivce.medium.com/" target="_blank" rel="noopener">Å½ivkoviÄ‡ MiloÅ¡</a><br>è¯‘è€…ï¼š<a href="https://maybelence.cn/">maybelence</a></p></blockquote><p>Javaä¸éœ€è¦å†åšè¿‡å¤šä»‹ç»ã€‚å®ƒä½œä¸ºä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œå·²ç»æœ‰å¾ˆå¤šå¹´çš„å‘å±•å†å²ã€‚æœ€è¿‘çš„æ›´æ–°ä¹Ÿä¸ºè¯¥è¯­è¨€å¸¦æ¥äº†å‡ ä¸ªæ–°çš„ç‰¹æ€§ï¼š</p><ul><li>å¯†å°ç±»</li><li>æ¨¡å¼åŒ¹é…</li><li>å…¶ä»–å®‰å…¨æªæ–½ã€‚</li></ul><h3 id="å¯†å°ç±»"><a href="#å¯†å°ç±»" class="headerlink" title="å¯†å°ç±»"></a>å¯†å°ç±»</h3><p><a href="https://openjdk.java.net/jeps/397" target="_blank" rel="noopener">JEP-397</a></p><p><code>å¯†å°</code>çš„ç›®çš„æ˜¯é™åˆ¶å…·ä½“çš„ç±»ã€‚å¯†å°å°†å®ç°æ§åˆ¶æ¨¡å¼åŒ¹é…ï¼Œå¹¶æä¾›å¯¹æ¨¡å¼åŒ¹é…çš„æ”¯æŒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œå¯ä»¥è®¸å¯çš„å…³é”®å­—å·²ç»å¯†å° </span></span><br><span class="line"><span class="comment">// å…è®¸åˆ—å‡ºå¯ä»¥æ‰©å±•å¯†å°ç­‰çº§çš„ç­‰çº§</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> sealed <span class="class"><span class="keyword">class</span> <span class="title">Shape</span></span></span><br><span class="line"><span class="class">    <span class="title">permits</span> <span class="title">Circle</span>, <span class="title">Rectangle</span>, <span class="title">Square</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨åŸºæœ¬çš„æ¥å£ï¼Œé‚£ä½ å°†ä¸ä¼šå¾—åˆ°åå°„ï¼Œæ‚¨ä¸ä¼šå¯¹è¿™äº›æœ‰é™çš„å…·ä½“å®ç°æœ‰ç»†è‡´äº†è§£ã€‚</p><p>å½“ä½¿ç”¨å¯†å°ç±»çš„è¯ï¼Œä½ å°†è·å–åˆ°è¿™ä¸ªåå°„è¡Œä¸ºï¼Œæ‚¨çŸ¥é“è‡ªå·±åŸŸä¸­å¯ä»¥æ‹¥æœ‰çš„ç±»å‹ã€‚</p><p>æšä¸¾è¡¨æ˜äº†ä¸€ç»„æœ‰é™çš„å€¼ã€‚å¯†å°ç±»è¡¨æ˜äº†ä¸€ç»„æ•°é‡æœ‰é™çš„ä¸€ç§å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sealed <span class="class"><span class="keyword">interface</span> <span class="title">Celestial</span> </span></span><br><span class="line"><span class="class">    <span class="title">permits</span> <span class="title">Planet</span>, <span class="title">Star</span>, <span class="title">Comet</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Planet</span> <span class="keyword">implements</span> <span class="title">Celestial</span> </span>&#123; ... &#125;</span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Star</span>   <span class="keyword">implements</span> <span class="title">Celestial</span> </span>&#123; ... &#125;</span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Comet</span>  <span class="keyword">implements</span> <span class="title">Celestial</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä½†æ˜¯ï¼Œè¿™ç§å±‚æ¬¡ç»“æ„å¹¶ä¸ä¼šåæ˜ å‡ºé‡è¦çš„é¢†åŸŸçŸ¥è¯†ï¼Œå³æˆ‘ä»¬çš„æ¨¡å‹ä¸­åªæœ‰ä¸‰ç§ã€‚<br>åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œé™åˆ¶å­ç±»æˆ–è€…å­æ¥å£çš„é›†åˆå¯ä»¥ç®€åŒ–å»ºæ¨¡ã€‚ â€” JEP-397</p></blockquote><h3 id="å¯¹åŸºäºå€¼çš„ç±»çš„å€¼å‘å‡ºè­¦å‘Š"><a href="#å¯¹åŸºäºå€¼çš„ç±»çš„å€¼å‘å‡ºè­¦å‘Š" class="headerlink" title="å¯¹åŸºäºå€¼çš„ç±»çš„å€¼å‘å‡ºè­¦å‘Š"></a>å¯¹åŸºäºå€¼çš„ç±»çš„å€¼å‘å‡ºè­¦å‘Š</h3><p><a href="https://openjdk.java.net/jeps/390" target="_blank" rel="noopener">JEP-390</a></p><p>åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»æ˜¯åŸºäºå€¼çš„ç±»ï¼Œä¾‹å¦‚ï¼š<code>Byte</code>, <code>Short</code>, <code>Integer</code>, <code>Long</code>, <code>Float</code>, <code>Double</code>, <code>Boolean</code>,å’Œ <code>Character</code>ã€‚æœ‰å…³åŸºäºå€¼çš„ç±»çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/lang/doc-files/ValueBased.html" target="_blank" rel="noopener">æ­¤å¤„</a>ã€‚</p><p>ç”±äºå®ƒä»¬æ˜¯ä¸å¯å˜çš„å¯¹è±¡ï¼Œå› æ­¤æ„é€ å‡½æ•°å¯¹äºå®ƒä»¬æ¥è¨€æ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„ã€‚</p><p>ä¸ºäº†é˜²æ­¢æ»¥ç”¨æ„é€ å‡½æ•°ï¼Œæä¾›<code>@jdk.internal.ValueBased</code>æ¥ç”¨äºæ ‡æ³¨ä½œä¸ºvalue-basedçš„ç±»ã€‚æ¯æ¬¡ç¼–è¯‘å™¨æ‰¾åˆ°åŸºäºå€¼çš„ç±»æ„é€ å‡½æ•°æ—¶ï¼Œè¿™éƒ½ä¼šå‘å‡ºè­¦å‘Šã€‚</p><h3 id="é»˜è®¤å¼ºå°è£…JDKå†…éƒ¨å…ƒç´ "><a href="#é»˜è®¤å¼ºå°è£…JDKå†…éƒ¨å…ƒç´ " class="headerlink" title="é»˜è®¤å¼ºå°è£…JDKå†…éƒ¨å…ƒç´ "></a>é»˜è®¤å¼ºå°è£…JDKå†…éƒ¨å…ƒç´ </h3><p><a href="https://openjdk.java.net/jeps/396" target="_blank" rel="noopener">JEP-396</a></p><p>è¿™æ˜¯ä¸ºäº†é¼“åŠ±ç”¨æˆ·ä½¿ç”¨æ ‡å‡†çš„Java APIã€‚ä¸è¿‡ï¼Œå¦‚æœæ‚¨å¦‚æœéœ€è¦ä½¿ç”¨å®½æ¾çš„å°è£…ã€‚è¯·å°½é‡é¿å…ä½¿ç”¨è¯¥ç‰¹æ€§ã€‚</p><p>æ‚¨éœ€è¦å°†å‚æ•°æ·»åŠ åˆ°JVMçš„å¯åŠ¨å™¨ä¸­ã€‚åœ¨ä¸‹é¢æ‚¨å¯ä»¥çœ‹åˆ°å¯èƒ½çš„å‚æ•°ï¼Œæ‚¨å¯ä»¥ä¼ å…¥ã€‚æœ‰å…³å‚æ•°çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://openjdk.java.net/jeps/396#Description" target="_blank" rel="noopener">æ­¤å¤„</a>ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--illegal-access&#x3D; permit | deny | debug | warn</span><br></pre></td></tr></table></figure><p>å°½ç®¡JAVA16åŒ…å«äº†æ­¤åŠŸèƒ½ï¼Œä½†æ˜¯æ‚¨å¯èƒ½åœ¨æ›´æ—©çš„<a href="https://stackoverflow.com/questions/53790182/get-the-current-value-of-illegal-access-setting-in-java" target="_blank" rel="noopener">ç‰ˆæœ¬</a>å°±é‡åˆ°äº†è¿™ç§é—®é¢˜ï¼Œè¿™ä¸ªæ›´æ”¹æ˜¯åœ¨JAVA9<a href="https://jaxenter.com/jdk-9-replace-permit-illegal-access-134180.html" target="_blank" rel="noopener">å‘å¸ƒ</a>ä¹‹åæå‡ºçš„ã€‚</p><blockquote><p>ç›´è‡³ä»Šæ—¥ï¼ŒæŸäº›æ„å»ºå·¥å…·åœ¨æ„å»ºJavaé¡¹ç›®(Java&gt; = 9)æ—¶ä»ä¼šæ‰“å°å‡º<a href="https://issues.apache.org/jira/browse/GROOVY-8339" target="_blank" rel="noopener">â€œåå°„è®¿é—®â€è­¦å‘Š</a>ï¼Œå³ä½¿å·²ç»æˆåŠŸæ„å»ºï¼Œå®ƒä»¬ä¹Ÿä¼šæ„Ÿè§‰â€œå°šæœªå°±ç»ªâ€ã€‚ - <a href="https://www.marcobehler.com/guides/a-guide-to-java-versions-and-features" target="_blank" rel="noopener">å‡ºå¤„</a></p></blockquote><h3 id="æ¨¡å¼åŒ¹é…"><a href="#æ¨¡å¼åŒ¹é…" class="headerlink" title="æ¨¡å¼åŒ¹é…"></a>æ¨¡å¼åŒ¹é…</h3><p><a href="https://openjdk.java.net/jeps/394" target="_blank" rel="noopener">JEP-394</a></p><p>æ¨¡å¼åŒ¹é…å·²ç»å­˜åœ¨å¾ˆé•¿æ—¶é—´äº†ï¼Œä½ å¯ä»¥åœ¨å¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­å‘ç°å®ƒï¼Œä¾‹å¦‚Elixirã€‚</p><p>åœ¨JAVAä¸­ï¼Œå­˜åœ¨è®¸å¤š<code>instanceof</code>æ¡ä»¶ã€‚å› ä¸ºæœ‰å‡å°‘æ“ä½œçš„åŠ¨æœºä»è€Œè¡ç”Ÿå‡ºäº†æ¨¡å¼åŒ¹é…ã€‚</p><blockquote><p>æ¨¡å¼åŒ¹é…å…è®¸ç®€æ˜åœ°è¡¨è¾¾å¯¹è±¡çš„æ‰€éœ€â€œå½¢çŠ¶â€ï¼ˆæ¨¡å¼ï¼‰ï¼Œå¹¶å…è®¸å„ç§è¯­å¥å’Œè¡¨è¾¾å¼é’ˆå¯¹å…¶è¾“å…¥ï¼ˆåŒ¹é…ï¼‰æ¥æµ‹è¯•â€œå½¢çŠ¶â€ã€‚ â€” JEP-394</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¾ˆå¤šæ ·æ¿ä»£ç </span></span><br><span class="line"><span class="keyword">if</span> (obj <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">    String s = (String) obj;    <span class="comment">// grr...</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ¨¡å¼åŒ¹é…ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—æ­¤ä»£ç ã€‚å‡å°‘æ ·æ¿ï¼Œè¿›è¡Œè½¬æ¢ï¼Œå¹¶å£°æ˜å˜é‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (obj <span class="keyword">instanceof</span> String s) &#123;</span><br><span class="line">    <span class="comment">// Let pattern matching do the work!</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¨¡å¼å˜é‡åœ¨å®ƒåŒ¹é…çš„èŒƒå›´å†…ã€‚å› æ­¤ï¼Œè¿™æ ·çš„ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a <span class="keyword">instanceof</span> Point p) &#123;</span><br><span class="line">    <span class="comment">// påœ¨èŒƒå›´å†…</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// pä¸å†èŒƒå›´å†…</span></span><br><span class="line"><span class="keyword">if</span> (b <span class="keyword">instanceof</span> Point p) &#123;     <span class="comment">// Sure!</span></span><br><span class="line">        ... </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‚¨ä¸å¿…æ‹…å¿ƒå˜é‡åã€‚å¦‚æœèŒƒå›´ä¸åŒï¼Œåˆ™å¯ä»¥é‡ç”¨ç°æœ‰åç§°ã€‚</p><p><em>æ¨¡å¼åŒ¹é…æ”¹å–„äº†ä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿ</em></p><p>å¯ä»¥é¿å…å¾ˆå¤šæ˜¾ç¤ºçš„è½¬æ¢ï¼Œè®©æˆ‘ä»¬ç”¨ç›¸åŒçš„æ–¹æ³•ï¼Œå†™å‡ºå¯è¯»æ€§æ›´é«˜çš„ä»£ç ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> (o <span class="keyword">instanceof</span> CaseInsensitiveString) &amp;&amp;</span><br><span class="line">        ((CaseInsensitiveString) o).s.equalsIgnoreCase(s);</span><br><span class="line"><span class="comment">// to this </span></span><br><span class="line"><span class="keyword">return</span> (o <span class="keyword">instanceof</span> CaseInsensitiveString cis) &amp;&amp;</span><br><span class="line">        cis.s.equalsIgnoreCase(s);</span><br></pre></td></tr></table></figure><p>ç°åœ¨çœ‹ä¸‹ä¸€ä¸ªä¾‹å­ï¼Œå¦‚æœinstanceof String sçš„æ¡ä»¶ä¸ºtrueï¼Œåˆ™ä¸ºsåˆ†é…ä¸€ä¸ªå€¼ã€‚ç›¸åï¼Œå¦‚æœæ¨¡å¼åŒ¹é…å¤±è´¥ï¼Œé‚£ä¹ˆså°†æ²¡æœ‰ä»»ä½•å€¼ã€‚</p><p>å› æ­¤è¿™ä¸ªä»£ç å®Œå…¨å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œä¸å­˜åœ¨<a href="https://docs.oracle.com/javase/specs/jls/se15/html/jls-14.html#jls-14.22" target="_blank" rel="noopener">è¯­å¥ä¸å¯è¾¾</a>çš„æƒ…å†µã€‚å¦‚æœæœ‰æ¡ä»¶é€šè¿‡ï¼Œåˆ™såˆ†é…å€¼ï¼›å¦‚æœæ²¡æœ‰é€šè¿‡ï¼Œåˆ™sè¢«å®‰å…¨ä¸¢å¼ƒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onlyForStrings</span><span class="params">(Object o)</span> <span class="keyword">throws</span> MyException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> String s))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> MyException();</span><br><span class="line">    <span class="comment">// s has value at this point</span></span><br><span class="line">    System.out.println(s);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Javaåœ¨ä¸æ–­å‘å±•ã€‚å¯¼è‡´å¾ˆå¤šé‡å¤§æ›´æ”¹ã€‚åŒæ—¶ä¹Ÿå¼•å…¥å¾ˆå¤š<a href="https://medium.com/dev-genius/8-problems-every-java-developer-knows-4f65339e0c00" target="_blank" rel="noopener">é—®é¢˜</a>ã€‚</p><p><img src="0_MzIcNjgSR9uVS3yb.png" alt="Constant Java updates"></p><p>å³ä½¿è¿™æ ·ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦è¿›è¡Œè°ƒæ•´ã€‚ä½¿ç”¨æ–°ç‰¹æ€§ï¼Œä»¥ä¾¿æˆ‘ä»¬åˆ›å»ºæ›´å¥½çš„è½¯ä»¶ã€‚è¿™äº›æ˜¯æˆ‘æå‡ºçš„å‡ ä¸ªæ–°ç‰¹æ€§ã€‚æ‚¨å¯ä»¥åœ¨ä¸‹é¢çš„éƒ¨åˆ†ä¸­é˜…è¯»æ›´å¤šå†…å®¹ã€‚</p><hr><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><p>JEPè‰æ¡ˆï¼šå¼€å…³çš„æ¨¡å¼åŒ¹é…ï¼ˆpreviewï¼‰<a href="https://openjdk.java.net/jeps/406" target="_blank" rel="noopener">ç‚¹æ­¤æŸ¥çœ‹</a></p><p>JDK16ï¼šJAVA16ä¸­çš„æ–°ç‰¹æ€§ <a href="https://www.infoworld.com/article/3569150/jdk-16-the-new-features-in-java-16.html" target="_blank" rel="noopener">ç‚¹æ­¤æŸ¥çœ‹</a></p>]]></content>
      
      
      <categories>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA16 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ‡é¢ç¼–ç¨‹--springAOP</title>
      <link href="2021/03/24/%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B-springAOP/"/>
      <url>2021/03/24/%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B-springAOP/</url>
      
        <content type="html"><![CDATA[<h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>AOPæ„ä¸º<code>é¢å‘åˆ‡é¢ç¼–ç¨‹</code>ï¼Œæ˜¯é€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸåŠ¨æ€ä»£ç†å®ç°ç¨‹åºåŠŸèƒ½çš„ç»Ÿä¸€ç»´æŠ¤çš„ä¸€ç§æŠ€æœ¯ï¼Œæ˜¯OOPé¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€ç§è¡¥è¶³ã€‚å®ƒæ˜¯è½¯ä»¶å¼€å‘ä¸­çš„ä¸€ä¸ªçƒ­ç‚¹æŠ€æœ¯ï¼ŒSpring AOP ä¹Ÿæ˜¯Springæ¡†æ¶çš„æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼ˆå¦ä¸€ä¸ªæ ¸å¿ƒç‰¹æ€§æ˜¯IOCï¼‰</p><h4 id="ä¸ºä»€ä¹ˆè¦å¼•å…¥AOP"><a href="#ä¸ºä»€ä¹ˆè¦å¼•å…¥AOP" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å¼•å…¥AOP"></a>ä¸ºä»€ä¹ˆè¦å¼•å…¥AOP</h4><ul><li>åˆ†ç¦»åŠŸèƒ½æ€§éœ€æ±‚å’ŒéåŠŸèƒ½æ€§éœ€æ±‚</li><li>é›†ä¸­å¤„ç†æŸä¸€å…³æ³¨ç‚¹</li><li>ä¾µå…¥æ€§å°‘ï¼Œå¢å¼ºä»£ç å¯è¯»æ€§åŠå¯ç»´æŠ¤æ€§</li></ul><h4 id="AOPåº”ç”¨åœºæ™¯"><a href="#AOPåº”ç”¨åœºæ™¯" class="headerlink" title="AOPåº”ç”¨åœºæ™¯"></a>AOPåº”ç”¨åœºæ™¯</h4><p>æƒé™æ§åˆ¶ã€ç¼“å­˜æ§åˆ¶ã€äº‹åŠ¡æ§åˆ¶ã€åˆ†å¸ƒå¼è¿½è¸ªã€å¼‚å¸¸å¤„ç†ç­‰</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ä¸€ä¸ªåå°ç®¡ç†ç³»ç»Ÿï¼Œæ¯æ¬¡ä¿®æ”¹å…ƒç´ ä¿¡æ¯çš„æ—¶å€™ï¼Œéƒ½éœ€è¦æ ¡éªŒæ“ä½œäººæ˜¯å¦æ‹¥æœ‰è¯¥æ“ä½œæƒé™ï¼Œåœ¨ä¼ ç»Ÿçš„OOPä¸­ï¼Œæˆ‘ä»¬éœ€è¦å†™ä¸€ä¸ª<code>åŸºç±»</code>ï¼Œå£°æ˜é‰´æƒæ–¹æ³•ï¼Œåœ¨å­ç±»ä¸­è°ƒç”¨super.checkPriv();æ¥è¿”å›ç»“æœã€‚å¦‚æœServiceå¾ˆå¤šï¼Œæ¯ä¸ªServiceéƒ½éœ€è¦ç»§æ‰¿BaseService,å°±ä¼šå¯¼è‡´è€¦åˆåº¦è¿‡é«˜ï¼Œä»£ç å†—ä½™ã€‚<br>è€ŒAOPå¯ä»¥ç›´æ¥é€šè¿‡ä¸€ä¸ªå•ä¸€çš„åˆ‡é¢ç±»ï¼Œå¯¹éœ€è¦æƒé™éªŒè¯çš„æ–¹æ³•ç»Ÿä¸€ç»‡å…¥ã€‚å°±å¥½åƒä¸€ä¸ªåŒ…ç§Ÿå©†ï¼Œå¥¹å…¶å®å…³å¿ƒçš„åªæ˜¯è·Ÿç”¨æˆ·ç­¾åˆåŒå’Œæ”¶æˆ¿ç§Ÿï¼Œå¦‚æœæ¯æ¥ä¸€ä¸ªç”¨æˆ·ï¼Œå¥¹éƒ½è¦å¸¦ç€çœ‹æˆ¿ã€è°ˆä»·æ ¼ã€‚å¯¹å¥¹è€Œè¨€æ˜¾ç„¶æ˜¯ä¸ä¹æ„çš„ã€‚æ‰€ä»¥ä¸­ä»‹å°±å‡ºç°äº†ï¼Œè¿™ç§é‡å¤ä¸”éæ ¸å¿ƒçš„äº‹æƒ…ï¼Œç›´æ¥äº¤ç»™ä¸­ä»‹ã€‚å¥¹å°±å¯ä»¥ä¸“æ³¨äºç­¾åˆåŒå’Œæ”¶ç§Ÿã€‚</p><p><img src="1.png" alt=""></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Landlady1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä»…ä»…åªæ˜¯å®ç°äº†æ ¸å¿ƒçš„ä¸šåŠ¡åŠŸèƒ½</span></span><br><span class="line">        System.out.println(<span class="string">"ç­¾åˆåŒ"</span>);</span><br><span class="line">        System.out.println(<span class="string">"æ”¶ç§Ÿ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Landlady2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä»…ä»…åªæ˜¯å®ç°äº†æ ¸å¿ƒçš„ä¸šåŠ¡åŠŸèƒ½</span></span><br><span class="line">        System.out.println(<span class="string">"ç­¾åˆåŒ"</span>);</span><br><span class="line">        System.out.println(<span class="string">"æ”¶ç§Ÿ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Intermediary</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(* com.example.*.service())"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logPointCut</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"logPointCut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//é‡å¤ä¸”éæ ¸å¿ƒçš„äº‹æƒ…</span></span><br><span class="line">        System.out.println(<span class="string">"å¸¦ç§Ÿå®¢çœ‹æˆ¿"</span>);</span><br><span class="line">        System.out.println(<span class="string">"è°ˆä»·æ ¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ³¨å†Œè¿‡ç¨‹"><a href="#æ³¨å†Œè¿‡ç¨‹" class="headerlink" title="æ³¨å†Œè¿‡ç¨‹"></a>æ³¨å†Œè¿‡ç¨‹</h3><h4 id="AopAutoConfiguration"><a href="#AopAutoConfiguration" class="headerlink" title="AopAutoConfiguration"></a>AopAutoConfiguration</h4><p>AopAutoConfiguration è¿™ä¸ªé…ç½®ç±»ä¸»è¦æ˜¯é…ç½®aopçš„ä»£ç†ç±»å‹ï¼Œé»˜è®¤spring.aop.auto=trueã€‚çœ‹æ³¨é‡Šçš„æ„æ€ï¼Œ<code>spring.aop.auto=true</code>ä¸ºtrueçš„æ—¶å€™ï¼Œé€šè¿‡ä¸ºé…ç½®ç±»æ·»åŠ <code>@EnableAspectJAutoProxy</code>ï¼Œspringé»˜è®¤å°±ä¼šå¼€å¯AOPåŠŸèƒ½ã€‚springboot2.0ä¹‹åAOPä»£ç†æœ‰ä¸‰ç§ç­–ç•¥ï¼š</p><ul><li>jdkåŠ¨æ€ä»£ç†ï¼šå½“spring.aop.proxy-target-class=false, å¼•å…¥äº†aspectjweaverä¾èµ–æ—¶ç”Ÿæ•ˆ</li><li>cglibä»£ç†ï¼šå½“spring.aop.proxy-target-class=true, å¼•å…¥äº†aspectjweaverä¾èµ–æ—¶ç”Ÿæ•ˆ</li><li>åŸºç¡€ä»£ç†ï¼šå½“spring.aop.proxy-target-class=true, è‹¥æ²¡æœ‰aspectjweaverä¾èµ–æ—¶ç”Ÿæ•ˆï¼Œåªä½œç”¨äºæ¡†æ¶å†…éƒ¨çš„advisors<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> org.springframework.boot.autoconfigure.EnableAutoConfiguration</span></span><br><span class="line"><span class="comment"> * Auto-configuration&#125; for Spring's AOP support. Equivalent to enabling</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> EnableAspectJAutoProxy <span class="doctag">@EnableAspectJAutoProxy</span>&#125; in your configuration.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * The configuration will not be activated if &#123;<span class="doctag">@literal</span> spring.aop.auto=false&#125;. The</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@literal</span> proxyTargetClass&#125; attribute will be &#123;<span class="doctag">@literal</span> true&#125;, by default, but can be</span></span><br><span class="line"><span class="comment"> * overridden by specifying &#123;<span class="doctag">@literal</span> spring.aop.proxy-target-class=false&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Dave Syer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Josh Long</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> EnableAspectJAutoProxy</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(prefix = <span class="string">"spring.aop"</span>, name = <span class="string">"auto"</span>, havingValue = <span class="string">"true"</span>, matchIfMissing = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AopAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å› ä¸ºè¯¥æ³¨è§£çš„è¿™ä¸ªé»˜è®¤å€¼æ˜¯trueï¼Œè¿™äº›éƒ½ä¸èƒ½çœç•¥ï¼Œæˆ‘å¥½ç—›è‹¦</span></span><br><span class="line">    <span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>) </span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(Advice<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">static</span> <span class="title">class</span> <span class="title">AspectJAutoProxyingConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span>(proxyTargetClass = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(prefix = <span class="string">"spring.aop"</span>, name = <span class="string">"proxy-target-class"</span>, havingValue = <span class="string">"false"</span>,</span><br><span class="line">matchIfMissing = <span class="keyword">false</span>)</span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">JdkDynamicAutoProxyConfiguration</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span>(proxyTargetClass = <span class="keyword">true</span>)</span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(prefix = <span class="string">"spring.aop"</span>, name = <span class="string">"proxy-target-class"</span>, havingValue = <span class="string">"true"</span>,</span><br><span class="line">matchIfMissing = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CglibAutoProxyConfiguration</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@ConditionalOnMissingClass</span>(<span class="string">"org.aspectj.weaver.Advice"</span>)</span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(prefix = <span class="string">"spring.aop"</span>, name = <span class="string">"proxy-target-class"</span>, havingValue = <span class="string">"true"</span>,</span><br><span class="line">matchIfMissing = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassProxyingConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">ClassProxyingConfiguration(BeanFactory beanFactory) &#123;</span><br><span class="line"><span class="keyword">if</span> (beanFactory <span class="keyword">instanceof</span> BeanDefinitionRegistry) &#123;</span><br><span class="line">BeanDefinitionRegistry registry = (BeanDefinitionRegistry) beanFactory;</span><br><span class="line">AopConfigUtils.registerAutoProxyCreatorIfNecessary(registry);</span><br><span class="line">AopConfigUtils.forceAutoProxyCreatorToUseClassProxying(registry);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="EnableAspectJAutoProxy"><a href="#EnableAspectJAutoProxy" class="headerlink" title="@EnableAspectJAutoProxy"></a>@EnableAspectJAutoProxy</h4><p>ä»ä»£ç å¯ä»¥çœ‹å‡º @EnableAspectJAutoProxy å¼•å…¥äº† AspectJAutoProxyRegister.class å¯¹è±¡ ï¼ŒAspectJAutoProxyRegister ç»™å®¹å™¨ä¸­æ³¨å†Œä¸€ä¸ª AnnotationAwareAspectJAutoProxyCreatorï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Import</span>(AspectJAutoProxyRegistrar<span class="class">.<span class="keyword">class</span>) //å¼•å…¥<span class="title">AspectJAutoProxyRegister</span>.<span class="title">class</span>å¯¹è±¡</span></span><br><span class="line"><span class="class"><span class="title">public</span> @<span class="title">interface</span> <span class="title">EnableAspectJAutoProxy</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//é»˜è®¤ä½¿ç”¨javaæ¥å£åˆ›å»ºä»£ç†ï¼Œå½“å€¼ä¸ºtrueçš„æ—¶å€™é‡‡ç”¨CGlibåŸºäºç±»ä»£ç†</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">proxyTargetClass</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//æ˜¯å¦é€šè¿‡aopæ¡†æ¶æš´éœ²è¯¥ä»£ç†å¯¹è±¡ï¼ŒAopContextèƒ½å¤Ÿè®¿é—®.</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">exposeProxy</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AspectJAutoProxyRegistrar"><a href="#AspectJAutoProxyRegistrar" class="headerlink" title="AspectJAutoProxyRegistrar"></a>AspectJAutoProxyRegistrar</h4><p>è¿™ä¸ªç±»çš„ä½œç”¨æ³¨é‡Šå†™çš„ä¹Ÿå¾ˆæ˜ç™½ï¼Œ åŸºäº<code>@EnableAspectJAutoProxy</code>æ³¨è§£çš„æƒ…å†µä¸‹ï¼Œå¯¹å½“å‰çš„<code>BeanDefinitionRegistry</code>æ³¨å†Œä¸€ä¸ª<code>AnnotationAwareAspectJAutoProxyCreator</code>ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Registers an org.springframework.aop.aspectj.annotation.AnnotationAwareAspectJAutoProxyCreator</span></span><br><span class="line"><span class="comment"> * AnnotationAwareAspectJAutoProxyCreator against the current BeanDefinitionRegistry</span></span><br><span class="line"><span class="comment"> * as appropriate based on a given <span class="doctag">@EnableAspectJAutoProxy</span> annotation.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AspectJAutoProxyRegistrar</span> <span class="keyword">implements</span> <span class="title">ImportBeanDefinitionRegistrar</span> </span>&#123;</span><br><span class="line">    AopConfigUtils.registerAspectJAnnotationAutoProxyCreatorIfNecessary(registry);</span><br><span class="line">    <span class="comment">//ä¸‹é¢çš„ä»£ç æ˜¯åˆ¤æ–­æ˜¯å¦é‡‡ç”¨CGlibå’Œé€šè¿‡AOPæš´éœ²è¯¥ä»£ç†å¯¹è±¡çš„ä»£ç </span></span><br><span class="line">    <span class="comment">//å…¨çœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ç›´æ¥æ¥ç€çœ‹<code>AopConfigUtils</code>, registerAspectJAnnotationAutoProxyCreatorIfNecessary è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æœ€åè°ƒç”¨åˆ°äº†<code>registerOrEscalateApcAsRequired</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> BeanDefinition <span class="title">registerOrEscalateApcAsRequired</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        Class&lt;?&gt; cls, BeanDefinitionRegistry registry, @Nullable Object source)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Assert.notNull(registry, <span class="string">"BeanDefinitionRegistry must not be null"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (registry.containsBeanDefinition(AUTO_PROXY_CREATOR_BEAN_NAME)) &#123; <span class="comment">//å¦‚æœregistryå·²ç»åŒ…å«ç›®æ ‡bean</span></span><br><span class="line">        BeanDefinition apcDefinition = registry.getBeanDefinition(AUTO_PROXY_CREATOR_BEAN_NAME);</span><br><span class="line">        <span class="keyword">if</span> (!cls.getName().equals(apcDefinition.getBeanClassName())) &#123;</span><br><span class="line">            <span class="keyword">int</span> currentPriority = findPriorityForClass(apcDefinition.getBeanClassName());</span><br><span class="line">            <span class="keyword">int</span> requiredPriority = findPriorityForClass(cls);</span><br><span class="line">            <span class="keyword">if</span> (currentPriority &lt; requiredPriority) &#123;</span><br><span class="line">                apcDefinition.setBeanClassName(cls.getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    RootBeanDefinition beanDefinition = <span class="keyword">new</span> RootBeanDefinition(cls);</span><br><span class="line">    beanDefinition.setSource(source);</span><br><span class="line">    beanDefinition.getPropertyValues().add(<span class="string">"order"</span>, Ordered.HIGHEST_PRECEDENCE);</span><br><span class="line">    beanDefinition.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);</span><br><span class="line">    <span class="comment">//å¦åˆ™å°†beanDefinitionæ³¨å†Œè¿›registryä¸­,æ³¨å†Œåä¸º AUTO_PROXY_CREATOR_BEAN_NAME</span></span><br><span class="line">    registry.registerBeanDefinition(AUTO_PROXY_CREATOR_BEAN_NAME, beanDefinition);</span><br><span class="line">    <span class="keyword">return</span> beanDefinition;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>AnnotationAwareAspectJAutoProxyCreatorå¯¹ç›®æ ‡å¯¹è±¡è¿›è¡Œä»£ç†å¯¹è±¡çš„åˆ›å»ºï¼Œåˆ›å»ºä»£ç†å¯¹è±¡è¿‡ç¨‹ä¸­ï¼Œä¼šå…ˆåˆ›å»ºä¸€ä¸ªä»£ç†å·¥å‚ï¼Œè·å–åˆ°æ‰€æœ‰çš„å¢å¼ºå™¨ï¼ˆé€šçŸ¥æ–¹æ³•ï¼‰ï¼Œå°†è¿™äº›å¢å¼ºå™¨å’Œç›®æ ‡ç±»æ³¨å…¥ä»£ç†å·¥å‚ï¼Œå†ç”¨ä»£ç†å·¥å‚åˆ›å»ºå¯¹è±¡ï¼›<br>ä»£ç†å¯¹è±¡æ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼Œå¾—åˆ°ç›®æ ‡æ–¹æ³•çš„æ‹¦æˆªå™¨é“¾ï¼Œåˆ©ç”¨æ‹¦æˆªå™¨çš„é“¾å¼æœºåˆ¶ï¼Œä¾æ¬¡è¿›å…¥æ¯ä¸€ä¸ªæ‹¦æˆªå™¨è¿›è¡Œæ‰§è¡Œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Frameworks </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
            <tag> åˆ‡é¢ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCodeæ¯æ—¥ä¸€é¢˜--StrStr()</title>
      <link href="2021/03/23/LeetCode%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-StrStr/"/>
      <url>2021/03/23/LeetCode%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-StrStr/</url>
      
        <content type="html"><![CDATA[<p>æ˜¨å¤©å’Œæœ‹å‹åŠ³(da)é€¸(you)ç»“(xi)åˆçš„æ—¶å€™ï¼Œæœ‹å‹å‘Šè¯‰æˆ‘ä»–å®ç°äº†ä¸€ä¸ªStrstr()ã€‚ç„¶åæˆ‘å»çœ‹äº†ä¸€ä¸‹ï¼Œé¢˜ç›®éš¾åº¦å±äºEasyã€‚æƒ³ç€åšå‡ºæ¥è¿˜æ˜¯ç®€å•çš„ï¼Œäºæ˜¯ç«‹é©¬åŠ¨æ‰‹æ“ä½œäº†ä¸€æŠŠã€‚</p><h4 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p>å®ç° strStr() å‡½æ•°ã€‚</p><p>ç»™å®šä¸€ä¸ª haystack å­—ç¬¦ä¸²å’Œä¸€ä¸ª needle å­—ç¬¦ä¸²ï¼Œåœ¨ haystack å­—ç¬¦ä¸²ä¸­æ‰¾å‡º needle å­—ç¬¦ä¸²å‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½® (ä»0å¼€å§‹)ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›  -1ã€‚</p><p>ç¤ºä¾‹ 1:</p><blockquote><p>è¾“å…¥: haystack = â€œhelloâ€, needle = â€œllâ€<br>è¾“å‡º: 2<br>ç¤ºä¾‹ 2:</p><p>è¾“å…¥: haystack = â€œaaaaaâ€, needle = â€œbbaâ€<br>è¾“å‡º: -1</p></blockquote><blockquote id="fn_é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/implement-strstr"><sup>é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/implement-strstr</sup>. æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<a href="#reffn_é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/implement-strstr" title="Jump back to footnote [é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/implement-strstr] in the text."> &#8617;</a></blockquote><p>å› ä¸ºæˆ‘æ˜¯ä¸€ä¸ªjavaå…šï¼Œæˆ‘æ‹¿åˆ°è¿™ä¸ªé¢˜ç›®ä¸€çœ‹ï¼Œè¿™ä¸å°±æ˜¯indexOfå—ï¼Œäºæ˜¯æˆ‘ä¼˜é›…çš„å†™ä¸‹äº†ç¬¬ä¸€è¡Œä»£ç ã€‚ã€‚ã€‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">strStr</span><span class="params">(String haystack, String needle)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> haystack.indexOf(needle);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸´ç•Œæƒ…å†µ"><a href="#ä¸´ç•Œæƒ…å†µ" class="headerlink" title="ä¸´ç•Œæƒ…å†µ"></a>ä¸´ç•Œæƒ…å†µ</h4><p>ä½†æ˜¯é¢˜ç›®çš„æœ¬æ„æ˜¾ç„¶ä¸æ˜¯è®©æˆ‘ä»¬ä¹‹é—´è°ƒç”¨APIï¼ŒstrStr()æ˜¯C++çš„APIï¼Œé¢˜ç›®çš„æœ¬æ„æ˜¯è®©æˆ‘ä»¬å®ç°ä»–ï¼ŒçŸ­æš‚æ€ç´¢ä¸€ä¸‹ã€‚æˆ‘å°±å¼€å§‹äº†æˆ‘æ¥ä¸‹æ¥çš„æ€è·¯ã€‚<br>æ—¢ç„¶è¦è¿”å›åˆå§‹ä¸‹æ ‡ï¼Œé‚£æˆ‘ç›´æ¥å°†å­—ç¬¦ä¸²è½¬ä¸ºchar[]ï¼Œé€šè¿‡åˆ¤æ–­æ•°ç»„ä¸‹æ ‡ï¼Œè¿”å›èµ·å§‹ä½ç½®,å½“needleæ˜¯ç©ºä¸²çš„æ—¶å€™æŒ‰ç…§APIçš„è¿”å›ç»“æœé»˜è®¤åº”è¯¥è¿”å›0ï¼Œå› æ­¤åŠ äº†ä¸€å±‚ç‰¹æ®Šçš„æ¡ä»¶åˆ¤æ–­ã€‚ç„¶åå¼€å§‹æ€è€ƒindexOfå¦‚ä½•å®ç°ã€‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">strStr</span><span class="params">(String haystack, String needle)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (needle.length() == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span>[] sources = haystack.toCharArray();</span><br><span class="line">    <span class="keyword">char</span>[] targets = needle.toCharArray();</span><br><span class="line">    <span class="keyword">return</span> indexOf(sources, targets, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆæ¥æ€è€ƒä¸´ç•Œæ¡ä»¶ã€‚å½“targetsçš„é•¿åº¦å¤§äºsourcesé•¿åº¦çš„æ—¶å€™ã€‚é‚£è‚¯å®šæ˜¯åŒ¹é…ä¸ä¸Šçš„ã€‚å› æ­¤ç›´æ¥è¿”å›-1ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(<span class="keyword">char</span>[] sources, <span class="keyword">char</span>[] targets, <span class="keyword">int</span> fromIndex)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (targets.length &gt; sources.length)</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¤„ç†æ€è·¯"><a href="#å¤„ç†æ€è·¯" class="headerlink" title="å¤„ç†æ€è·¯"></a>å¤„ç†æ€è·¯</h4><p>å½“æ»¡è¶³targetsçš„é•¿åº¦å°äºç­‰äºsourcesçš„é•¿åº¦çš„æ—¶å€™ï¼Œæˆ‘éœ€è¦å»å¯»æ‰¾targetsä¸­ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºsourcesç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚å¦‚æœä»å¤´è‡³å°¾æˆ‘éƒ½æ‰¾ä¸åˆ°è¿™ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆè¯´æ˜åŒ¹é…ä¸æ˜¯ï¼Œç›´æ¥è¿”å›-1ï¼Œå¦‚æœæˆ‘èƒ½æ‰¾åˆ°è¿™ä¸ªå…ƒç´ çš„ä¸‹æ ‡ï¼Œåˆ™çœ‹åé¢èƒ½å¦å®Œå…¨åŒ¹é…ï¼Œè‹¥èƒ½è¿™ä¸ªç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®å°±æ˜¯è¿”å›ä¸‹æ ‡ã€‚å¦‚æœåé¢ä¸å®Œå…¨åŒ¹é…ï¼Œé‚£ä¹ˆæˆ‘å¯ä»¥æˆªå–sourcesä¸­è¿™ä¸ª<code>ä¸‹æ ‡</code>åˆ°<code>sources.length</code>ç”Ÿæˆä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œæˆ‘å®šä¹‰ä¸ºnewsourcesï¼Œé‡å¤è¿™ä¸ªåŒ¹é…é€»è¾‘ï¼Œå¦‚æœåŒ¹é…ä¸Šï¼Œé‚£ä¹ˆè¿”å›åæ ‡å°±æ˜¯sourcesä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®åŠ ä¸Šnewsourcesä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå¦‚æœæ²¡åŒ¹é…ä¸Šï¼Œå°±é‡å¤åˆ†å‰²æ•°ç»„ï¼Œç›´è‡³<code>åŒ¹é…æˆåŠŸ</code>æˆ–è€…å‡ºç°ä¸Šé¢<code>ä¸´ç•Œæƒ…å†µ</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">strStr</span><span class="params">(String haystack, String needle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (needle.length() == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">char</span>[] sources = haystack.toCharArray();</span><br><span class="line">        <span class="keyword">char</span>[] targets = needle.toCharArray();</span><br><span class="line">        <span class="keyword">return</span> indexOf(sources, targets, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(<span class="keyword">char</span>[] sources, <span class="keyword">char</span>[] targets, <span class="keyword">int</span> fromIndex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (targets.length &gt; sources.length)</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//å…ˆæ‰¾åˆ°ç¬¬ä¸€ä¸ªä½ç½®</span></span><br><span class="line">        <span class="keyword">char</span> Item = targets[<span class="number">0</span>];</span><br><span class="line">        BREAK:</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sources.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (sources[i] == Item) &#123;</span><br><span class="line">                fromIndex = i; <span class="comment">//é¢„è®¾å®š</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; targets.length; j++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (i != <span class="number">0</span> &amp;&amp; i == sources.length - <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="comment">//è¿™é‡Œå…¶å®å¯ä»¥ä¼˜åŒ–ï¼Œå½“æ‰¾åˆ°ç¬¬ä¸€ä¸ªä½ç½®ä¹‹åï¼Œ</span></span><br><span class="line">                    <span class="comment">//ç›´æ¥åˆ¤æ–­sourceså‰©ä½™é•¿åº¦æ˜¯ä¸æ˜¯å¤§äºç­‰äºtargetsé•¿åº¦å¯çœç•¥å¾ˆå¤šæ¬¡ifåˆ¤æ–­</span></span><br><span class="line">                        <span class="keyword">return</span> -<span class="number">1</span>; </span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (sources[i++] != targets[j]) &#123;</span><br><span class="line">                        fromIndex++;</span><br><span class="line">                        <span class="keyword">break</span> BREAK;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> fromIndex;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å…¨éƒ¨éå†éƒ½æ‰¾ä¸åˆ°ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›-1</span></span><br><span class="line">            <span class="keyword">if</span> (i + <span class="number">1</span> == sources.length)</span><br><span class="line">                <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//é€’å½’</span></span><br><span class="line">        <span class="keyword">int</span> thenIndex = indexOf(Arrays.copyOfRange(sources, fromIndex, sources.length), targets, fromIndex);</span><br><span class="line">        <span class="keyword">return</span> thenIndex == -<span class="number">1</span> ? -<span class="number">1</span> : fromIndex + thenIndex;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢åœ¨éå†åŒ¹é…çš„æ—¶å€™ï¼Œæˆ‘åŠ äº†ä¸€å±‚åˆ¤æ–­ï¼Œå› ä¸ºå¯èƒ½sourceså‰©ä½™é•¿åº¦å¦‚æœå°äºtargetsé•¿åº¦ï¼Œi++ä¹‹å sources[i++]æœ‰å¯èƒ½ä¼šæ•°ç»„è¶Šç•Œã€‚è¿™ç§å¤„ç†å…¶å®ä¸å¥½ï¼Œå¯ä»¥ç›´æ¥åœ¨éå†targetsä¹‹å‰åˆ¤æ–­sources.length-fromIndexæ˜¯ä¸æ˜¯æ¯”targets.lengthå¤§ã€‚è¿™æ ·å¯ä»¥çœç•¥å¾ˆå¤šæ¬¡ifåˆ¤æ–­ï¼Œ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(sources.length-fromIndex&lt;targets.length)&#123;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; targets.length; j++) &#123;</span><br><span class="line">    <span class="comment">// if (i != 0 &amp;&amp; i == sources.length - 1) &#123;</span></span><br><span class="line">    <span class="comment">// //è¿™é‡Œå…¶å®å¯ä»¥ä¼˜åŒ–ï¼Œå½“æ‰¾åˆ°ç¬¬ä¸€ä¸ªä½ç½®ä¹‹åï¼Œ</span></span><br><span class="line">    <span class="comment">// //ç›´æ¥åˆ¤æ–­sourceså‰©ä½™é•¿åº¦æ˜¯ä¸æ˜¯å¤§äºç­‰äºtargetsé•¿åº¦å¯çœç•¥å¾ˆå¤šæ¬¡ifåˆ¤æ–­</span></span><br><span class="line">    <span class="comment">//     return -1; </span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="keyword">if</span> (sources[i++] != targets[j]) &#123;</span><br><span class="line">        fromIndex++;</span><br><span class="line">        <span class="keyword">break</span> BREAK;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å…¶å®ç±»ä¼¼å­—ç¬¦ä¸²çš„åŒ¹é…ç®—æ³•è¿˜æœ‰å¾ˆå¤šï¼Œæ¯”è¾ƒæœ‰åçš„KMPç®—æ³•ï¼Œæˆ–è€…åˆ©ç”¨å“ˆå¸Œè¡¨æ¥å¤„ç†ï¼Œéƒ½æ˜¯ä¸€äº›è§£å†³æ–¹æ¡ˆï¼Œä»…æ­¤è®°å½•ä¸€ä¸‹æˆ‘çš„è§£æ³•ï¼Œå‹¿å–·å‹¿å–·ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> leetcode </tag>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç™¾é—®ä¸åŒçš„ä¹è§‚é”å’Œæ‚²è§‚é”</title>
      <link href="2021/01/28/%E7%99%BE%E9%97%AE%E4%B8%8D%E5%8E%8C%E7%9A%84%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%82%B2%E8%A7%82%E9%94%81/"/>
      <url>2021/01/28/%E7%99%BE%E9%97%AE%E4%B8%8D%E5%8E%8C%E7%9A%84%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%82%B2%E8%A7%82%E9%94%81/</url>
      
        <content type="html"><![CDATA[<p>ä¹è§‚é”å’Œæ‚²è§‚é”ä¸€ç›´éƒ½æ˜¯é¢è¯•ä¸­é«˜é¢‘è€ƒå¯Ÿç‚¹ï¼Œé¢è¯•å®˜ä¹Ÿå–œæ¬¢ä»è¿™ç±»é—®é¢˜å»è€ƒå¯Ÿé¢è¯•è€…çš„åŸºæœ¬åŠŸã€‚ä»Šå¤©æˆ‘ä»¬å°±æ¥èŠä¸€ä¸‹ä¹è§‚é”å’Œæ‚²è§‚é”çš„å®ç°ï¼š<br><code>CASï¼ŒSynchronizedï¼ŒReentrantLock</code>ã€‚</p><p>é¦–å…ˆè¦å¯¹ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Œæˆ‘ä»¬è¦æœ‰ä¸€å®šçš„æ¦‚å¿µï¼š</p><ul><li>æ‚²è§‚é”ï¼šæ‚²è§‚çš„è®¤ä¸ºåªè¦ä¸åšæ­£ç¡®çš„æ•°æ®åŒæ­¥æªæ–½ï¼Œå®ƒå°±ä¸€å®šä¼šå‡ºé—®é¢˜</li><li>ä¹è§‚é”ï¼šä¹è§‚çš„è®¤ä¸ºä¸éœ€è¦å»é‡‡å–åŒæ­¥æªæ–½ä¹Ÿä¸ä¼šå‡ºé—®é¢˜ï¼Œå¦‚æœå‡ºç°é—®é¢˜ï¼Œå†å»è¡¥æ•‘</li></ul><p>é‚£å…·ä½“é€šè¿‡å“ªäº›æ–¹å¼å»æ‰å–åŒæ­¥å‘¢ï¼Œåœ¨å¤šçº¿ç¨‹ä¸­ï¼ŒåŒæ­¥æœºåˆ¶ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å››ç§ï¼Œå…·ä½“çš„åŒºåˆ«ä»¥åå†è®²ï¼š</p><ul><li>äº’æ–¥é‡ï¼šä¸ºåè°ƒå…±åŒå¯¹ä¸€ä¸ªå…±äº«èµ„æºçš„å•ç‹¬è®¿é—®è€Œè®¾è®¡çš„ã€‚</li><li>ä¸´ç•ŒåŒºï¼šé€šè¿‡å¯¹å¤šçº¿ç¨‹çš„ä¸²è¡ŒåŒ–æ¥è®¿é—®å…¬å…±èµ„æºæˆ–ä¸€æ®µä»£ç ï¼Œé€Ÿåº¦å¿«ï¼Œé€‚åˆæ§åˆ¶æ•°æ®è®¿é—®ã€‚</li><li>ä¸´ç•Œé‡ï¼šä¸ºæ§åˆ¶ä¸€ä¸ªå…·æœ‰æœ‰é™æ•°é‡ç”¨æˆ·èµ„æºè€Œè®¾è®¡ã€‚</li><li>äº‹ä»¶ï¼šç”¨æ¥é€šçŸ¥çº¿ç¨‹æœ‰ä¸€äº›äº‹ä»¶å·²å‘ç”Ÿï¼Œä»è€Œå¯åŠ¨åç»§ä»»åŠ¡çš„å¼€å§‹ã€‚</li></ul><h3 id="äº’æ–¥ï¼ˆåŒæ­¥é˜»å¡ï¼‰æ‚²è§‚é”"><a href="#äº’æ–¥ï¼ˆåŒæ­¥é˜»å¡ï¼‰æ‚²è§‚é”" class="headerlink" title="äº’æ–¥ï¼ˆåŒæ­¥é˜»å¡ï¼‰æ‚²è§‚é”"></a>äº’æ–¥ï¼ˆåŒæ­¥é˜»å¡ï¼‰æ‚²è§‚é”</h3><p>äº’æ–¥åªæ˜¯åŒæ­¥æœºåˆ¶çš„å…¶ä¸­ä¸€ä¸ªæ‰‹æ®µï¼Œä¹Ÿæ˜¯å¾ˆå¸¸è§çš„ä¿éšœå¹¶å‘æ­£ç¡®æ€§çš„æ‰‹æ®µ<br>æˆ‘ä»¬çŸ¥é“ä¼ ç»Ÿçš„é”ï¼ˆå¦‚<code>synchronized</code>æˆ–è€…<code>ReentrantLock</code>ï¼‰ä¹‹æ‰€ä»¥è¢«ç§°ä¸ºé‡é‡çº§é”ï¼Œå°±æ˜¯å› ä¸ºä»–ä½¿ç”¨æ“ä½œç³»ç»Ÿäº’æ–¥é‡æ¥å®ç°åŒæ­¥ã€‚</p><h4 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h4><p>synchronizedèƒ½å®ç°åŒæ­¥çš„åŸºç¡€ï¼šä¹Ÿæ˜¯å› ä¸ºåœ¨javaä¸­ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºé”ã€‚</p><p>å…·ä½“è¡¨ç°ä¸ºä»¥ä¸‹3ç§å½¢å¼ã€‚</p><ul><li>å¯¹äºæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ã€‚</li><li>å¯¹äºé™æ€åŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰ç±»çš„Classå¯¹è±¡ã€‚</li><li>å¯¹äºåŒæ­¥æ–¹æ³•å—ï¼Œé”æ˜¯Synchonizedæ‹¬å·é‡Œé…ç½®çš„å¯¹è±¡ã€‚</li><li>å½“ä¸€ä¸ªçº¿ç¨‹è¯•å›¾è®¿é—®åŒæ­¥ä»£ç å—æ—¶ï¼Œå®ƒé¦–å…ˆå¿…é¡»å¾—åˆ°é”ï¼Œé€€å‡ºæˆ–æŠ›å‡ºå¼‚å¸¸æ—¶å¿…é¡»é‡Šæ”¾é”ã€‚</li></ul><p>synchronizedæ˜¯åŸºäº<code>Monitor</code>æ¥å®ç°åŒæ­¥çš„ã€‚å½“<code>synchronized</code>ç»è¿‡ç¼–è¯‘ä¹‹åï¼Œ<strong>ä¼šåœ¨<code>åŒæ­¥å—</code>çš„å‰ååˆ†åˆ«å½¢æˆ<code>monitorenter</code>å’Œ<code>monitorexit</code>æŒ‡ä»¤</strong>ã€‚</p><ul><li>æ¯ä¸ªmonitorç»´æŠ¤ç€ä¸€ä¸ªè®°å½•ç€æ‹¥æœ‰æ¬¡æ•°çš„è®¡æ•°å™¨ã€‚æœªè¢«æ‹¥æœ‰çš„monitorçš„è¯¥è®¡æ•°å™¨ä¸º0</li><li>å½“æ‰§è¡Œè¿›å…¥monitorenteræ—¶ï¼Œé”è®¡æ•°å™¨å°±ä¼š+1ï¼Œå½“æ‰§è¡Œåˆ°monitorexit,é”è®¡æ•°å™¨å°±ä¼š-1ã€‚å½“é”è®¡æ•°å™¨ä¸º0çš„æ—¶å€™ï¼Œé”å°±ä¼šè¢«é‡Šæ”¾</li><li>synchronizedä¸ä¼šå‡ºç°è‡ªå·±æ­»é”è‡ªå·±çš„æƒ…å†µï¼Œå› ä¸ºå¯¹äºå·²ç»è¿›å…¥åŒæ­¥å—çš„çº¿ç¨‹ï¼Œsynchronizedé”æ˜¯å¯é‡å…¥çš„</li><li>åœ¨synchronizedåŒæ­¥ä»£ç å—æ‰§è¡Œå®Œï¼Œä¼šé˜»å¡å…¶ä»–çº¿ç¨‹è¿›å…¥åŒæ­¥é”ï¼ˆæ’ä»–é”ï¼‰</li><li>å¯¹äº<code>åŒæ­¥æ–¹æ³•</code>ï¼Œ<code>synchronized</code>åŒæ­¥æ–¹å¼æ˜¯é€šè¿‡æ–¹æ³•ä¸­çš„access_flagsä¸­è®¾ç½®<code>ACC_SYNCHRONIZED</code>æ ‡å¿—æ¥å®ç°</li></ul><p>å¹¶ä¸”ï¼Œéšç€JDK6å¯¹<code>synchronized</code>è¿›è¡Œäº†å„ç§ä¼˜åŒ–ä¹‹åï¼Œæœ‰äº›æƒ…å†µä¸‹synchronizedå°±å¹¶ä¸é‚£ä¹ˆé‡,JDK6ä¸­ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—è€Œå¼•å…¥çš„åå‘é”å’Œè½»é‡çº§é”ã€‚<br>é’ˆå¯¹<code>synchronized</code>è·å–é”çš„æ–¹å¼ï¼ŒJVM ä½¿ç”¨äº†é”å‡çº§çš„ä¼˜åŒ–æ–¹å¼ï¼Œå°±æ˜¯å…ˆä½¿ç”¨åå‘é”ä¼˜å…ˆåŒä¸€çº¿ç¨‹ç„¶åå†æ¬¡è·å–é”ï¼Œå¦‚æœå¤±è´¥ï¼Œå°±å‡çº§ä¸º CAS è½»é‡çº§é”ï¼Œå¦‚æœå¤±è´¥å°±ä¼šçŸ­æš‚è‡ªæ—‹ï¼Œé˜²æ­¢çº¿ç¨‹è¢«ç³»ç»ŸæŒ‚èµ·ã€‚æœ€åå¦‚æœä»¥ä¸Šéƒ½å¤±è´¥å°±å‡çº§ä¸ºé‡é‡çº§é”ã€‚å¹¶ä¸”é”åªèƒ½å‘ä¸Šå‡çº§ï¼Œä¸èƒ½é™çº§ã€‚</p><p><img src="11.png" alt=""></p><h4 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h4><p>å®ç°ReentrantLockçš„åŸºç¡€æ˜¯AQS( AbstractQueuedSynchronizer é˜Ÿåˆ—åŒæ­¥å™¨)ï¼ŒAQS æœ‰ä¸€ä¸ª state æ ‡è®°ä½ï¼Œå€¼ä¸º<code>1</code>æ—¶è¡¨ç¤ºæœ‰çº¿ç¨‹å ç”¨ï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦è¿›å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ç­‰å¾…ï¼ŒåŒæ­¥é˜Ÿåˆ—æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚<br>å½“è·å¾—é”éœ€è¦ç­‰å¾…æŸä¸ªæ¡ä»¶æ—¶ï¼Œä¼šè¿›å…¥conditioné˜Ÿåˆ—ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—çš„å¯ä»¥æœ‰å¾ˆå¤šä¸ªã€‚å½“æ»¡è¶³conditionçš„æ¡ä»¶çš„æ—¶å€™ï¼Œçº¿ç¨‹å°±ä¼šé‡æ–°ç«äº‰é”èµ„æºã€‚<br>ReentrantLock å†…éƒ¨æœ‰å…¬å¹³é”å’Œéå…¬å¹³é”ä¸¤ç§å®ç°ï¼Œå·®åˆ«å°±åœ¨äºæ–°æ¥çš„çº¿ç¨‹æ˜¯å¦æ¯”å·²ç»åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­çš„ç­‰å¾…çº¿ç¨‹æ›´æ—©è·å¾—é”ã€‚</p><p><img src="12.png" alt=""></p><p>ReentrantLocké‡Œé¢æœ‰ä¸€ä¸ªå†…éƒ¨ç±»Syncï¼ŒSyncç»§æ‰¿AQSï¼ˆAbstractQueuedSynchronizerï¼‰ï¼Œæ·»åŠ é”å’Œé‡Šæ”¾é”çš„å¤§éƒ¨åˆ†æ“ä½œå®é™…ä¸Šéƒ½æ˜¯åœ¨Syncä¸­å®ç°çš„ã€‚<br>å®ƒæœ‰å…¬å¹³é”FairSyncå’Œéå…¬å¹³é”NonfairSyncä¸¤ä¸ªå­ç±»ã€‚<br>ReentrantLocké»˜è®¤ä½¿ç”¨éå…¬å¹³é”ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ„é€ å™¨æ¥æ˜¾ç¤ºçš„æŒ‡å®šä½¿ç”¨å…¬å¹³é”ã€‚</p><h3 id="éé˜»å¡åŒæ­¥ï¼ˆä¹è§‚é”ï¼‰"><a href="#éé˜»å¡åŒæ­¥ï¼ˆä¹è§‚é”ï¼‰" class="headerlink" title="éé˜»å¡åŒæ­¥ï¼ˆä¹è§‚é”ï¼‰"></a>éé˜»å¡åŒæ­¥ï¼ˆä¹è§‚é”ï¼‰</h3><h4 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h4><p>CAS(Compare And Swap)æ˜¯ä¸€ç§ä¹è§‚é”çš„å®ç°æ–¹å¼ã€‚æ˜¯ä¸€ç§è½»é‡çº§é”ï¼ŒJUC ä¸­å¾ˆå¤šå·¥å…·ç±»çš„å®ç°éƒ½æ˜¯åŸºäº<code>CAS</code>çš„ã€‚CASæ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°â€”â€” å†…å­˜ä½ç½®çš„å€¼ï¼ˆVï¼‰ã€é¢„æœŸåŸå€¼ï¼ˆAï¼‰å’Œæ–°å€¼ï¼ˆBï¼‰ã€‚å¦‚æœå†…å­˜ä½ç½®çš„å€¼ä¸é¢„æœŸåŸå€¼ç›¸åŒ¹é…ï¼Œé‚£ä¹ˆå¤„ç†å™¨ä¼šè‡ªåŠ¨å°†è¯¥ä½ç½®æ›´æ–°ä¸ºæ–°å€¼ã€‚å¦åˆ™ï¼Œå¤„ç†å™¨ä¸åšä»»ä½•æ“ä½œã€‚æ— è®ºå“ªç§æƒ…å†µï¼Œå®ƒéƒ½ä¼šåœ¨CASæŒ‡ä»¤ä¹‹å‰è¿”å›è¯¥ä½ç½®çš„å€¼ã€‚</p><p><img src="13.png" alt=""></p><p>ä½†æ˜¯è¿™ç§æƒ…å†µï¼Œå½“æ•°æ®è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼Œå°±ä¼šå‡ºç°ä¸€ç›´å¾ªç¯ã€‚å¯¼è‡´CPUèµ„æºä¸€ç›´æ¶ˆè€—è¿‡å¤šã€‚é™¤æ­¤ä¹‹å¤–<code>CAS</code>æœ¬èº«è¿˜å­˜åœ¨<code>ABAé—®é¢˜</code>ã€‚å³çº¿ç¨‹ä¸€è¯»å–æ•°æ®Aï¼Œçº¿ç¨‹äºŒä¹Ÿè¯»å–æ•°æ®Aï¼Œçº¿ç¨‹äºŒé€šè¿‡CASæ¯”è¾ƒå‘ç°æ•°æ®æ˜¯Aï¼Œäºæ˜¯å°†Aå†™å›Bï¼Œçº¿ç¨‹ä¸‰è¯»å–Bï¼Œçº¿ç¨‹ä¸‰é€šè¿‡CASæ¯”è¾ƒå‘ç°æ•°æ®æ˜¯Bæ²¡æœ‰è¢«æ“ä½œè¿‡ï¼Œåˆå°†æ•°æ®å†™å›Aï¼Œæ­¤æ—¶çº¿ç¨‹ä¸€è¯»åˆ°çš„æ˜¯Aï¼Œä¼šä»¥ä¸ºæ•°æ®æ²¡æœ‰æ”¹å˜è¿‡ã€‚å¯¹äºABAé—®é¢˜ï¼Œé€šè¿‡æ§åˆ¶å˜é‡å€¼çš„<code>ç‰ˆæœ¬å·</code>ï¼ˆè‡ªå¢å­—æ®µæˆ–è€…æ—¶é—´æˆ³ï¼‰æ¥ä¿è¯CASçš„æ­£ç¡®æ€§ã€‚å…·ä½“è§£å†³æ€è·¯å°±æ˜¯åœ¨å˜é‡å‰è¿½åŠ ä¸Šç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å˜é‡æ›´æ–°çš„æ—¶å€™æŠŠç‰ˆæœ¬å·åŠ ä¸€ï¼Œé‚£ä¹ˆA - B - Aå°±ä¼šå˜æˆ1A - 2B - 3Aã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä»Šæ—¥å·æ‡’ï¼Œä¸å†™æ€»ç»“ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é” </tag>
            
            <tag> å¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®€å•èŠä¸€ä¸‹volatile</title>
      <link href="2021/01/06/%E7%AE%80%E5%8D%95%E8%81%8A%E4%B8%80%E4%B8%8Bvolatile/"/>
      <url>2021/01/06/%E7%AE%80%E5%8D%95%E8%81%8A%E4%B8%80%E4%B8%8Bvolatile/</url>
      
        <content type="html"><![CDATA[<p>å¼€å§‹è®²è¿™ä¸ªé¢˜ç›®ä¹‹å‰ï¼Œå…ˆæ¥èŠä¸€ä¸‹ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ã€‚å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœä¸ç”¨è€ƒè™‘è¿™äº›çº¿ç¨‹åœ¨è¿è¡Œæ—¶ç¯å¢ƒä¸‹çš„è°ƒåº¦å’Œäº¤æ›¿æ‰§è¡Œï¼Œä¹Ÿä¸éœ€è¦è¿›è¡Œé¢å¤–çš„åŒæ­¥ï¼Œæˆ–è€…åœ¨è°ƒç”¨æ–¹è¿›è¡Œä»»ä½•å…¶ä»–æ“ä½œï¼Œè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„è¡Œä¸ºéƒ½å¯ä»¥è·å¾—æ­£ç¡®çš„ç»“æœï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±æ˜¯<code>çº¿ç¨‹å®‰å…¨</code>çš„ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„é¢è¯•é¢˜ï¼Œå†æ¥ç€å¾€ä¸‹æ·±å…¥ä¸€ç‚¹ï¼Œå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨å‘¢ï¼Ÿçº¿ç¨‹å®‰å…¨ä¸€èˆ¬æ˜¯ä»ä¸‰ä¸ªæ–¹é¢è€ƒè™‘ï¼š</p><ul><li>åŸå­æ€§: <code>synchronized</code>ç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‹¿åˆ°é”,è¿›å…¥å½“å‰ä»£ç å—</li><li>å¯è§æ€§ï¼š<code>volatile</code>ä¿è¯ä¸åŒçº¿ç¨‹å¯¹å…±äº«å˜é‡æ“ä½œçš„å¯è§æ€§,<code>synchronized</code>è·å¾—é”åä¼šæ¸…ç©ºå·¥ä½œå†…å­˜ï¼Œä»ä¸»å­˜æ‹·è´æœ€æ–°çš„å˜é‡åˆ°å·¥ä½œå†…å­˜(å‰¯æœ¬)ï¼Œå†å°†ä¿®æ”¹åçš„å‰¯æœ¬é‡æ–°åˆ·åˆ°ä¸»å­˜ä¸­ï¼Œç„¶åé‡Šæ”¾é”ï¼Œå…¶ä»–æ²¡æœ‰è·å¾—é”çš„çº¿ç¨‹éƒ½å¤„äºé˜»å¡çŠ¶æ€ï¼Œå› æ­¤ä¹Ÿèƒ½ä¿è¯æ•°æ®å¯è§æ€§ã€‚</li><li>æœ‰åºæ€§ï¼š<code>volatile</code>æœ¬èº«å°±å…·æœ‰æŒ‡ä»¤é‡æ’åºï¼Œ<code>synchronized</code>å’Œ<code>Lock</code>ä¿è¯æ¯ä¸ªæ—¶åˆ»æ˜¯æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œè‡ªç„¶å°±ä¿è¯äº†æœ‰åºæ€§ã€‚</li></ul><p>è¯´å®Œè¿™äº›æˆ‘ä»¬å¼€å§‹çœ‹ä¸€ä¸ªæ§åˆ¶å°å°ç¨‹åºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> maybelence</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@descrpition</span> a demo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-01-05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Consumer&lt;String&gt; fun = System.out::println;</span><br><span class="line">        Test test = <span class="keyword">new</span> Test();</span><br><span class="line">        test.start();</span><br><span class="line">        <span class="keyword">while</span> (!test.isFlag())&#123; &#125;</span><br><span class="line">        fun.accept(<span class="string">"ä½ çœŸå‰å®³"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFlag</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.flag = <span class="keyword">true</span>;</span><br><span class="line">        System.out.println(<span class="string">"flag is "</span>+ flag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ§åˆ¶å°æ‰“å°çš„æ˜¯<code>flag is true</code>ï¼Œç°åœ¨åº”è¯¥ä¸è¶³ä¸ºå¥‡äº†ã€‚é‚£å¦‚ä½•è®©è®¡ç®—æœºå¯¹ä½ è¯´â€œä½ çœŸå‰å®³â€å‘¢ã€‚è¿™æ—¶å€™åº”è¯¥å¯ä»¥èƒ¸æœ‰æˆç«¹çš„é€‰æ‹©volatileæˆ–è€…synchronizedã€‚<br>å…ˆæ¥çœ‹ä¸€ä¸‹synchronizedå®ç°ã€‚<br>æˆ‘è¿™é‡Œå¤§è‡´å†™äº†ä¸€ä¸‹,è¿™é‡Œåªæœ‰ç¬¬ä¸€ç§ä¼šæ‰“å°â€œä½ çœŸå‰å®³â€ï¼Œä½†æ˜¯ç¬¬äºŒç§å¹¶ä¸ä¼šæ‰“å°ã€‚ç¬¬ä¸€ç§æ¯å¾ªç¯ä¸€æ¬¡éƒ½ä¼šè·å–ä¸€æ¬¡é”ï¼Œå½“æ‰§è¡Œå®Œæˆä¹‹åï¼Œä¼šå°†flagå€¼ä»å·¥ä½œå†…å­˜åˆ·æ–°åˆ°ä¸»å­˜ä¸­ã€‚ä½†æ˜¯ç¬¬äºŒç§ï¼Œä»–åœ¨è·å–é”çš„æ—¶å€™ï¼Œflagä»ç„¶æ˜¯falseçš„ï¼Œç„¶åå°±è¿›å…¥äº†æ— é™æ­»å¾ªç¯ã€‚å¹¶ä¸ä¼šå°†flagå€¼æ›´æ–°åˆ°ä¸»å­˜ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Consumer&lt;String&gt; fun = System.out::println;</span><br><span class="line">        Test test = <span class="keyword">new</span> Test();</span><br><span class="line">        test.start();</span><br><span class="line">        <span class="keyword">while</span> (!test.isFlag()) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (test) &#123; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        fun.accept(<span class="string">"ä½ çœŸå‰å®³"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testmain</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Consumer&lt;String&gt; fun = System.out::println;</span><br><span class="line">        Test test = <span class="keyword">new</span> Test();</span><br><span class="line">        test.start();</span><br><span class="line">        <span class="keyword">synchronized</span> (test) &#123;</span><br><span class="line">            <span class="keyword">while</span> (!test.isFlag()) &#123; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        fun.accept(<span class="string">"ä½ çœŸå‰å®³"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="å¯è§æ€§"><a href="#å¯è§æ€§" class="headerlink" title="å¯è§æ€§"></a>å¯è§æ€§</h2><p>ç°åœ¨æ¥çœ‹ä¸€ä¸‹åŠ volatileä¿®é¥°çš„æ–¹å¼,æ¯ä¸ªçº¿ç¨‹åœ¨æ“ä½œæ•°æ®çš„æ—¶å€™ï¼Œä¼šå°†æ•°æ®ä»ä¸»å†…å­˜ä¸­æ‹·è´ä¸€ä»½å‰¯æœ¬åˆ°å½“å‰çº¿ç¨‹çš„å·¥ä½œå†…å­˜ï¼Œå¦‚æœè¯¥çº¿ç¨‹å¯¹äºå‰¯æœ¬æ“ä½œï¼Œå¹¶ä¸”å†™å›äº†ã€‚<br>é‚£ä¹ˆå…¶ä»–çº¿ç¨‹æ‰€å–å¾—çš„å‰¯æœ¬å°±å¤±æ•ˆäº†ã€‚éœ€è¦å¯¹æ•°æ®æ“ä½œçš„è¯å°±åˆå¾—ä»ä¸»å­˜ä¸­é‡æ–°è¯»å–ã€‚è€Œvolatileå¯ä»¥ä¿è¯ä¸åŒçº¿ç¨‹å¯¹äºè¯¥å˜é‡çš„å¯è§æ€§ï¼Œä¹Ÿå°±æ˜¯å½“ä¸€ä¸ªçº¿ç¨‹å¯¹äºè¯¥æ•°æ®æ“ä½œä¹‹åï¼Œå¹¶å†™å›ä¸»å­˜ï¼Œå…¶ä»–çº¿ç¨‹å°±å¯ä»¥ç«‹å³è·å¾—è¯¥å˜é‡æœ€æ–°çš„å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFlag</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.flag = <span class="keyword">true</span>;</span><br><span class="line">        System.out.println(<span class="string">"flag is "</span>+ flag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£å½“æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹<code>flag</code>è¿›è¡Œæ“ä½œï¼Œé‚£åˆ·æ–°åˆ°ä¸»å­˜ä¸­ä»¥è°çš„æ•°æ®ä¸ºå‡†å‘¢ï¼Ÿå¯¹äºè¿™ç§ç¼“å­˜ä¸ä¸€è‡´æ€§é—®é¢˜ï¼Œé€šå¸¸æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>é€šè¿‡åœ¨æ€»çº¿åŠ LOCK#é”çš„æ–¹å¼ï¼ˆé”æ€»çº¿ï¼‰</li><li>é€šè¿‡æŸäº›ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼ˆé”ç¼“å­˜ï¼‰</li></ul><h3 id="é”æ€»çº¿"><a href="#é”æ€»çº¿" class="headerlink" title="é”æ€»çº¿"></a>é”æ€»çº¿</h3><p>CPUæ€»çº¿æ˜¯CPUä¸æ‰€æœ‰èŠ¯ç‰‡è¿æ¥çš„ä¸»å¹²é“ï¼Œå½“ä¸€ä¸ªCPUè¦æ“ä½œæ•°æ®çš„æ—¶å€™ï¼Œå®ƒå‘æ€»çº¿å‘é€ä¸€ä¸ª<code>LOCK#</code>çš„ä¿¡å·ï¼Œå…¶ä»–å¤„ç†å™¨å°±ä¼šå¤„äºé˜»å¡çŠ¶æ€ã€‚ä»è€Œä½¿è¯¥CPUå¯ä»¥ç‹¬äº«æ­¤å…±äº«å†…å­˜ã€‚ä½†æ˜¯é”æ€»çº¿ä¼šå¯¼è‡´å…¶ä»–CPUä¸å…±äº«å†…å­˜ä¹‹é—´çš„é€šä¿¡è¢«é”ä½ï¼Œå¯¼è‡´å¯¹å…¶ä»–å…±äº«å†…å­˜çš„æ•°æ®ä¹Ÿæ— æ³•æ“ä½œï¼Œå› æ­¤å¼€é”€è¾ƒå¤§ã€‚</p><h3 id="é”ç¼“å­˜"><a href="#é”ç¼“å­˜" class="headerlink" title="é”ç¼“å­˜"></a>é”ç¼“å­˜</h3><p>ä»¥åœ¨Intelç³»åˆ—ä¸­å¹¿æ³›ä½¿ç”¨çš„MESIåè®®ä¸ºä¾‹ï¼Œå½“CPUæ“ä½œæ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°è¯¥å˜é‡æ˜¯ä¸€ä¸ªå…±äº«å˜é‡ï¼Œå³åœ¨å…¶ä»–å¤„ç†å™¨ä¸­ä¹Ÿå­˜åœ¨è¯¥å˜é‡çš„å‰¯æœ¬ã€‚é‚£ä¹ˆå°±ä¼šå‘ä¿¡å·å‘ŠçŸ¥è¯¥CPUå°†è¯¥å˜é‡çš„ç¼“å­˜è¡Œç½®ä¸ºæ— æ•ˆçŠ¶æ€ã€‚å½“å…¶ä»–CPUéœ€è¦è¯»å–è¿™ä¸ªæ•°æ®çš„æ—¶å€™ï¼Œä¼šæŸ¥çœ‹è¯¥å˜é‡æ˜¯å¦æ˜¯å¤±æ•ˆçŠ¶æ€ï¼Œå¦‚æœæ˜¯å¤±æ•ˆçŠ¶æ€ï¼Œä¼šé‡æ–°ä»å…±äº«å†…å­˜ä¸­é‡æ–°è¯»å–è¯¥å˜é‡çš„å€¼ã€‚è‡³äºCPUæ˜¯å¦‚ä½•å‘ç°æ•°æ®æ˜¯å¦å·²ç»è¿‡æœŸã€‚æ˜¯CPUé€šè¿‡<code>å—…æ¢</code>åœ¨æ€»çº¿ä¸Šä¼ æ’­çš„æ•°æ®æ¥æ£€æŸ¥è‡ªå·±çš„ç¼“å­˜æ˜¯å¦è¿‡æœŸã€‚å½“å¤„ç†å™¨å‘ç°è‡ªå·±ç¼“å­˜è¡Œå¯¹åº”çš„å†…å­˜åœ°å€è¢«ä¿®æ”¹ï¼Œå°±ä¼šå°†å½“å‰å¤„ç†å™¨çš„ç¼“å­˜è¡Œç½®ä¸ºå¤±æ•ˆçŠ¶æ€ï¼Œå½“å¤„ç†å™¨éœ€è¦å¯¹è¿™ä¸ªæ•°æ®è¿›è¡Œ<code>è¯»å–(æ“ä½œ)</code>çš„æ—¶å€™ï¼Œä¼šé‡æ–°ä»ç³»ç»Ÿå†…å­˜ä¸­è¯»å–è¯¥æ•°æ®ã€‚</p><blockquote><p>ç”±äºvolatileçš„mesiç¼“å­˜ä¸€è‡´æ€§åè®®éœ€è¦ä¸æ–­çš„ä»ä¸»å†…å­˜å—…æ¢å’Œcasä¸æ–­å¾ªç¯æ— æ•ˆäº¤äº’å¯¼è‡´æ€»çº¿å¸¦å®½è¾¾åˆ°å³°å€¼<code>(æ€»çº¿é£æš´)</code>ã€‚å› æ­¤ä¸è¦å¤§é‡ä½¿ç”¨volatileã€‚</p></blockquote><h2 id="æŒ‡ä»¤é‡æ’åº"><a href="#æŒ‡ä»¤é‡æ’åº" class="headerlink" title="æŒ‡ä»¤é‡æ’åº"></a>æŒ‡ä»¤é‡æ’åº</h2><blockquote><p>ä¸ºäº†æé«˜æ€§èƒ½ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸¸å¸¸ä¼šå¯¹æ—¢å®šçš„ä»£ç æ‰§è¡Œé¡ºåºè¿›è¡ŒæŒ‡ä»¤é‡æ’åºã€‚</p></blockquote><p>ä¸€æ®µæºç ï¼Œåˆ°æœ€åæ‰§è¡Œï¼Œéœ€è¦ç»å†é‚£äº›é‡æ’åºè§„åˆ™å‘¢ï¼Ÿ</p><p><img src="00.png" alt="æºç åˆ°æ‰§è¡ŒæŒ‡ä»¤ç»å†çš„é‡æ’åº"></p><p>ä¸€ä¸ªå¥½çš„å†…å­˜æ¨¡å‹ï¼Œä¼šå°½å¯èƒ½å°çš„å»çº¦æŸå¤„ç†å™¨å’Œç¼–è¯‘å™¨ï¼Œåœ¨ä¸æ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„æƒ…å†µä¸‹ï¼Œå°½å¯èƒ½æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚å› æ­¤JMMä¼šå°½é‡å‡å°‘å¯¹åº•å±‚çš„çº¦æŸï¼Œä½¿å…¶èƒ½å¤Ÿå‘æŒ¥è‡ªèº«ä¼˜åŠ¿ã€‚</p><p>ä¸€èˆ¬é‡æ’åºåˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ï¼š</p><ul><li>ç¼–è¯‘å™¨çš„é‡æ’åºï¼šç¼–è¯‘å™¨åœ¨ä¸æ”¹å˜å•çº¿ç¨‹è¯­ä¹‰çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é‡æ–°å®šä¹‰è¯­å¥æ‰§è¡Œé¡ºåº</li><li>æŒ‡ä»¤é›†å¹¶è¡Œçš„é‡æ’åºï¼šç°ä»£å¤„ç†å™¨é‡‡ç”¨äº†æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯æ¥å°†å¤šæ¡æŒ‡ä»¤é‡å æ‰§è¡Œã€‚å¦‚æœä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§ï¼Œå¤„ç†å™¨å¯ä»¥æ”¹å˜è¯­å¥å¯¹åº”æœºå™¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåº</li><li>å†…å­˜ç³»ç»Ÿçš„é‡æ’åºï¼šç”±äºå¤„ç†å™¨ä½¿ç”¨ç¼“å­˜å’Œè¯»/å†™ç¼“å†²åŒºï¼Œè¿™ä½¿å¾—åŠ è½½å’Œå­˜å‚¨æ“ä½œçœ‹ä¸Šå»å¯èƒ½æ˜¯åœ¨ä¹±åºæ‰§è¡Œçš„</li></ul><p>è¿™é‡Œè¦æåˆ°ä¸€ä¸ªæ¦‚å¿µï¼š<code>as-if-serial</code>ã€‚</p><blockquote><p>ä¸ç®¡æ€ä¹ˆé‡æ’åºï¼Œå•çº¿ç¨‹ä¸‹çš„æ‰§è¡Œç»“æœä¸èƒ½è¢«æ”¹å˜ã€‚ç¼–è¯‘å™¨ã€runtimeå’Œå¤„ç†å™¨éƒ½å¿…é¡»éµå®ˆas-if-serialè¯­ä¹‰ã€‚</p></blockquote><h3 id="Volatileå¦‚ä½•ç¦æ­¢é‡æ’åº"><a href="#Volatileå¦‚ä½•ç¦æ­¢é‡æ’åº" class="headerlink" title="Volatileå¦‚ä½•ç¦æ­¢é‡æ’åº"></a>Volatileå¦‚ä½•ç¦æ­¢é‡æ’åº</h3><p>javaç¼–è¯‘å™¨ä¼šåœ¨ç”ŸæˆæŒ‡ä»¤ç³»åˆ—æ—¶åœ¨é€‚å½“çš„ä½ç½®ä¼šæ’å…¥<code>å†…å­˜å±éšœ</code>æŒ‡ä»¤æ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åºã€‚å¹¶ä¸”ä¸ºäº†å®ç°volatileçš„å†…å­˜è¯­ä¹‰ï¼Œä¸ºäº†å®ç°volatileçš„å†…å­˜è¯­ä¹‰ï¼ŒJMMä¼šé™åˆ¶ç‰¹å®šç±»å‹çš„ç¼–è¯‘å™¨å’Œå¤„ç†å™¨é‡æ’åºï¼ŒJMMä¼šé’ˆå¯¹ç¼–è¯‘å™¨åˆ¶å®švolatileé‡æ’åºè§„åˆ™è¡¨ï¼š</p><div class="table-container"><table><thead><tr><th>èƒ½å¦é‡æ’åº</th><th></th><th><strong>ç¬¬äºŒä¸ªæ“ä½œ</strong></th><th></th></tr></thead><tbody><tr><td><strong>ç¬¬ä¸€ä¸ªæ“ä½œ</strong></td><td>æ™®é€šè¯»ï¼ˆå†™ï¼‰</td><td>volatileï¼ˆè¯»ï¼‰</td><td>volatileï¼ˆå†™ï¼‰</td></tr><tr><td>æ™®é€šè¯»ï¼ˆå†™ï¼‰</td><td></td><td></td><td>NO</td></tr><tr><td>volatileï¼ˆè¯»ï¼‰</td><td>NO</td><td>NO</td><td>NO</td></tr><tr><td>volatileï¼ˆå†™ï¼‰</td><td></td><td>NO</td><td>NO</td></tr></tbody></table></div><blockquote><p>volatile<code>å†™</code>æ˜¯åœ¨<code>å‰é¢å’Œåé¢</code>åˆ†åˆ«æ’å…¥å†…å­˜å±éšœï¼Œè€Œvolatile<code>è¯»</code>æ“ä½œæ˜¯åœ¨<code>åé¢æ’å…¥ä¸¤ä¸ª</code>å†…å­˜å±éšœã€‚</p></blockquote><p><img src="01.png" alt="volatileå†™"></p><p><img src="02.png" alt="volatileè¯»"></p><p>ä¸Šè¿°é‡æ’åºè§„åˆ™ï¼Œä¸ºäº†æé«˜å¤„ç†é€Ÿåº¦ï¼ŒJVMå¾€å¾€ä¼šå¯¹ä»£ç è¿›è¡ŒæŒ‡ä»¤é‡æ’åºä¼˜åŒ–ã€‚å¹¶å‘ç¼–ç¨‹ä¸‹æŒ‡ä»¤é‡æ’åºä¼šå¸¦æ¥ä¸€äº›å®‰å…¨éšæ‚£ï¼šå¦‚æŒ‡ä»¤é‡æ’åºå¯¼è‡´çš„å¤šä¸ªçº¿ç¨‹æ“ä½œä¹‹é—´çš„ä¸å¯è§æ€§ã€‚</p><p>ä»JDK5å¼€å§‹ï¼Œæå‡ºäº†<code>happens-before</code>çš„æ¦‚å¿µï¼Œé€šè¿‡è¿™ä¸ªæ¦‚å¿µæ¥é˜è¿°æ“ä½œä¹‹é—´çš„å†…å­˜å¯è§æ€§ã€‚</p><h3 id="happens-before"><a href="#happens-before" class="headerlink" title="happens-before"></a>happens-before</h3><p>å¦‚æœä¸€ä¸ªæ“ä½œæ‰§è¡Œçš„ç»“æœéœ€è¦å¯¹å¦ä¸€ä¸ªæ“ä½œå¯è§ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å¿…é¡»å­˜åœ¨happens-beforeå…³ç³»ã€‚<br><code>volatileåŸŸè§„åˆ™ï¼šå¯¹ä¸€ä¸ªvolatileåŸŸçš„å†™æ“ä½œï¼Œhappens-beforeäºä»»æ„çº¿ç¨‹åç»­å¯¹è¿™ä¸ªvolatileåŸŸçš„è¯»ã€‚</code><br>å¦‚æœç°åœ¨æˆ‘çš„å˜äº†flagå˜æˆäº†falseï¼Œé‚£ä¹ˆåé¢çš„é‚£ä¸ªæ“ä½œï¼Œä¸€å®šè¦çŸ¥é“æˆ‘å˜äº†ã€‚</p><p>ä¸€å®šè¦è®°ä½<code>volatileæ— æ³•ä¿è¯åŸå­æ€§</code>ï¼Œå¦‚æœéè¦ä¿è¯åŸå­æ€§ï¼Œå¯ä»¥é‡‡ç”¨concurrentåŒ…ä¸‹çš„ä¸€äº›åŸå­ç±»æˆ–è€…ç»™åŠ é”ã€‚å…³äºvolatileçš„åº”ç”¨ï¼Œå¯ä»¥çœ‹ä¹‹å‰æœ‰ä¸€ç¯‡è®²å•ä¾‹çš„æ–‡ç« <a href="/2020/09/25/é‚£äº›å¹´æˆ‘ä»¬å­¦è¿‡çš„è®¾è®¡æ¨¡å¼ï¼Œä½ è¿˜è®°å¾—å‡ ä¸ªï¼ˆä¸€ï¼‰/">2020-09-25-é‚£äº›å¹´æˆ‘ä»¬å­¦è¿‡çš„è®¾è®¡æ¨¡å¼ï¼Œä½ è¿˜è®°å¾—å‡ ä¸ªï¼ˆä¸€ï¼‰</a>ã€‚</p><h3 id="volatileå’Œsynchronizedçš„åŒºåˆ«"><a href="#volatileå’Œsynchronizedçš„åŒºåˆ«" class="headerlink" title="volatileå’Œsynchronizedçš„åŒºåˆ«"></a>volatileå’Œsynchronizedçš„åŒºåˆ«</h3><ul><li>volatileåªèƒ½ä¿®é¥°å®ä¾‹å˜é‡å’Œç±»å˜é‡ï¼Œè€Œsynchronizedå¯ä»¥ä¿®é¥°æ–¹æ³•ï¼Œä»¥åŠä»£ç å—ã€‚</li><li>volatileä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œä½†æ˜¯ä¸ä¿è¯åŸå­æ€§(å¤šçº¿ç¨‹è¿›è¡Œå†™æ“ä½œï¼Œä¸ä¿è¯çº¿ç¨‹å®‰å…¨);è€Œsynchronizedæ˜¯ä¸€ç§æ’ä»–(äº’æ–¥)çš„æœºåˆ¶ã€‚</li><li>volatileç”¨äºç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼šå¯ä»¥è§£å†³å•ä¾‹åŒé‡æ£€æŸ¥å¯¹è±¡åˆå§‹åŒ–ä»£ç æ‰§è¡Œä¹±åºé—®é¢˜ã€‚</li><li>volatileå¯ä»¥çœ‹åšæ˜¯è½»é‡ç‰ˆçš„synchronizedï¼Œvolatileä¸ä¿è¯åŸå­æ€§ï¼Œä½†æ˜¯å¦‚æœæ˜¯å¯¹ä¸€ä¸ªå…±äº«å˜é‡è¿›è¡Œå¤šä¸ªçº¿ç¨‹çš„èµ‹å€¼ï¼Œè€Œæ²¡æœ‰å…¶ä»–çš„æ“ä½œï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨volatileæ¥ä»£æ›¿synchronizedï¼Œå› ä¸ºèµ‹å€¼æœ¬èº«æ˜¯æœ‰åŸå­æ€§çš„ï¼Œè€Œvolatileåˆä¿è¯äº†å¯è§æ€§ï¼Œæ‰€ä»¥å°±å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨äº†ã€‚</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li><p>volatileä¿®é¥°ç¬¦é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼šæŸä¸ªå±æ€§è¢«å¤šä¸ªçº¿ç¨‹å…±äº«ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æ­¤å±æ€§ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥ç«‹å³å¾—åˆ°ä¿®æ”¹åçš„å€¼ï¼Œæ¯”å¦‚booleanflag;æˆ–è€…ä½œä¸ºè§¦å‘å™¨ï¼Œå®ç°è½»é‡çº§åŒæ­¥ã€‚</p></li><li><p>volatileå±æ€§çš„è¯»å†™æ“ä½œéƒ½æ˜¯æ— é”çš„ï¼Œå®ƒä¸èƒ½æ›¿ä»£synchronizedï¼Œå› ä¸ºå®ƒæ²¡æœ‰æä¾›åŸå­æ€§å’Œäº’æ–¥æ€§ã€‚å› ä¸ºæ— é”ï¼Œä¸éœ€è¦èŠ±è´¹æ—¶é—´åœ¨è·å–é”å’Œé‡Šæ”¾é”_ä¸Šï¼Œæ‰€ä»¥è¯´å®ƒæ˜¯ä½æˆæœ¬çš„ã€‚</p></li><li><p>volatileåªèƒ½ä½œç”¨äºå±æ€§ï¼Œæˆ‘ä»¬ç”¨volatileä¿®é¥°å±æ€§ï¼Œè¿™æ ·compilerså°±ä¸ä¼šå¯¹è¿™ä¸ªå±æ€§åšæŒ‡ä»¤é‡æ’åºã€‚</p></li><li><p>volatileæä¾›äº†å¯è§æ€§ï¼Œä»»ä½•ä¸€ä¸ªçº¿ç¨‹å¯¹å…¶çš„ä¿®æ”¹å°†ç«‹é©¬å¯¹å…¶ä»–çº¿ç¨‹å¯è§ï¼Œvolatileå±æ€§ä¸ä¼šè¢«çº¿ç¨‹ç¼“å­˜ï¼Œå§‹ç»ˆä»ä¸»å­˜ä¸­è¯»å–ã€‚</p></li><li><p>volatileæä¾›äº†happens-beforeä¿è¯ï¼Œå¯¹volatileå˜é‡vçš„å†™å…¥happens-beforeæ‰€æœ‰å…¶ä»–çº¿ç¨‹åç»­å¯¹vçš„è¯»æ“ä½œã€‚</p></li><li><p>volatileå¯ä»¥ä½¿å¾—longå’Œdoubleçš„èµ‹å€¼æ˜¯åŸå­çš„ã€‚</p></li><li><p>volatileå¯ä»¥åœ¨å•ä¾‹åŒé‡æ£€æŸ¥ä¸­å®ç°å¯è§æ€§å’Œç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œä»è€Œä¿è¯å®‰å…¨æ€§ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµ…è°ˆçº¢é»‘æ ‘</title>
      <link href="2020/11/05/%E6%B5%85%E8%B0%88%E7%BA%A2%E9%BB%91%E6%A0%91/"/>
      <url>2020/11/05/%E6%B5%85%E8%B0%88%E7%BA%A2%E9%BB%91%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ç½‘ä¸Šå¾ˆå¤šåšå®¢ä¸Šé¢çœ‹åˆ°æœ‰äº›è®²çº¢é»‘æ ‘çš„æ–‡ç« éƒ½ä¸èƒ½å®Œæ•´æè¿°å®ƒçš„ä½“ç³»ï¼Œå¯¹äºæ ‘çš„è°ƒå¹³æŸ“è‰²ä¹Ÿæ²¡æœ‰å¾ˆè¯¦ç»†çš„ä»‹ç»ï¼Œå› æ­¤è®©å¾ˆå¤šäººè§‰å¾—çº¢é»‘æ ‘å¾ˆéš¾ç†è§£ã€‚ä½†çº¢é»‘æ ‘çš„åº”ç”¨åœºæ™¯è¿˜æ˜¯å¾ˆå¸¸è§çš„ã€‚</p><p>JAVA8ä¸­HashMapçš„åº•å±‚å®ç°ï¼Œå°±ä¸ºäº†è§£å†³è¿‡åº¦å“ˆå¸Œå†²çªè€Œé€ æˆçš„é•¿é“¾è¡¨ï¼Œä»è€Œå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼›Linuxä¸­çš„CFSè¿›ç¨‹è°ƒåº¦ç®—æ³•ï¼Œvruntimeåˆ©ç”¨çº¢é»‘æ ‘æ¥å­˜å‚¨ï¼›å¤šè·¯å¤ç”¨EPollæ ¸å¿ƒç»“æ„ä¹Ÿæ˜¯é‡‡ç”¨çº¢é»‘æ ‘å’ŒåŒå‘é“¾è¡¨æ¥å­˜å‚¨ã€‚</p><p>äº†è§£çº¢é»‘æ ‘çš„ç»“æ„ï¼Œæœ‰åŠ©äºæˆ‘ä»¬å»ç†è§£ä¸€äº›åº•å±‚å®ç°ï¼Œå¹¶ä¸”çº¢é»‘æ ‘æœ¬èº«ä¹Ÿæ˜¯å¯¹æ ‘ç»“æ„çš„ä¸€ç§é«˜åº¦åº”ç”¨ã€‚åŒ…æ‹¬å¤šå‰æ ‘ã€æ ‘å¹³è¡¡è°ƒæ•´ã€æ ‘èŠ‚ç‚¹æ—‹è½¬ã€‚å…¶å®çº¢é»‘æ ‘çš„æœ¬è´¨å°±æ˜¯å¯¹2-3-4æ ‘çš„æ¦‚å¿µæ¨¡å‹ä¸€ç§å…·ä½“å®ç°ã€‚</p><h3 id="2-3-4æ ‘"><a href="#2-3-4æ ‘" class="headerlink" title="2-3-4æ ‘"></a>2-3-4æ ‘</h3><p>2-3-4æ ‘æ˜¯<code>é˜¶æ•°</code>ä¸º4çš„Bæ ‘ï¼ŒBæ ‘ï¼Œå…¨åBalanceTreeï¼Œå¹³è¡¡æ ‘ã€‚è¿™ç§ç»“æ„ä¸»è¦ç”¨æ¥åšæŸ¥æ‰¾ã€‚å®ƒæœ€é‡è¦çš„ç‰¹æ€§åœ¨äºå¹³è¡¡ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿåœ¨æœ€åæƒ…å†µä¸‹ä¹Ÿä¿æŒO(LogN)çš„æ—¶é—´å¤æ‚åº¦å®ç°æŸ¥æ‰¾ï¼ˆä¸€ä¸ªä¸å…·å¤‡å¹³è¡¡æ€§çš„æŸ¥æ‰¾æ ‘å¯èƒ½é€€åŒ–æˆå•é“¾è¡¨ï¼Œæ—¶é—´å¤æ‚åº¦ä¼šåˆ°Oï¼ˆNï¼‰ï¼‰ã€‚</p><blockquote><p>å¹³è¡¡çš„å®šä¹‰æ˜¯è¯´ä»ç©ºé“¾æ¥åˆ°æ ¹èŠ‚ç‚¹è·ç¦»ç›¸ç­‰ï¼Œæ­¤å¤„ä¸€å®šè¦ç”¨å¿ƒç†è§£ã€‚ï¼ˆä¹Ÿå°±æ˜¯è¯´éå¶å­èŠ‚ç‚¹æ˜¯ä¸ä¼šå­˜åœ¨ç©ºé“¾æ¥çš„ï¼‰</p></blockquote><p>å› ä¸º2-3-4æ˜¯ä¸€ä¸ª<code>é˜¶æ•°</code>ä¸º4çš„æ•°ï¼Œæ‰€ä»¥ä»–ä¼šå­˜åœ¨ä»¥ä¸‹å‡ ä¸ªèŠ‚ç‚¹ï¼š</p><ul><li>2ç»“ç‚¹ 2èŠ‚ç‚¹ä¸­å­˜æ”¾ç€ä¸€ä¸ªkey[X]ï¼Œä¸¤ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘å°äºXçš„å­èŠ‚ç‚¹å’Œå¤§äºXçš„å­èŠ‚ç‚¹ï¼›</li><li>3ç»“ç‚¹ 3èŠ‚ç‚¹ä¸­å­˜æ”¾åœ¨ä¸¤ä¸ªkey[X,Y],ä¸‰ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘å°äºXçš„å­èŠ‚ç‚¹ï¼Œä»‹äºX~Yä¹‹é—´çš„å­èŠ‚ç‚¹å’Œå¤§äºYçš„å­èŠ‚ç‚¹ï¼›</li><li>4ç»“ç‚¹ 4èŠ‚ç‚¹ä¸­å­˜æ”¾åœ¨ä¸¤ä¸ªkey[X,Y,Z],å››ä¸ªæŒ‡é’ˆï¼Œç†è®ºåŒä¸Š</li></ul><p><img src="49.png" alt="2-3-4æ•°å›¾è§£"></p><h3 id="çº¢é»‘æ ‘"><a href="#çº¢é»‘æ ‘" class="headerlink" title="çº¢é»‘æ ‘"></a>çº¢é»‘æ ‘</h3><p>çº¢é»‘æ ‘æ˜¯å¯¹æ¦‚å¿µæ¨¡å‹2-3-4æ ‘çš„ä¸€ç§å®ç°ï¼Œç”±äºç›´æ¥è¿›è¡Œä¸åŒèŠ‚ç‚¹é—´çš„è½¬åŒ–ä¼šé€ æˆè¾ƒå¤§çš„å¼€é”€ï¼Œæ‰€ä»¥é€‰æ‹©ä»¥äºŒå‰æ ‘ä¸ºåŸºç¡€ï¼Œåœ¨äºŒå‰æ ‘çš„å±æ€§ä¸­åŠ å…¥ä¸€ä¸ª<code>é¢œè‰²</code>å±æ€§æ¥è¡¨ç¤º2-3-4æ ‘ä¸­ä¸åŒçš„èŠ‚ç‚¹ã€‚<br>2-3-4æ ‘ä¸­çš„2èŠ‚ç‚¹å¯¹åº”ç€çº¢é»‘æ ‘ä¸­çš„<code>é»‘è‰²èŠ‚ç‚¹</code>ï¼Œè€Œ2-3-4æ ‘ä¸­çš„é2èŠ‚ç‚¹æ˜¯ä»¥<code>çº¢èŠ‚ç‚¹+é»‘èŠ‚ç‚¹</code>çš„æ–¹å¼å­˜åœ¨ï¼Œçº¢èŠ‚ç‚¹çš„æ„ä¹‰æ˜¯ä¸é»‘è‰²çˆ¶èŠ‚ç‚¹ç»“åˆï¼Œè¡¨è¾¾ç€2-3-4æ ‘ä¸­çš„3ï¼Œ4èŠ‚ç‚¹ã€‚</p><p>æˆ‘ä»¬å…ˆçœ‹2-3-4æ ‘åˆ°çº¢é»‘æ ‘çš„èŠ‚ç‚¹è½¬æ¢ã€‚2èŠ‚ç‚¹ç›´æ¥è½¬åŒ–ä¸ºé»‘è‰²èŠ‚ç‚¹ï¼›3èŠ‚ç‚¹è¿™é‡Œå¯ä»¥æœ‰ä¸¤ç§è¡¨ç°å½¢å¼ï¼Œå·¦å€¾çº¢èŠ‚ç‚¹æˆ–è€…å³å€¾çº¢èŠ‚ç‚¹ã€‚è€Œ4èŠ‚ç‚¹è¢«å¼ºåˆ¶è¦æ±‚è½¬åŒ–ä¸ºä¸€ä¸ªé»‘çˆ¶å¸¦ç€å·¦å³ä¸¤ä¸ªçº¢è‰²å„¿å­ã€‚</p><p><img src="50.png" alt="2-3-4æ ‘è½¬çº¢é»‘æ ‘"></p><p>æœ¬æ–‡ä¸»è¦é’ˆå¯¹2-3æ ‘çš„å·¦å€¾çº¢é»‘æ ‘è¿›è¡Œæ¢è®¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªæ ‘ä¸­å‡ºç°äº†<code>çº¢è‰²</code>ç»“ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªç»“ç‚¹ä¸€å®šæ˜¯<code>å·¦å„¿å­</code>ï¼Œè¿™ä¹Ÿæ˜¯<code>ç®—æ³•4</code>ä¸­ç»™å‡ºçš„çº¢é»‘æ ‘çš„å®ç°æ–¹å¼ã€‚</p><ul><li>è¿™ç§å®ç°æ–¹å¼ä¸ç”¨è€ƒè™‘2-3-4æ ‘ä¸­å¤æ‚çš„4èŠ‚ç‚¹åˆ†è£‚</li><li>è¿™ç§é™å®šèƒ½å¤Ÿå¾ˆå¤§çš„å‡å°‘çº¢é»‘æ ‘è°ƒæ•´è¿‡ç¨‹ä¸­çš„å¤æ‚æ€§</li></ul><p><img src="51.png" alt="2-3æ ‘è½¬çº¢é»‘æ ‘"></p><p>å¦‚æœè¯´è¿™æ ·è¿˜æ˜¯æ¯”è¾ƒæŠ½è±¡çš„è¯ï¼Œé‚£ä¸‹é¢è¿™ä¸ªå·¦å€¾çº¢é»‘æ ‘è½¬2-3æ ‘åº”è¯¥èƒ½å¤Ÿæ¸…æ™°çš„æç»˜ä»–ä»¬ä¹‹é—´çš„å…³ç³»äº†ã€‚</p><p><img src="52.png" alt="å·¦å€¾çº¢é»‘æ ‘è½¬2-3æ ‘"></p><p>åœ¨äº†è§£çº¢é»‘æ ‘çš„æ’å…¥åˆ é™¤æ“ä½œä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£2-3æ ‘çš„æ’å…¥åˆ é™¤æ“ä½œï¼Œæ‰èƒ½ç†è§£çº¢é»‘æ ‘ä¸­æŸ“è‰²å’Œæ—‹è½¬èƒŒåçš„æ„ä¹‰ã€‚æ’å…¥æ“ä½œéœ€è¦éµå¾ªä¸€ä¸ªåŸåˆ™ï¼š</p><blockquote><p>å…ˆå°†è¿™ä¸ªå…ƒç´ å°è¯•æ€§åœ°æ”¾åœ¨å·²ç»å­˜åœ¨çš„èŠ‚ç‚¹ä¸­ï¼Œå¦‚æœè¦å­˜æ”¾çš„èŠ‚ç‚¹æ˜¯2èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ’å…¥åä¼šå˜æˆ3èŠ‚ç‚¹ï¼Œå¦‚æœè¦å­˜æ”¾çš„èŠ‚ç‚¹æ˜¯3èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ’å…¥åä¼šå˜æˆ4èŠ‚ç‚¹ï¼ˆä¸´æ—¶ï¼‰ã€‚<br>ç„¶åå¯¹å¯èƒ½ç”Ÿæˆçš„ä¸´æ—¶4èŠ‚ç‚¹è¿›è¡Œåˆ†è£‚å¤„ç†ï¼Œä½¿å¾—ä¸´æ—¶4èŠ‚ç‚¹æ¶ˆå¤±ã€‚</p></blockquote><p><img src="53.jpg" alt="2-3-4æ ‘æ’å…¥(1)"><br><img src="54.jpg" alt="2-3-4æ ‘æ’å…¥(2)"></p><p>æ­£å¯¹åº”äº†çº¢é»‘æ ‘åœ¨æ’å…¥çš„æ—¶å€™ä¸€å®šä¼šæŠŠå¾…æ’å…¥èŠ‚ç‚¹æ¶‚æˆçº¢è‰²ï¼Œå› ä¸ºçº¢è‰²èŠ‚ç‚¹çš„æ„ä¹‰æ˜¯ä¸<code>çˆ¶èŠ‚ç‚¹</code>è¿›è¡Œå…³è”ï¼Œå½¢æˆæ¦‚å¿µæ¨¡å‹2-3æ ‘ä¸­çš„3èŠ‚ç‚¹æˆ–è€…ä¸´æ—¶4èŠ‚ç‚¹ã€‚</p><p>è€Œçº¢é»‘æ ‘ä¹‹æ‰€ä»¥éœ€è¦åœ¨æ’å…¥åè¿›è¡Œè°ƒæ•´ï¼Œæ­£æ˜¯å› ä¸ºå¯èƒ½å­˜åœ¨ç€æ¦‚å¿µæ¨¡å‹ä¸­çš„ä¸´æ—¶4èŠ‚ç‚¹ï¼ˆååº”åœ¨çº¢é»‘æ ‘ä¸­æ˜¯åŒçº¢çš„æƒ…å†µï¼‰ã€‚</p><p>è¯•æƒ³åœ¨2-3æ ‘ä¸­å¦‚æœå¾…æ’å…¥èŠ‚ç‚¹æ˜¯ä¸ª2èŠ‚ç‚¹ï¼Œé‚£ä¹ˆååº”åœ¨çº¢é»‘æ ‘ä¸­ï¼Œä¸æ­£å¥½å¯¹åº”ç€é»‘è‰²çˆ¶èŠ‚ç‚¹å—ï¼Œåœ¨é»‘è‰²çˆ¶èŠ‚ç‚¹ä¸‹é¢å¢åŠ ä¸€ä¸ªçº¢è‰²å„¿å­ï¼Œç¡®å®ä¸ä¼šè¿èƒŒçº¢é»‘æ ‘çš„ä»»ä½•è§„åˆ™ï¼Œè¿™ä¹Ÿå¯¹åº”ç€æˆ‘ä»¬å‘2-3æ ‘ä¸­çš„2èŠ‚ç‚¹æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œåªéœ€è¦ç®€å•çš„æŠŠ2èŠ‚ç‚¹å˜æˆ3èŠ‚ç‚¹ã€‚</p><p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¯¹äº2-3æ ‘çš„åˆ é™¤ã€‚å¯¹äº2-3æ ‘çš„åˆ é™¤æˆ‘ä»¬ä¸»è¦è¦è€ƒè™‘å¾…åˆ é™¤å…ƒç´ åœ¨2èŠ‚ç‚¹è¿™ç§æƒ…å†µï¼Œå› ä¸ºå¦‚æœå¾…åˆ é™¤å…ƒç´ åœ¨3èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥å°†è¿™ä¸ªå…ƒç´ åˆ é™¤ï¼Œè€Œä¸ä¼šç ´å2-3æ ‘çš„ä»»ä½•æ€§è´¨ï¼ˆåˆ é™¤è¿™ä¸ªå…ƒç´ ä¸ä¼šå¼•èµ·é«˜åº¦çš„å˜åŒ–ï¼‰ã€‚</p><p>å½“å¾…åˆ é™¤å…ƒç´ åœ¨2èŠ‚ç‚¹çš„æ—¶å€™ï¼Œç”±äºåˆ é™¤è¿™ä¸ªå…ƒç´ ä¼šå¯¼è‡´2èŠ‚ç‚¹å¤±å»è‡ªå·±å”¯ä¸€çš„å…ƒç´ ï¼Œå¼•å‘2èŠ‚ç‚¹è‡ªèº«çš„åˆ é™¤ï¼Œä¼šä½¿å¾—æ ‘ä¸­æŸæ¡è·¯å¾„çš„é«˜åº¦å‘ç”Ÿå˜åŒ–ï¼Œæ ‘å˜å¾—ä¸å¹³è¡¡ã€‚<br>å› æ­¤æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ¡ˆå»è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p><ul><li>å…ˆåˆ é™¤è¿™ä¸ª2èŠ‚ç‚¹ï¼Œç„¶åå¯¹æ ‘è¿›è¡Œå¹³è¡¡è°ƒæ•´ã€‚</li><li>æƒ³åŠæ³•è®©è¿™ä¸ªè¢«åˆ é™¤çš„å…ƒç´ ä¸å¯èƒ½å‡ºç°åœ¨2èŠ‚ç‚¹ä¸­ã€‚</li></ul><p>è¿™é‡Œé€‰æ‹©ç¬¬äºŒç§æ–¹æ¡ˆï¼Œæˆ‘ä»¬åœ¨æœç´¢åˆ°è¿™ä¸ªèŠ‚ç‚¹çš„è·¯å¾„ä¸­ï¼Œä¸æ–­åœ°åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦ä¸º2èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯ï¼Œå°±ä»å®ƒçš„å…„å¼ŸèŠ‚ç‚¹æˆ–è€…å®ƒçš„çˆ¶èŠ‚ç‚¹å€Ÿä¸€ä¸ªå…ƒç´ ï¼Œä½¿å¾—å½“å‰èŠ‚ç‚¹ç”±2èŠ‚ç‚¹æˆä¸ºä¸€ä¸ª3èŠ‚ç‚¹æˆ–è€…ä¸€ä¸ªä¸´æ—¶4èŠ‚ç‚¹ï¼ˆè§†å…·ä½“æƒ…å†µè€Œå®šï¼Œåœ¨åé¢çš„çº¢é»‘æ ‘éƒ¨åˆ†ä¼šè¯¦ç»†ä»‹ç»ï¼‰ã€‚</p><p>è¿™ç§æ“ä½œä¼šäº§ç”Ÿä¸€ç§ç»“æœï¼šé™¤éå½“å‰èŠ‚ç‚¹æ˜¯æ ¹èŠ‚ç‚¹ï¼Œå¦åˆ™å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸€å®šæ˜¯ä¸€ä¸ªé2èŠ‚ç‚¹ï¼ˆå› ä¸ºæœç´¢çš„è·¯å¾„æ˜¯è‡ªä¸Šè€Œä¸‹ï¼Œçˆ¶èŠ‚ç‚¹å·²ç»è¿›è¡Œè¿‡äº†è¿™ç§æ“ä½œï¼Œæ‰€ä»¥ä¸å¯èƒ½æ˜¯2èŠ‚ç‚¹ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä¿è¯åˆ°è¾¾å¶å­èŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¹Ÿèƒ½é¡ºåˆ©çš„ä»çˆ¶èŠ‚ç‚¹æˆ–è€…å…„å¼ŸèŠ‚ç‚¹å¤„å€Ÿåˆ°å…ƒç´ ï¼Œä½¿å¾—è‡ªå·±æˆä¸ºé2èŠ‚ç‚¹ã€‚ä»è€Œèƒ½å¤Ÿç›´æ¥åˆ é™¤æŸä¸ªå…ƒç´ ï¼ˆç°åœ¨è¿™ä¸ªå…ƒç´ ä¸åœ¨2èŠ‚ç‚¹ä¸­äº†ï¼‰ã€‚</p><p><img src="55.jpg" alt="2-3æ ‘çš„åˆ é™¤"></p><h3 id="å†å“çº¢é»‘æ ‘"><a href="#å†å“çº¢é»‘æ ‘" class="headerlink" title="å†å“çº¢é»‘æ ‘"></a>å†å“çº¢é»‘æ ‘</h3><p><img src="56.png" alt="çº¢é»‘æ ‘ä¸­çš„çº¢é»‘ç»“ç‚¹"></p><p>æ¥å“ä¸€ä¸‹çº¢é»‘æ ‘çš„5æ¡å®šä¹‰</p><ul><li><p>çº¢é»‘æ ‘ç»“ç‚¹é¢œè‰²çš„æœ‰é»‘è‰²å’Œçº¢è‰²</p><blockquote><p>2-3æ ‘åˆ°çº¢é»‘æ ‘çš„è½¬åŒ–å·²ç»è¯¦ç»†è¯´æ˜</p></blockquote></li><li><p>æ ¹ç»“ç‚¹ä¸€å®šæ˜¯é»‘è‰²</p><blockquote><p>2-3æ ‘ä¸­å¦‚æœæ ¹èŠ‚ç‚¹ä¸º2èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå®ƒæœ¬æ¥å°±å¯¹åº”çº¢é»‘æ ‘ä¸­é»‘èŠ‚ç‚¹ï¼›å¦‚æœæ ¹èŠ‚ç‚¹ä¸º3èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥ç”¨é»‘è‰²èŠ‚ç‚¹è¡¨ç¤ºè¾ƒå¤§çš„é‚£ä¸ªå…ƒç´ ï¼Œç„¶åè¾ƒå°çš„å…ƒç´ ä½œä¸ºå·¦å€¾çº¢èŠ‚ç‚¹å­˜åœ¨äºçº¢é»‘æ ‘ä¸­</p></blockquote></li><li><p>æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²</p><blockquote><p>è¿™é‡Œçš„å¶å­å…¶å®æ˜¯ç©ºé“¾æ¥</p></blockquote></li><li><p>ä»»æ„èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹ç»è¿‡çš„é»‘è‰²èŠ‚ç‚¹æ•°ç›®ç›¸åŒ</p><blockquote><p>çº¢é»‘æ ‘ä¸­çš„çº¢èŠ‚ç‚¹æ˜¯å’Œé»‘è‰²çˆ¶èŠ‚ç‚¹ç»‘å®šçš„ï¼Œåœ¨2-3æ ‘ä¸­æœ¬æ¥å°±æ˜¯åŒä¸€å±‚çš„ï¼Œåªæœ‰é»‘è‰²èŠ‚ç‚¹æ‰ä¼šåœ¨2-3æ ‘ä¸­çœŸæ­£è´¡çŒ®é«˜åº¦ï¼Œç”±äº2-3æ ‘çš„ä»»ä¸€èŠ‚ç‚¹åˆ°ç©ºé“¾æ¥è·ç¦»ç›¸åŒï¼Œå› æ­¤ååº”åœ¨çº¢é»‘æ ‘ä¸­å°±æ˜¯<code>é»‘è‰²å®Œç¾å¹³è¡¡</code></p></blockquote></li><li><p>ä¸ä¼šæœ‰è¿ç»­çš„çº¢è‰²èŠ‚ç‚¹</p><blockquote><p>2-3æ ‘ä¸­æœ¬æ¥å°±è§„å®šæ²¡æœ‰4èŠ‚ç‚¹ï¼Œ2-3-4æ ‘ä¸­è™½ç„¶æœ‰4èŠ‚ç‚¹ï¼Œä½†æ˜¯è¦æ±‚åœ¨çº¢é»‘æ ‘ä¸­ä½“ç°ä¸ºä¸€é»‘è‰²èŠ‚ç‚¹å¸¦ä¸¤çº¢è‰²å„¿å­ï¼Œåˆ†å¸ƒå·¦å³ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šæœ‰è¿ç»­çº¢èŠ‚ç‚¹</p></blockquote></li></ul><hr><blockquote><p>ç°åœ¨å°±èƒ½çœ‹çš„å‡ºæ¥çº¢é»‘æ ‘çš„å®šä¹‰èƒŒåæ­£æµ®ç°ç€ä¸€é¢—2-3æ ‘æ¦‚å¿µæ¨¡å‹ã€‚è™½ç„¶æˆ‘ä»¬å·²ç»æœ‰äº†è¿™æ ·çš„è®¤è¯†ï¼Œä½†æ˜¯çº¢é»‘æ ‘ä½œä¸ºçœŸæ­£çš„å®ç°æ¨¡å‹ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦å›åˆ°è¿™ä¸ªå®ç°æœ¬èº«æ¥æ¢ç©¶å®ƒçš„ä¸€ç³»åˆ—æ“ä½œ</p></blockquote><h4 id="ä½œä¸ºäºŒå‰æŸ¥æ‰¾æ ‘"><a href="#ä½œä¸ºäºŒå‰æŸ¥æ‰¾æ ‘" class="headerlink" title="ä½œä¸ºäºŒå‰æŸ¥æ‰¾æ ‘"></a>ä½œä¸ºäºŒå‰æŸ¥æ‰¾æ ‘</h4><p>äºŒå‰æŸ¥æ‰¾æ ‘çš„èŠ‚ç‚¹æœ‰ä¸€ä¸ªå…ƒç´ Xå’Œä¸¤ä¸ªæŒ‡é’ˆåŸŸï¼Œå·¦æŒ‡é’ˆæŒ‡å‘å°äºXçš„å…ƒç´ ï¼Œå³æŒ‡é’ˆæŒ‡å‘å¤§äºXçš„å…ƒç´ ã€‚</p><p>å‡è®¾æˆ‘ä»¬çš„æ’å…¥åºåˆ—æ˜¯1~10ï¼Œé‚£ä¹ˆè¿™é¢—æ ‘ä¼šæ¼”å˜æˆåªæœ‰å³é“¾æ¥çš„å½¢å¼ï¼Œæ ‘é«˜ä¼šå¢åŠ åˆ°10å±‚ï¼Œè¿™ä¸ªæ—¶å€™å·²ç»ä¸å…·å¤‡O(LogN)çš„æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦ï¼Œå› ä¸ºè¿™é¢—æ ‘é€€åŒ–æˆäº†é“¾è¡¨ã€‚</p><p>å› æ­¤å¯¹äºŒå‰æ ‘è¿›è¡Œå¹³è¡¡è°ƒæ•´æ˜¯å¾ˆé‡è¦çš„ä¸€ä¸ªç¯èŠ‚ï¼Œæ— è®ºæ˜¯AVLè¿˜æ˜¯çº¢é»‘æ ‘ï¼Œå®ƒä»¬æœ¬è´¨ä¸Šéƒ½æ˜¯å¸Œæœ›å°½å¯èƒ½ä¿è¯è¿™é¢—äºŒå‰æŸ¥æ‰¾æ ‘ä¸­çš„å…ƒç´ å°½é‡å‡è¡¡çš„åˆ†å¸ƒåœ¨æ ‘çš„ä¸¤ä¾§ã€‚</p><p>å½“æˆ‘ä»¬å‘ä¸€é¢—äºŒå‰æŸ¥æ‰¾æ ‘ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ Yçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šä¸€ç›´ä¸æ ‘ä¸­çš„èŠ‚ç‚¹è¿›è¡Œå¤§å°æ¯”è¾ƒï¼Œå¦‚æœYå°äºå½“å‰å…ƒç´ ï¼Œå°±å¾€å·¦èµ°ï¼Œå¦‚æœYå¤§äºå½“å‰å…ƒç´ ï¼Œå°±å¾€å³èµ°ï¼Œç›´åˆ°è¾¾åˆ°å¶å­èŠ‚ç‚¹ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥æŠŠYæ’å…¥è¿™é¢—äºŒå‰æŸ¥æ‰¾æ ‘äº†ã€‚</p><p>ç”±äºè¿™æ¬¡çš„æ’å…¥åŠ¨ä½œï¼Œæ•´æ£µæ ‘å¯èƒ½ä¼šå‘ç”Ÿä¸€äº›ä¸å¹³è¡¡ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨æ’å…¥åè¿›è¡Œä¸€æ¬¡å¹³è¡¡è°ƒæ•´ï¼Œä½¿å¾—æ•´æ£µæ ‘æ¢å¤åˆ°å¹³è¡¡çš„çŠ¶æ€ï¼ˆå…·ä½“å¦‚ä½•è°ƒæ•´ï¼Œè¦çœ‹æ ‘æ˜¯AVLè¿˜æ˜¯çº¢é»‘æ ‘äº¦æˆ–æ˜¯å…¶ä»–çš„å¹³è¡¡æ ‘ï¼‰ã€‚</p><p>äºŒå‰æŸ¥æ‰¾æ ‘çš„åˆ é™¤æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„é—®é¢˜ï¼Œä¸åŒäºæ’å…¥çš„æ˜¯ï¼Œå¾…åˆ é™¤çš„å…ƒç´ å¹¶ä¸èƒ½ä¿è¯ä¸€å®šå‡ºç°åœ¨æ ‘ä¸­çš„å¶å­èŠ‚ç‚¹ã€‚è¿™å°†å¸¦æ¥ä¸€ä¸ªæ£˜æ‰‹çš„æƒ…æ™¯ï¼Œå³æˆ‘ä»¬éœ€è¦ä»æ ‘çš„ä¸­é—´éƒ¨åˆ†å–èµ°ä¸€ä¸ªå…ƒç´ ï¼Œè€Œä¸”åœ¨å–èµ°åè¿˜éœ€è¦ç»è¿‡è°ƒæ•´æ¥ä½¿å¾—æ•´é¢—æ ‘æ»¡è¶³å¹³è¡¡çš„æ€§è´¨ã€‚ä»æ ‘çš„ä¸­é—´éƒ¨åˆ†ç›´æ¥å–èµ°ä¸€ä¸ªèŠ‚ç‚¹çš„åœºæ™¯å®åœ¨æ˜¯å¤ªå¤šï¼Œä¹Ÿç‰µæ‰¯åˆ°äº†å¤ªå¤šç›¸å…³çš„èŠ‚ç‚¹ï¼Œè¿™ç§æ“ä½œå¾ˆéš¾å®ç°ã€‚</p><p>å¥½åœ¨æœ‰äººæå‡ºäº†ä¸€ä¸ªè§‚ç‚¹ï¼Œæˆ‘ä»¬å¯¹æŸ¥æ‰¾æ ‘ä¸­ä¸€ä¸ªèŠ‚ç‚¹çš„åˆ é™¤ï¼Œå…¶å®å¯ä»¥ä¸å¿…çœŸçš„æ”¹åŠ¨è¿™ä¸ªèŠ‚ç‚¹çš„ä½ç½®ã€‚ç”±äºæŸ¥æ‰¾æ ‘çš„ç‰¹æ®Šæ€§è´¨ï¼Œå°†æŸä¸ªå…ƒç´ èŠ‚ç‚¹åˆ é™¤åï¼Œå®ƒæœ‰ä¸¤ä¸ªæœ€ä½³æ›¿ä»£è€…ï¼Œåˆ†åˆ«æ˜¯æœ‰åºåºåˆ—ä¸­çš„å‰é©±å…ƒç´ å’Œåç»§å…ƒç´ ã€‚</p><p>æˆ‘ä»¬è¿˜æ˜¯ä»¥ä¸€ä¸ªåŒ…å«å…ƒç´ 1~10çš„äºŒå‰æŸ¥æ‰¾æ ‘ä¸ºä¾‹ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›åˆ é™¤5æ‰€åœ¨çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè®©4æˆ–è€…6æ›¿ä»£å®ƒçš„ä½ç½®éƒ½æ˜¯å¯è¡Œçš„ã€‚ä½œä¸ºå‰é©±å…ƒç´ çš„4ï¼Œä¼šå­˜æ”¾åœ¨5æ‰€åœ¨èŠ‚ç‚¹çš„å·¦å­æ ‘çš„æœ€å³ä¾§ï¼›ä½œä¸ºåç»§å…ƒç´ çš„6ï¼Œä¼šå­˜æ”¾åœ¨5æ‰€åœ¨èŠ‚ç‚¹çš„å³å­æ ‘çš„æœ€å·¦ä¾§ã€‚</p><p>å…³äºè¿™ä¸ªç»“è®ºï¼Œå¤§å®¶åªéœ€ç¨åŠ æ€ç´¢ä¾¿å¯ä»¥æ˜ç™½ã€‚</p><p>ç°åœ¨æˆ‘ä»¬åˆè®©é—®é¢˜ç®€åŒ–äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ é™¤æŸä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å…ˆæ‰¾åˆ°å®ƒçš„å‰é©±å…ƒç´ æˆ–è€…åç»§å…ƒç´ ï¼ˆéšä¾¿é€‰ä¸€ä¸ªï¼‰ï¼Œå°†å®ƒçš„å‰é©±å…ƒç´ ç›´æ¥å¡«åˆ°å¾…åˆ é™¤çš„èŠ‚ç‚¹ï¼Œç„¶åå†æŠŠå®ƒçš„å‰é©±å…ƒç´ æˆ–è€…åç»§å…ƒç´ åˆ é™¤ã€‚</p><p>è¿™ä¸ªæ—¶å€™é—®é¢˜å°±è½¬åŒ–æˆäº†åœ¨äºŒå‰æŸ¥æ‰¾æ ‘ä¸­åˆ é™¤ä¸€ä¸ªæ²¡æœ‰å·¦å­æ ‘çš„èŠ‚ç‚¹ï¼ˆæˆ–è€…æ˜¯ä¸€ä¸ªæ²¡æœ‰å³å­æ ‘çš„èŠ‚ç‚¹ï¼‰ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¿™ä¸ªèŠ‚ç‚¹åˆ é™¤å†è¿›è¡Œå¯¹åº”çš„å¹³è¡¡è°ƒæ•´å³å¯ï¼ˆè™½ç„¶è¿˜æ˜¯éœ€è¦è°ƒå¹³ï¼Œä½†æ˜¯æ¯”ç›´æ¥åœ¨æ ‘ä¸­å±‚åˆ é™¤ä¸€ä¸ªåŒæ—¶å…·å¤‡å·¦å³å„¿å­çš„èŠ‚ç‚¹è¦å®¹æ˜“å¾ˆå¤šï¼‰ã€‚</p><p>æ³¨æ„ï¼Œæ­¤å¤„å¹¶æ²¡æœ‰å¼ºè°ƒæ˜¯é’ˆå¯¹çº¢é»‘æ ‘çš„æ“ä½œï¼Œå› ä¸ºçº¢é»‘æ ‘å’ŒAVLéƒ½æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå®ƒä»¬éƒ½é€‚ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><h4 id="æ ‘çš„æ—‹è½¬"><a href="#æ ‘çš„æ—‹è½¬" class="headerlink" title="æ ‘çš„æ—‹è½¬"></a>æ ‘çš„æ—‹è½¬</h4><p>ä¸ºäº†è°ƒå¹³ä¸€é¢—äºŒå‰æ ‘ï¼Œä½¿å¾—å…¶å·¦å³èŠ‚ç‚¹æ•°ç›®åˆ†å¸ƒå‡åŒ€ï¼Œé€šå¸¸ä¼šé€‰æ‹©æ—‹è½¬çš„æ‰‹æ®µã€‚ä½ å¯ä»¥æŠŠä¸€é¢—äºŒå‰æ ‘æŸèŠ‚ç‚¹çš„å·¦å³å­æ ‘æƒ³è±¡æˆå¤©å¹³ä¸Šå¾…ç§°é‡çš„ç‰©å“ï¼Œå¦‚æœå“ªè¾¹é‡äº†ï¼Œæˆ‘ä»¬å°±ä»é‡çš„é‚£è¾¹æ‹¿å‡ºä¸€éƒ¨åˆ†ï¼ŒåŠ åˆ°è½»çš„é‚£è¾¹ï¼Œä»¥æ­¤ä¿æŒç›¸å¯¹çš„å¹³å‡ã€‚</p><p>ä»¥Xä¸ºæ—‹è½¬ç‚¹çš„å·¦æ—‹</p><p><img src="58.png" alt="å·¦æ—‹è°ƒå¹³"></p><p>ä»¥Xä¸ºæ—‹è½¬ç‚¹çš„å³æ—‹</p><p><img src="59.png" alt="å³æ—‹è°ƒå¹³"></p><p>ç†è§£äº†è¿™äº›ä¹‹åï¼Œå†å»çœ‹çº¢é»‘æ ‘çš„æ’å…¥åˆ é™¤ï¼Œå°±èƒ½å¤Ÿç†è§£æ—‹è½¬å’ŒæŸ“è‰²èƒŒåçš„æ„ä¹‰äº†ã€‚æˆ‘ä»¬ä»ç„¶é€‰æ‹©ç®—æ³•4ä¸­çš„å·¦å€¾çº¢é»‘æ ‘ä½œæ¼”ç¤ºï¼šé¦–å…ˆçœ‹<code>æ’å…¥</code></p><h4 id="å·¦å€¾çº¢é»‘æ ‘çš„æ’å…¥"><a href="#å·¦å€¾çº¢é»‘æ ‘çš„æ’å…¥" class="headerlink" title="å·¦å€¾çº¢é»‘æ ‘çš„æ’å…¥"></a>å·¦å€¾çº¢é»‘æ ‘çš„æ’å…¥</h4><p><img src="60.png" alt="çº¢é»‘æ ‘åŸºæ ‘"></p><p>å¯¹äºä¸Šè¿°å·¦å€¾çº¢é»‘æ ‘çš„æ’å…¥ä¸€å…±æœ‰ä¸‰ç§å¯èƒ½çš„æƒ…å†µï¼š</p><ul><li>å¾…æ’å…¥å…ƒç´ æ¯”é»‘çˆ¶å¤§ï¼Œæ’åœ¨äº†é»‘çˆ¶çš„å³è¾¹ï¼Œè€Œé»‘çˆ¶å·¦è¾¹æ˜¯çº¢è‰²å„¿å­ã€‚è¿™ç§æƒ…å†µä¼šå¯¼è‡´åœ¨çº¢é»‘æ ‘ä¸­å‡ºç°å³å€¾çº¢èŠ‚ç‚¹ã€‚</li></ul><p>è¿™ç§æƒ…å†µå¯¹åº”ç€2-3æ ‘ä¸­å‡ºç°äº†ä¸´æ—¶4èŠ‚ç‚¹ï¼Œæˆ‘ä»¬åœ¨2-3æ ‘ä¸­çš„å¤„ç†æ˜¯å°†è¿™ä¸ªä¸´æ—¶4èŠ‚ç‚¹åˆ†è£‚ï¼Œå·¦å³å…ƒç´ å„è‡ªå½¢æˆä¸€ä¸ª2èŠ‚ç‚¹ï¼Œä¸­é—´å…ƒç´ ä¸Šå‡åˆ°ä¸Šå±‚è·Ÿçˆ¶èŠ‚ç‚¹ç»“åˆã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨çº¢é»‘æ ‘ä¸­çš„åŠ¨ä½œæ˜¯ï¼Œå°†åŸæœ¬çº¢è‰²çš„å·¦å³å„¿å­æŸ“é»‘ï¼ˆå·¦å³åˆ†è£‚ï¼‰ï¼Œå°†é»‘çˆ¶æŸ“çº¢ï¼ˆç­‰å¾…ä¸Šå‡ç»“åˆï¼‰ã€‚</p><p><img src="61.png" alt="çº¢é»‘æ ‘åŸºäºé»‘å”æ’å…¥å›¾1"></p><ul><li>å¾…æ’å…¥å…ƒç´ æ¯”çº¢çˆ¶å°ï¼Œä¸”çº¢çˆ¶è‡ªèº«å°±æ˜¯å·¦å€¾ã€‚å¬èµ·æ¥æœ‰ç‚¹ç»•ï¼Œçœ‹å›¾å°±ä¼šæ˜ç™½ï¼Œå…¶å®å°±æ˜¯è¯´çº¢çˆ¶å’Œå¾…æ’å…¥å…ƒç´ åŒæ—¶é åœ¨äº†å·¦è¾¹ï¼Œå½¢æˆäº†è¿ç»­çš„çº¢èŠ‚ç‚¹ã€‚</li></ul><p>è¿™ç§æƒ…å†µæˆ‘ä»¬éœ€è¦ç”¨ä¸¤æ­¥æ¥è°ƒæ•´ã€‚ç”±äºæˆ‘ä»¬æ’å…¥çš„æ˜¯çº¢è‰²èŠ‚ç‚¹ï¼Œå…¶å®ä¸ä¼šç ´åé»‘è‰²å®Œç¾å¹³è¡¡ï¼Œæ‰€ä»¥è¦æ³¨æ„çš„æ˜¯åœ¨æ—‹è½¬å’ŒæŸ“è‰²çš„è¿‡ç¨‹ç§ç»§ç»­ä¿æŒè¿™ç§å®Œç¾é»‘è‰²å¹³è¡¡ã€‚<br>é¦–å…ˆå¯¹çº¢çˆ¶çš„çˆ¶äº²è¿›è¡Œä¸€æ¬¡å³æ—‹ï¼Œè¿™æ¬¡å³æ—‹ä¸ä¼šç ´åé»‘è‰²å¹³è¡¡ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰è§£å†³è¿ç»­çº¢è‰²çš„é—®é¢˜ã€‚<br>æ¥ä¸‹æ¥å°†12æ‰€åœ¨èŠ‚ç‚¹ä¸15æ‰€åœ¨èŠ‚ç‚¹äº¤æ¢é¢œè‰²ï¼Œè¿™æ ·çš„ç›®çš„æ˜¯ä¸ºäº†æ¶ˆé™¤è¿ç»­çº¢è‰²ï¼Œå¹¶ä¸”è¿™ä¸ªæ“ä½œä¾æ—§ç»´æŒäº†é»‘è‰²å¹³è¡¡ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»å¾—åˆ°äº†æƒ…å†µ1çš„åœºæ™¯ï¼Œç›´æ¥æŒ‰æƒ…å†µ1å¤„ç†å³å¯ã€‚</p><p><img src="62.png" alt="çº¢é»‘æ ‘åŸºäºé»‘å”æ’å…¥å›¾2"></p><ul><li>å¾…æ’å…¥å…ƒç´ æ¯”çº¢çˆ¶å¤§ï¼Œä¸”çº¢çˆ¶è‡ªèº«å°±æ˜¯å·¦å€¾ã€‚</li></ul><p>ä¹Ÿå°±æ˜¯è¯´æ’å…¥çš„è¿™ä¸ªèŠ‚ç‚¹å½¢æˆäº†ä¸€ä¸ªå³å€¾çš„çº¢è‰²èŠ‚ç‚¹ï¼Œå¯¹å³å€¾çš„å¤„ç†å¾ˆç®€å•ï¼Œå°†çº¢çˆ¶è¿›è¡Œä¸€æ¬¡å·¦æ—‹ï¼Œå°±èƒ½ä½¿å¾—å³å€¾çº¢èŠ‚ç‚¹å˜ä¸ºå·¦å€¾ï¼Œç°åœ¨å‡ºç°äº†è¿ç»­çš„å·¦å€¾çº¢èŠ‚ç‚¹ï¼Œç›´æ¥æŒ‰æƒ…å†µ2å¤„ç†å³å¯ã€‚</p><p><img src="63.png" alt="çº¢é»‘æ ‘åŸºäºé»‘å”æ’å…¥å›¾3"></p><p>åœ¨æ’å…¥æ—¶ï¼Œå¯ä»¥ä½“ä¼šåˆ°å·¦å€¾çº¢é»‘æ ‘å¯¹äºå·¦å€¾çš„é™åˆ¶å¸¦æ¥çš„å¥½å¤„ï¼Œå› ä¸ºåœ¨åŸæ ‘ç¬¦åˆçº¢é»‘æ ‘å®šä¹‰çš„æƒ…å†µä¸‹ï¼Œå¦‚æœçˆ¶äº²æ˜¯çº¢çš„ï¼Œé‚£ä¹ˆå®ƒä¸€å®šå·¦å€¾ï¼ŒåŒæ—¶ä¹Ÿä¸ç”¨è€ƒè™‘å¯èƒ½å­˜åœ¨çš„å³å€¾å…„å¼Ÿï¼ˆå¦‚æœæœ‰ï¼Œé‚£è¯´æ˜åŸæ ‘ä¸æ»¡è¶³çº¢é»‘æ ‘å®šä¹‰ï¼‰ã€‚</p><p>è¿™ç§é™åˆ¶æ¶ˆé™¤äº†å¾ˆå¤šéœ€è¦è€ƒè™‘çš„åœºæ™¯ï¼Œè®©æ’å…¥å˜å¾—æ›´åŠ ç®€å•ã€‚</p><h4 id="å·¦å€¾çº¢é»‘æ ‘çš„åˆ é™¤"><a href="#å·¦å€¾çº¢é»‘æ ‘çš„åˆ é™¤" class="headerlink" title="å·¦å€¾çº¢é»‘æ ‘çš„åˆ é™¤"></a>å·¦å€¾çº¢é»‘æ ‘çš„åˆ é™¤</h4><p>å·¦å€¾çº¢é»‘æ ‘çš„åˆ é™¤éœ€è¦å€Ÿé‰´ä¹‹å‰æåˆ°çš„<code>äºŒå‰æŸ¥æ‰¾æ ‘é€šç”¨çš„åˆ é™¤</code>ç­–ç•¥ï¼Œå½“æˆ‘ä»¬è¦åˆ é™¤æŸä¸ªèŠ‚ç‚¹çš„æ—¶å€™é€‰æ‹©å®ƒçš„å‰é©±èŠ‚ç‚¹æˆ–è€…åç»§èŠ‚ç‚¹å…ƒç´ æ¥æ›¿ä»£å®ƒï¼Œè½¬è€Œåˆ é™¤å®ƒçš„å‰é©±/åç»§èŠ‚ç‚¹ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ç”¨<code>åç»§èŠ‚ç‚¹</code>æ¥æ›¿ä»£è¢«åˆ é™¤èŠ‚ç‚¹ã€‚</p><p>å‡è®¾æˆ‘ä»¬éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹å®ƒçš„å³å­æ ‘å¦‚å›¾æ‰€ç¤ºï¼Œé‚£ä¹ˆå¯¹è¯¥èŠ‚ç‚¹çš„åˆ é™¤å®é™…ä¸Šè½¬ä¸ºäº†å¯¹2çš„åˆ é™¤ã€‚</p><p>æˆ‘ä»¬ä»å½“å‰çš„æ ¹èŠ‚ç‚¹å‡ºå‘ï¼Œåˆ©äº2-3æ ‘ä¸­é¢„åˆå¹¶çš„ç­–ç•¥é€å±‚å¯¹çº¢é»‘æ ‘è¿›è¡Œè°ƒæ•´ã€‚å…·ä½“çš„åšæ³•æ˜¯ï¼Œæ¯æ¬¡éƒ½ä¿è¯å½“å‰çš„èŠ‚ç‚¹æ˜¯2-3æ ‘ä¸­çš„é2èŠ‚ç‚¹ï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹å·²ç»æ˜¯é2èŠ‚ç‚¹ï¼Œé‚£ä¹ˆç›´æ¥è·³è¿‡ï¼›å¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯2èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ ¹æ®å…„å¼ŸèŠ‚ç‚¹çš„çŠ¶å†µæ¥è¿›è¡Œè°ƒæ•´ï¼š</p><ul><li><p>å¦‚æœå…„å¼Ÿæ˜¯2èŠ‚ç‚¹ï¼Œé‚£ä¹ˆä»çˆ¶èŠ‚ç‚¹å€Ÿä¸€ä¸ªå…ƒç´ ç»™å½“å‰èŠ‚ç‚¹ï¼Œç„¶åä¸å…„å¼ŸèŠ‚ç‚¹ä¸€èµ·å½¢æˆä¸€ä¸ªä¸´æ—¶4èŠ‚ç‚¹ã€‚</p></li><li><p>å¦‚æœå…„å¼Ÿæ˜¯é2èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå…„å¼Ÿä¸Šå‡ä¸€ä¸ªå…ƒç´ åˆ°çˆ¶èŠ‚ç‚¹ï¼ŒåŒæ—¶çˆ¶èŠ‚ç‚¹ä¸‹é™ä¸€ä¸ªå…ƒç´ åˆ°å½“å‰èŠ‚ç‚¹ï¼Œä½¿å¾—å½“å‰èŠ‚ç‚¹æˆä¸ºä¸€ä¸ª3èŠ‚ç‚¹ã€‚</p></li></ul><p>è¿™æ ·çš„ç­–ç•¥èƒ½å¤Ÿä¿è¯æœ€åèµ°åˆ°å¾…åˆ é™¤èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå®ƒä¸€å®šæ˜¯ä¸€ä¸ªé2èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†å…¶å…ƒç´ åˆ é™¤ã€‚</p><p><img src="64.png" alt="å·¦å€¾çº¢é»‘æ ‘çš„åˆ é™¤"></p><p>æ¥ä¸‹æ¥è¦è€ƒè™‘çš„æ˜¯ä¿®å¤å·¥ä½œï¼Œç”±äºçº¢é»‘æ ‘å®šä¹‰çš„é™åˆ¶ï¼Œæˆ‘ä»¬åœ¨è°ƒæ•´çš„è¿‡ç¨‹ä¸­å‡ºç°äº†ä¸€äº›æœ¬ä¸è¯¥å­˜åœ¨çš„<code>çº¢è‰²å³å€¾èŠ‚ç‚¹</code>ï¼ˆå› ä¸ºç”Ÿæˆäº†æ¦‚å¿µæ¨¡å‹ä¸­çš„ä¸´æ—¶4èŠ‚ç‚¹ï¼‰ï¼Œäºæ˜¯æˆ‘ä»¬é¡ºç€æœç´¢çš„æ–¹å‘å‘ä¸Š<code>å›æº¯</code>ï¼Œå¦‚æœé‡åˆ°å½“å‰èŠ‚ç‚¹å…·å¤‡å³å€¾çš„çº¢è‰²å„¿å­ï¼Œé‚£ä¹ˆå¯¹å½“å‰èŠ‚ç‚¹è¿›è¡Œä¸€æ¬¡å·¦æ—‹ï¼Œè¿™æ—¶åŸæœ¬çš„å³å„¿å­ä¼šæ¥åˆ°å½“å‰èŠ‚ç‚¹çš„ä½ç½®ï¼Œç„¶åå°†å³å„¿å­ä¸å½“å‰èŠ‚ç‚¹äº¤æ¢é¢œè‰²ï¼Œæˆ‘ä»¬å°±å°†å³å€¾çº¢èŠ‚ç‚¹ä¿®å¤æˆäº†å·¦å€¾çº¢èŠ‚ç‚¹ï¼ŒåŒæ—¶æˆ‘ä»¬å¹¶æ²¡æœ‰ç ´åé»‘è‰²èŠ‚ç‚¹çš„å¹³è¡¡ã€‚</p><p><img src="65.png" alt="å·¦å€¾çº¢é»‘æ ‘ä¿®å¤"></p><h3 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h3><ul><li>ä½ çŸ¥é“äº†çº¢é»‘æ ‘çš„äº”æ¡å®šä¹‰ï¼Œå¦‚æœæˆ‘æ„é€ ä¸€é¢—åªæœ‰é»‘è‰²èŠ‚ç‚¹çš„çº¢é»‘æ ‘ï¼Œè¿™æ ·å­å¯è¡Œå—ï¼Ÿå› ä¸ºè¿™æ ·å­æ²¡æœ‰ç ´åä»»ä½•ä¸€æ¡çº¢é»‘æ ‘çš„è§„åˆ™ã€‚</li><li>é‚£ä¹ˆè¯·é—®çº¢é»‘æ ‘ä¸­è¦çº¢èŠ‚ç‚¹å¹²ä»€ä¹ˆå‘¢ï¼Ÿçº¢èŠ‚ç‚¹çš„çœŸå®æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> çº¢é»‘æ ‘ </tag>
            
            <tag> HashMap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°ä¸€ä¸‹æœ€è¿‘åˆ·é¢˜çš„ä¸€äº›å°æƒ³æ³•</title>
      <link href="2020/10/30/%E4%B8%80%E9%81%93%E7%AE%97%E6%B3%95%E9%A2%98%E5%BC%95%E5%8F%91%E7%9A%84%E6%83%AF%E6%80%A7%E6%80%9D%E7%BB%B4/"/>
      <url>2020/10/30/%E4%B8%80%E9%81%93%E7%AE%97%E6%B3%95%E9%A2%98%E5%BC%95%E5%8F%91%E7%9A%84%E6%83%AF%E6%80%A7%E6%80%9D%E7%BB%B4/</url>
      
        <content type="html"><![CDATA[<p>äº‹æƒ…çš„èµ·å› è¿˜æ˜¯è¦ä»æˆ‘æ˜¨å¤©ä¸Šç­èµšï¼ˆmoï¼‰é’±ï¼ˆyuï¼‰å¼€å§‹è¯´èµ·ï¼Œæœ€è¿‘é¡¹ç›®æ¯”è¾ƒé—²ï¼Œäºæ˜¯æˆ‘åœ¨intelijä¸Šé¢è£…äº†ä¸€ä¸ªleetcodeæ’ä»¶ï¼Œæ¯å¤©æ—¥å¸¸åˆ·ä¸€åˆ·leetcodeé¢˜ã€‚å°±åœ¨æ˜¨å¤©ï¼Œæˆ‘åˆ·åˆ°äº†è¿™æ ·ä¸€é¢˜</p><hr><p>ç»™å®šä¸€ä¸ªè¾ƒé•¿å­—ç¬¦ä¸²<code>big</code>å’Œä¸€ä¸ªåŒ…å«è¾ƒçŸ­å­—ç¬¦ä¸²çš„æ•°ç»„<code>smalls</code>ï¼Œè®¾è®¡ä¸€ä¸ªæ–¹æ³•ï¼Œæ ¹æ®<code>smalls</code>ä¸­çš„æ¯ä¸€ä¸ªè¾ƒçŸ­å­—ç¬¦ä¸²ï¼Œå¯¹<code>big</code>è¿›è¡Œæœç´¢ã€‚è¾“å‡º<code>smalls</code>ä¸­çš„å­—ç¬¦ä¸²åœ¨<code>big</code>é‡Œå‡ºç°çš„æ‰€æœ‰ä½ç½®<code>positions</code>ï¼Œå…¶ä¸­<code>positions[i]</code>ä¸º<code>smalls[i]</code>å‡ºç°çš„æ‰€æœ‰ä½ç½®ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š</span><br><span class="line">big &#x3D; &quot;mississippi&quot;</span><br><span class="line">smalls &#x3D; [&quot;is&quot;,&quot;ppi&quot;,&quot;hi&quot;,&quot;sis&quot;,&quot;i&quot;,&quot;ssippi&quot;]</span><br><span class="line">è¾“å‡ºï¼š [[1,4],[8],[],[3],[1,4,7,10],[5]]</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>0 &lt;= len(big) &lt;= 1000</code></li><li><code>0 &lt;= len(smalls[i]) &lt;= 1000</code></li><li><code>smalls</code>çš„æ€»å­—ç¬¦æ•°ä¸ä¼šè¶…è¿‡ 100000ã€‚</li><li>ä½ å¯ä»¥è®¤ä¸º<code>smalls</code>ä¸­æ²¡æœ‰é‡å¤å­—ç¬¦ä¸²ã€‚</li><li>æ‰€æœ‰å‡ºç°çš„å­—ç¬¦å‡ä¸ºè‹±æ–‡å°å†™å­—æ¯ã€‚</li></ul><p><strong>è§£æ³•ï¼š</strong></p><p>çœ‹åˆ°åˆ¤æ–­å­—ç¬¦ä¸²åœ¨æ¯ä¸²çš„ä½ç½®ï¼Œå¾ˆå®¹æ˜“è®©äººæƒ³åˆ°indexOf(str)ï¼Œæˆ‘ä»¬å¯ä»¥è®°å½•indexOf(str)è¿”å›å€¼ï¼Œä½†<code>smalls</code>ä¸­ç‰¹å®šä½çš„å­—ç¬¦åœ¨<code>big</code>å‡ºç°çš„æ¬¡æ•°æ˜¯æœªçŸ¥æ•°xï¼Œæ‰€ä»¥å¯ä»¥ç”¨ä¸€ä¸ªå¯å˜æ•°ç»„Listæ¥å­˜å‚¨è¿™ä¸ªå­—ç¬¦åœ¨<code>big</code>ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚è€ŒindexOf(str)é»˜è®¤è¿”å›çš„æ˜¯stråœ¨æ¯ä¸²ä¸­ç¬¬ä¸€æ¬¡çš„ç´¢å¼•å€¼ï¼ŒStringè¿˜æä¾›äº†indexOf(str,index)æ¥è®°å½•ä»ç¬¬ä¸€ä¸ªå¼€å§‹çš„ç´¢å¼•å€¼ï¼Œå› æ­¤å¯ä»¥é‡‡ç”¨indexOf(str,index+1)æ¥é¿å…è®°å½•é‡å¤å€¼ã€‚<br>æ‰€ä»¥è§£æ³•å°±å¾ˆç®€å•ï¼Œå…ˆç”¨indexOfè·å–ç´¢å¼•å€¼ï¼Œç„¶åå­˜å‚¨åœ¨ä¸€ä¸ªé•¿åº¦å¯å˜çš„æ•°ç»„Listä¸­ï¼Œæ¥ç€è®²Listå†è½¬æˆå›ºå®šé•¿åº¦æ•°ç»„ï¼Œè¿”å›ç»™result[i]ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[][] multiSearch(String big, String[] smalls) &#123;</span><br><span class="line">        <span class="keyword">int</span> [][] result = <span class="keyword">new</span> <span class="keyword">int</span> [smalls.length][];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; smalls.length ; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">""</span>.equals(big))&#123;</span><br><span class="line">                result[i] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(!smalls[i].equals(<span class="string">""</span>))&#123;</span><br><span class="line">                <span class="keyword">int</span> index = big.indexOf(smalls[i]);</span><br><span class="line">                List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                <span class="keyword">while</span> (index&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">                    list.add(index);</span><br><span class="line">                    index = big.indexOf(smalls[i],index+<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                result[i] = parseList2Array(list);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                result[i] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] parseList2Array(List&lt;Integer&gt; list)&#123;</span><br><span class="line">        <span class="keyword">int</span> [] index = <span class="keyword">new</span> <span class="keyword">int</span>[list.size()];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.size() ; i++) &#123;</span><br><span class="line">            index[i] = list.get(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¢˜å¾ˆç®€ç­”ï¼Œä½†æ˜¯æˆ‘è¶Šåˆ·(mo yu)è¶Šå¼€å¿ƒï¼Œåˆåˆ·åˆ°äº†è¿™æ ·ä¸€é¢˜ã€‚</p><hr><p> ç»™å®šå­—ç¬¦ä¸²<code>J</code> ä»£è¡¨çŸ³å¤´ä¸­å®çŸ³çš„ç±»å‹ï¼Œå’Œå­—ç¬¦ä¸² <code>S</code>ä»£è¡¨ä½ æ‹¥æœ‰çš„çŸ³å¤´ã€‚ <code>S</code> ä¸­æ¯ä¸ªå­—ç¬¦ä»£è¡¨äº†ä¸€ç§ä½ æ‹¥æœ‰çš„çŸ³å¤´çš„ç±»å‹ï¼Œä½ æƒ³çŸ¥é“ä½ æ‹¥æœ‰çš„çŸ³å¤´ä¸­æœ‰å¤šå°‘æ˜¯å®çŸ³ã€‚</p><p><code>J</code> ä¸­çš„å­—æ¯ä¸é‡å¤ï¼Œ<code>J</code> å’Œ <code>S</code>ä¸­çš„æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯å­—æ¯ã€‚å­—æ¯åŒºåˆ†å¤§å°å†™ï¼Œå› æ­¤<code>&quot;a&quot;</code>å’Œ<code>&quot;A&quot;</code>æ˜¯ä¸åŒç±»å‹çš„çŸ³å¤´ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: J &#x3D; &quot;aA&quot;, S &#x3D; &quot;aAAbbbb&quot;</span><br><span class="line">è¾“å‡º: 3</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: J &#x3D; &quot;z&quot;, S &#x3D; &quot;ZZ&quot;</span><br><span class="line">è¾“å‡º: 0</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„:</strong></p><ul><li><code>S</code> å’Œ <code>J</code> æœ€å¤šå«æœ‰50ä¸ªå­—æ¯ã€‚</li><li><code>J</code> ä¸­çš„å­—ç¬¦ä¸é‡å¤ã€‚</li></ul><p>æˆ‘ç›´æ¥ä¸€æ³¢æƒ¯æ€§æ€ç»´ï¼Œæƒ³åˆ°äº†indexOfçœŸé¦™(ä¸»è¦ç®€å•)ï¼ŒæŠŠ<code>J</code>æ‹†æˆchar[],é‚£æ¯ä¸ªchar[i],ä¸å°±ç›¸å½“äºä¸Šä¸€é¢˜é‡Œé¢çš„small[i]å—ï¼Œè¿™æ ·ä¸€æƒ³ï¼Œå…¶å®è¿˜æ˜¯åœ¨æ¯ä¸²é‡Œæ‰¾æ¯ä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numJewelsInStones</span><span class="params">(String J, String S)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span>[] charArray = J.toCharArray();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">char</span> item: charArray) &#123;</span><br><span class="line">        <span class="keyword">int</span> index = S.indexOf(item);</span><br><span class="line">        <span class="keyword">while</span> (index&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            result++;</span><br><span class="line">            index = S.indexOf(item,index+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£ç­”å‡ºæ¥ä¹‹åï¼Œæˆ‘å°±å¼€å§‹æ€è€ƒæœ‰æ²¡æœ‰å…¶ä»–æ–¹æ³•å¯ä»¥æ›´ç®€å•æˆ–è€…æ›´å¿«çš„è§£å†³è¿™ä¸ªé¢˜ç›®ã€‚è¿˜æ˜¯ä»åˆšåˆšè¿™ä¸ªæ€è·¯åˆ‡å…¥ï¼ŒæŠŠ<code>J</code>åˆ‡æˆchar[]ï¼Œå› ä¸º<code>S</code>ä¸­çš„char[i]å¯èƒ½æ˜¯å¤šä¸ªï¼Œæ‰€ä»¥è¿˜éœ€è¦åƒä¸Šä¸€é¢˜è¿™æ ·å¤šæ¬¡æœç´¢ï¼Œä½†æ˜¯<code>J</code>ä¸­çš„å…ƒç´ æ˜¯ä¸ä¼šé‡å¤çš„ï¼Œå¦‚æœæŠŠ<code>S</code>æ‹†æˆchar[]ï¼Œé‚£ä¹ˆå¯¹åº”å¯ä»¥ç›´æ¥åœ¨<code>J</code>ä¸­è¿›è¡Œä¸€æ¬¡æœç´¢ï¼Œè€Œä¸”å› ä¸ºä¸éœ€è¦å–ç´¢å¼•å€¼ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨J.contains(char[i])ï¼Œçœ‹è¿”å›çš„å¸ƒå°”å€¼ï¼Œå®ç°è®¡æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numJewelsInStones</span><span class="params">(String J, String S)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span>[] charArray = S.toCharArray();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">char</span> item: charArray) &#123;</span><br><span class="line">        <span class="keyword">if</span>(J.contains(item+<span class="string">""</span>))&#123;</span><br><span class="line">            result++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿›ä¸€æ­¥æ€è€ƒï¼Œæ—¢ç„¶<code>J</code>çš„æ¯ä¸ªå…ƒç´ éƒ½ä¸ç›¸åŒï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é‡‡ç”¨å…ƒç´ éƒ½ä¸é‡å¤çš„é›†åˆSetæ¥å­˜å‚¨Jçš„æ¯ä¸€ä¸ªå…ƒç´ ã€‚ä¸è¿‡è¿™æ ·éœ€è¦å¯¹ä¸¤ä¸ªå­—ç¬¦ä¸²éƒ½è½¬æ•°ç»„ï¼Œè™½ç„¶ç®€å•ä½†æ˜¯æ„Ÿè§‰ä¸å¦‚ä¸Šè¿°ä»£ç ç®€æ´ã€‚ã€‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numJewelsInStones</span><span class="params">(String J, String S)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">    HashSet&lt;Character&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">    <span class="keyword">char</span>[] chars = J.toCharArray();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">char</span> item: chars) &#123;</span><br><span class="line">        set.add(item);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; S.length(); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(set.contains(S.charAt(i)))</span><br><span class="line">            result++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†™å®Œè¿™äº›ï¼Œæ˜¯ä¸æ˜¯çªç„¶å‘ç°ï¼Œæ—¢ç„¶æ˜¯ç”¨<code>J</code>ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦å»æŒ¨ä¸ªéå†<code>S</code>ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦ã€‚é‚£ä¹ˆæœ€ç²—æš´çš„æ–¹æ³•å½“ç„¶æ˜¯åŒé‡forå¾ªç¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numJewelsInStones</span><span class="params">(String J, String S)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">char</span> Jitem : J.toCharArray())&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">char</span> Sitem : S.toCharArray())&#123;</span><br><span class="line">            <span class="keyword">if</span>(Jitem == Sitem)&#123;</span><br><span class="line">                result++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æ–¹æ³•è™½ç„¶ç®€å•ï¼Œä½†æ˜¯è¿™æ ·æ•ˆç‡æä½æä½ï¼Œè¿™æ ·çš„å†™æ³•ç›¸å½“äºæ˜¯æŠŠæ•´ä¸ª<code>J</code>å’Œæ•´ä¸ª<code>S</code>éƒ½éå†äº†ä¸€éï¼Œç›¸å½“äºæ‰§è¡Œäº†<code>J.length*S.length</code>æ¬¡ã€‚å› ä¸ºè¿™é‡Œ<code>J</code>çš„æ¯ä¸€ä¸ªå­—ç¬¦éƒ½æ˜¯å”¯ä¸€ä¸é‡å¤çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨<code>S</code>å»åŒ¹é…<code>J</code>,æ‰¾åˆ°è‡ªå·±breakå½“å‰å°å¾ªç¯ç›´æ¥è¿›å…¥ä¸‹ä¸€æ¬¡å¤§å¾ªç¯ï¼Œå°±ä¼šå°‘ä¸€äº›éå†<code>J</code>ä¸­å‰©ä¸‹çš„å­—ç¬¦æ¬¡æ•°ï¼Œç›¸å¯¹è€Œè¨€å°±ä¼šå°‘æ‰§è¡Œå¾ˆå¤šæ¬¡å¾ªç¯ä½“ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numJewelsInStones</span><span class="params">(String J, String S)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">char</span> Sitem : S.toCharArray())&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">char</span> Jitem : J.toCharArray())&#123;</span><br><span class="line">                <span class="keyword">if</span>(Jitem == Sitem)&#123;</span><br><span class="line">                    result++;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¿«ä¹çš„ä¸Šç­(mo yu)æ—¶å…‰æ€»æ˜¯å¾ˆçŸ­æš‚ï¼Œä¸‹ç­å•¦~~~~</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> leetcode </tag>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVMåƒåœ¾å›æ”¶ä¸å†…å­˜åˆ†é…</title>
      <link href="2020/09/27/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E4%B8%8E%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/"/>
      <url>2020/09/27/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E4%B8%8E%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/</url>
      
        <content type="html"><![CDATA[<p>Javaä¸C++ä¹‹é—´æœ‰ä¸€å µç”±å†…å­˜åŠ¨æ€åˆ†é…å’Œåƒåœ¾æ”¶é›†æŠ€æœ¯æ‰€å›´æˆçš„é«˜å¢™ï¼Œå¤–é¢çš„äººæƒ³è¿›æ¥ï¼Œé‡Œé¢çš„äººæƒ³å‡ºå»ã€‚</p><blockquote id="fn_å¼•ç”¨"><sup>å¼•ç”¨</sup>. ã€Šæ·±å…¥ç†è§£JAVAè™šæ‹Ÿæœºã€‹<a href="#reffn_å¼•ç”¨" title="Jump back to footnote [å¼•ç”¨] in the text."> &#8617;</a></blockquote><p>JAVAç›¸å¯¹äºC/C++è€Œè¨€å¼•å…¥äº†GCæœºåˆ¶ï¼Œä½¿ç¨‹åºå‘˜æ›´åŠ å»å…³æ³¨ç¨‹åºæœ¬èº«ï¼Œä¸éœ€è¦å†å¯¹æ¯ä¸ªnewçš„å¯¹è±¡å»è¿›è¡Œdelete/freeæ“ä½œã€‚C++å°±å¥½åƒä½ åœ¨å®¶é‡Œè‡ªå·±æ°é¥­ï¼Œéœ€è¦å»è‡ªå·±åšå¥½ã€‚åƒå®Œä¹‹åè¿˜è¦è‡ªå·±æ”¶æ‹¾ã€‚è€ŒJAVAæ›´åƒæ˜¯åœ¨é¤å…ä¸­åƒé¥­ï¼Œä½ ä¸éœ€è¦å»å…³æ³¨é¥­æ˜¯å¦‚ä½•åšå¥½çš„ï¼Œä»¥åŠåƒå®Œä»¥åæœåŠ¡å‘˜æ˜¯å¦‚ä½•æ”¶æ‹¾çš„ï¼Œä½ åªè¦è´Ÿè´£äº«ç”¨ç¾é£Ÿå°±å¯ä»¥äº†ã€‚</p><hr><h2 id="JVMå†…å­˜åŒºåŸŸ"><a href="#JVMå†…å­˜åŒºåŸŸ" class="headerlink" title="JVMå†…å­˜åŒºåŸŸ"></a>JVMå†…å­˜åŒºåŸŸ</h2><p>äº†è§£GCä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£JVMçš„å†…å­˜æ¨¡å‹ï¼Œææ¸…æ¥šè¢«å›æ”¶çš„æ•°æ®ä¸€èˆ¬å­˜åœ¨åœ¨å“ªäº›åŒºåŸŸã€‚</p><p><img src="jvmncqy.png" alt="JVMå†…å­˜åŒºåŸŸ"></p><ul><li>è™šæ‹Ÿæœºæ ˆï¼šæè¿°æ–¹æ³•æ‰§è¡Œæ—¶çš„å†…å­˜æ¨¡å‹ï¼Œå±äºçº¿ç¨‹ç§æœ‰ï¼Œç”Ÿå‘½å‘¨æœŸåŒçº¿ç¨‹ä¸€æ ·ã€‚ä¸»è¦ä¿å­˜æ‰§è¡Œæ–¹æ³•æ—¶çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€è¿æ¥å’Œæ–¹æ³•è¿”å›åœ°å€ç­‰ä¿¡æ¯,æ–¹æ³•æ‰§è¡Œæ—¶å…¥æ ˆï¼Œæ–¹æ³•æ‰§è¡Œå®Œå‡ºæ ˆï¼Œå‡ºæ ˆä¹‹åæ•°æ®æ¸…ç©ºï¼Œä¸éœ€è¦GCã€‚</li><li>æœ¬åœ°æ–¹æ³•æ ˆï¼šä¸»è¦å­˜å‚¨è™šæ‹Ÿæœºè°ƒç”¨nativeæ–¹æ³•/æœåŠ¡ç›¸å…³ä¿¡æ¯ã€‚å¤§ä½“é€»è¾‘å’Œè™šæ‹Ÿæœºæ ˆç›¸åŒï¼Œä¹Ÿä¸éœ€è¦GCã€‚</li><li>ç¨‹åºæŠ€æœ¯å™¨ï¼šä¸»è¦è®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œå­—èŠ‚ç çš„è¡Œå·ã€‚æ˜¯<code>å”¯ä¸€ä¸€ä¸ª</code>åœ¨ Java è™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½• OOM æƒ…å†µçš„åŒºåŸŸï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦GCã€‚</li><li>æœ¬åœ°å†…å­˜ï¼šçº¿ç¨‹å…±äº«åŒºåŸŸã€‚åœ¨JAVA8ä¹‹å‰ï¼Œæ–¹æ³•åŒºæ˜¯åœ¨å †å†…çš„å®ç°çš„ã€‚å—GCç®¡ç†ï¼ŒJAVA8æŠŠæ–¹æ³•åŒºçš„å®ç°ç§»åˆ°äº†æœ¬åœ°å†…å­˜ä¸­çš„å…ƒç©ºé—´ã€‚è¿™æ ·æ–¹æ³•åŒºå°±ä¸å—JVMæ§åˆ¶ï¼Œä¹Ÿä¸ä¼šè¿›è¡ŒGCï¼Œä¹Ÿæå‡äº†æ€§èƒ½ï¼Œå› ä¸ºå‘ç”Ÿ GC ä¼šå‘ç”Ÿ Stop The Word,é€ æˆæ€§èƒ½å—åˆ°ä¸€å®šå½±å“ï¼Œä¹Ÿæ–¹ä¾¿åœ¨å…ƒç©ºé—´ä¸­ç»Ÿä¸€ç®¡ç†ã€‚</li><li>å †ï¼šå †æ˜¯GC å‘ç”Ÿçš„ä¸»è¦åŒºåŸŸï¼Œå¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½æ˜¯åœ¨å †ä¸Šåˆ†é…çš„ï¼ŒGC ä¹Ÿä¸»è¦å¯¹è¿™ä¸¤ç±»æ•°æ®è¿›è¡Œå›æ”¶ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¹Ÿç»ˆç‚¹åˆ†æè¿™å—åŒºåŸŸã€‚</li></ul><h2 id="å¦‚ä½•åˆ¤æ–­åƒåœ¾"><a href="#å¦‚ä½•åˆ¤æ–­åƒåœ¾" class="headerlink" title="å¦‚ä½•åˆ¤æ–­åƒåœ¾"></a>å¦‚ä½•åˆ¤æ–­åƒåœ¾</h2><h3 id="å¼•ç”¨è®¡æ•°æ³•"><a href="#å¼•ç”¨è®¡æ•°æ³•" class="headerlink" title="å¼•ç”¨è®¡æ•°æ³•"></a>å¼•ç”¨è®¡æ•°æ³•</h3><p>ç®€å•æ¥è¯´å°±æ˜¯å¯¹æ¯ä¸ªå¯¹è±¡å»æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨ä»–ï¼Œè®¡æ•°å™¨å°±åŠ ä¸€ï¼Œå½“å¼•ç”¨å¤±æ•ˆå°±å‡ä¸€ã€‚å¦‚æœæ²¡æœ‰è¢«å¼•ç”¨ï¼ˆå¼•ç”¨æ¬¡æ•°ä¸º 0ï¼‰ï¼Œåˆ™æ­¤å¯¹è±¡å¯å›æ”¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String ref = <span class="keyword">new</span> String(<span class="string">"Java"</span>);</span><br></pre></td></tr></table></figure><p><img src="630.png" alt="å¼•ç”¨è®¡æ•°"></p><p>ref å¼•ç”¨äº†å³ä¾§å®šä¹‰çš„å¯¹è±¡ï¼Œæ‰€ä»¥å¼•ç”¨æ¬¡æ•°æ˜¯ 1 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ref &#x3D; null;</span><br></pre></td></tr></table></figure><p>å¯¹è±¡æ²¡è¢«å¼•ç”¨ï¼Œå¼•ç”¨æ¬¡æ•°ç½®ä¸º 0ï¼Œç”±äºä¸è¢«ä»»ä½•å˜é‡å¼•ç”¨ï¼Œæ­¤æ—¶å³è¢«å›æ”¶</p><p><img src="640.gif" alt="å¼•ç”¨è®¡æ•°"></p><p>ä½†å•çº¯çš„å¼•ç”¨è®¡æ•°æ— æ³•è§£å†³å¯¹è±¡ä¹‹é—´çš„ç›¸äº’å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestRCGC</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    TestRCGC instance;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TestRCGC</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ­¥</span></span><br><span class="line">    A a = <span class="keyword">new</span> TestRCGC(<span class="string">"a"</span>);</span><br><span class="line">    B b = <span class="keyword">new</span> TestRCGC(<span class="string">"b"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬äºŒæ­¥</span></span><br><span class="line">    a.instance = b;</span><br><span class="line">    b.instance = a;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬ä¸‰æ­¥</span></span><br><span class="line">    a = <span class="keyword">null</span>;</span><br><span class="line">    b = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="650.png" alt="å¾ªç¯å¼•ç”¨"></p><p>è™½ç„¶æœ€å aï¼Œb éƒ½è¢«ç½®ä¸º null äº†ï¼Œä½†æ˜¯ç”±äºä¹‹å‰å®ƒä»¬æŒ‡å‘çš„å¯¹è±¡äº’ç›¸æŒ‡å‘äº†å¯¹æ–¹ï¼ˆå¼•ç”¨è®¡æ•°éƒ½ä¸º 1ï¼‰ï¼Œæ‰€ä»¥æ— æ³•å›æ”¶ï¼Œä¹Ÿæ­£æ˜¯ç”±äºæ— æ³•è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œæ‰€ä»¥ç°ä»£JAVAè™šæ‹Ÿæœºéƒ½ä¸ç”¨å¼•ç”¨è®¡æ•°æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦åº”è¯¥è¢«å›æ”¶ã€‚</p><h3 id="å¯è¾¾æ€§åˆ†ææ³•"><a href="#å¯è¾¾æ€§åˆ†ææ³•" class="headerlink" title="å¯è¾¾æ€§åˆ†ææ³•"></a>å¯è¾¾æ€§åˆ†ææ³•</h3><p>å½“å‰ä¸»æµçš„å†…å­˜ç®¡ç†ç³»ç»ŸåŸºæœ¬éƒ½æ˜¯é‡‡ç”¨çš„å¯è¾¾æ€§åˆ†æç®—æ³•æ¥åˆ¤å®šå¯¹è±¡æ˜¯å¦å­˜æ´»ã€‚å®ƒçš„åŸç†æ˜¯é€šè¿‡ä¸€ç³»åˆ—â€œGC Rootsâ€çš„æ ¹å¯¹è±¡ä½œä¸ºèµ·å§‹èŠ‚ç‚¹é›†ã€‚ä»è¿™ä¸ªèŠ‚ç‚¹å¼€å§‹ï¼Œé€šè¿‡å¼•ç”¨å‘ä¸‹æœç´¢ï¼Œæœç´¢è¿‡ç¨‹èµ°çš„è·¯è¢«ç§°ä¸ºâ€œå¼•ç”¨é“¾â€ï¼Œå¦‚æœå¯¹è±¡åˆ°â€œGC Rootsâ€ä¹‹é—´æ²¡æœ‰å¼•ç”¨é“¾ç›¸è¿çš„è¯ï¼Œåˆ™è¯´æ˜è¿™ä¸ªå¯¹è±¡æ˜¯ä¸å¯è¾¾çš„ï¼Œä¹Ÿå°±æ˜¯æ­»äº¡çš„ã€‚</p><p><img src="660.png" alt="å¯è¾¾æ€§åˆ†æ"></p><p>å¦‚å›¾æ‰€ç¤ºï¼šå¯¹è±¡aå’Œå¯¹è±¡bä¹‹é—´ï¼Œè™½ç„¶å­˜åœ¨å¾ªç¯å¼•ç”¨ï¼Œä½†æ˜¯aï¼Œbä¹‹é—´ä¸å­˜åœ¨ä¸GC Rootæƒ³å…³è”çš„å¼•ç”¨ï¼Œå› æ­¤a,bæ˜¯å¯å›æ”¶çš„ã€‚<br>ä½†æ˜¯æ­¤æ—¶a,bå¹¶æ²¡æœ‰çœŸæ­£çš„æ­»äº¡ï¼Œè€Œæ˜¯å¤„äºä¸€ä¸ªâ€œç¼“åˆ‘â€çš„é˜¶æ®µã€‚ä¸€ä¸ªå¯¹è±¡çœŸæ­£æ­»äº¡éœ€è¦åŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼Œä¸€ä¸ªæ˜¯å¯¹è±¡ä¸GC Rootsæ²¡æœ‰ç›¸è¿æ¥çš„å¼•ç”¨é“¾ã€‚å¦ä¸€ä¸ªæ˜¯å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œfinallize()æ–¹æ³•ã€‚å¦‚æœå¯¹è±¡æœªæ‰§è¡Œï¼Œåˆ™ä¼šå…ˆæ‰§è¡Œfinallize()æ–¹æ³•ã€‚å¦‚æœæ‰§è¡Œè¯¥æ–¹æ³•åå¯¹è±¡ä»ä¸å¯è¾¾ï¼Œåˆ™å›æ”¶è¯¥å¯¹è±¡ï¼Œåä¹‹ä¸å›æ”¶è¯¥å¯¹è±¡ã€‚<br>ä½†æ˜¯finallizeåªä¼šè¢«æ‰§è¡Œ<code>ä¸€æ¬¡</code>ï¼Œå¦‚æœåœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œäº†finallizeä¹‹åå¯¹è±¡ä»ç„¶æ˜¯å¯è¾¾çš„ã€‚é‚£ä¹ˆä¸‹ä¸€æ¬¡å¯¹è±¡å†è¢«GCçš„æ—¶å€™ä¼šå¿½ç•¥finallizeæ–¹æ³•ï¼Œä¼šè¢«å›æ”¶ã€‚</p><p>é‚£ä¹ˆè¿™äº› GC Roots åˆ°åº•æ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Œå“ªäº›å¯¹è±¡å¯ä»¥ä½œä¸º GC Root å‘¢ï¼Œæœ‰ä»¥ä¸‹å‡ ç±»</p><ul><li>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNIï¼ˆå³ä¸€èˆ¬è¯´çš„ Native æ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡</li></ul><h4 id="è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡"><a href="#è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡" class="headerlink" title="è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡"></a>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</h4><p>a æ˜¯æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡ï¼Œå½“ a = null æ—¶ï¼Œç”±äºæ­¤æ—¶ a å……å½“äº† <strong>GC Root</strong> çš„ä½œç”¨ï¼Œa ä¸åŸæ¥æŒ‡å‘çš„å®ä¾‹ <strong>new Test()</strong> æ–­å¼€äº†è¿æ¥ï¼Œæ‰€ä»¥å¯¹è±¡ä¼šè¢«å›æ”¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Test a = <span class="keyword">new</span> Test();</span><br><span class="line">    a = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨å¯¹è±¡"><a href="#æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨å¯¹è±¡" class="headerlink" title="æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨å¯¹è±¡"></a>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨å¯¹è±¡</h4><p>å½“æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡ a = null æ—¶ï¼Œç”±äº a åŸæ¥æŒ‡å‘çš„å¯¹è±¡ä¸ GC Root (å˜é‡ a) æ–­å¼€äº†è¿æ¥ï¼Œæ‰€ä»¥ a åŸæ¥æŒ‡å‘çš„å¯¹è±¡ä¼šè¢«å›æ”¶ï¼Œè€Œç”±äºæˆ‘ä»¬ç»™ s èµ‹å€¼äº†å˜é‡çš„å¼•ç”¨ï¼Œs åœ¨æ­¤æ—¶æ˜¯ç±»é™æ€å±æ€§å¼•ç”¨ï¼Œå……å½“äº† GC Root çš„ä½œç”¨ï¼Œå®ƒæŒ‡å‘çš„å¯¹è±¡ä¾ç„¶å­˜æ´»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Test s;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Test a = <span class="keyword">new</span> Test();</span><br><span class="line">    a.s = <span class="keyword">new</span> Test();</span><br><span class="line">    a = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨å¯¹è±¡"><a href="#æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨å¯¹è±¡" class="headerlink" title="æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨å¯¹è±¡"></a>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨å¯¹è±¡</h4><p>å¸¸é‡ s æŒ‡å‘çš„å¯¹è±¡å¹¶ä¸ä¼šå› ä¸º a æŒ‡å‘çš„å¯¹è±¡è¢«å›æ”¶è€Œå›æ”¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Test s = <span class="keyword">new</span> Test();</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Test a = <span class="keyword">new</span> Test();</span><br><span class="line">        a = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æœ¬åœ°æ–¹æ³•æ ˆä¸­-JNI-å¼•ç”¨çš„å¯¹è±¡"><a href="#æœ¬åœ°æ–¹æ³•æ ˆä¸­-JNI-å¼•ç”¨çš„å¯¹è±¡" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNI å¼•ç”¨çš„å¯¹è±¡"></a>æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNI å¼•ç”¨çš„å¯¹è±¡</h4><p>æœ¬åœ°æ–¹æ³•å°±æ˜¯ä¸€ä¸ª java è°ƒç”¨é java ä»£ç çš„æ¥å£ï¼Œè¯¥æ–¹æ³•å¹¶é Java å®ç°çš„ï¼Œå¯èƒ½ç”± C æˆ– Pythonç­‰å…¶ä»–è¯­è¨€å®ç°çš„ï¼Œ Java é€šè¿‡ JNI æ¥è°ƒç”¨æœ¬åœ°æ–¹æ³•ï¼Œ è€Œæœ¬åœ°æ–¹æ³•æ˜¯ä»¥åº“æ–‡ä»¶çš„å½¢å¼å­˜æ”¾çš„ï¼ˆåœ¨ WINDOWS å¹³å°ä¸Šæ˜¯ DLL æ–‡ä»¶å½¢å¼ï¼Œåœ¨ UNIX æœºå™¨ä¸Šæ˜¯ SO æ–‡ä»¶å½¢å¼ï¼‰ã€‚é€šè¿‡è°ƒç”¨æœ¬åœ°çš„åº“æ–‡ä»¶çš„å†…éƒ¨æ–¹æ³•ï¼Œä½¿ JAVA å¯ä»¥å®ç°å’Œæœ¬åœ°æœºå™¨çš„ç´§å¯†è”ç³»ï¼Œè°ƒç”¨ç³»ç»Ÿçº§çš„å„æ¥å£æ–¹æ³•ã€‚</p><p>å½“è°ƒç”¨ Java æ–¹æ³•æ—¶ï¼Œè™šæ‹Ÿæœºä¼šåˆ›å»ºä¸€ä¸ªæ ˆæ¡¢å¹¶å‹å…¥ Java æ ˆï¼Œè€Œå½“å®ƒè°ƒç”¨çš„æ˜¯æœ¬åœ°æ–¹æ³•æ—¶ï¼Œè™šæ‹Ÿæœºä¼šä¿æŒ Java æ ˆä¸å˜ï¼Œä¸ä¼šåœ¨ Java æ ˆç¥¯ä¸­å‹å…¥æ–°çš„ç¥¯ï¼Œè™šæ‹Ÿæœºåªæ˜¯ç®€å•åœ°åŠ¨æ€è¿æ¥å¹¶ç›´æ¥è°ƒç”¨æŒ‡å®šçš„æœ¬åœ°æ–¹æ³•ã€‚</p><p><img src="670.png" alt="æ ˆå¸§"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL <span class="title">Java_com_pecuyu_jnirefdemo_MainActivity_newStringNative</span><span class="params">(JNIEnv *env, jobject instanceï¼Œjstring jmsg)</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">   <span class="comment">// ç¼“å­˜Stringçš„class</span></span><br><span class="line">   jclass jc = (*env)-&gt;FindClass(env, STRING_PATH);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ java è°ƒç”¨ä»¥ä¸Šæœ¬åœ°æ–¹æ³•æ—¶ï¼Œjc ä¼šè¢«æœ¬åœ°æ–¹æ³•æ ˆå‹å…¥æ ˆä¸­, jc å°±æ˜¯æˆ‘ä»¬è¯´çš„æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNI çš„å¯¹è±¡å¼•ç”¨ï¼Œå› æ­¤åªä¼šåœ¨æ­¤æœ¬åœ°æ–¹æ³•æ‰§è¡Œå®Œæˆåæ‰ä¼šè¢«é‡Šæ”¾ã€‚</p><h2 id="åƒåœ¾å›æ”¶ç®—æ³•"><a href="#åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="åƒåœ¾å›æ”¶ç®—æ³•"></a>åƒåœ¾å›æ”¶ç®—æ³•</h2><h3 id="æ ‡è®°æ¸…é™¤ç®—æ³•"><a href="#æ ‡è®°æ¸…é™¤ç®—æ³•" class="headerlink" title="æ ‡è®°æ¸…é™¤ç®—æ³•"></a>æ ‡è®°æ¸…é™¤ç®—æ³•</h3><p>å…ˆæ ¹æ®å¯è¾¾æ€§ç®—æ³•<strong>æ ‡è®°</strong>å‡ºç›¸åº”çš„å¯å›æ”¶å¯¹è±¡ï¼Œå¯¹å¯å›æ”¶çš„å¯¹è±¡è¿›è¡Œå›æ”¶ã€‚</p><p><img src="680.png" alt="æ ‡è®°æ¸…é™¤"></p><p>è¿™ç§æ–¹å¼å¾ˆç®€å•ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªç‰¹åˆ«æ˜æ˜¾çš„é—®é¢˜ï¼Œå½“å¤§é‡çš„å°å¯¹è±¡æ­»äº¡æ—¶ï¼Œæ ‡è®°æ¸…é™¤å‡ºæ¥çš„ç¢ç‰‡åŒ–ç©ºé—´å°±ç‰¹åˆ«å¤šã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•èƒ½è·å¾—ä¸€ä¸ªè¿ç»­å†…å­˜ç©ºé—´å‘¢ï¼Ÿ</p><h3 id="æ ‡è®°æ•´ç†æ³•"><a href="#æ ‡è®°æ•´ç†æ³•" class="headerlink" title="æ ‡è®°æ•´ç†æ³•"></a>æ ‡è®°æ•´ç†æ³•</h3><p>ä¸¤æ­¥å’Œæ ‡è®°æ¸…é™¤æ³•ä¸€æ ·ï¼Œä¸åŒçš„æ˜¯å®ƒåœ¨æ ‡è®°æ¸…é™¤æ³•çš„åŸºç¡€ä¸Šæ·»åŠ äº†ä¸€ä¸ªæ•´ç†çš„è¿‡ç¨‹ ï¼Œå³å°†æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡éƒ½å¾€ä¸€ç«¯ç§»åŠ¨,ç´§é‚»æ’åˆ—ï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³ç¢ç‰‡åŒ–ç©ºé—´çš„é—®é¢˜ã€‚</p><p><img src="690.png" alt="æ ‡è®°æ•´ç†"></p><p>è¿™ç§ç®—æ³•çš„ç¼ºç‚¹æ˜¯æ¯è¿›ä¸€æ¬¡åƒåœ¾æ¸…é™¤éƒ½è¦é¢‘ç¹åœ°ç§»åŠ¨å­˜æ´»çš„å¯¹è±¡ï¼Œæ•ˆç‡ååˆ†ä½ä¸‹ã€‚</p><h3 id="å¤åˆ¶ç®—æ³•"><a href="#å¤åˆ¶ç®—æ³•" class="headerlink" title="å¤åˆ¶ç®—æ³•"></a>å¤åˆ¶ç®—æ³•</h3><p>æŠŠå †ç­‰åˆ†æˆä¸¤å—åŒºåŸŸ, A å’Œ Bï¼ŒåŒºåŸŸ A è´Ÿè´£åˆ†é…å¯¹è±¡ï¼ŒåŒºåŸŸ B ä¸åˆ†é…, å¯¹åŒºåŸŸ A ä½¿ç”¨ä»¥ä¸Šæ‰€è¯´çš„æ ‡è®°æ³•æŠŠå­˜æ´»çš„å¯¹è±¡æ ‡è®°å‡ºæ¥ï¼ˆä¸‹å›¾æœ‰è¯¯æ— éœ€æ¸…é™¤ï¼‰ï¼Œç„¶åæŠŠåŒºåŸŸ A ä¸­å­˜æ´»çš„å¯¹è±¡éƒ½å¤åˆ¶åˆ°åŒºåŸŸ Bï¼ˆå­˜æ´»å¯¹è±¡éƒ½ä¾æ¬¡<strong>ç´§é‚»æ’åˆ—</strong>ï¼‰æœ€åæŠŠ A åŒºå¯¹è±¡å…¨éƒ¨æ¸…ç†æ‰é‡Šæ”¾å‡ºç©ºé—´ã€‚</p><p><img src="700.png" alt="æ ‡è®°æ•´ç†"></p><p>å¤åˆ¶ç®—æ³•çš„ç¼ºç‚¹æ˜¯æ¯”å¦‚ç»™å †åˆ†é…åˆ†é…çš„å†…å­˜åªæœ‰ä¸€åŠæ˜¯å¯ç”¨çš„ï¼Œå¦å¤–æ¯æ¬¡å›æ”¶ä¹Ÿè¦æŠŠå­˜æ´»å¯¹è±¡ç§»åŠ¨åˆ°å¦ä¸€åŠï¼Œæ•ˆç‡ä½ä¸‹ã€‚</p><h3 id="åˆ†ä»£æ”¶é›†ç®—æ³•"><a href="#åˆ†ä»£æ”¶é›†ç®—æ³•" class="headerlink" title="åˆ†ä»£æ”¶é›†ç®—æ³•"></a>åˆ†ä»£æ”¶é›†ç®—æ³•</h3><p>åˆ†ä»£æ”¶é›†ç®—æ³•æ•´åˆäº†ä»¥ä¸Šç®—æ³•ï¼Œç»¼åˆäº†è¿™äº›ç®—æ³•çš„ä¼˜ç‚¹ï¼Œæœ€å¤§ç¨‹åº¦é¿å…äº†å®ƒä»¬çš„ç¼ºç‚¹ï¼Œæ‰€ä»¥æ˜¯ç°ä»£è™šæ‹Ÿæœºé‡‡ç”¨çš„é¦–é€‰ç®—æ³•,ä¸å…¶è¯´å®ƒæ˜¯ç®—æ³•ï¼Œå€’ä¸æ˜¯è¯´å®ƒæ˜¯ä¸€ç§ç­–ç•¥ï¼Œå› ä¸ºå®ƒæ˜¯æŠŠä¸Šè¿°å‡ ç§ç®—æ³•æ•´åˆåœ¨äº†ä¸€èµ·ï¼Œä¸ºå•¥éœ€è¦åˆ†ä»£æ”¶é›†å‘¢ï¼Œæ¥çœ‹ä¸€ä¸‹å¯¹è±¡çš„åˆ†é…æœ‰å•¥è§„å¾‹</p><p><img src="710.png" alt="å¯¹è±¡å­˜æ´»æ—¶é—´"></p><p><em>å¦‚å›¾ç¤ºï¼šçºµè½´ä»£è¡¨å·²åˆ†é…çš„å­—èŠ‚ï¼Œè€Œæ¨ªè½´ä»£è¡¨ç¨‹åºè¿è¡Œæ—¶é—´</em></p><p>ç”±å›¾å¯çŸ¥ï¼Œå¤§éƒ¨åˆ†çš„å¯¹è±¡éƒ½å¾ˆçŸ­å‘½ï¼Œéƒ½åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…éƒ½è¢«å›æ”¶äº†ï¼ˆIBM ä¸“ä¸šç ”ç©¶è¡¨æ˜ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œ98% çš„å¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•æ­»çš„ï¼Œç»è¿‡ä¸€æ¬¡ Minor GC åå°±ä¼šè¢«å›æ”¶ï¼‰ï¼Œæ‰€ä»¥åˆ†ä»£æ”¶é›†ç®—æ³•æ ¹æ®<strong>å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒ</strong>å°†å †åˆ†æˆæ–°ç”Ÿä»£å’Œè€ç”Ÿä»£ï¼ˆJava8ä»¥å‰è¿˜æœ‰ä¸ªæ°¸ä¹…ä»£ï¼‰,é»˜è®¤æ¯”ä¾‹ä¸º 1 : 2ï¼Œæ–°ç”Ÿä»£åˆåˆ†ä¸º Eden åŒºï¼Œ from Survivor åŒºï¼ˆç®€ç§°S0ï¼‰ï¼Œto Survivor åŒº(ç®€ç§° S1),ä¸‰è€…çš„æ¯”ä¾‹ä¸º 8: 1 : 1ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®æ–°è€ç”Ÿä»£çš„ç‰¹ç‚¹é€‰æ‹©æœ€åˆé€‚çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œæˆ‘ä»¬æŠŠæ–°ç”Ÿä»£å‘ç”Ÿçš„ GC ç§°ä¸º Young GCï¼ˆä¹Ÿå« Minor GCï¼‰,è€å¹´ä»£å‘ç”Ÿçš„ GC ç§°ä¸º Old GCï¼ˆä¹Ÿç§°ä¸º Full GCï¼‰ã€‚</p><p><img src="720.png" alt="æ–°ç”Ÿä»£è€å¹´ä»£"></p><h4 id="åˆ†ä»£æ”¶é›†å·¥ä½œåŸç†"><a href="#åˆ†ä»£æ”¶é›†å·¥ä½œåŸç†" class="headerlink" title="åˆ†ä»£æ”¶é›†å·¥ä½œåŸç†"></a>åˆ†ä»£æ”¶é›†å·¥ä½œåŸç†</h4><p><strong>1ã€å¯¹è±¡åœ¨æ–°ç”Ÿä»£çš„åˆ†é…ä¸å›æ”¶</strong></p><p>ç”±ä»¥ä¸Šçš„åˆ†æå¯çŸ¥ï¼Œå¤§éƒ¨åˆ†å¯¹è±¡åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…éƒ½ä¼šè¢«å›æ”¶ï¼Œå¯¹è±¡ä¸€èˆ¬åˆ†é…åœ¨ Eden åŒº</p><p><img src="730.png" alt="img"></p><p>å½“ Eden åŒºå°†æ»¡æ—¶ï¼Œè§¦å‘ Minor GC<img src="740.png" alt="img"></p><p>æˆ‘ä»¬ä¹‹å‰æ€ä¹ˆè¯´æ¥ç€ï¼Œå¤§éƒ¨åˆ†å¯¹è±¡åœ¨çŸ­æ—¶é—´å†…éƒ½ä¼šè¢«å›æ”¶, æ‰€ä»¥ç»è¿‡ Minor GC ååªæœ‰å°‘éƒ¨åˆ†å¯¹è±¡ä¼šå­˜æ´»ï¼Œå®ƒä»¬ä¼šè¢«ç§»åˆ° S0 åŒºï¼ˆè¿™å°±æ˜¯ä¸ºå•¥ç©ºé—´å¤§å°  Eden: S0: S1 = 8:1:1, Eden åŒºè¿œå¤§äº S0,S1 çš„åŸå› ï¼Œå› ä¸ºåœ¨ Eden åŒºè§¦å‘çš„ Minor GC æŠŠå¤§éƒ¨å¯¹è±¡ï¼ˆæ¥è¿‘98%ï¼‰éƒ½å›æ”¶äº†,åªç•™ä¸‹å°‘é‡å­˜æ´»çš„å¯¹è±¡ï¼Œæ­¤æ—¶æŠŠå®ƒä»¬ç§»åˆ° S0 æˆ– S1 ç»°ç»°æœ‰ä½™ï¼‰åŒæ—¶å¯¹è±¡å¹´é¾„åŠ ä¸€ï¼ˆå¯¹è±¡çš„å¹´é¾„å³å‘ç”Ÿ Minor GC çš„æ¬¡æ•°ï¼‰ï¼Œæœ€åæŠŠ Eden åŒºå¯¹è±¡å…¨éƒ¨æ¸…ç†ä»¥é‡Šæ”¾å‡ºç©ºé—´,åŠ¨å›¾å¦‚ä¸‹</p><p><img src="750.gif" alt="img"></p><p>å½“è§¦å‘ä¸‹ä¸€æ¬¡ Minor GC æ—¶ï¼Œä¼šæŠŠ Eden åŒºçš„å­˜æ´»å¯¹è±¡å’Œ S0ï¼ˆæˆ–S1ï¼‰ ä¸­çš„å­˜æ´»å¯¹è±¡ï¼ˆS0 æˆ– S1 ä¸­çš„å­˜æ´»å¯¹è±¡ç»è¿‡æ¯æ¬¡ Minor GC éƒ½å¯èƒ½è¢«å›æ”¶ï¼‰ä¸€èµ·ç§»åˆ° S1ï¼ˆEden å’Œ S0 çš„å­˜æ´»å¯¹è±¡å¹´é¾„+1ï¼‰, åŒæ—¶æ¸…ç©º Eden å’Œ S0 çš„ç©ºé—´ã€‚<img src="760.gif" alt="img"></p><p>è‹¥å†è§¦å‘ä¸‹ä¸€æ¬¡ Minor GCï¼Œåˆ™é‡å¤ä¸Šä¸€æ­¥ï¼Œåªä¸è¿‡æ­¤æ—¶å˜æˆäº† ä» Edenï¼ŒS1 åŒºå°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ° S0 åŒº,æ¯æ¬¡åƒåœ¾å›æ”¶, S0, S1 è§’è‰²äº’æ¢ï¼Œéƒ½æ˜¯ä» Eden ,S0(æˆ–S1) å°†å­˜æ´»å¯¹è±¡ç§»åŠ¨åˆ° S1(æˆ–S0)ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ Eden åŒºçš„åƒåœ¾å›æ”¶æˆ‘ä»¬é‡‡ç”¨çš„æ˜¯<strong>å¤åˆ¶ç®—æ³•</strong>ï¼Œå› ä¸ºåœ¨ Eden åŒºåˆ†é…çš„å¯¹è±¡å¤§éƒ¨åˆ†åœ¨ Minor GC åéƒ½æ¶ˆäº¡äº†ï¼Œåªå‰©ä¸‹æå°‘éƒ¨åˆ†å­˜æ´»å¯¹è±¡ï¼ˆè¿™ä¹Ÿæ˜¯ä¸ºå•¥ Eden:S0:S1 é»˜è®¤ä¸º 8:1:1 çš„åŸå› ï¼‰ï¼ŒS0,S1 åŒºåŸŸä¹Ÿæ¯”è¾ƒå°ï¼Œæ‰€ä»¥æœ€å¤§é™åº¦åœ°é™ä½äº†å¤åˆ¶ç®—æ³•é€ æˆçš„å¯¹è±¡é¢‘ç¹æ‹·è´å¸¦æ¥çš„å¼€é”€ã€‚</p><p><strong>2ã€å¯¹è±¡ä½•æ—¶æ™‹å‡è€å¹´ä»£</strong></p><ul><li>å½“å¯¹è±¡çš„å¹´é¾„è¾¾åˆ°äº†æˆ‘ä»¬è®¾å®šçš„é˜ˆå€¼ï¼Œåˆ™ä¼šä»S0ï¼ˆæˆ–S1ï¼‰æ™‹å‡åˆ°è€å¹´ä»£<img src="770.gif" alt="img">å¦‚å›¾ç¤ºï¼šå¹´é¾„é˜ˆå€¼è®¾ç½®ä¸º 15ï¼Œ å½“å‘ç”Ÿä¸‹ä¸€æ¬¡ Minor GC æ—¶ï¼ŒS0 ä¸­æœ‰ä¸ªå¯¹è±¡å¹´é¾„è¾¾åˆ° 15ï¼Œè¾¾åˆ°æˆ‘ä»¬çš„è®¾å®šé˜ˆå€¼ï¼Œæ™‹å‡åˆ°è€å¹´ä»£ï¼</li><li>å¤§å¯¹è±¡ å½“æŸä¸ªå¯¹è±¡åˆ†é…éœ€è¦å¤§é‡çš„è¿ç»­å†…å­˜æ—¶ï¼Œæ­¤æ—¶å¯¹è±¡çš„åˆ›å»ºä¸ä¼šåˆ†é…åœ¨ Eden åŒºï¼Œä¼šç›´æ¥åˆ†é…åœ¨è€å¹´ä»£ï¼Œå› ä¸ºå¦‚æœæŠŠå¤§å¯¹è±¡åˆ†é…åœ¨ Eden åŒº, Minor GC åå†ç§»åŠ¨åˆ° S0,S1 ä¼šæœ‰å¾ˆå¤§çš„å¼€é”€ï¼ˆå¯¹è±¡æ¯”è¾ƒå¤§ï¼Œå¤åˆ¶ä¼šæ¯”è¾ƒæ…¢ï¼Œä¹Ÿå ç©ºé—´ï¼‰ï¼Œä¹Ÿå¾ˆå¿«ä¼šå æ»¡ S0,S1 åŒºï¼Œæ‰€ä»¥å¹²è„†å°±ç›´æ¥ç§»åˆ°è€å¹´ä»£.</li><li>è¿˜æœ‰ä¸€ç§æƒ…å†µä¹Ÿä¼šè®©å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£ï¼Œå³åœ¨ S0ï¼ˆæˆ–S1ï¼‰ åŒºç›¸åŒå¹´é¾„çš„å¯¹è±¡å¤§å°ä¹‹å’Œå¤§äº S0ï¼ˆæˆ–S1ï¼‰ç©ºé—´ä¸€åŠä»¥ä¸Šæ—¶ï¼Œåˆ™å¹´é¾„å¤§äºç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡ä¹Ÿä¼šæ™‹å‡åˆ°è€å¹´ä»£ã€‚</li></ul><p><strong>3ã€ç©ºé—´åˆ†é…æ‹…ä¿</strong></p><p>åœ¨å‘ç”Ÿ MinorGC ä¹‹å‰ï¼Œè™šæ‹Ÿæœºä¼šå…ˆæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡çš„æ€»ç©ºé—´ï¼Œå¦‚æœå¤§äºï¼Œé‚£ä¹ˆMinor GC å¯ä»¥ç¡®ä¿æ˜¯å®‰å…¨çš„,å¦‚æœä¸å¤§äºï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºä¼šæŸ¥çœ‹ HandlePromotionFailure è®¾ç½®å€¼æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥ã€‚å¦‚æœå…è®¸ï¼Œé‚£ä¹ˆä¼šç»§ç»­æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œå¦‚æœå¤§äºåˆ™è¿›è¡Œ Minor GCï¼Œå¦åˆ™å¯èƒ½è¿›è¡Œä¸€æ¬¡ Full GCã€‚</p><p><strong>4ã€Stop The World</strong></p><p>å¦‚æœè€å¹´ä»£æ»¡äº†ï¼Œä¼šè§¦å‘ Full GC, Full GC ä¼šåŒæ—¶å›æ”¶æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼ˆå³å¯¹æ•´ä¸ªå †è¿›è¡ŒGCï¼‰ï¼Œå®ƒä¼šå¯¼è‡´ Stop The Worldï¼ˆç®€ç§° STWï¼‰,é€ æˆæŒºå¤§çš„æ€§èƒ½å¼€é”€ã€‚</p><p>ä»€ä¹ˆæ˜¯ STW ï¼Ÿæ‰€è°“çš„ STW, å³åœ¨ GCï¼ˆminor GC æˆ– Full GCï¼‰æœŸé—´ï¼Œåªæœ‰åƒåœ¾å›æ”¶å™¨çº¿ç¨‹åœ¨å·¥ä½œï¼Œå…¶ä»–å·¥ä½œçº¿ç¨‹åˆ™è¢«æŒ‚èµ·ã€‚</p><p><img src="780.png" alt="img"></p><p><em>ç”»å¤–éŸ³ï¼šä¸ºå•¥åœ¨åƒåœ¾æ”¶é›†æœŸé—´å…¶ä»–å·¥ä½œçº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Ÿæƒ³è±¡ä¸€ä¸‹ï¼Œä½ ä¸€è¾¹åœ¨æ”¶åƒåœ¾ï¼Œå¦å¤–ä¸€ç¾¤äººä¸€è¾¹ä¸¢åƒåœ¾ï¼Œåƒåœ¾èƒ½æ”¶æ‹¾å¹²å‡€å—ã€‚</em></p><p>ä¸€èˆ¬ Full GC ä¼šå¯¼è‡´å·¥ä½œçº¿ç¨‹åœé¡¿æ—¶é—´è¿‡é•¿ï¼ˆå› ä¸ºFull GC ä¼šæ¸…ç†<strong>æ•´ä¸ªå †</strong>ä¸­çš„ä¸å¯ç”¨å¯¹è±¡ï¼Œä¸€èˆ¬è¦èŠ±è¾ƒé•¿çš„æ—¶é—´ï¼‰ï¼Œå¦‚æœåœ¨æ­¤ server æ”¶åˆ°äº†å¾ˆå¤šè¯·æ±‚ï¼Œåˆ™ä¼šè¢«æ‹’ç»æœåŠ¡ï¼æ‰€ä»¥æˆ‘ä»¬è¦å°½é‡å‡å°‘ Full GCï¼ˆMinor GC ä¹Ÿä¼šé€ æˆ STW,ä½†åªä¼šè§¦å‘è½»å¾®çš„ STW,å› ä¸º Eden åŒºçš„å¯¹è±¡å¤§éƒ¨åˆ†éƒ½è¢«å›æ”¶äº†ï¼Œåªæœ‰æå°‘æ•°å­˜æ´»å¯¹è±¡ä¼šé€šè¿‡å¤åˆ¶ç®—æ³•è½¬ç§»åˆ° S0 æˆ– S1 åŒºï¼Œæ‰€ä»¥ç›¸å¯¹è¿˜å¥½ï¼‰ã€‚</p><p>ç°åœ¨æˆ‘ä»¬åº”è¯¥æ˜ç™½æŠŠæ–°ç”Ÿä»£è®¾ç½®æˆ Eden, S0ï¼ŒS1åŒºæˆ–è€…ç»™å¯¹è±¡è®¾ç½®å¹´é¾„é˜ˆå€¼æˆ–è€…é»˜è®¤æŠŠæ–°ç”Ÿä»£ä¸è€å¹´ä»£çš„ç©ºé—´å¤§å°è®¾ç½®æˆ 1:2 éƒ½æ˜¯ä¸ºäº†<strong>å°½å¯èƒ½åœ°é¿å…å¯¹è±¡è¿‡æ—©åœ°è¿›å…¥è€å¹´ä»£ï¼Œå°½å¯èƒ½æ™šåœ°è§¦å‘ Full GC</strong>ã€‚æƒ³æƒ³æ–°ç”Ÿä»£å¦‚æœåªè®¾ç½® Eden ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œåæœå°±æ˜¯æ¯ç»è¿‡ä¸€æ¬¡ Minor GCï¼Œå­˜æ´»å¯¹è±¡ä¼šè¿‡æ—©åœ°è¿›å…¥è€å¹´ä»£ï¼Œé‚£ä¹ˆè€å¹´ä»£å¾ˆå¿«å°±ä¼šè£…æ»¡ï¼Œå¾ˆå¿«ä¼šè§¦å‘ Full GCï¼Œè€Œå¯¹è±¡å…¶å®åœ¨ç»è¿‡ä¸¤ä¸‰æ¬¡çš„ Minor GC åå¤§éƒ¨åˆ†éƒ½ä¼šæ¶ˆäº¡ï¼Œæ‰€ä»¥æœ‰äº† S0,S1çš„ç¼“å†²ï¼Œåªæœ‰å°‘æ•°çš„å¯¹è±¡ä¼šè¿›å…¥è€å¹´ä»£ï¼Œè€å¹´ä»£å¤§å°ä¹Ÿå°±ä¸ä¼šè¿™ä¹ˆå¿«åœ°å¢é•¿ï¼Œä¹Ÿå°±é¿å…äº†è¿‡æ—©åœ°è§¦å‘ Full GCã€‚</p><p>ç”±äº Full GCï¼ˆæˆ–Minor GCï¼‰ ä¼šå½±å“æ€§èƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åœ¨ä¸€ä¸ªåˆé€‚çš„æ—¶é—´ç‚¹å‘èµ· GCï¼Œè¿™ä¸ªæ—¶é—´ç‚¹è¢«ç§°ä¸º Safe Pointï¼Œè¿™ä¸ªæ—¶é—´ç‚¹çš„é€‰å®šæ—¢ä¸èƒ½å¤ªå°‘ä»¥è®© GC æ—¶é—´å¤ªé•¿å¯¼è‡´ç¨‹åºè¿‡é•¿æ—¶é—´å¡é¡¿ï¼Œä¹Ÿä¸èƒ½è¿‡äºé¢‘ç¹ä»¥è‡³äºè¿‡åˆ†å¢å¤§è¿è¡Œæ—¶çš„è´Ÿè·ã€‚ä¸€èˆ¬å½“çº¿ç¨‹åœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸ŠçŠ¶æ€æ˜¯å¯ä»¥ç¡®å®šçš„ï¼Œå¦‚ç¡®å®š GC Root çš„ä¿¡æ¯ç­‰ï¼Œå¯ä»¥ä½¿ JVM å¼€å§‹å®‰å…¨åœ° GCã€‚Safe Point ä¸»è¦æŒ‡çš„æ˜¯ä»¥ä¸‹ç‰¹å®šä½ç½®ï¼š</p><ul><li>å¾ªç¯çš„æœ«å°¾</li><li>æ–¹æ³•è¿”å›å‰</li><li>è°ƒç”¨æ–¹æ³•çš„ call ä¹‹å</li><li>æŠ›å‡ºå¼‚å¸¸çš„ä½ç½® å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ç”±äºæ–°ç”Ÿä»£çš„ç‰¹ç‚¹ï¼ˆå¤§éƒ¨åˆ†å¯¹è±¡ç»è¿‡ Minor GCåä¼šæ¶ˆäº¡ï¼‰ï¼Œ Minor GC ç”¨çš„æ˜¯å¤åˆ¶ç®—æ³•ï¼Œè€Œåœ¨è€ç”Ÿä»£ç”±äºå¯¹è±¡æ¯”è¾ƒå¤šï¼Œå ç”¨çš„ç©ºé—´è¾ƒå¤§ï¼Œä½¿ç”¨å¤åˆ¶ç®—æ³•ä¼šæœ‰è¾ƒå¤§å¼€é”€ï¼ˆå¤åˆ¶ç®—æ³•åœ¨å¯¹è±¡å­˜æ´»ç‡è¾ƒé«˜æ—¶è¦è¿›è¡Œå¤šæ¬¡å¤åˆ¶æ“ä½œï¼ŒåŒæ—¶æµªè´¹ä¸€åŠç©ºé—´ï¼‰æ‰€ä»¥æ ¹æ®è€ç”Ÿä»£ç‰¹ç‚¹ï¼Œåœ¨è€å¹´ä»£è¿›è¡Œçš„ GC ä¸€èˆ¬é‡‡ç”¨çš„æ˜¯æ ‡è®°æ•´ç†æ³•æ¥è¿›è¡Œå›æ”¶ã€‚</li></ul><h2 id="åƒåœ¾æ”¶é›†å™¨ç§ç±»"><a href="#åƒåœ¾æ”¶é›†å™¨ç§ç±»" class="headerlink" title="åƒåœ¾æ”¶é›†å™¨ç§ç±»"></a>åƒåœ¾æ”¶é›†å™¨ç§ç±»</h2><p>å¦‚æœè¯´æ”¶é›†ç®—æ³•æ˜¯å†…å­˜å›æ”¶çš„æ–¹æ³•è®ºï¼Œé‚£ä¹ˆåƒåœ¾æ”¶é›†å™¨å°±æ˜¯å†…å­˜å›æ”¶çš„å…·ä½“å®ç°ã€‚Java è™šæ‹Ÿæœºè§„èŒƒå¹¶æ²¡æœ‰è§„å®šåƒåœ¾æ”¶é›†å™¨åº”è¯¥å¦‚ä½•å®ç°ï¼Œå› æ­¤ä¸€èˆ¬æ¥è¯´ä¸åŒå‚å•†ï¼Œä¸åŒç‰ˆæœ¬çš„è™šæ‹Ÿæœºæä¾›çš„åƒåœ¾æ”¶é›†å™¨å®ç°å¯èƒ½ä¼šæœ‰å·®åˆ«ï¼Œä¸€èˆ¬ä¼šç»™å‡ºå‚æ•°æ¥è®©ç”¨æˆ·æ ¹æ®åº”ç”¨çš„ç‰¹ç‚¹æ¥ç»„åˆå„ä¸ªå¹´ä»£ä½¿ç”¨çš„æ”¶é›†å™¨ï¼Œä¸»è¦æœ‰ä»¥ä¸‹åƒåœ¾æ”¶é›†å™¨</p><p><img src="790.png" alt="img"></p><ul><li>åœ¨æ–°ç”Ÿä»£å·¥ä½œçš„åƒåœ¾å›æ”¶å™¨ï¼šSerial, ParNew, ParallelScavenge</li><li>åœ¨è€å¹´ä»£å·¥ä½œçš„åƒåœ¾å›æ”¶å™¨ï¼šCMSï¼ŒSerial Old, Parallel Old</li><li>åŒæ—¶åœ¨æ–°è€ç”Ÿä»£å·¥ä½œçš„åƒåœ¾å›æ”¶å™¨ï¼šG1</li></ul><p>å›¾ç‰‡ä¸­çš„åƒåœ¾æ”¶é›†å™¨å¦‚æœå­˜åœ¨è¿çº¿ï¼Œåˆ™ä»£è¡¨å®ƒä»¬ä¹‹é—´å¯ä»¥é…åˆä½¿ç”¨ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹å„ä¸ªåƒåœ¾æ”¶é›†å™¨çš„å…·ä½“åŠŸèƒ½ã€‚</p><h3 id="æ–°ç”Ÿä»£æ”¶é›†å™¨"><a href="#æ–°ç”Ÿä»£æ”¶é›†å™¨" class="headerlink" title="æ–°ç”Ÿä»£æ”¶é›†å™¨"></a>æ–°ç”Ÿä»£æ”¶é›†å™¨</h3><h4 id="Serial-æ”¶é›†å™¨"><a href="#Serial-æ”¶é›†å™¨" class="headerlink" title="Serial æ”¶é›†å™¨"></a>Serial æ”¶é›†å™¨</h4><p>Serial æ”¶é›†å™¨æ˜¯å·¥ä½œåœ¨æ–°ç”Ÿä»£çš„ï¼Œå•çº¿ç¨‹çš„åƒåœ¾æ”¶é›†å™¨ï¼Œå•çº¿ç¨‹æ„å‘³ç€å®ƒåªä¼šä½¿ç”¨ä¸€ä¸ª CPU æˆ–ä¸€ä¸ªæ”¶é›†çº¿ç¨‹æ¥å®Œæˆåƒåœ¾å›æ”¶ï¼Œä¸ä»…å¦‚æ­¤ï¼Œè¿˜è®°å¾—æˆ‘ä»¬ä¸Šæ–‡æåˆ°çš„ STW äº†å—ï¼Œå®ƒåœ¨è¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œå…¶ä»–ç”¨æˆ·çº¿ç¨‹ä¼šæš‚åœï¼Œç›´åˆ°åƒåœ¾æ”¶é›†ç»“æŸï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ GC æœŸé—´ï¼Œæ­¤æ—¶çš„åº”ç”¨ä¸å¯ç”¨ã€‚</p><p>çœ‹èµ·æ¥å•çº¿ç¨‹åƒåœ¾æ”¶é›†å™¨ä¸å¤ªå®ç”¨ï¼Œä¸è¿‡æˆ‘ä»¬éœ€è¦çŸ¥é“çš„ä»»ä½•æŠ€æœ¯çš„ä½¿ç”¨éƒ½ä¸èƒ½è„±ç¦»åœºæ™¯ï¼Œåœ¨ <strong>Client æ¨¡å¼</strong>ä¸‹ï¼Œå®ƒç®€å•æœ‰æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹æ¯”ï¼‰ï¼Œå¯¹äºé™å®šå•ä¸ª CPU çš„ç¯å¢ƒæ¥è¯´ï¼ŒSerial å•çº¿ç¨‹æ¨¡å¼æ— éœ€ä¸å…¶ä»–çº¿ç¨‹äº¤äº’ï¼Œå‡å°‘äº†å¼€é”€ï¼Œä¸“å¿ƒåš GC èƒ½å°†å…¶å•çº¿ç¨‹çš„ä¼˜åŠ¿å‘æŒ¥åˆ°æè‡´ï¼Œå¦å¤–åœ¨ç”¨æˆ·çš„æ¡Œé¢åº”ç”¨åœºæ™¯ï¼Œåˆ†é…ç»™è™šæ‹Ÿæœºçš„å†…å­˜ä¸€èˆ¬ä¸ä¼šå¾ˆå¤§ï¼Œæ”¶é›†å‡ åç”šè‡³ä¸€ä¸¤ç™¾å…†ï¼ˆä»…æ˜¯æ–°ç”Ÿä»£çš„å†…å­˜ï¼Œæ¡Œé¢åº”ç”¨åŸºæœ¬ä¸ä¼šå†å¤§äº†ï¼‰ï¼ŒSTW æ—¶é—´å¯ä»¥æ§åˆ¶åœ¨ä¸€ç™¾å¤šæ¯«ç§’å†…ï¼Œåªè¦ä¸æ˜¯é¢‘ç¹å‘ç”Ÿï¼Œè¿™ç‚¹åœé¡¿æ˜¯å¯ä»¥æ¥å—çš„ï¼Œæ‰€ä»¥å¯¹äºè¿è¡Œåœ¨ Client æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºï¼ŒSerial æ”¶é›†å™¨æ˜¯æ–°ç”Ÿä»£çš„é»˜è®¤æ”¶é›†å™¨</p><h4 id="ParNew-æ”¶é›†å™¨"><a href="#ParNew-æ”¶é›†å™¨" class="headerlink" title="ParNew æ”¶é›†å™¨"></a>ParNew æ”¶é›†å™¨</h4><p>ParNew æ”¶é›†å™¨æ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œé™¤äº†ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œå…¶ä»–åƒæ”¶é›†ç®—æ³•,STW,å¯¹è±¡åˆ†é…è§„åˆ™ï¼Œå›æ”¶ç­–ç•¥ä¸ Serial æ”¶é›†å™¨å®Œæˆä¸€æ ·ï¼Œåœ¨åº•å±‚ä¸Šï¼Œè¿™ä¸¤ç§æ”¶é›†å™¨ä¹Ÿå…±ç”¨äº†ç›¸å½“å¤šçš„ä»£ç ï¼Œå®ƒçš„åƒåœ¾æ”¶é›†è¿‡ç¨‹å¦‚ä¸‹<img src="800.png" alt="img"></p><p>ParNew ä¸»è¦å·¥ä½œåœ¨ Server æ¨¡å¼ï¼Œæˆ‘ä»¬çŸ¥é“æœåŠ¡ç«¯å¦‚æœæ¥æ”¶çš„è¯·æ±‚å¤šäº†ï¼Œå“åº”æ—¶é—´å°±å¾ˆé‡è¦äº†ï¼Œå¤šçº¿ç¨‹å¯ä»¥è®©åƒåœ¾å›æ”¶å¾—æ›´å¿«ï¼Œä¹Ÿå°±æ˜¯å‡å°‘äº† STW æ—¶é—´ï¼Œèƒ½æå‡å“åº”æ—¶é—´ï¼Œæ‰€ä»¥æ˜¯è®¸å¤šè¿è¡Œåœ¨ Server æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºçš„é¦–é€‰æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå¦ä¸€ä¸ªä¸æ€§èƒ½æ— å…³çš„åŸå› æ˜¯å› ä¸ºé™¤äº† Serial  æ”¶é›†å™¨ï¼Œ<strong>åªæœ‰å®ƒèƒ½ä¸ CMS æ”¶é›†å™¨é…åˆå·¥ä½œ</strong>ï¼ŒCMS æ˜¯ä¸€ä¸ªåˆ’æ—¶ä»£çš„åƒåœ¾æ”¶é›†å™¨ï¼Œæ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„<strong>å¹¶å‘æ”¶é›†å™¨</strong>ï¼Œå®ƒç¬¬ä¸€æ¬¡å®ç°äº†åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹ï¼ˆåŸºæœ¬ä¸Šï¼‰åŒæ—¶å·¥ä½œï¼Œå®ƒé‡‡ç”¨çš„æ˜¯ä¼ ç»Ÿçš„ GC æ”¶é›†å™¨ä»£ç æ¡†æ¶ï¼Œä¸ Serial,ParNew å…±ç”¨ä¸€å¥—ä»£ç æ¡†æ¶ï¼Œæ‰€ä»¥èƒ½ä¸è¿™ä¸¤è€…ä¸€èµ·é…åˆå·¥ä½œï¼Œè€Œåæ–‡æåˆ°çš„ Parallel Scavenge ä¸ G1 æ”¶é›†å™¨æ²¡æœ‰ä½¿ç”¨ä¼ ç»Ÿçš„ GC æ”¶é›†å™¨ä»£ç æ¡†æ¶ï¼Œè€Œæ˜¯å¦èµ·ç‚‰ç¶ç‹¬ç«‹å®ç°çš„ï¼Œå¦å¤–ä¸€äº›æ”¶é›†å™¨åˆ™åªæ˜¯å…±ç”¨äº†éƒ¨åˆ†çš„æ¡†æ¶ä»£ç ,æ‰€ä»¥æ— æ³•ä¸ CMS æ”¶é›†å™¨ä¸€èµ·é…åˆå·¥ä½œã€‚</p><p>åœ¨å¤š CPU çš„æƒ…å†µä¸‹ï¼Œç”±äº ParNew çš„å¤šçº¿ç¨‹å›æ”¶ç‰¹æ€§ï¼Œæ¯«æ— ç–‘é—®åƒåœ¾æ”¶é›†ä¼šæ›´å¿«ï¼Œä¹Ÿèƒ½æœ‰æ•ˆåœ°å‡å°‘ STW çš„æ—¶é—´ï¼Œæå‡åº”ç”¨çš„å“åº”é€Ÿåº¦ã€‚</p><h4 id="Parallel-Scavenge-æ”¶é›†å™¨"><a href="#Parallel-Scavenge-æ”¶é›†å™¨" class="headerlink" title="Parallel Scavenge æ”¶é›†å™¨"></a>Parallel Scavenge æ”¶é›†å™¨</h4><p>Parallel Scavenge æ”¶é›†å™¨ä¹Ÿæ˜¯ä¸€ä¸ªä½¿ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>ï¼Œ<strong>å¤šçº¿ç¨‹</strong>ï¼Œå·¥ä½œäºæ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†å™¨ï¼Œçœ‹èµ·æ¥åŠŸèƒ½å’Œ ParNew æ”¶é›†å™¨ä¸€æ ·ï¼Œå®ƒæœ‰å•¥ç‰¹åˆ«ä¹‹å¤„å—</p><p><strong>å…³æ³¨ç‚¹ä¸åŒ</strong>ï¼ŒCMS ç­‰åƒåœ¾æ”¶é›†å™¨å…³æ³¨çš„æ˜¯å°½å¯èƒ½ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼Œè€Œ Parallel Scavenge ç›®æ ‡æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ï¼ˆååé‡ = è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ / ï¼ˆè¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´+åƒåœ¾æ”¶é›†æ—¶é—´ï¼‰ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ CMS ç­‰åƒåœ¾æ”¶é›†å™¨æ›´é€‚åˆç”¨åˆ°ä¸ç”¨æˆ·äº¤äº’çš„ç¨‹åºï¼Œå› ä¸ºåœé¡¿æ—¶é—´è¶ŠçŸ­ï¼Œç”¨æˆ·ä½“éªŒè¶Šå¥½ï¼Œè€Œ Parallel Scavenge æ”¶é›†å™¨å…³æ³¨çš„æ˜¯ååé‡ï¼Œæ‰€ä»¥æ›´é€‚åˆåšåå°è¿ç®—ç­‰ä¸éœ€è¦å¤ªå¤šç”¨æˆ·äº¤äº’çš„ä»»åŠ¡ã€‚</p><p>Parallel Scavenge æ”¶é›†å™¨æä¾›äº†ä¸¤ä¸ªå‚æ•°æ¥ç²¾ç¡®æ§åˆ¶ååé‡ï¼Œåˆ†åˆ«æ˜¯æ§åˆ¶æœ€å¤§åƒåœ¾æ”¶é›†æ—¶é—´çš„ -XX:MaxGCPauseMillis å‚æ•°åŠç›´æ¥è®¾ç½®ååé‡å¤§å°çš„ -XX:GCTimeRatioï¼ˆé»˜è®¤99%ï¼‰</p><p>é™¤äº†ä»¥ä¸Šä¸¤ä¸ªå‚æ•°ï¼Œè¿˜å¯ä»¥ç”¨ Parallel Scavenge æ”¶é›†å™¨æä¾›çš„ç¬¬ä¸‰ä¸ªå‚æ•° -XX:UseAdaptiveSizePolicyï¼Œå¼€å¯è¿™ä¸ªå‚æ•°åï¼Œå°±ä¸éœ€è¦æ‰‹å·¥æŒ‡å®šæ–°ç”Ÿä»£å¤§å°,Eden ä¸ Survivor æ¯”ä¾‹ï¼ˆSurvivorRatioï¼‰ç­‰ç»†èŠ‚ï¼Œåªéœ€è¦è®¾ç½®å¥½åŸºæœ¬çš„å †å¤§å°ï¼ˆ-Xmx è®¾ç½®æœ€å¤§å †ï¼‰,ä»¥åŠæœ€å¤§åƒåœ¾æ”¶é›†æ—¶é—´ä¸ååé‡å¤§å°ï¼Œè™šæ‹Ÿæœºå°±ä¼šæ ¹æ®å½“å‰ç³»ç»Ÿè¿è¡Œæƒ…å†µæ”¶é›†ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´è¿™äº›å‚æ•°ä»¥å°½å¯èƒ½åœ°è¾¾åˆ°æˆ‘ä»¬è®¾å®šçš„æœ€å¤§åƒåœ¾æ”¶é›†æ—¶é—´æˆ–ååé‡å¤§å°è¿™ä¸¤ä¸ªæŒ‡æ ‡ã€‚è‡ªé€‚åº”ç­–ç•¥ä¹Ÿæ˜¯ Parallel Scavenge  ä¸ ParNew çš„é‡è¦åŒºåˆ«ï¼</p><h3 id="è€å¹´ä»£æ”¶é›†å™¨"><a href="#è€å¹´ä»£æ”¶é›†å™¨" class="headerlink" title="è€å¹´ä»£æ”¶é›†å™¨"></a>è€å¹´ä»£æ”¶é›†å™¨</h3><h4 id="Serial-Old-æ”¶é›†å™¨"><a href="#Serial-Old-æ”¶é›†å™¨" class="headerlink" title="Serial Old æ”¶é›†å™¨"></a>Serial Old æ”¶é›†å™¨</h4><p>ä¸Šæ–‡æˆ‘ä»¬çŸ¥é“ï¼Œ Serial æ”¶é›†å™¨æ˜¯å·¥ä½œäºæ–°ç”Ÿä»£çš„å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œä¸ä¹‹ç›¸å¯¹åœ°ï¼ŒSerial Old æ˜¯å·¥ä½œäºè€å¹´ä»£çš„å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œæ­¤æ”¶é›†å™¨çš„ä¸»è¦æ„ä¹‰åœ¨äºç»™ Client æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºä½¿ç”¨ï¼Œå¦‚æœåœ¨ Server æ¨¡å¼ä¸‹ï¼Œåˆ™å®ƒè¿˜æœ‰ä¸¤å¤§ç”¨é€”ï¼šä¸€ç§æ˜¯åœ¨ JDK 1.5 åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ä¸ Parallel Scavenge é…åˆä½¿ç”¨ï¼Œå¦ä¸€ç§æ˜¯ä½œä¸º CMS æ”¶é›†å™¨çš„åå¤‡é¢„æ¡ˆ,åœ¨å¹¶å‘æ”¶é›†å‘ç”Ÿ Concurrent Mode Failure æ—¶ä½¿ç”¨ï¼ˆåæ–‡è®²è¿°ï¼‰,å®ƒä¸ Serial æ”¶é›†å™¨é…åˆä½¿ç”¨ç¤ºæ„å›¾å¦‚ä¸‹</p><p><img src="810.png" alt="img"></p><h4 id="Parallel-Old-æ”¶é›†å™¨"><a href="#Parallel-Old-æ”¶é›†å™¨" class="headerlink" title="Parallel Old æ”¶é›†å™¨"></a>Parallel Old æ”¶é›†å™¨</h4><p>Parallel Old æ˜¯ç›¸å¯¹äº Parallel Scavenge æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä½¿ç”¨å¤šçº¿ç¨‹å’Œæ ‡è®°æ•´ç†æ³•ï¼Œä¸¤è€…ç»„åˆç¤ºæ„å›¾å¦‚ä¸‹,è¿™ä¸¤è€…çš„ç»„åˆç”±äºéƒ½æ˜¯å¤šçº¿ç¨‹æ”¶é›†å™¨ï¼ŒçœŸæ­£å®ç°äº†ã€Œååé‡ä¼˜å…ˆã€çš„ç›®æ ‡</p><p><img src="820.png" alt="img"></p><h4 id="CMS-æ”¶é›†å™¨"><a href="#CMS-æ”¶é›†å™¨" class="headerlink" title="CMS æ”¶é›†å™¨"></a>CMS æ”¶é›†å™¨</h4><p>CMS æ”¶é›†å™¨æ˜¯ä»¥å®ç°æœ€çŸ­ STW æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œå¦‚æœåº”ç”¨å¾ˆé‡è§†æœåŠ¡çš„å“åº”é€Ÿåº¦ï¼Œå¸Œæœ›ç»™ç”¨æˆ·æœ€å¥½çš„ä½“éªŒï¼Œåˆ™ CMS æ”¶é›†å™¨æ˜¯ä¸ªå¾ˆä¸é”™çš„é€‰æ‹©ï¼</p><p>æˆ‘ä»¬ä¹‹å‰è¯´è€å¹´ä»£ä¸»è¦ç”¨æ ‡è®°æ•´ç†æ³•ï¼Œè€Œ CMS è™½ç„¶å·¥ä½œäºè€å¹´ä»£ï¼Œä½†é‡‡ç”¨çš„æ˜¯æ ‡è®°æ¸…é™¤æ³•ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å››ä¸ªæ­¥éª¤</p><ol><li>åˆå§‹æ ‡è®°</li><li>å¹¶å‘æ ‡è®°</li><li>é‡æ–°æ ‡è®°</li><li>å¹¶å‘æ¸…é™¤</li></ol><p><img src="830.png" alt="img"></p><p>ä»å›¾ä¸­å¯ä»¥çš„çœ‹åˆ°åˆå§‹æ ‡è®°å’Œé‡æ–°æ ‡è®°ä¸¤ä¸ªé˜¶æ®µä¼šå‘ç”Ÿ STWï¼Œé€ æˆç”¨æˆ·çº¿ç¨‹æŒ‚èµ·ï¼Œä¸è¿‡åˆå§‹æ ‡è®°ä»…æ ‡è®° GC Roots èƒ½å…³è”çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œå¹¶å‘æ ‡è®°æ˜¯è¿›è¡Œ GC Roots  Tracing çš„è¿‡ç¨‹ï¼Œé‡æ–°æ ‡è®°æ˜¯ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·çº¿ç¨‹ç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œè¿™ä¸€é˜¶æ®µåœé¡¿æ—¶é—´ä¸€èˆ¬æ¯”åˆå§‹æ ‡è®°é˜¶æ®µç¨é•¿ï¼Œä½†<strong>è¿œæ¯”å¹¶å‘æ ‡è®°æ—¶é—´çŸ­</strong>ã€‚</p><p>æ•´ä¸ªè¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿çš„æ˜¯å¹¶å‘æ ‡è®°å’Œæ ‡è®°æ¸…ç†ï¼Œä¸è¿‡è¿™ä¸¤ä¸ªé˜¶æ®µç”¨æˆ·çº¿ç¨‹éƒ½å¯å·¥ä½œï¼Œæ‰€ä»¥ä¸å½±å“åº”ç”¨çš„æ­£å¸¸ä½¿ç”¨ï¼Œæ‰€ä»¥æ€»ä½“ä¸Šçœ‹ï¼Œå¯ä»¥è®¤ä¸º CMS æ”¶é›†å™¨çš„å†…å­˜å›æ”¶è¿‡ç¨‹æ˜¯ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å¹¶å‘æ‰§è¡Œçš„ã€‚</p><p>ä½†æ˜¯ CMS æ”¶é›†å™¨è¿œè¾¾ä¸åˆ°å®Œç¾çš„ç¨‹åº¦ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªç¼ºç‚¹</p><ul><li>CMS æ”¶é›†å™¨å¯¹ CPU èµ„æºéå¸¸æ•æ„Ÿ  åŸå› ä¹Ÿå¯ä»¥ç†è§£ï¼Œæ¯”å¦‚æœ¬æ¥æˆ‘æœ¬æ¥å¯ä»¥æœ‰ 10 ä¸ªç”¨æˆ·çº¿ç¨‹å¤„ç†è¯·æ±‚ï¼Œç°åœ¨å´è¦åˆ†å‡º 3 ä¸ªä½œä¸ºå›æ”¶çº¿ç¨‹ï¼Œååé‡ä¸‹é™äº†30%ï¼ŒCMS é»˜è®¤å¯åŠ¨çš„å›æ”¶çº¿ç¨‹æ•°æ˜¯ ï¼ˆCPUæ•°é‡+3ï¼‰/ 4, å¦‚æœ CPU æ•°é‡åªæœ‰ä¸€ä¸¤ä¸ªï¼Œé‚£ååé‡å°±ç›´æ¥ä¸‹é™ 50%,æ˜¾ç„¶æ˜¯ä¸å¯æ¥å—çš„</li><li>CMS æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼ˆFloating Garbageï¼‰,å¯èƒ½å‡ºç° ã€ŒConcurrent Mode Failureã€è€Œå¯¼è‡´å¦ä¸€æ¬¡ Full GC çš„äº§ç”Ÿï¼Œç”±äºåœ¨å¹¶å‘æ¸…ç†é˜¶æ®µç”¨æˆ·çº¿ç¨‹è¿˜åœ¨è¿è¡Œï¼Œæ‰€ä»¥æ¸…ç†çš„åŒæ—¶æ–°çš„åƒåœ¾ä¹Ÿåœ¨ä¸æ–­å‡ºç°ï¼Œè¿™éƒ¨åˆ†åƒåœ¾åªèƒ½åœ¨ä¸‹ä¸€æ¬¡ GC æ—¶å†æ¸…ç†æ‰ï¼ˆå³æµ®äº‘åƒåœ¾ï¼‰ï¼ŒåŒæ—¶åœ¨åƒåœ¾æ”¶é›†é˜¶æ®µç”¨æˆ·çº¿ç¨‹ä¹Ÿè¦ç»§ç»­è¿è¡Œï¼Œå°±éœ€è¦é¢„ç•™è¶³å¤Ÿå¤šçš„ç©ºé—´è¦ç¡®ä¿ç”¨æˆ·çº¿ç¨‹æ­£å¸¸æ‰§è¡Œï¼Œè¿™å°±æ„å‘³ç€ CMS æ”¶é›†å™¨ä¸èƒ½åƒå…¶ä»–æ”¶é›†å™¨ä¸€æ ·ç­‰è€å¹´ä»£æ»¡äº†å†ä½¿ç”¨ï¼ŒJDK 1.5 é»˜è®¤å½“è€å¹´ä»£ä½¿ç”¨äº†68%ç©ºé—´åå°±ä¼šè¢«æ¿€æ´»ï¼Œå½“ç„¶è¿™ä¸ªæ¯”ä¾‹å¯ä»¥é€šè¿‡ -XX:CMSInitiatingOccupancyFraction æ¥è®¾ç½®ï¼Œä½†æ˜¯å¦‚æœè®¾ç½®åœ°å¤ªé«˜å¾ˆå®¹æ˜“å¯¼è‡´åœ¨ CMS è¿è¡ŒæœŸé—´é¢„ç•™çš„å†…å­˜æ— æ³•æ»¡è¶³ç¨‹åºè¦æ±‚ï¼Œä¼šå¯¼è‡´ <strong>Concurrent Mode Failure</strong> å¤±è´¥ï¼Œè¿™æ—¶ä¼šå¯ç”¨ Serial Old æ”¶é›†å™¨æ¥é‡æ–°è¿›è¡Œè€å¹´ä»£çš„æ”¶é›†ï¼Œè€Œæˆ‘ä»¬çŸ¥é“ Serial Old æ”¶é›†å™¨æ˜¯å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ STW æ›´é•¿äº†ã€‚</li><li>CMS é‡‡ç”¨çš„æ˜¯æ ‡è®°æ¸…é™¤æ³•ï¼Œä¸Šæ–‡æˆ‘ä»¬å·²ç»æåˆ°è¿™ç§æ–¹æ³•ä¼šäº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œè¿™æ ·ä¼šç»™å¤§å†…å­˜åˆ†é…å¸¦æ¥å¾ˆå¤§çš„éº»çƒ¦ï¼Œå¦‚æœæ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§çš„è¿ç»­ç©ºé—´æ¥åˆ†é…å¯¹è±¡ï¼Œå°†ä¼šè§¦å‘ Full GCï¼Œè¿™ä¼šå½±å“åº”ç”¨çš„æ€§èƒ½ã€‚å½“ç„¶æˆ‘ä»¬å¯ä»¥å¼€å¯ -XX:+UseCMSCompactAtFullCollectionï¼ˆé»˜è®¤æ˜¯å¼€å¯çš„ï¼‰ï¼Œç”¨äºåœ¨ CMS æ”¶é›†å™¨é¡¶ä¸ä½è¦è¿›è¡Œ FullGC æ—¶å¼€å¯å†…å­˜ç¢ç‰‡çš„åˆå¹¶æ•´ç†è¿‡ç¨‹ï¼Œå†…å­˜æ•´ç†ä¼šå¯¼è‡´ STWï¼Œåœé¡¿æ—¶é—´ä¼šå˜é•¿ï¼Œè¿˜å¯ä»¥ç”¨å¦ä¸€ä¸ªå‚æ•° -XX:CMSFullGCsBeforeCompation ç”¨æ¥è®¾ç½®æ‰§è¡Œå¤šå°‘æ¬¡ä¸å‹ç¼©çš„ Full GC åè·Ÿç€å¸¦æ¥ä¸€æ¬¡å¸¦å‹ç¼©çš„ã€‚</li></ul><h4 id="G1ï¼ˆGarbage-Firstï¼‰-æ”¶é›†å™¨"><a href="#G1ï¼ˆGarbage-Firstï¼‰-æ”¶é›†å™¨" class="headerlink" title="G1ï¼ˆGarbage Firstï¼‰ æ”¶é›†å™¨"></a>G1ï¼ˆGarbage Firstï¼‰ æ”¶é›†å™¨</h4><p>G1 æ”¶é›†å™¨æ˜¯é¢å‘æœåŠ¡ç«¯çš„åƒåœ¾æ”¶é›†å™¨ï¼Œè¢«ç§°ä¸ºé©¾é©­ä¸€åˆ‡çš„åƒåœ¾å›æ”¶å™¨ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹</p><ul><li><p>åƒ CMS æ”¶é›†å™¨ä¸€æ ·ï¼Œèƒ½ä¸åº”ç”¨ç¨‹åºçº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚</p></li><li><p>æ•´ç†ç©ºé—²ç©ºé—´æ›´å¿«ã€‚</p></li><li><p>éœ€è¦ GC åœé¡¿æ—¶é—´æ›´å¥½é¢„æµ‹ã€‚</p></li><li><p>ä¸ä¼šåƒ CMS é‚£æ ·ç‰ºç‰²å¤§é‡çš„ååæ€§èƒ½ã€‚</p></li><li><p>ä¸éœ€è¦æ›´å¤§çš„ Java Heap</p></li></ul><p>ä¸ CMS ç›¸æ¯”ï¼Œå®ƒåœ¨ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢è¡¨ç°æ›´å‡ºè‰²</p><ol><li>è¿ä½œæœŸé—´ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼ŒG1 ä»æ•´ä½“ä¸Šçœ‹é‡‡ç”¨çš„æ˜¯æ ‡è®°-æ•´ç†æ³•ï¼Œå±€éƒ¨ï¼ˆä¸¤ä¸ª Regionï¼‰ä¸Šçœ‹æ˜¯åŸºäºå¤åˆ¶ç®—æ³•å®ç°çš„ï¼Œä¸¤ä¸ªç®—æ³•éƒ½ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œæ”¶é›†åæä¾›è§„æ•´çš„å¯ç”¨å†…å­˜ï¼Œè¿™æ ·æœ‰åˆ©äºç¨‹åºçš„é•¿æ—¶é—´è¿è¡Œã€‚</li><li>åœ¨ STW ä¸Šå»ºç«‹äº†<strong>å¯é¢„æµ‹</strong>çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œç”¨æˆ·å¯ä»¥æŒ‡å®šæœŸæœ›åœé¡¿æ—¶é—´ï¼ŒG1 ä¼šå°†åœé¡¿æ—¶é—´æ§åˆ¶åœ¨ç”¨æˆ·è®¾å®šçš„åœé¡¿æ—¶é—´ä»¥å†…ã€‚</li></ol><p>ä¸ºä»€ä¹ˆG1èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ¨¡å‹å‘¢ï¼Œä¸»è¦åŸå› åœ¨äº G1 å¯¹å †ç©ºé—´çš„åˆ†é…ä¸ä¼ ç»Ÿçš„åƒåœ¾æ”¶é›†å™¨ä¸ä¸€å™¨ï¼Œä¼ ç»Ÿçš„å†…å­˜åˆ†é…å°±åƒæˆ‘ä»¬å‰æ–‡æ‰€è¿°ï¼Œæ˜¯è¿ç»­çš„ï¼Œåˆ†æˆæ–°ç”Ÿä»£ï¼Œè€å¹´ä»£ï¼Œæ–°ç”Ÿä»£åˆåˆ† Eden,S0,S1,å¦‚ä¸‹</p><p><img src="840.png" alt="img"><br>è€Œ G1 å„ä»£çš„å­˜å‚¨åœ°å€ä¸æ˜¯è¿ç»­çš„ï¼Œæ¯ä¸€ä»£éƒ½ä½¿ç”¨äº† n ä¸ªä¸è¿ç»­çš„å¤§å°ç›¸åŒçš„ Regionï¼Œæ¯ä¸ªRegionå æœ‰ä¸€å—è¿ç»­çš„è™šæ‹Ÿå†…å­˜åœ°å€ï¼Œå¦‚å›¾ç¤º</p><p><img src="850.png" alt="img"><br>é™¤äº†å’Œä¼ ç»Ÿçš„æ–°è€ç”Ÿä»£ï¼Œå¹¸å­˜åŒºçš„ç©ºé—´åŒºåˆ«ï¼ŒRegionè¿˜å¤šäº†ä¸€ä¸ªHï¼Œå®ƒä»£è¡¨Humongousï¼Œè¿™è¡¨ç¤ºè¿™äº›Regionå­˜å‚¨çš„æ˜¯å·¨å¤§å¯¹è±¡ï¼ˆhumongous objectï¼ŒH-objï¼‰ï¼Œå³å¤§å°å¤§äºç­‰äºregionä¸€åŠçš„å¯¹è±¡ï¼Œè¿™æ ·è¶…å¤§å¯¹è±¡å°±ç›´æ¥åˆ†é…åˆ°äº†è€å¹´ä»£ï¼Œé˜²æ­¢äº†åå¤æ‹·è´ç§»åŠ¨ã€‚é‚£ä¹ˆ G1 åˆ†é…æˆè¿™æ ·æœ‰å•¥å¥½å¤„å‘¢ï¼Ÿ</p><p>ä¼ ç»Ÿçš„æ”¶é›†å™¨å¦‚æœå‘ç”Ÿ Full GC æ˜¯å¯¹æ•´ä¸ªå †è¿›è¡Œå…¨åŒºåŸŸçš„åƒåœ¾æ”¶é›†ï¼Œè€Œåˆ†é…æˆå„ä¸ª Region çš„è¯ï¼Œæ–¹ä¾¿ G1 è·Ÿè¸ªå„ä¸ª Region é‡Œåƒåœ¾å †ç§¯çš„ä»·å€¼å¤§å°ï¼ˆå›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°åŠå›æ”¶æ‰€éœ€ç»éªŒå€¼ï¼‰ï¼Œè¿™æ ·æ ¹æ®ä»·å€¼å¤§å°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆæ”¶é›†å›æ”¶ä»·å€¼æœ€å¤§çš„ Region,ä¹Ÿå°±é¿å…äº†æ•´ä¸ªè€å¹´ä»£çš„å›æ”¶ï¼Œä¹Ÿå°±å‡å°‘äº† STW é€ æˆçš„åœé¡¿æ—¶é—´ã€‚åŒæ—¶ç”±äºåªæ”¶é›†éƒ¨åˆ† Region,å¯å°±åšåˆ°äº† STW æ—¶é—´çš„å¯æ§ã€‚</p><p>G1 æ”¶é›†å™¨çš„å·¥ä½œæ­¥éª¤å¦‚ä¸‹</p><ol><li>åˆå§‹æ ‡è®°</li><li>å¹¶å‘æ ‡è®°</li><li>æœ€ç»ˆæ ‡è®°</li><li>ç­›é€‰å›æ”¶</li></ol><p><img src="860.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°æ•´ä½“è¿‡ç¨‹ä¸ CMS æ”¶é›†å™¨éå¸¸ç±»ä¼¼ï¼Œç­›é€‰é˜¶æ®µä¼šæ ¹æ®å„ä¸ª Region çš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æœŸæœ›çš„ GC åœé¡¿æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
            <tag> GC </tag>
            
            <tag> åƒåœ¾å›æ”¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é‚£äº›å¹´æˆ‘ä»¬å­¦è¿‡çš„è®¾è®¡æ¨¡å¼ï¼Œä½ è¿˜è®°å¾—å‡ ä¸ªï¼ˆä¸€ï¼‰</title>
      <link href="2020/09/25/%E9%82%A3%E4%BA%9B%E5%B9%B4%E6%88%91%E4%BB%AC%E5%AD%A6%E8%BF%87%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%8C%E4%BD%A0%E8%BF%98%E8%AE%B0%E5%BE%97%E5%87%A0%E4%B8%AA%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>2020/09/25/%E9%82%A3%E4%BA%9B%E5%B9%B4%E6%88%91%E4%BB%AC%E5%AD%A6%E8%BF%87%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%8C%E4%BD%A0%E8%BF%98%E8%AE%B0%E5%BE%97%E5%87%A0%E4%B8%AA%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨å¿™ç€é¢è¯•ï¼Œè¶ç€æ²¡å·¥ä½œçš„ç©ºé—²æœŸï¼Œæƒ³æŠŠè®¾è®¡æ¨¡å¼å¥½å¥½æ•´ç†ä¸€éã€‚è¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ç›´æ¥ä¸Šç¬¬ä¸€ä¸ªè®¾è®¡æ¨¡å¼â€”-<code>å•ä¾‹æ¨¡å¼</code></p><h2 id="ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼"></a>ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼</h2><p>è¿™ä¹Ÿæ˜¯é¢è¯•æ—¶é¢è¯•å®˜ç»å¸¸é—®æˆ‘çš„é—®é¢˜ï¼Œä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ï¼Ÿè„‘æµ·ä¸­æ˜¯ä¸æ˜¯ç«‹å³æµ®ç°å‡ºä¸¤ç§å•ä¾‹æ¨¡å¼ã€‚ç„¶åå‡†å¤‡æ»”æ»”ä¸ç»çš„è¯´ç»™é¢è¯•å®˜å¬ï¼Ÿé¢è¯•å®˜åœ¨é—®æˆ‘ä»¬è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬æœ€å¥½ä¸è¦ç­”éæ‰€é—®ã€‚æœ€å¥½æ ¹æ®å•ä¾‹æ¨¡å¼çš„å®šä¹‰å»æ­£é¢å›ç­”é¢è¯•å®˜ã€‚</p><p>å•ä¾‹æ¨¡å¼æ˜¯æŒ‡åœ¨å†…å­˜ä¸­åªä¼šåˆ›å»ºä¸”ä»…åˆ›å»ºä¸€æ¬¡å¯¹è±¡çš„è®¾è®¡æ¨¡å¼ã€‚åœ¨ç¨‹åºä¸­å¤šæ¬¡ä½¿ç”¨åŒä¸€ä¸ªå¯¹è±¡ä¸”ä½œç”¨ç›¸åŒæ—¶ï¼Œä¸ºäº†é˜²æ­¢é¢‘ç¹åœ°åˆ›å»ºå¯¹è±¡ä½¿å¾—å†…å­˜é£™å‡ï¼Œå•ä¾‹æ¨¡å¼å¯ä»¥è®©ç¨‹åºä»…åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè®©æ‰€æœ‰éœ€è¦è°ƒç”¨çš„åœ°æ–¹éƒ½å…±äº«è¿™ä¸€å•ä¾‹å¯¹è±¡ã€‚</p><p><img src="dlms1.jpg" alt="å•ä¾‹æ¨¡å¼å®šä¹‰"></p><h2 id="å•ä¾‹æ¨¡å¼åˆ›å»ºç±»å‹"><a href="#å•ä¾‹æ¨¡å¼åˆ›å»ºç±»å‹" class="headerlink" title="å•ä¾‹æ¨¡å¼åˆ›å»ºç±»å‹"></a>å•ä¾‹æ¨¡å¼åˆ›å»ºç±»å‹</h2><ul><li><p><code>æ‡’æ±‰å¼</code>ï¼šåœ¨è¢«ç¨‹åºç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™æ‰åˆå§‹åŒ–è¯¥å•ä¾‹å¯¹è±¡</p></li><li><p><code>é¥¿æ±‰å¼</code>ï¼šåœ¨ç±»åŠ è½½çš„æ—¶å€™å°±å·²ç»åˆ›å»ºå¥½è¯¥å•ä¾‹å¯¹è±¡</p></li></ul><h3 id="æ‡’æ±‰å¼åˆ›å»ºå•ä¾‹å¯¹è±¡"><a href="#æ‡’æ±‰å¼åˆ›å»ºå•ä¾‹å¯¹è±¡" class="headerlink" title="æ‡’æ±‰å¼åˆ›å»ºå•ä¾‹å¯¹è±¡"></a>æ‡’æ±‰å¼åˆ›å»ºå•ä¾‹å¯¹è±¡</h3><p>æ‡’æ±‰å¼åªåœ¨ç¨‹åºç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™åˆ›å»ºå¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦è°ƒç”¨çš„æ—¶å€™éœ€è¦åˆ¤æ–­æ˜¯å¦å·²ç»å®ä¾‹åŒ–è¯¥å¯¹è±¡ï¼Œå¦‚æœæœªå®ä¾‹åŒ–ï¼Œåˆ™å®ä¾‹åŒ–è¯¥å¯¹è±¡ã€‚</p><p><img src="lhs.png" alt="æ‡’æ±‰å¼"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LazySingleTon</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazySingleTon singleTon;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LazySingleTon</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LazySingleTon <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(singleTon==<span class="keyword">null</span>)&#123;</span><br><span class="line">            singleTon = <span class="keyword">new</span> LazySingleTon();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> singleTon;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åé¢å†è®²è¿™æ®µä»£ç çš„ä¼˜åŒ–ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬äºŒç§å•ä¾‹æ¨¡å¼çš„å®ç°ã€‚</p><h3 id="é¥¿æ±‰å¼åˆ›å»ºå•ä¾‹å¯¹è±¡"><a href="#é¥¿æ±‰å¼åˆ›å»ºå•ä¾‹å¯¹è±¡" class="headerlink" title="é¥¿æ±‰å¼åˆ›å»ºå•ä¾‹å¯¹è±¡"></a>é¥¿æ±‰å¼åˆ›å»ºå•ä¾‹å¯¹è±¡</h3><p>é¥¿æ±‰å¼åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±å·²ç»åˆå§‹åŒ–å¥½è¯¥å¯¹è±¡ï¼Œåç»­ç¨‹åºè°ƒç”¨çš„éƒ½æ˜¯è¯¥å¯¹è±¡ã€‚</p><p><img src="ehs.png" alt="é¥¿æ±‰å¼"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HungrySingleTon</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> HungrySingleTon singleTon = <span class="keyword">new</span> HungrySingleTon();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">HungrySingleTon</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HungrySingleTon <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> singleTon;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ç±»åœ¨åŠ è½½æ—¶ä¼šåœ¨å †å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªHungrySingleTonå¯¹è±¡ï¼Œå½“ç±»è¢«å¸è½½æ—¶ï¼ŒHungrySingleTonå¯¹è±¡ä¹Ÿå°±ä¼šè¢«éšä¹‹æ­»äº¡äº†ã€‚</p><h3 id="æ‡’æ±‰å¼ä»£ç å¦‚ä½•ä¼˜åŒ–"><a href="#æ‡’æ±‰å¼ä»£ç å¦‚ä½•ä¼˜åŒ–" class="headerlink" title="æ‡’æ±‰å¼ä»£ç å¦‚ä½•ä¼˜åŒ–"></a>æ‡’æ±‰å¼ä»£ç å¦‚ä½•ä¼˜åŒ–</h3><p>å› ä¸ºä¸Šè¿°æ‡’æ±‰å¼çš„å®ç°å¹¶ä¸èƒ½ä¿è¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯¹è±¡åªè¢«åˆ›å»ºä¸€æ¬¡çš„é—®é¢˜ã€‚å› æ­¤å­˜åœ¨ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ä¸Šé¢æ‡’æ±‰å¼åˆ›å»ºçš„ä¸»è¦å‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LazySingleTon <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(singleTon==<span class="keyword">null</span>)&#123;</span><br><span class="line">            singleTon = <span class="keyword">new</span> LazySingleTon();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> singleTon;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœåŒæ—¶å­˜åœ¨å¤šä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹1åœ¨åˆ¤æ–­äº†<code>singleTon==null</code>åè®©å‡ºäº†cpuçš„ä½¿ç”¨æƒï¼Œè€Œçº¿ç¨‹äºŒè¿™æ—¶å€™è·å–åˆ°äº†cpuçš„ä½¿ç”¨æƒï¼Œä¹Ÿåˆ¤æ–­äº†ä¸€æ¬¡<code>singleTon==null</code>é‚£ä¹ˆçº¿ç¨‹2å°±ä¼šæ‰§è¡Œ<code>singleTon = new LazySingleTon()</code>,å½“çº¿ç¨‹1é‡æ–°è·å–åˆ°cpuçš„ä½¿ç”¨æƒä¹‹åï¼Œå› ä¸ºä»–åˆšåˆ¤æ–­äº†<code>singleTon</code>æ˜¯nullï¼Œæ‰€ä»¥çº¿ç¨‹1ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªLazySingleTonçš„å®ä¾‹ã€‚æ‰€ä»¥å°±å­˜åœ¨äº†<code>çº¿ç¨‹å®‰å…¨</code>çš„é—®é¢˜ã€‚</p><hr><p>æˆ‘ä»¬æœ€å®¹æ˜“æƒ³åˆ°çš„åŠæ³•å°±æ˜¯åŠ é”ï¼Œç»™ç±»å¯¹è±¡åŠ é”æˆ–è€…ç»™æ–¹æ³•åŠ é”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç»™æ–¹æ³•åŠ é”</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> LazySingleTon <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(singleTon==<span class="keyword">null</span>)&#123;</span><br><span class="line">singleTon = <span class="keyword">new</span> LazySingleTon();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> singleTon;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç»™ç±»å¯¹è±¡åŠ é”</span></span><br><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">static</span> LazySingleTon <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(<span class="keyword">this</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(singleTon==<span class="keyword">null</span>)&#123;</span><br><span class="line">singleTon = <span class="keyword">new</span> LazySingleTon();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> singleTon;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†ä¸Šé¢ä¸¤ç§æ–¹æ³•éƒ½å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨è·å–å¯¹è±¡ä¹‹å‰éƒ½è¦å…ˆè·å–é”ï¼Œæ‰€ä»¥å¹¶å‘æ€§èƒ½å°±æ˜¾å¾—å°¤å…¶çš„ä½ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> LazySingleTon <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(singleTon ==<span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">synchronized</span> (LazySingleTon<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (singleTon == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    singleTon = <span class="keyword">new</span> LazySingleTon();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> singleTon;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„å®ç°æ–¹å¼ï¼Œå°±å®Œç¾çš„è§£å†³äº†æ€§èƒ½ä½ä¸‹å’Œé”èµ„æºçš„é—®é¢˜ã€‚</p><ul><li><strong>line2:</strong>å½“singleTonå·²ç»è¢«å®ä¾‹åŒ–çš„æ—¶å€™,ç›´æ¥è¿”å›å¯¹è±¡ï¼Œä¸å†è·å–é”èµ„æº</li><li><strong>line3</strong>:å½“å¤šä¸ªçº¿ç¨‹è¿›å…¥ç¬¬ä¸€ä¸ªifæ—¶ï¼Œæ–½åŠ åŒæ­¥é”ï¼Œæ¯æ¬¡ä»…å…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›å»å½“å‰ä»£ç å—ã€‚</li><li><strong>line4</strong>:é”å†…å†æ¬¡è¿›è¡Œåˆ¤æ–­ï¼Œå› ä¸ºå¤šä¸ªçº¿ç¨‹æŠ¢å¤ºä¸€ä¸ªèµ„æºæ—¶åªæœ‰ä¸€ä¸ªè·å–åˆ°ï¼Œåè¿›å…¥çš„çº¿ç¨‹æ‰€è¦è·å–çš„å¯¹è±¡å·²ç»è¢«ç¬¬ä¸€ä¸ªçº¿ç¨‹å®ä¾‹åŒ–è¿‡ã€‚æ‰€ä»¥éœ€è¦å†æ¬¡åˆ¤æ–­ã€‚</li></ul><p>è¿™å°±æ˜¯å…¸å‹çš„DCLå‹æ‡’æ±‰å•ä¾‹ï¼Œ<code>Double Check and Lock</code>åŒé‡æ ¡éªŒåŠ é”ã€‚ä½†æ˜¯æˆ‘ä»¬åœ¨å†™DCLçš„æ—¶å€™éƒ½ä¼šåŠ å…¥<code>volatile</code>å…³é”®è¯ä¿®é¥°singleTonã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LazySingleTon</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> LazySingleTon singleTon;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LazySingleTon</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LazySingleTon <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(singleTon ==<span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">synchronized</span> (LazySingleTon<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (singleTon == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    singleTon = <span class="keyword">new</span> LazySingleTon();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> singleTon;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸå› æ˜¯å› ä¸ºJVMåœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œå¯ä»¥å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºä»¥æé«˜ç¨‹åºæ€§èƒ½ã€‚JVMåœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šç»è¿‡ä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š</p><ul><li>åˆ†é…å†…å­˜ç©ºé—´</li><li>åˆå§‹åŒ–å¯¹è±¡</li><li>å°†å¯¹è±¡æŒ‡å‘åˆ†é…å¥½çš„å†…å­˜ç©ºé—´</li></ul><p>ä½†æ˜¯åœ¨2å’Œ3çš„æ—¶å€™æœ‰å¯èƒ½å‡ºç°æŒ‡ä»¤é‡æ’ã€‚æ¯”å¦‚å¤šä¸ªçº¿ç¨‹ï¼Œå½“çº¿ç¨‹1æ‰§è¡Œäº†1-3è€Œæ­£åœ¨åˆå§‹åŒ–å¯¹è±¡ï¼Œè€Œçº¿ç¨‹2è·å–å¯¹è±¡æ—¶ï¼Œå°±è·å–åˆ°äº†ä¸€ä¸ªæœªåˆå§‹åŒ–çš„å¯¹è±¡ã€‚å°±ä¼šå‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸äº†ã€‚è€Œvolatileå°±æ˜¯ä¸ºäº†åœ¨JVMåˆ›å»ºå¯¹è±¡çš„æ—¶å€™è¿›è¡Œ<code>ç¦æ­¢æŒ‡ä»¤é‡æ’</code>çš„ã€‚</p><h2 id="è¿˜æœ‰å…¶ä»–çš„å½¢å¼å—"><a href="#è¿˜æœ‰å…¶ä»–çš„å½¢å¼å—" class="headerlink" title="è¿˜æœ‰å…¶ä»–çš„å½¢å¼å—"></a>è¿˜æœ‰å…¶ä»–çš„å½¢å¼å—</h2><h3 id="é™æ€å†…éƒ¨ç±»å®ç°å•ä¾‹"><a href="#é™æ€å†…éƒ¨ç±»å®ç°å•ä¾‹" class="headerlink" title="é™æ€å†…éƒ¨ç±»å®ç°å•ä¾‹"></a>é™æ€å†…éƒ¨ç±»å®ç°å•ä¾‹</h3><p>é™æ€å†…éƒ¨ç±»ç›¸å¯¹äºDCLæ¨¡å¼å®ç°æ›´ç®€å•ï¼Œå¯¹<code>é™æ€åŸŸ</code>ä½¿ç”¨å»¶è¿Ÿåˆå§‹åŒ–ï¼Œåº”ä½¿ç”¨è¿™ç§æ–¹å¼è€Œä¸æ˜¯åŒæ£€é”æ–¹å¼ã€‚è¿™ç§æ–¹å¼åªé€‚ç”¨äºé™æ€åŸŸçš„æƒ…å†µï¼ŒåŒæ£€é”æ–¹å¼å¯åœ¨<code>å®ä¾‹åŸŸ</code>éœ€è¦å»¶è¿Ÿåˆå§‹åŒ–æ—¶ä½¿ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleTon</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> SingleTon INSTANCE = <span class="keyword">new</span> SingleTon();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span> <span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> SingleTon <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æšä¸¾ç±»å®ç°å•ä¾‹"><a href="#æšä¸¾ç±»å®ç°å•ä¾‹" class="headerlink" title="æšä¸¾ç±»å®ç°å•ä¾‹"></a>æšä¸¾ç±»å®ç°å•ä¾‹</h3><p>åœ¨JDK1.5ä¸­ï¼Œjavaå¼•å…¥äº†æšä¸¾ç±»å‹ã€‚æšä¸¾æ˜¯å®ç°å•ä¾‹æ¨¡å¼çš„æœ€ä½³æ–¹æ³•ã€‚å®ƒæ›´ç®€æ´ï¼Œè‡ªåŠ¨æ”¯æŒåºåˆ—åŒ–æœºåˆ¶ï¼Œç»å¯¹é˜²æ­¢å¤šæ¬¡å®ä¾‹åŒ–ã€‚è¿™ç§æ–¹å¼æ˜¯ã€Š Effective Javaã€‹ ä½œè€… Josh Bloch æå€¡çš„æ–¹å¼ï¼Œå®ƒä¸ä»…èƒ½é¿å…å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜ï¼Œè€Œä¸”è¿˜è‡ªåŠ¨æ”¯æŒåºåˆ—åŒ–æœºåˆ¶ï¼Œé˜²æ­¢ååºåˆ—åŒ–é‡æ–°åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</p><p>ä¼˜ç‚¹ä¸è¨€è€Œå–»ï¼š</p><ul><li>å®ç°æ›´ç®€å•</li><li>å¤©ç„¶çš„çº¿ç¨‹å®‰å…¨</li><li>å¯ä»¥é˜²æ­¢åå°„ã€ååºåˆ—åŒ–åˆ›å»ºå¤šä¸ªæšä¸¾å¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Singleton &#123;  </span><br><span class="line">    INSTANCE;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whateverMethod</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç ´åå•ä¾‹æ¨¡å¼"><a href="#ç ´åå•ä¾‹æ¨¡å¼" class="headerlink" title="ç ´åå•ä¾‹æ¨¡å¼"></a>ç ´åå•ä¾‹æ¨¡å¼</h2><p>æšä¸¾æœ¬èº«è‡ªå¸¦é˜²æ­¢åå°„å’Œååºåˆ—åŒ–çš„ç‰¹æ€§ï¼Œé‚£æ‡’æ±‰å¼å’Œé¥¿æ±‰å¼åˆæ˜¯å¦‚ä½•è¢«ç ´åçš„å‘¢</p><h3 id="åå°„ç ´åå•ä¾‹æ¨¡å¼"><a href="#åå°„ç ´åå•ä¾‹æ¨¡å¼" class="headerlink" title="åå°„ç ´åå•ä¾‹æ¨¡å¼"></a>åå°„ç ´åå•ä¾‹æ¨¡å¼</h3><p>ä¸‹é¢æˆ‘ä»¬å°±å¯ä»¥ç”¨åå°„ç›´æ¥å¼ºåˆ¶è®¿é—®ç§æœ‰æ„é€ å™¨ï¼Œå»åˆ›å»ºå®ä¾‹å¯¹è±¡ç ´åå•ä¾‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// è·å–ç±»çš„æ˜¾å¼æ„é€ å™¨</span></span><br><span class="line">    Constructor&lt;HungrySingleTon&gt; construct = HungrySingleTon<span class="class">.<span class="keyword">class</span>.<span class="title">getDeclaredConstructor</span>()</span>;</span><br><span class="line">    <span class="comment">// å¯è®¿é—®ç§æœ‰æ„é€ å™¨</span></span><br><span class="line">    construct.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">// åˆ©ç”¨åå°„æ„é€ æ–°å¯¹è±¡</span></span><br><span class="line">    HungrySingleTon obj1 = construct.newInstance();</span><br><span class="line">    <span class="comment">// é€šè¿‡æ­£å¸¸æ–¹å¼è·å–å•ä¾‹å¯¹è±¡</span></span><br><span class="line">    HungrySingleTon obj2 = HungrySingleTon.getInstance();</span><br><span class="line">    System.out.println(obj1 == obj2); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£å¦‚ä½•é˜²æ­¢å•ä¾‹æ¨¡å¼è¢«åå°„ç ´åå‘¢ï¼Œå› ä¸ºåå°„æ˜¯å¼ºåˆ¶è®¿é—®ç§æœ‰æ„é€ å™¨ï¼Œå¯¹äºé¥¿æ±‰å¼ï¼Œåœ¨ç±»åŠ è½½çš„æ—¶å€™å¯¹è±¡å·²ç»åˆå§‹åŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ç§æœ‰æ„é€ å™¨å¯¹å½“å‰å¯¹è±¡è¿›è¡Œåˆ¤æ–­æ¥è§„é¿åå°„ç ´åå•ä¾‹æ¨¡å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HungrySingleTon</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> HungrySingleTon singleTon = <span class="keyword">new</span> HungrySingleTon();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">HungrySingleTon</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(singleTon!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"ç¦æ­¢é€šè¿‡åå°„å®ä¾‹åŒ–å¯¹è±¡"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HungrySingleTon <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> singleTon;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç ´åå•ä¾‹æ¨¡å¼"><a href="#åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç ´åå•ä¾‹æ¨¡å¼" class="headerlink" title="åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç ´åå•ä¾‹æ¨¡å¼"></a>åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç ´åå•ä¾‹æ¨¡å¼</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªåºåˆ—åŒ–å’Œååºåˆ—åŒ–å»ç ´åå•ä¾‹çš„ä¾‹å­ï¼Œä½†æ˜¯ä½¿ç”¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç ´åå•ä¾‹æ—¶ï¼Œå•ä¾‹å¯¹è±¡çš„ç±»å¿…é¡»å®ç°Serializableæ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HungrySingleTon</span> <span class="keyword">implements</span>  <span class="title">Serializable</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºè¾“å‡ºæµ</span></span><br><span class="line">        ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">"Singleton.file"</span>));</span><br><span class="line">        <span class="comment">// å°†å•ä¾‹å¯¹è±¡å†™åˆ°æ–‡ä»¶ä¸­</span></span><br><span class="line">        oos.writeObject(HungrySingleTon.getInstance());</span><br><span class="line">        <span class="comment">// ä»æ–‡ä»¶ä¸­è¯»å–å•ä¾‹å¯¹è±¡</span></span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">"Singleton.file"</span>);</span><br><span class="line">        ObjectInputStream ois =  <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(file));</span><br><span class="line">        HungrySingleTon newInstance = (HungrySingleTon) ois.readObject();</span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">        System.out.println(newInstance == HungrySingleTon.getInstance()); <span class="comment">// false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> HungrySingleTon singleTon = <span class="keyword">new</span> HungrySingleTon();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">HungrySingleTon</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HungrySingleTon <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> singleTon;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li>å•ä¾‹æ¨¡å¼ä¸»è¦å®ç°æ–¹å¼ä¸ºæ‡’æ±‰å¼ã€é¥¿æ±‰å¼ã€é™æ€å†…éƒ¨ç±»å’Œæšä¸¾</li><li>å¤§éƒ¨åˆ†çš„å•ä¾‹æ¨¡å¼å¯ä»¥è¢«åå°„å’Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ç ´å</li><li>æˆ‘ä»¬å¯ä»¥é€šè¿‡äººä¸ºå¹²é¢„æ¥é¿å…åå°„æˆ–ç³»åˆ—åŒ–æ”»å‡»</li><li>æšä¸¾è‡ªå¸¦å¤©ç„¶çš„çº¿ç¨‹å®‰å…¨å’Œå•ä¸€å®ä¾‹ä»¥åŠé˜²åå°„å’Œé˜²åºåˆ—åŒ–å’Œååºåˆ—ç ´åçš„ç‰¹æ€§</li><li>å¯¹äºæ‡’æ±‰å¼æœ€ä¼˜é›…çš„å†™æ³•åº”è¯¥æ˜¯DCLåŠ volatileä¿®é¥°</li><li>å¯¹å†…å­˜è¦æ±‚é«˜çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥é€‰æ‹©<code>æ‡’åŠ è½½</code>çš„å•ä¾‹å®ç°æ–¹å¼</li></ul>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
            <tag> å•ä¾‹æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
